diff --git a/Event/package.json b/Event/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..d6e95be793a3322eaff3d8976460ec74fcada2c6
--- /dev/null
+++ b/Event/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/Event.js",
+  "module": "../dist/esm/Event.js",
+  "types": "../dist/dts/Event.d.ts",
+  "sideEffects": []
+}
diff --git a/EventGroup/package.json b/EventGroup/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..1d684bd094ea1015242394d3106919345175c422
--- /dev/null
+++ b/EventGroup/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventGroup.js",
+  "module": "../dist/esm/EventGroup.js",
+  "types": "../dist/dts/EventGroup.d.ts",
+  "sideEffects": []
+}
diff --git a/EventJournal/package.json b/EventJournal/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..483f1109b78024aca35573b8b1fe672bf392fcf4
--- /dev/null
+++ b/EventJournal/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventJournal.js",
+  "module": "../dist/esm/EventJournal.js",
+  "types": "../dist/dts/EventJournal.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLog/package.json b/EventLog/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..c2671207381330737d388377b16442e8df21eb16
--- /dev/null
+++ b/EventLog/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventLog.js",
+  "module": "../dist/esm/EventLog.js",
+  "types": "../dist/dts/EventLog.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLogEncryption/package.json b/EventLogEncryption/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..3d84ce163dd0d91d4e821c4ad5a7f1f6227315f6
--- /dev/null
+++ b/EventLogEncryption/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventLogEncryption.js",
+  "module": "../dist/esm/EventLogEncryption.js",
+  "types": "../dist/dts/EventLogEncryption.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLogRemote/Node/package.json b/EventLogRemote/Node/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..8c986cd898f78f9e946ee2027171ecf13a5b3004
--- /dev/null
+++ b/EventLogRemote/Node/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../../dist/cjs/EventLogRemote/Node.js",
+  "module": "../../dist/esm/EventLogRemote/Node.js",
+  "types": "../../dist/dts/EventLogRemote/Node.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLogRemote/package.json b/EventLogRemote/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..932f35156df8f7999a6e0c22663e73a9d1e4bae9
--- /dev/null
+++ b/EventLogRemote/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventLogRemote.js",
+  "module": "../dist/esm/EventLogRemote.js",
+  "types": "../dist/dts/EventLogRemote.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLogServer/Cloudflare/package.json b/EventLogServer/Cloudflare/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..ac5ac84b0b63c90c9aecdad6a42f8f42d2afab20
--- /dev/null
+++ b/EventLogServer/Cloudflare/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../../dist/cjs/EventLogServer/Cloudflare.js",
+  "module": "../../dist/esm/EventLogServer/Cloudflare.js",
+  "types": "../../dist/dts/EventLogServer/Cloudflare.d.ts",
+  "sideEffects": []
+}
diff --git a/EventLogServer/package.json b/EventLogServer/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..ac72d4f5cfbba7a61442e09b2b9383e634042f03
--- /dev/null
+++ b/EventLogServer/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/EventLogServer.js",
+  "module": "../dist/esm/EventLogServer.js",
+  "types": "../dist/dts/EventLogServer.d.ts",
+  "sideEffects": []
+}
diff --git a/README.md b/README.md
index 8113be23686d429ec632b83d23e9720ac05fcf38..afeb2913de5f13fe3ba6ba90387dbc72c9fc4808 100644
--- a/README.md
+++ b/README.md
@@ -1,64 +1,5 @@
-# Effect
-
-Welcome to Effect, a powerful TypeScript framework that provides a fully-fledged functional effect system with a rich standard library.
-
-# Requirements
-
-- TypeScript 5.0 or newer
-- The `strict` flag enabled in your `tsconfig.json` file
-
-```
-{
-  // ...
-  "compilerOptions": {
-    // ...
-    "strict": true,
-  }
-}
-```
+# `@effect/experimental`
 
 ## Documentation
 
-For detailed information and usage examples, please visit the [Effect website](https://www.effect.website/).
-
-## Introduction to Effect
-
-To get started with Effect, watch our introductory video on YouTube. This video provides an overview of Effect and its key features, making it a great starting point for newcomers:
-
-[![Introduction to Effect](https://img.youtube.com/vi/SloZE4i4Zfk/maxresdefault.jpg)](https://youtu.be/SloZE4i4Zfk)
-
-## Connect with Our Community
-
-Join our vibrant community on Discord to interact with fellow developers, ask questions, and share your experiences. Here's the invite link to our Discord server: [Join Effect's Discord Community](https://discord.gg/hdt7t7jpvn).
-
-## API Reference
-
-For detailed information on the Effect API, please refer to our [API Reference](https://effect-ts.github.io/effect/).
-
-## Pull Requests
-
-We welcome contributions via pull requests! Here are some guidelines to help you get started:
-
-1. Fork the repository and clone it to your local machine.
-2. Create a new branch for your changes: `git checkout -b my-new-feature`.
-3. Ensure you have the required dependencies installed by running: `pnpm install` (assuming pnpm version `8.x`).
-4. Make your desired changes and, if applicable, include tests to validate your modifications.
-5. Run the following commands to ensure the integrity of your changes:
-   - `pnpm check`: Verify that the code compiles.
-   - `pnpm test`: Execute the tests.
-   - `pnpm circular`: Confirm there are no circular imports.
-   - `pnpm lint`: Check for code style adherence (if you happen to encounter any errors during this process, you can use `pnpm lint-fix` to automatically fix some of these style issues).
-   - `pnpm dtslint`: Run type-level tests.
-   - `pnpm docgen`: Update the automatically generated documentation.
-6. Create a changeset for your changes: before committing your changes, create a changeset to document the modifications. This helps in tracking and communicating the changes effectively. To create a changeset, run the following command: `pnpm changeset`. Always choose the `patch` option when prompted (please note that we are currently in pre-release mode).
-7. Commit your changes: after creating the changeset, commit your changes with a descriptive commit message: `git commit -am 'Add some feature'`.
-8. Push your changes to your fork: `git push origin my-new-feature`.
-9. Open a pull request against our `main` branch.
-
-### Pull Request Guidelines
-
-- Please make sure your changes are consistent with the project's existing style and conventions.
-- Please write clear commit messages and include a summary of your changes in the pull request description.
-- Please make sure all tests pass and add new tests as necessary.
-- If your change requires documentation, please update the relevant documentation.
-- Please be patient! We will do our best to review your pull request as soon as possible.
+- **API Reference**: [View the full documentation](https://effect-ts.github.io/effect/docs/experimental).
diff --git a/Reactivity/package.json b/Reactivity/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..212f059b884f885b6c820f7fab622b7bc3b67400
--- /dev/null
+++ b/Reactivity/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/Reactivity.js",
+  "module": "../dist/esm/Reactivity.js",
+  "types": "../dist/dts/Reactivity.d.ts",
+  "sideEffects": []
+}
diff --git a/Sse/package.json b/Sse/package.json
new file mode 100644
index 0000000000000000000000000000000000000000..cd834287a6a06ba84cac6f52041d47b96e63f52c
--- /dev/null
+++ b/Sse/package.json
@@ -0,0 +1,6 @@
+{
+  "main": "../dist/cjs/Sse.js",
+  "module": "../dist/esm/Sse.js",
+  "types": "../dist/dts/Sse.d.ts",
+  "sideEffects": []
+}
diff --git a/dist/cjs/DevTools/Client.js b/dist/cjs/DevTools/Client.js
index 735fd6cc36cde966bd42c35248ea547c0614a4be..412d83c7e9a72ff17e35e31109d15e2a2f54851e 100644
--- a/dist/cjs/DevTools/Client.js
+++ b/dist/cjs/DevTools/Client.js
@@ -4,10 +4,13 @@ Object.defineProperty(exports, "__esModule", {
   value: true
 });
 exports.makeTracer = exports.make = exports.layerTracer = exports.layer = exports.Client = void 0;
+var Ndjson = _interopRequireWildcard(require("@effect/platform/Ndjson"));
 var Socket = _interopRequireWildcard(require("@effect/platform/Socket"));
 var Cause = _interopRequireWildcard(require("effect/Cause"));
 var Context = _interopRequireWildcard(require("effect/Context"));
+var Deferred = _interopRequireWildcard(require("effect/Deferred"));
 var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Exit = _interopRequireWildcard(require("effect/Exit"));
 var _Function = require("effect/Function");
 var Layer = _interopRequireWildcard(require("effect/Layer"));
 var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
@@ -16,7 +19,6 @@ var MetricState = _interopRequireWildcard(require("effect/MetricState"));
 var Schedule = _interopRequireWildcard(require("effect/Schedule"));
 var Stream = _interopRequireWildcard(require("effect/Stream"));
 var Tracer = _interopRequireWildcard(require("effect/Tracer"));
-var Ndjson = _interopRequireWildcard(require("../Ndjson.js"));
 var Domain = _interopRequireWildcard(require("./Domain.js"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
@@ -90,10 +92,12 @@ const make = exports.make = /*#__PURE__*/Effect.gen(function* () {
       metrics
     };
   }
+  const connected = yield* Deferred.make();
   yield* Mailbox.toStream(requests).pipe(Stream.pipeThroughChannel(Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
     inputSchema: Domain.Request,
     outputSchema: Domain.Response
   })), Stream.runForEach(req => {
+    Deferred.unsafeDone(connected, Exit.void);
     switch (req._tag) {
       case "MetricsRequest":
         {
@@ -104,11 +108,12 @@ const make = exports.make = /*#__PURE__*/Effect.gen(function* () {
           return Effect.void;
         }
     }
-  }), Effect.retry(Schedule.spaced("1 seconds")), Effect.catchAllCause(Effect.logDebug), Effect.forkScoped, Effect.uninterruptible);
+  }), Effect.tapErrorCause(Effect.logDebug), Effect.retry(Schedule.spaced("1 seconds")), Effect.forkScoped, Effect.uninterruptible);
   yield* Effect.addFinalizer(() => requests.offer(metricsSnapshot()).pipe(Effect.zipRight(Effect.fiberIdWith(id => requests.failCause(Cause.interrupt(id))))));
   yield* requests.offer({
     _tag: "Ping"
   }).pipe(Effect.delay("3 seconds"), Effect.forever, Effect.forkScoped, Effect.interruptible);
+  yield* Deferred.await(connected).pipe(Effect.timeoutOption("1 second"));
   return Client.of({
     unsafeAddSpan: request => requests.unsafeOffer(request)
   });
@@ -126,9 +131,9 @@ const layer = exports.layer = /*#__PURE__*/Layer.scoped(Client, make);
  * @since 1.0.0
  * @category constructors
  */
-const makeTracer = exports.makeTracer = /*#__PURE__*/Effect.gen(function* (_) {
-  const client = yield* _(Client);
-  const currentTracer = yield* _(Effect.tracer);
+const makeTracer = exports.makeTracer = /*#__PURE__*/Effect.gen(function* () {
+  const client = yield* Client;
+  const currentTracer = yield* Effect.tracer;
   return Tracer.make({
     span(name, parent, context, links, startTime, kind) {
       const span = currentTracer.span(name, parent, context, links, startTime, kind);
diff --git a/dist/cjs/DevTools/Client.js.map b/dist/cjs/DevTools/Client.js.map
index 2c9e9f10ca41b74cf63054a24412a9613f4830e5..c5b2cbe4fc5f9b2a052bcde507173c91795cbcb3 100644
--- a/dist/cjs/DevTools/Client.js.map
+++ b/dist/cjs/DevTools/Client.js.map
@@ -1 +1 @@
-{"version":3,"file":"Client.js","names":["Socket","_interopRequireWildcard","require","Cause","Context","Effect","_Function","Layer","Mailbox","Metric","MetricState","Schedule","Stream","Tracer","Ndjson","Domain","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Client","exports","GenericTag","make","gen","socket","requests","metricsSnapshot","snapshot","unsafeSnapshot","metrics","len","length","metricPair","isCounterState","metricState","push","_tag","name","metricKey","description","tags","state","isGaugeState","isHistogramState","isSummaryState","isFrequencyState","occurrences","fromEntries","entries","toStream","pipe","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Request","outputSchema","Response","runForEach","req","offer","void","retry","spaced","catchAllCause","logDebug","forkScoped","uninterruptible","addFinalizer","zipRight","fiberIdWith","id","failCause","interrupt","delay","forever","interruptible","of","unsafeAddSpan","request","unsafeOffer","annotateLogs","package","module","service","layer","scoped","makeTracer","_","client","currentTracer","tracer","span","parent","context","links","startTime","kind","oldEvent","event","attributes","traceId","spanId","oldEnd","end","apply","arguments","layerTracer","map","setTracer","unwrapEffect","provide"],"sources":["../../../src/DevTools/Client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Client.js","names":["Ndjson","_interopRequireWildcard","require","Socket","Cause","Context","Deferred","Effect","Exit","_Function","Layer","Mailbox","Metric","MetricState","Schedule","Stream","Tracer","Domain","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Client","exports","GenericTag","make","gen","socket","requests","metricsSnapshot","snapshot","unsafeSnapshot","metrics","len","length","metricPair","isCounterState","metricState","push","_tag","name","metricKey","description","tags","state","isGaugeState","isHistogramState","isSummaryState","isFrequencyState","occurrences","fromEntries","entries","connected","toStream","pipe","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Request","outputSchema","Response","runForEach","req","unsafeDone","void","offer","tapErrorCause","logDebug","retry","spaced","forkScoped","uninterruptible","addFinalizer","zipRight","fiberIdWith","id","failCause","interrupt","delay","forever","interruptible","await","timeoutOption","of","unsafeAddSpan","request","unsafeOffer","annotateLogs","package","module","service","layer","scoped","makeTracer","client","currentTracer","tracer","span","parent","context","links","startTime","kind","oldEvent","event","attributes","traceId","spanId","oldEnd","end","apply","arguments","layerTracer","map","setTracer","unwrapEffect","provide"],"sources":["../../../src/DevTools/Client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/DevTools/Domain.js b/dist/cjs/DevTools/Domain.js
index 99a34abb8181411b90d3237cec8fc8be564fa7ce..081c56a2f4aef14e30f303d8cd8886c5e5dc6d5b 100644
--- a/dist/cjs/DevTools/Domain.js
+++ b/dist/cjs/DevTools/Domain.js
@@ -4,13 +4,9 @@ Object.defineProperty(exports, "__esModule", {
   value: true
 });
 exports.metric = exports.Summary = exports.SpanStatusStarted = exports.SpanStatusEnded = exports.SpanStatus = exports.SpanEvent = exports.Span = exports.Response = exports.Request = exports.Pong = exports.Ping = exports.ParentSpan = exports.MetricsSnapshot = exports.MetricsRequest = exports.MetricLabel = exports.Metric = exports.Histogram = exports.Gauge = exports.Frequency = exports.ExternalSpan = exports.Counter = void 0;
-var Schema = _interopRequireWildcard(require("@effect/schema/Schema"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
-/**
- * @since 1.0.0
- */
-
 /**
  * @since 1.0.0
  * @category schemas
@@ -58,7 +54,11 @@ const Span = exports.Span = /*#__PURE__*/Schema.Struct({
     value: Schema.Unknown
   }),
   status: SpanStatus,
-  parent: /*#__PURE__*/Schema.Option( /*#__PURE__*/Schema.suspend(() => ParentSpan))
+  parent: /*#__PURE__*/Schema.Option( /*#__PURE__*/Schema.suspend(() => ParentSpan)
+  // add a title annotation to avoid "Cannot access 'ParentSpan' before initialization" error during module initialization
+  .annotations({
+    title: "ParentSpan"
+  }))
 });
 /**
  * @since 1.0.0
diff --git a/dist/cjs/DevTools/Domain.js.map b/dist/cjs/DevTools/Domain.js.map
index 6fda76f2fa3a79b942a843dfbd75cc92ff269466..a9b5996a5b9f1626df9cfd1df05757dc27f7fa6f 100644
--- a/dist/cjs/DevTools/Domain.js.map
+++ b/dist/cjs/DevTools/Domain.js.map
@@ -1 +1 @@
-{"version":3,"file":"Domain.js","names":["Schema","_interopRequireWildcard","require","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","SpanStatusStarted","exports","Struct","_tag","Literal","startTime","BigInt","SpanStatusEnded","endTime","SpanStatus","Union","ExternalSpan","spanId","String","traceId","sampled","Boolean","Span","name","attributes","ReadonlyMap","key","value","Unknown","status","parent","Option","suspend","ParentSpan","SpanEvent","Record","Ping","Pong","MetricsRequest","MetricLabel","metric","tag","state","description","optionalWith","as","tags","Array","Counter","count","Number","Frequency","occurrences","Gauge","numberOrInfinity","transform","Null","strict","decode","POSITIVE_INFINITY","encode","isFinite","Histogram","buckets","Tuple","min","max","sum","Summary","error","quantiles","Metric","MetricsSnapshot","metrics","Request","Response"],"sources":["../../../src/DevTools/Domain.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Domain.js","names":["Schema","_interopRequireWildcard","require","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","SpanStatusStarted","exports","Struct","_tag","Literal","startTime","BigInt","SpanStatusEnded","endTime","SpanStatus","Union","ExternalSpan","spanId","String","traceId","sampled","Boolean","Span","name","attributes","ReadonlyMap","key","value","Unknown","status","parent","Option","suspend","ParentSpan","annotations","title","SpanEvent","Record","Ping","Pong","MetricsRequest","MetricLabel","metric","tag","state","description","optionalWith","as","tags","Array","Counter","count","Number","Frequency","occurrences","Gauge","numberOrInfinity","transform","Null","strict","decode","POSITIVE_INFINITY","encode","isFinite","Histogram","buckets","Tuple","min","max","sum","Summary","error","quantiles","Metric","MetricsSnapshot","metrics","Request","Response"],"sources":["../../../src/DevTools/Domain.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/DevTools/Server.js b/dist/cjs/DevTools/Server.js
index 1865a09ebf130e02e7f7b7a8e5863245a6ff7eb0..358916c79c64e90d2c983a5ce9b7e629e58dd8ad 100644
--- a/dist/cjs/DevTools/Server.js
+++ b/dist/cjs/DevTools/Server.js
@@ -3,14 +3,13 @@
 Object.defineProperty(exports, "__esModule", {
   value: true
 });
-exports.make = exports.Server = void 0;
+exports.run = void 0;
+var Ndjson = _interopRequireWildcard(require("@effect/platform/Ndjson"));
 var Socket = _interopRequireWildcard(require("@effect/platform/Socket"));
-var Context = _interopRequireWildcard(require("effect/Context"));
+var SocketServer = _interopRequireWildcard(require("@effect/platform/SocketServer"));
 var Effect = _interopRequireWildcard(require("effect/Effect"));
-var Queue = _interopRequireWildcard(require("effect/Queue"));
+var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
 var Stream = _interopRequireWildcard(require("effect/Stream"));
-var Ndjson = _interopRequireWildcard(require("../Ndjson.js"));
-var SocketServer = _interopRequireWildcard(require("../SocketServer/Node.js"));
 var Domain = _interopRequireWildcard(require("./Domain.js"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
@@ -18,34 +17,26 @@ function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e;
  * @since 1.0.0
  */
 
-/**
- * @since 1.0.0
- * @category tags
- */
-const Server = exports.Server = /*#__PURE__*/Context.GenericTag("@effect/experimental/DevTools/Server");
 /**
  * @since 1.0.0
  * @category constructors
  */
-const make = exports.make = /*#__PURE__*/Effect.gen(function* (_) {
-  const server = yield* _(SocketServer.SocketServer);
-  const run = handle => server.run(socket => Effect.gen(function* (_) {
-    const responses = yield* _(Queue.unbounded());
-    const requests = yield* _(Queue.unbounded());
+const run = exports.run = /*#__PURE__*/Effect.fnUntraced(function* (handle) {
+  const server = yield* SocketServer.SocketServer;
+  return yield* server.run(socket => Effect.gen(function* () {
+    const responses = yield* Mailbox.make();
+    const requests = yield* Mailbox.make();
     const client = {
       queue: requests,
       request: res => responses.offer(res)
     };
-    yield* _(Stream.fromQueue(responses), Stream.pipeThroughChannel(Ndjson.duplexSchema(Socket.toChannel(socket), {
+    yield* Mailbox.toStream(responses).pipe(Stream.pipeThroughChannel(Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
       inputSchema: Domain.Response,
       outputSchema: Domain.Request
     })), Stream.runForEach(req => req._tag === "Ping" ? responses.offer({
       _tag: "Pong"
-    }) : requests.offer(req)), Effect.ensuring(Effect.all([requests.shutdown, responses.shutdown])), Effect.fork);
-    return yield* _(handle(client));
+    }) : requests.offer(req)), Effect.ensuring(Effect.zipRight(responses.shutdown, requests.shutdown)), Effect.fork);
+    yield* handle(client);
   }));
-  return Server.of({
-    run
-  });
 });
 //# sourceMappingURL=Server.js.map
\ No newline at end of file
diff --git a/dist/cjs/DevTools/Server.js.map b/dist/cjs/DevTools/Server.js.map
index 3ba762f430fabd8f8d8e8954b1a73ac2e91d55fb..497ce20075010165d33dfba79aa0dea84ff77cbb 100644
--- a/dist/cjs/DevTools/Server.js.map
+++ b/dist/cjs/DevTools/Server.js.map
@@ -1 +1 @@
-{"version":3,"file":"Server.js","names":["Socket","_interopRequireWildcard","require","Context","Effect","Queue","Stream","Ndjson","SocketServer","Domain","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Server","exports","GenericTag","make","gen","_","server","run","handle","socket","responses","unbounded","requests","client","queue","request","res","offer","fromQueue","pipeThroughChannel","duplexSchema","toChannel","inputSchema","Response","outputSchema","Request","runForEach","req","_tag","ensuring","all","shutdown","fork","of"],"sources":["../../../src/DevTools/Server.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Server.js","names":["Ndjson","_interopRequireWildcard","require","Socket","SocketServer","Effect","Mailbox","Stream","Domain","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","run","exports","fnUntraced","handle","server","socket","gen","responses","make","requests","client","queue","request","res","offer","toStream","pipe","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Response","outputSchema","Request","runForEach","req","_tag","ensuring","zipRight","shutdown","fork"],"sources":["../../../src/DevTools/Server.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Event.js b/dist/cjs/Event.js
new file mode 100644
index 0000000000000000000000000000000000000000..c2747e12e4d9dbc8b8612d3819ed99b119367352
--- /dev/null
+++ b/dist/cjs/Event.js
@@ -0,0 +1,47 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.make = exports.isEvent = exports.TypeId = void 0;
+var MsgPack = _interopRequireWildcard(require("@effect/platform/MsgPack"));
+var _Pipeable = require("effect/Pipeable");
+var Predicate = _interopRequireWildcard(require("effect/Predicate"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+const TypeId = exports.TypeId = /*#__PURE__*/Symbol.for("@effect/experimental/Event");
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+const isEvent = u => Predicate.hasProperty(u, TypeId);
+exports.isEvent = isEvent;
+const Proto = {
+  [TypeId]: TypeId,
+  pipe() {
+    return (0, _Pipeable.pipeArguments)(this, arguments);
+  }
+};
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+const make = options => Object.assign(Object.create(Proto), {
+  tag: options.tag,
+  primaryKey: options.primaryKey,
+  payload: options.payload ?? Schema.Void,
+  payloadMsgPack: MsgPack.schema(options.payload ?? Schema.Void),
+  success: options.success ?? Schema.Void,
+  error: options.error ?? Schema.Never
+});
+exports.make = make;
+//# sourceMappingURL=Event.js.map
\ No newline at end of file
diff --git a/dist/cjs/Event.js.map b/dist/cjs/Event.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..1359e31034bed6e37b31666d1ec4c57f47192e47
--- /dev/null
+++ b/dist/cjs/Event.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Event.js","names":["MsgPack","_interopRequireWildcard","require","_Pipeable","Predicate","Schema","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","isEvent","hasProperty","Proto","pipe","pipeArguments","arguments","make","options","assign","create","tag","primaryKey","payload","Void","payloadMsgPack","schema","success","error","Never"],"sources":["../../src/Event.ts"],"sourcesContent":[null],"mappings":";;;;;;AAGA,IAAAA,OAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,MAAA,GAAAJ,uBAAA,CAAAC,OAAA;AAAuC,SAAAI,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAN,wBAAAM,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AANvC;;;;AAQA;;;;AAIO,MAAMW,MAAM,GAAAC,OAAA,CAAAD,MAAA,gBAAkBE,MAAM,CAACC,GAAG,CAAC,4BAA4B,CAAC;AAQ7E;;;;AAIO,MAAMC,OAAO,GAAIT,CAAU,IAAqCjB,SAAS,CAAC2B,WAAW,CAACV,CAAC,EAAEK,MAAM,CAAC;AAAAC,OAAA,CAAAG,OAAA,GAAAA,OAAA;AA8MvG,MAAME,KAAK,GAAG;EACZ,CAACN,MAAM,GAAGA,MAAM;EAChBO,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD;AAED;;;;AAIO,MAAMC,IAAI,GAKfC,OAMD,IACCnB,MAAM,CAACoB,MAAM,CAACpB,MAAM,CAACqB,MAAM,CAACP,KAAK,CAAC,EAAE;EAClCQ,GAAG,EAAEH,OAAO,CAACG,GAAG;EAChBC,UAAU,EAAEJ,OAAO,CAACI,UAAU;EAC9BC,OAAO,EAAEL,OAAO,CAACK,OAAO,IAAIrC,MAAM,CAACsC,IAAI;EACvCC,cAAc,EAAE5C,OAAO,CAAC6C,MAAM,CAACR,OAAO,CAACK,OAAO,IAAIrC,MAAM,CAACsC,IAAI,CAAC;EAC9DG,OAAO,EAAET,OAAO,CAACS,OAAO,IAAIzC,MAAM,CAACsC,IAAI;EACvCI,KAAK,EAAEV,OAAO,CAACU,KAAK,IAAI1C,MAAM,CAAC2C;CAChC,CAAC;AAAArB,OAAA,CAAAS,IAAA,GAAAA,IAAA","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventGroup.js b/dist/cjs/EventGroup.js
new file mode 100644
index 0000000000000000000000000000000000000000..8124a7b9ab932b6478e2b000f583e54de8597f4c
--- /dev/null
+++ b/dist/cjs/EventGroup.js
@@ -0,0 +1,68 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.isEventGroup = exports.empty = exports.TypeId = void 0;
+var HttpApiSchema = _interopRequireWildcard(require("@effect/platform/HttpApiSchema"));
+var _Pipeable = require("effect/Pipeable");
+var Predicate = _interopRequireWildcard(require("effect/Predicate"));
+var Record = _interopRequireWildcard(require("effect/Record"));
+var EventApi = _interopRequireWildcard(require("./Event.js"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+const TypeId = exports.TypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventGroup");
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+const isEventGroup = u => Predicate.hasProperty(u, TypeId);
+exports.isEventGroup = isEventGroup;
+const Proto = {
+  [TypeId]: TypeId,
+  add(options) {
+    return makeProto({
+      events: {
+        ...this.events,
+        [options.tag]: EventApi.make(options)
+      }
+    });
+  },
+  addError(error) {
+    return makeProto({
+      events: Record.map(this.events, event => EventApi.make({
+        ...event,
+        error: HttpApiSchema.UnionUnify(event.error, error)
+      }))
+    });
+  },
+  pipe() {
+    return (0, _Pipeable.pipeArguments)(this, arguments);
+  }
+};
+const makeProto = options => {
+  function EventGroup() {}
+  Object.setPrototypeOf(EventGroup, Proto);
+  return Object.assign(EventGroup, options);
+};
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLog.group` api.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+const empty = exports.empty = /*#__PURE__*/makeProto({
+  events: /*#__PURE__*/Record.empty()
+});
+//# sourceMappingURL=EventGroup.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventGroup.js.map b/dist/cjs/EventGroup.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..372ba518f75fbc1d0ee63b9d968a6da1e3a258cb
--- /dev/null
+++ b/dist/cjs/EventGroup.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventGroup.js","names":["HttpApiSchema","_interopRequireWildcard","require","_Pipeable","Predicate","Record","EventApi","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","isEventGroup","hasProperty","Proto","add","options","makeProto","events","tag","make","addError","error","map","event","UnionUnify","pipe","pipeArguments","arguments","EventGroup","setPrototypeOf","assign","empty"],"sources":["../../src/EventGroup.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventJournal.js b/dist/cjs/EventJournal.js
new file mode 100644
index 0000000000000000000000000000000000000000..18d23e31260ce1bace2a22a5e26b0db2b801c027
--- /dev/null
+++ b/dist/cjs/EventJournal.js
@@ -0,0 +1,477 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.makeRemoteId = exports.makeMemory = exports.makeIndexedDb = exports.makeEntryId = exports.layerMemory = exports.layerIndexedDb = exports.entryIdMillis = exports.RemoteIdTypeId = exports.RemoteId = exports.RemoteEntry = exports.EventJournalError = exports.EventJournal = exports.ErrorTypeId = exports.EntryIdTypeId = exports.EntryId = exports.Entry = void 0;
+var MsgPack = _interopRequireWildcard(require("@effect/platform/MsgPack"));
+var Context = _interopRequireWildcard(require("effect/Context"));
+var DateTime = _interopRequireWildcard(require("effect/DateTime"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var PubSub = _interopRequireWildcard(require("effect/PubSub"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+var Uuid = _interopRequireWildcard(require("uuid"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+class EventJournal extends /*#__PURE__*/Context.Tag("@effect/experimental/EventJournal")() {}
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+exports.EventJournal = EventJournal;
+const ErrorTypeId = exports.ErrorTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/ErrorId");
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+class EventJournalError extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventJournal/Error")("EventJournalError", {
+  method: Schema.String,
+  cause: Schema.Defect
+}) {
+  /**
+   * @since 1.0.0
+   */
+  [ErrorTypeId] = ErrorTypeId;
+}
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+exports.EventJournalError = EventJournalError;
+const RemoteIdTypeId = exports.RemoteIdTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/RemoteId");
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+const RemoteId = exports.RemoteId = /*#__PURE__*/Schema.Uint8ArrayFromSelf.pipe( /*#__PURE__*/Schema.brand(RemoteIdTypeId));
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+const makeRemoteId = () => Uuid.v4({}, new Uint8Array(16));
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+exports.makeRemoteId = makeRemoteId;
+const EntryIdTypeId = exports.EntryIdTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/EntryId");
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+const EntryId = exports.EntryId = /*#__PURE__*/Schema.Uint8ArrayFromSelf.pipe( /*#__PURE__*/Schema.brand(EntryIdTypeId));
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+const makeEntryId = (options = {}) => {
+  return Uuid.v7(options, new Uint8Array(16));
+};
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+exports.makeEntryId = makeEntryId;
+const entryIdMillis = entryId => {
+  const bytes = new Uint8Array(8);
+  bytes.set(entryId.subarray(0, 6), 2);
+  return Number(new DataView(bytes.buffer).getBigUint64(0));
+};
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+exports.entryIdMillis = entryIdMillis;
+class Entry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventJournal/Entry")({
+  id: EntryId,
+  event: Schema.String,
+  primaryKey: Schema.String,
+  payload: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static arrayMsgPack = /*#__PURE__*/Schema.Array( /*#__PURE__*/MsgPack.schema(Entry));
+  /**
+   * @since 1.0.0
+   */
+  static encodeArray = /*#__PURE__*/Schema.encode(Entry.arrayMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  static decodeArray = /*#__PURE__*/Schema.decode(Entry.arrayMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  get idString() {
+    return Uuid.stringify(this.id);
+  }
+  /**
+   * @since 1.0.0
+   */
+  get createdAtMillis() {
+    return entryIdMillis(this.id);
+  }
+  /**
+   * @since 1.0.0
+   */
+  get createdAt() {
+    return DateTime.unsafeMake(this.createdAtMillis);
+  }
+}
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+exports.Entry = Entry;
+class RemoteEntry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventJournal/RemoteEntry")({
+  remoteSequence: Schema.Number,
+  entry: Entry
+}) {}
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+exports.RemoteEntry = RemoteEntry;
+const makeMemory = exports.makeMemory = /*#__PURE__*/Effect.gen(function* () {
+  const journal = [];
+  const byId = new Map();
+  const remotes = new Map();
+  const pubsub = yield* PubSub.unbounded();
+  const ensureRemote = remoteId => {
+    const remoteIdString = Uuid.stringify(remoteId);
+    let remote = remotes.get(remoteIdString);
+    if (remote) return remote;
+    remote = {
+      sequence: 0,
+      missing: journal.slice()
+    };
+    remotes.set(remoteIdString, remote);
+    return remote;
+  };
+  return EventJournal.of({
+    entries: Effect.sync(() => journal.slice()),
+    write({
+      effect,
+      event,
+      payload,
+      primaryKey
+    }) {
+      return Effect.acquireUseRelease(Effect.sync(() => new Entry({
+        id: makeEntryId(),
+        event,
+        primaryKey,
+        payload
+      }, {
+        disableValidation: true
+      })), effect, (entry, exit) => Effect.suspend(() => {
+        if (exit._tag === "Failure" || byId.has(entry.idString)) return Effect.void;
+        journal.push(entry);
+        byId.set(entry.idString, entry);
+        remotes.forEach(remote => {
+          remote.missing.push(entry);
+        });
+        return pubsub.publish(entry);
+      }));
+    },
+    writeFromRemote: options => Effect.gen(function* () {
+      const remote = ensureRemote(options.remoteId);
+      const uncommittedRemotes = [];
+      const uncommitted = [];
+      for (const remoteEntry of options.entries) {
+        if (byId.has(remoteEntry.entry.idString)) {
+          if (remoteEntry.remoteSequence > remote.sequence) {
+            remote.sequence = remoteEntry.remoteSequence;
+          }
+          continue;
+        }
+        uncommittedRemotes.push(remoteEntry);
+        uncommitted.push(remoteEntry.entry);
+      }
+      const brackets = options.compact ? yield* options.compact(uncommittedRemotes) : [[uncommitted, uncommittedRemotes]];
+      for (const [compacted, remoteEntries] of brackets) {
+        for (const originEntry of compacted) {
+          const entryMillis = entryIdMillis(originEntry.id);
+          const conflicts = [];
+          for (let i = journal.length - 1; i >= -1; i--) {
+            const entry = journal[i];
+            if (entry !== undefined && entry.createdAtMillis > entryMillis) {
+              continue;
+            }
+            for (let j = i + 2; j < journal.length; j++) {
+              const entry = journal[j];
+              if (entry.event === originEntry.event && entry.primaryKey === originEntry.primaryKey) {
+                conflicts.push(entry);
+              }
+            }
+            yield* options.effect({
+              entry: originEntry,
+              conflicts
+            });
+            break;
+          }
+        }
+        for (let j = 0; j < remoteEntries.length; j++) {
+          const remoteEntry = remoteEntries[j];
+          journal.push(remoteEntry.entry);
+          if (remoteEntry.remoteSequence > remote.sequence) {
+            remote.sequence = remoteEntry.remoteSequence;
+          }
+        }
+        journal.sort((a, b) => a.createdAtMillis - b.createdAtMillis);
+      }
+    }),
+    withRemoteUncommited: (remoteId, f) => Effect.acquireUseRelease(Effect.sync(() => ensureRemote(remoteId).missing.slice()), f, (entries, exit) => Effect.sync(() => {
+      if (exit._tag === "Failure") return;
+      const last = entries[entries.length - 1];
+      if (!last) return;
+      const remote = ensureRemote(remoteId);
+      for (let i = remote.missing.length - 1; i >= 0; i--) {
+        if (remote.missing[i].id === last.id) {
+          remote.missing = remote.missing.slice(i + 1);
+          break;
+        }
+      }
+    })),
+    nextRemoteSequence: remoteId => Effect.sync(() => ensureRemote(remoteId).sequence),
+    changes: PubSub.subscribe(pubsub),
+    destroy: Effect.sync(() => {
+      journal.length = 0;
+      byId.clear();
+      remotes.clear();
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+const layerMemory = exports.layerMemory = /*#__PURE__*/Layer.effect(EventJournal, makeMemory);
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+const makeIndexedDb = options => Effect.gen(function* () {
+  const database = options?.database ?? "effect_event_journal";
+  const openRequest = indexedDB.open(database, 1);
+  openRequest.onupgradeneeded = () => {
+    const db = openRequest.result;
+    const entries = db.createObjectStore("entries", {
+      keyPath: "id"
+    });
+    entries.createIndex("id", "id", {
+      unique: true
+    });
+    entries.createIndex("event", "event");
+    const remotes = db.createObjectStore("remotes", {
+      keyPath: ["remoteId", "entryId"]
+    });
+    remotes.createIndex("id", ["remoteId", "entryId"], {
+      unique: true
+    });
+    remotes.createIndex("sequence", ["remoteId", "sequence"], {
+      unique: true
+    });
+    const remoteEntryId = db.createObjectStore("remoteEntryId", {
+      keyPath: ["remoteId"]
+    });
+    remoteEntryId.createIndex("id", "remoteId", {
+      unique: true
+    });
+  };
+  const db = yield* Effect.acquireRelease(idbReq("open", () => openRequest), db => Effect.sync(() => db.close()));
+  const pubsub = yield* PubSub.unbounded();
+  return EventJournal.of({
+    entries: idbReq("entries", () => db.transaction("entries", "readonly").objectStore("entries").index("id").getAll()).pipe(Effect.flatMap(_ => decodeEntryIdbArray(_).pipe(Effect.mapError(cause => new EventJournalError({
+      method: "entries",
+      cause
+    }))))),
+    write: ({
+      effect,
+      event,
+      payload,
+      primaryKey
+    }) => Effect.uninterruptibleMask(restore => {
+      const entry = new Entry({
+        id: makeEntryId(),
+        event,
+        primaryKey,
+        payload
+      }, {
+        disableValidation: true
+      });
+      return restore(effect(entry)).pipe(Effect.zipLeft(idbReq("write", () => db.transaction("entries", "readwrite").objectStore("entries").put(encodeEntryIdb(entry)))), Effect.zipLeft(pubsub.publish(entry)));
+    }),
+    writeFromRemote: options => Effect.gen(function* () {
+      const uncommitted = [];
+      const uncommittedRemotes = [];
+      yield* Effect.async(resume => {
+        const tx = db.transaction(["entries", "remotes"], "readwrite");
+        const entries = tx.objectStore("entries");
+        const remotes = tx.objectStore("remotes");
+        const iterator = options.entries[Symbol.iterator]();
+        const handleNext = state => {
+          if (state.done) return;
+          const remoteEntry = state.value;
+          const entry = remoteEntry.entry;
+          entries.get(entry.id).onsuccess = event => {
+            if (event.target.result) {
+              remotes.put({
+                remoteId: options.remoteId,
+                entryId: remoteEntry.entry.id,
+                sequence: remoteEntry.remoteSequence
+              });
+              handleNext(iterator.next());
+              return;
+            }
+            uncommitted.push(entry);
+            uncommittedRemotes.push(remoteEntry);
+            handleNext(iterator.next());
+          };
+        };
+        handleNext(iterator.next());
+        tx.oncomplete = () => resume(Effect.void);
+        tx.onerror = () => resume(Effect.fail(new EventJournalError({
+          method: "writeFromRemote",
+          cause: tx.error
+        })));
+        return Effect.sync(() => tx.abort());
+      });
+      const brackets = options.compact ? yield* options.compact(uncommittedRemotes) : [[uncommitted, uncommittedRemotes]];
+      for (const [compacted, remoteEntries] of brackets) {
+        for (const originEntry of compacted) {
+          const conflicts = [];
+          yield* Effect.async(resume => {
+            const tx = db.transaction("entries", "readonly");
+            const entries = tx.objectStore("entries");
+            const cursorRequest = entries.index("id").openCursor(IDBKeyRange.lowerBound(originEntry.id, true), "next");
+            cursorRequest.onsuccess = () => {
+              const cursor = cursorRequest.result;
+              if (!cursor) return;
+              const decodedEntry = decodeEntryIdb(cursor.value);
+              if (decodedEntry.event === originEntry.event && decodedEntry.primaryKey === originEntry.primaryKey) {
+                conflicts.push(decodedEntry);
+              }
+              cursor.continue();
+            };
+            tx.oncomplete = () => resume(Effect.void);
+            tx.onerror = () => resume(Effect.fail(new EventJournalError({
+              method: "writeFromRemote",
+              cause: tx.error
+            })));
+            return Effect.sync(() => tx.abort());
+          });
+          yield* options.effect({
+            entry: originEntry,
+            conflicts
+          });
+        }
+        yield* Effect.async(resume => {
+          const tx = db.transaction(["entries", "remotes"], "readwrite");
+          const entries = tx.objectStore("entries");
+          const remotes = tx.objectStore("remotes");
+          for (const remoteEntry of remoteEntries) {
+            entries.add(encodeEntryIdb(remoteEntry.entry));
+            remotes.put({
+              remoteId: options.remoteId,
+              entryId: remoteEntry.entry.id,
+              sequence: remoteEntry.remoteSequence
+            });
+          }
+          tx.oncomplete = () => resume(Effect.void);
+          tx.onerror = () => resume(Effect.fail(new EventJournalError({
+            method: "writeFromRemote",
+            cause: tx.error
+          })));
+          return Effect.sync(() => tx.abort());
+        });
+      }
+    }),
+    withRemoteUncommited: (remoteId, f) => Effect.async(resume => {
+      const entries = [];
+      const tx = db.transaction(["entries", "remotes", "remoteEntryId"], "readwrite");
+      const entriesStore = tx.objectStore("entries");
+      const remotesStore = tx.objectStore("remotes");
+      const remoteEntryIdStore = tx.objectStore("remoteEntryId");
+      remoteEntryIdStore.get(remoteId).onsuccess = event => {
+        const startEntryId = event.target.result?.entryId;
+        const entryCursor = entriesStore.index("id").openCursor(startEntryId ? IDBKeyRange.lowerBound(startEntryId, true) : null, "next");
+        entryCursor.onsuccess = () => {
+          const cursor = entryCursor.result;
+          if (!cursor) return;
+          const entry = decodeEntryIdb(cursor.value);
+          remotesStore.get([remoteId, entry.id]).onsuccess = event => {
+            if (!event.target.result) entries.push(entry);
+            cursor.continue();
+          };
+        };
+      };
+      tx.oncomplete = () => resume(Effect.succeed(entries));
+      tx.onerror = () => resume(Effect.fail(new EventJournalError({
+        method: "withRemoteUncommited",
+        cause: tx.error
+      })));
+      return Effect.sync(() => tx.abort());
+    }).pipe(Effect.flatMap(entries => {
+      if (entries.length === 0) return f(entries);
+      const entryId = entries[entries.length - 1].id;
+      return Effect.uninterruptibleMask(restore => restore(f(entries)).pipe(Effect.zipLeft(idbReq("withRemoteUncommited", () => db.transaction("remoteEntryId", "readwrite").objectStore("remoteEntryId").put({
+        remoteId,
+        entryId
+      })))));
+    })),
+    nextRemoteSequence: remoteId => Effect.async(resume => {
+      const tx = db.transaction("remotes", "readonly");
+      let sequence = 0;
+      const cursorRequest = tx.objectStore("remotes").index("sequence").openCursor(IDBKeyRange.bound([remoteId, 0], [remoteId, Infinity]), "prev");
+      cursorRequest.onsuccess = () => {
+        const cursor = cursorRequest.result;
+        if (!cursor) return;
+        sequence = cursor.value.sequence + 1;
+      };
+      tx.oncomplete = () => resume(Effect.succeed(sequence));
+      tx.onerror = () => resume(Effect.fail(new EventJournalError({
+        method: "nextRemoteSequence",
+        cause: tx.error
+      })));
+      return Effect.sync(() => tx.abort());
+    }),
+    changes: PubSub.subscribe(pubsub),
+    destroy: Effect.sync(() => {
+      indexedDB.deleteDatabase(database);
+    })
+  });
+});
+exports.makeIndexedDb = makeIndexedDb;
+const decodeEntryIdb = /*#__PURE__*/Schema.decodeSync(Entry);
+const encodeEntryIdb = /*#__PURE__*/Schema.encodeSync(Entry);
+const EntryIdbArray = /*#__PURE__*/Schema.Array(Entry);
+const decodeEntryIdbArray = /*#__PURE__*/Schema.decodeUnknown(EntryIdbArray);
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+const layerIndexedDb = options => Layer.scoped(EventJournal, makeIndexedDb(options));
+exports.layerIndexedDb = layerIndexedDb;
+const idbReq = (method, evaluate) => Effect.async(resume => {
+  const request = evaluate();
+  if (request.readyState === "done") {
+    resume(Effect.succeed(request.result));
+    return;
+  }
+  request.onsuccess = () => resume(Effect.succeed(request.result));
+  request.onerror = () => resume(Effect.fail(new EventJournalError({
+    method,
+    cause: request.error
+  })));
+});
+//# sourceMappingURL=EventJournal.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventJournal.js.map b/dist/cjs/EventJournal.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..e603cc73e0536bc8955a6dd29086c7e42f3a7580
--- /dev/null
+++ b/dist/cjs/EventJournal.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventJournal.js","names":["MsgPack","_interopRequireWildcard","require","Context","DateTime","Effect","Layer","PubSub","Schema","Uuid","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","EventJournal","Tag","exports","ErrorTypeId","Symbol","for","EventJournalError","TaggedClass","method","String","cause","Defect","RemoteIdTypeId","RemoteId","Uint8ArrayFromSelf","pipe","brand","makeRemoteId","v4","Uint8Array","EntryIdTypeId","EntryId","makeEntryId","options","v7","entryIdMillis","entryId","bytes","subarray","Number","DataView","buffer","getBigUint64","Entry","Class","id","event","primaryKey","payload","arrayMsgPack","Array","schema","encodeArray","encode","decodeArray","decode","idString","stringify","createdAtMillis","createdAt","unsafeMake","RemoteEntry","remoteSequence","entry","makeMemory","gen","journal","byId","Map","remotes","pubsub","unbounded","ensureRemote","remoteId","remoteIdString","remote","sequence","missing","slice","of","entries","sync","write","effect","acquireUseRelease","disableValidation","exit","suspend","_tag","void","push","forEach","publish","writeFromRemote","uncommittedRemotes","uncommitted","remoteEntry","brackets","compact","compacted","remoteEntries","originEntry","entryMillis","conflicts","length","undefined","j","sort","b","withRemoteUncommited","f","last","nextRemoteSequence","changes","subscribe","destroy","clear","layerMemory","makeIndexedDb","database","openRequest","indexedDB","open","onupgradeneeded","db","result","createObjectStore","keyPath","createIndex","unique","remoteEntryId","acquireRelease","idbReq","close","transaction","objectStore","index","getAll","flatMap","_","decodeEntryIdbArray","mapError","uninterruptibleMask","restore","zipLeft","put","encodeEntryIdb","async","resume","tx","iterator","handleNext","state","done","value","onsuccess","target","next","oncomplete","onerror","fail","error","abort","cursorRequest","openCursor","IDBKeyRange","lowerBound","cursor","decodedEntry","decodeEntryIdb","continue","add","entriesStore","remotesStore","remoteEntryIdStore","startEntryId","entryCursor","succeed","bound","Infinity","deleteDatabase","decodeSync","encodeSync","EntryIdbArray","decodeUnknown","layerIndexedDb","scoped","evaluate","request","readyState"],"sources":["../../src/EventJournal.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLog.js b/dist/cjs/EventLog.js
new file mode 100644
index 0000000000000000000000000000000000000000..184c989f2a4f6e1e190dba4de0d70b810bdb7d44
--- /dev/null
+++ b/dist/cjs/EventLog.js
@@ -0,0 +1,393 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.schema = exports.makeClient = exports.layerEventLog = exports.layer = exports.isEventLogSchema = exports.groupReactivity = exports.groupCompaction = exports.group = exports.SchemaTypeId = exports.Registry = exports.Identity = exports.HandlersTypeId = exports.EventLog = void 0;
+var Chunk = _interopRequireWildcard(require("effect/Chunk"));
+var Context = _interopRequireWildcard(require("effect/Context"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var FiberMap = _interopRequireWildcard(require("effect/FiberMap"));
+var FiberRef = _interopRequireWildcard(require("effect/FiberRef"));
+var _Function = require("effect/Function");
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var _Pipeable = require("effect/Pipeable");
+var Predicate = _interopRequireWildcard(require("effect/Predicate"));
+var Queue = _interopRequireWildcard(require("effect/Queue"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+var _EventJournal = require("./EventJournal.js");
+var Reactivity = _interopRequireWildcard(require("./Reactivity.js"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+const SchemaTypeId = exports.SchemaTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventLog/EventLogSchema");
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+const isEventLogSchema = u => Predicate.hasProperty(u, SchemaTypeId);
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+exports.isEventLogSchema = isEventLogSchema;
+const schema = (...groups) => {
+  function EventLog() {}
+  EventLog[SchemaTypeId] = SchemaTypeId;
+  EventLog.groups = groups;
+  return EventLog;
+};
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+exports.schema = schema;
+const HandlersTypeId = exports.HandlersTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventLog/Handlers");
+const handlersProto = {
+  [HandlersTypeId]: {
+    _Endpoints: _Function.identity
+  },
+  handle(tag, handler) {
+    return makeHandlers({
+      group: this.group,
+      context: this.context,
+      handlers: {
+        ...this.handlers,
+        [tag]: {
+          event: this.group.events[tag],
+          context: this.context,
+          handler
+        }
+      }
+    });
+  },
+  pipe() {
+    return (0, _Pipeable.pipeArguments)(this, arguments);
+  }
+};
+const makeHandlers = options => Object.assign(Object.create(handlersProto), options);
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+const group = (group, f) => Effect.gen(function* () {
+  const context = yield* Effect.context();
+  const result = f(makeHandlers({
+    group: group,
+    handlers: {},
+    context
+  }));
+  const handlers = Effect.isEffect(result) ? yield* result : result;
+  const registry = yield* Registry;
+  yield* registry.add(handlers);
+}).pipe(Layer.scopedDiscard, Layer.provide(Registry.layer));
+/**
+ * @since 1.0.0
+ * @category compaction
+ */
+exports.group = group;
+const groupCompaction = (group, effect) => Effect.gen(function* () {
+  const log = yield* EventLog;
+  const context = yield* Effect.context();
+  yield* log.registerCompaction({
+    events: Object.keys(group.events),
+    effect: Effect.fnUntraced(function* ({
+      entries,
+      write
+    }) {
+      const writePayload = (timestamp, tag, payload) => Effect.gen(function* () {
+        const event = group.events[tag];
+        const entry = new _EventJournal.Entry({
+          id: (0, _EventJournal.makeEntryId)({
+            msecs: timestamp
+          }),
+          event: tag,
+          payload: yield* Schema.encode(event.payloadMsgPack)(payload).pipe(Effect.locally(FiberRef.currentContext, context), Effect.orDie),
+          primaryKey: event.primaryKey(payload)
+        }, {
+          disableValidation: true
+        });
+        yield* write(entry);
+      });
+      const byPrimaryKey = new Map();
+      for (const entry of entries) {
+        const payload = yield* Schema.decodeUnknown(group.events[entry.event].payloadMsgPack)(entry.payload).pipe(Effect.locally(FiberRef.currentContext, context));
+        if (byPrimaryKey.has(entry.primaryKey)) {
+          const record = byPrimaryKey.get(entry.primaryKey);
+          record.entries.push(entry);
+          record.taggedPayloads.push({
+            _tag: entry.event,
+            payload
+          });
+        } else {
+          byPrimaryKey.set(entry.primaryKey, {
+            entries: [entry],
+            taggedPayloads: [{
+              _tag: entry.event,
+              payload
+            }]
+          });
+        }
+      }
+      for (const [primaryKey, {
+        entries,
+        taggedPayloads
+      }] of byPrimaryKey) {
+        yield* effect({
+          primaryKey,
+          entries,
+          events: taggedPayloads,
+          write(tag, payload) {
+            return writePayload(entries[0].createdAtMillis, tag, payload);
+          }
+        }).pipe(Effect.locally(FiberRef.currentContext, context));
+      }
+    })
+  });
+}).pipe(Layer.scopedDiscard);
+/**
+ * @since 1.0.0
+ * @category reactivity
+ */
+exports.groupCompaction = groupCompaction;
+const groupReactivity = (group, keys) => Effect.gen(function* () {
+  const log = yield* EventLog;
+  if (!Array.isArray(keys)) {
+    yield* log.registerReactivity(keys);
+    return;
+  }
+  const obj = {};
+  for (const tag in group.events) {
+    obj[tag] = keys;
+  }
+  yield* log.registerReactivity(obj);
+}).pipe(Layer.scopedDiscard);
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+exports.groupReactivity = groupReactivity;
+class Registry extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/Registry")() {
+  /**
+   * @since 1.0.0
+   */
+  static layer = /*#__PURE__*/Layer.sync(Registry, () => {
+    const items = {};
+    return {
+      add: handlers => Effect.sync(() => {
+        for (const tag in handlers.handlers) {
+          items[tag] = handlers.handlers[tag];
+        }
+      }),
+      handlers: Effect.sync(() => items)
+    };
+  });
+}
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+exports.Registry = Registry;
+class Identity extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/Identity")() {}
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+exports.Identity = Identity;
+class EventLog extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/EventLog")() {}
+exports.EventLog = EventLog;
+const make = /*#__PURE__*/Effect.gen(function* () {
+  const identity = yield* Identity;
+  const registry = yield* Registry;
+  const journal = yield* _EventJournal.EventJournal;
+  const handlers = yield* registry.handlers;
+  const remotes = yield* FiberMap.make();
+  const compactors = new Map();
+  const journalSemaphore = yield* Effect.makeSemaphore(1);
+  const reactivity = yield* Reactivity.Reactivity;
+  const reactivityKeys = {};
+  const runRemote = remote => Effect.gen(function* () {
+    const startSequence = yield* journal.nextRemoteSequence(remote.id);
+    const changes = yield* remote.changes(identity, startSequence);
+    yield* changes.takeAll.pipe(Effect.flatMap(([entries]) => journal.writeFromRemote({
+      remoteId: remote.id,
+      entries: Chunk.toReadonlyArray(entries),
+      compact: compactors.size > 0 ? remoteEntries => Effect.gen(function* () {
+        let unprocessed = remoteEntries;
+        const brackets = [];
+        let uncompacted = [];
+        let uncompactedRemote = [];
+        while (true) {
+          let i = 0;
+          for (; i < unprocessed.length; i++) {
+            const remoteEntry = unprocessed[i];
+            if (!compactors.has(remoteEntry.entry.event)) {
+              uncompacted.push(remoteEntry.entry);
+              uncompactedRemote.push(remoteEntry);
+              continue;
+            }
+            if (uncompacted.length > 0) {
+              brackets.push([uncompacted, uncompactedRemote]);
+              uncompacted = [];
+              uncompactedRemote = [];
+            }
+            const compactor = compactors.get(remoteEntry.entry.event);
+            const entry = remoteEntry.entry;
+            const entries = [entry];
+            const remoteEntries = [remoteEntry];
+            const compacted = [];
+            const currentEntries = unprocessed;
+            unprocessed = [];
+            for (let j = i + 1; j < currentEntries.length; j++) {
+              const nextRemoteEntry = currentEntries[j];
+              if (!compactor.events.has(nextRemoteEntry.entry.event)) {
+                unprocessed.push(nextRemoteEntry);
+                continue;
+              }
+              entries.push(nextRemoteEntry.entry);
+              remoteEntries.push(nextRemoteEntry);
+            }
+            yield* compactor.effect({
+              entries,
+              write(entry) {
+                return Effect.sync(() => {
+                  compacted.push(entry);
+                });
+              }
+            });
+            brackets.push([compacted, remoteEntries]);
+            break;
+          }
+          if (i === unprocessed.length) {
+            brackets.push([unprocessed.map(_ => _.entry), unprocessed]);
+            break;
+          }
+        }
+        return brackets;
+      }) : undefined,
+      effect: ({
+        conflicts,
+        entry
+      }) => {
+        const handler = handlers[entry.event];
+        if (!handler) return Effect.logDebug(`Event handler not found for: "${entry.event}"`);
+        const decodePayload = Schema.decode(handlers[entry.event].event.payloadMsgPack);
+        return Effect.gen(function* () {
+          const decodedConflicts = new Array(conflicts.length);
+          for (let i = 0; i < conflicts.length; i++) {
+            decodedConflicts[i] = {
+              entry: conflicts[i],
+              payload: yield* decodePayload(conflicts[i].payload)
+            };
+          }
+          yield* handler.handler({
+            payload: yield* decodePayload(entry.payload),
+            entry,
+            conflicts: decodedConflicts
+          });
+          if (reactivityKeys[entry.event]) {
+            for (const key of reactivityKeys[entry.event]) {
+              reactivity.unsafeInvalidate({
+                [key]: [entry.primaryKey]
+              });
+            }
+          }
+        }).pipe(Effect.catchAllCause(Effect.log), Effect.annotateLogs({
+          service: "EventLog",
+          effect: "writeFromRemote",
+          entryId: entry.idString
+        }));
+      }
+    }).pipe(journalSemaphore.withPermits(1))), Effect.catchAllCause(Effect.log), Effect.forever, Effect.annotateLogs({
+      service: "EventLog",
+      effect: "runRemote consume"
+    }), Effect.fork);
+    const write = journal.withRemoteUncommited(remote.id, entries => remote.write(identity, entries));
+    yield* Effect.addFinalizer(() => Effect.ignore(write));
+    yield* write;
+    yield* Queue.takeBetween(yield* journal.changes, 1, Number.MAX_SAFE_INTEGER).pipe(Effect.zipRight(Effect.sleep(500)), Effect.zipRight(write), Effect.catchAllCause(Effect.log), Effect.forever);
+  }).pipe(Effect.scoped, Effect.provideService(Identity, identity), Effect.interruptible);
+  return EventLog.of({
+    write: options => {
+      const handler = handlers[options.event];
+      if (handler === undefined) {
+        return Effect.die(`Event handler not found for: "${options.event}"`);
+      }
+      return Effect.gen(function* () {
+        const payload = yield* Effect.orDie(Schema.encode(handlers[options.event].event.payloadMsgPack)(options.payload));
+        return yield* journalSemaphore.withPermits(1)(journal.write({
+          event: options.event,
+          primaryKey: handler.event.primaryKey(options.payload),
+          payload,
+          effect: entry => Effect.tap(handler.handler({
+            payload: options.payload,
+            entry,
+            conflicts: []
+          }), () => {
+            if (reactivityKeys[entry.event]) {
+              for (const key of reactivityKeys[entry.event]) {
+                reactivity.unsafeInvalidate({
+                  [key]: [entry.primaryKey]
+                });
+              }
+            }
+          })
+        }));
+      }).pipe(Effect.mapInputContext(context => Context.merge(handler.context, context)));
+    },
+    entries: journal.entries,
+    registerRemote: remote => Effect.gen(function* () {
+      yield* Effect.acquireRelease(FiberMap.run(remotes, remote.id, runRemote(remote)), () => FiberMap.remove(remotes, remote.id));
+    }),
+    registerCompaction: options => Effect.acquireRelease(Effect.sync(() => {
+      const events = new Set(options.events);
+      const compactor = {
+        events,
+        effect: options.effect
+      };
+      for (const event of options.events) {
+        compactors.set(event, compactor);
+      }
+    }), () => Effect.sync(() => {
+      for (const event of options.events) {
+        compactors.delete(event);
+      }
+    })),
+    registerReactivity: keys => Effect.sync(() => {
+      Object.assign(reactivityKeys, keys);
+    }),
+    destroy: journal.destroy
+  });
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+const layerEventLog = exports.layerEventLog = /*#__PURE__*/Layer.scoped(EventLog, make).pipe( /*#__PURE__*/Layer.provide([Registry.layer, Reactivity.layer]));
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+const layer = _schema => layerEventLog;
+/**
+ * @since 1.0.0
+ * @category client
+ */
+exports.layer = layer;
+const makeClient = schema => Effect.gen(function* () {
+  const log = yield* EventLog;
+  return (event, payload) => log.write({
+    schema,
+    event,
+    payload
+  });
+});
+exports.makeClient = makeClient;
+//# sourceMappingURL=EventLog.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLog.js.map b/dist/cjs/EventLog.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..ef7ff06b3ccd1214f6149c88267565116bfff166
--- /dev/null
+++ b/dist/cjs/EventLog.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLog.js","names":["Chunk","_interopRequireWildcard","require","Context","Effect","FiberMap","FiberRef","_Function","Layer","_Pipeable","Predicate","Queue","Schema","_EventJournal","Reactivity","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","SchemaTypeId","exports","Symbol","for","isEventLogSchema","hasProperty","schema","groups","EventLog","HandlersTypeId","handlersProto","_Endpoints","identity","handle","tag","handler","makeHandlers","group","context","handlers","event","events","pipe","pipeArguments","arguments","options","assign","create","f","gen","result","isEffect","registry","Registry","add","scopedDiscard","provide","layer","groupCompaction","effect","log","registerCompaction","keys","fnUntraced","entries","write","writePayload","timestamp","payload","entry","Entry","id","makeEntryId","msecs","encode","payloadMsgPack","locally","currentContext","orDie","primaryKey","disableValidation","byPrimaryKey","Map","decodeUnknown","record","push","taggedPayloads","_tag","createdAtMillis","groupReactivity","Array","isArray","registerReactivity","obj","Tag","sync","items","Identity","make","journal","EventJournal","remotes","compactors","journalSemaphore","makeSemaphore","reactivity","reactivityKeys","runRemote","remote","startSequence","nextRemoteSequence","changes","takeAll","flatMap","writeFromRemote","remoteId","toReadonlyArray","compact","size","remoteEntries","unprocessed","brackets","uncompacted","uncompactedRemote","length","remoteEntry","compactor","compacted","currentEntries","j","nextRemoteEntry","map","_","undefined","conflicts","logDebug","decodePayload","decode","decodedConflicts","key","unsafeInvalidate","catchAllCause","annotateLogs","service","entryId","idString","withPermits","forever","fork","withRemoteUncommited","addFinalizer","ignore","takeBetween","Number","MAX_SAFE_INTEGER","zipRight","sleep","scoped","provideService","interruptible","of","die","tap","mapInputContext","merge","registerRemote","acquireRelease","run","remove","Set","delete","destroy","layerEventLog","_schema","makeClient"],"sources":["../../src/EventLog.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLogEncryption.js b/dist/cjs/EventLogEncryption.js
new file mode 100644
index 0000000000000000000000000000000000000000..9a2def8a30043bbf4eda816f5d1ed4d53de90ddd
--- /dev/null
+++ b/dist/cjs/EventLogEncryption.js
@@ -0,0 +1,99 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.makeEncryptionSubtle = exports.layerSubtle = exports.EventLogEncryption = exports.EncryptedRemoteEntry = exports.EncryptedEntry = void 0;
+var Context = _interopRequireWildcard(require("effect/Context"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var Redacted = _interopRequireWildcard(require("effect/Redacted"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+var _EventJournal = require("./EventJournal.js");
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+const EncryptedEntry = exports.EncryptedEntry = /*#__PURE__*/Schema.Struct({
+  entryId: _EventJournal.EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+});
+/**
+ * @since 1.0.0
+ * @category models
+ */
+const EncryptedRemoteEntry = exports.EncryptedRemoteEntry = /*#__PURE__*/Schema.Struct({
+  sequence: Schema.Number,
+  iv: Schema.Uint8ArrayFromSelf,
+  entryId: _EventJournal.EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+});
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+class EventLogEncryption extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLogEncryption")() {}
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+exports.EventLogEncryption = EventLogEncryption;
+const makeEncryptionSubtle = crypto => Effect.sync(() => {
+  const keyCache = new WeakMap();
+  const getKey = identity => Effect.suspend(() => {
+    if (keyCache.has(identity)) {
+      return Effect.succeed(keyCache.get(identity));
+    }
+    return Effect.promise(() => crypto.subtle.importKey("raw", Redacted.value(identity.privateKey), "AES-GCM", true, ["encrypt", "decrypt"])).pipe(Effect.tap(key => {
+      keyCache.set(identity, key);
+    }));
+  });
+  return EventLogEncryption.of({
+    encrypt: (identity, entries) => Effect.gen(function* () {
+      const data = yield* Effect.orDie(_EventJournal.Entry.encodeArray(entries));
+      const key = yield* getKey(identity);
+      const iv = crypto.getRandomValues(new Uint8Array(12));
+      const encryptedEntries = yield* Effect.promise(() => Promise.all(data.map(entry => crypto.subtle.encrypt({
+        name: "AES-GCM",
+        iv,
+        tagLength: 128
+      }, key, entry))));
+      return {
+        iv,
+        encryptedEntries: encryptedEntries.map(entry => new Uint8Array(entry))
+      };
+    }),
+    decrypt: (identity, entries) => Effect.gen(function* () {
+      const key = yield* getKey(identity);
+      const decryptedData = (yield* Effect.promise(() => Promise.all(entries.map(data => crypto.subtle.decrypt({
+        name: "AES-GCM",
+        iv: data.iv,
+        tagLength: 128
+      }, key, data.encryptedEntry))))).map(buffer => new Uint8Array(buffer));
+      const decoded = yield* Effect.orDie(_EventJournal.Entry.decodeArray(decryptedData));
+      return decoded.map((entry, i) => new _EventJournal.RemoteEntry({
+        remoteSequence: entries[i].sequence,
+        entry
+      }));
+    }),
+    sha256: data => Effect.promise(() => crypto.subtle.digest("SHA-256", data)).pipe(Effect.map(hash => new Uint8Array(hash))),
+    sha256String: data => Effect.map(Effect.promise(() => crypto.subtle.digest("SHA-256", data)), hash => {
+      const hashArray = Array.from(new Uint8Array(hash));
+      const hashHex = hashArray.map(bytes => bytes.toString(16).padStart(2, "0")).join("");
+      return hashHex;
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+exports.makeEncryptionSubtle = makeEncryptionSubtle;
+const layerSubtle = exports.layerSubtle = /*#__PURE__*/Layer.suspend(() => Layer.effect(EventLogEncryption, makeEncryptionSubtle(globalThis.crypto)));
+//# sourceMappingURL=EventLogEncryption.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLogEncryption.js.map b/dist/cjs/EventLogEncryption.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..c9dee0e568ee4aebd75d2ed3a9a6a06700c482e2
--- /dev/null
+++ b/dist/cjs/EventLogEncryption.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogEncryption.js","names":["Context","_interopRequireWildcard","require","Effect","Layer","Redacted","Schema","_EventJournal","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","EncryptedEntry","exports","Struct","entryId","EntryId","encryptedEntry","Uint8ArrayFromSelf","EncryptedRemoteEntry","sequence","Number","iv","EventLogEncryption","Tag","makeEncryptionSubtle","crypto","sync","keyCache","getKey","identity","suspend","succeed","promise","subtle","importKey","value","privateKey","pipe","tap","key","of","encrypt","entries","gen","data","orDie","Entry","encodeArray","getRandomValues","Uint8Array","encryptedEntries","Promise","all","map","entry","name","tagLength","decrypt","decryptedData","buffer","decoded","decodeArray","RemoteEntry","remoteSequence","sha256","digest","hash","sha256String","hashArray","Array","from","hashHex","bytes","toString","padStart","join","layerSubtle","effect","globalThis"],"sources":["../../src/EventLogEncryption.ts"],"sourcesContent":[null],"mappings":";;;;;;AAGA,IAAAA,OAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,MAAA,GAAAF,uBAAA,CAAAC,OAAA;AACA,IAAAE,KAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,QAAA,GAAAJ,uBAAA,CAAAC,OAAA;AACA,IAAAI,MAAA,GAAAL,uBAAA,CAAAC,OAAA;AACA,IAAAK,aAAA,GAAAL,OAAA;AAA+D,SAAAM,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAR,wBAAAQ,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAR/D;;;;AAWA;;;;AAIO,MAAMW,cAAc,GAAAC,OAAA,CAAAD,cAAA,gBAAGtB,MAAM,CAACwB,MAAM,CAAC;EAC1CC,OAAO,EAAEC,qBAAO;EAChBC,cAAc,EAAE3B,MAAM,CAAC4B;CACxB,CAAC;AAQF;;;;AAIO,MAAMC,oBAAoB,GAAAN,OAAA,CAAAM,oBAAA,gBAAG7B,MAAM,CAACwB,MAAM,CAAC;EAChDM,QAAQ,EAAE9B,MAAM,CAAC+B,MAAM;EACvBC,EAAE,EAAEhC,MAAM,CAAC4B,kBAAkB;EAC7BH,OAAO,EAAEC,qBAAO;EAChBC,cAAc,EAAE3B,MAAM,CAAC4B;CACxB,CAAC;AAEF;;;;AAIM,MAAOK,kBAAmB,sBAAQvC,OAAO,CAACwC,GAAG,CAAC,yCAAyC,CAAC,EAiB3F;AAEH;;;;AAAAX,OAAA,CAAAU,kBAAA,GAAAA,kBAAA;AAIO,MAAME,oBAAoB,GAAIC,MAAc,IACjDvC,MAAM,CAACwC,IAAI,CAAC,MAAK;EACf,MAAMC,QAAQ,GAAG,IAAIlC,OAAO,EAAsC;EAClE,MAAMmC,MAAM,GAAIC,QAAiC,IAC/C3C,MAAM,CAAC4C,OAAO,CAAC,MAAK;IAClB,IAAIH,QAAQ,CAAC7B,GAAG,CAAC+B,QAAQ,CAAC,EAAE;MAC1B,OAAO3C,MAAM,CAAC6C,OAAO,CAACJ,QAAQ,CAAC5B,GAAG,CAAC8B,QAAQ,CAAE,CAAC;IAChD;IACA,OAAO3C,MAAM,CAAC8C,OAAO,CAAC,MACpBP,MAAM,CAACQ,MAAM,CAACC,SAAS,CACrB,KAAK,EACL9C,QAAQ,CAAC+C,KAAK,CAACN,QAAQ,CAACO,UAAU,CAAC,EACnC,SAAS,EACT,IAAI,EACJ,CAAC,SAAS,EAAE,SAAS,CAAC,CACvB,CACF,CAACC,IAAI,CACJnD,MAAM,CAACoD,GAAG,CAAEC,GAAG,IAAI;MACjBZ,QAAQ,CAACjB,GAAG,CAACmB,QAAQ,EAAEU,GAAG,CAAC;IAC7B,CAAC,CAAC,CACH;EACH,CAAC,CAAC;EAEJ,OAAOjB,kBAAkB,CAACkB,EAAE,CAAC;IAC3BC,OAAO,EAAEA,CAACZ,QAAQ,EAAEa,OAAO,KACzBxD,MAAM,CAACyD,GAAG,CAAC,aAAS;MAClB,MAAMC,IAAI,GAAG,OAAO1D,MAAM,CAAC2D,KAAK,CAACC,mBAAK,CAACC,WAAW,CAACL,OAAO,CAAC,CAAC;MAC5D,MAAMH,GAAG,GAAG,OAAOX,MAAM,CAACC,QAAQ,CAAC;MACnC,MAAMR,EAAE,GAAGI,MAAM,CAACuB,eAAe,CAAC,IAAIC,UAAU,CAAC,EAAE,CAAC,CAAC;MACrD,MAAMC,gBAAgB,GAAG,OAAOhE,MAAM,CAAC8C,OAAO,CAAC,MAC7CmB,OAAO,CAACC,GAAG,CACTR,IAAI,CAACS,GAAG,CAAEC,KAAK,IAAK7B,MAAM,CAACQ,MAAM,CAACQ,OAAO,CAAC;QAAEc,IAAI,EAAE,SAAS;QAAElC,EAAE;QAAEmC,SAAS,EAAE;MAAG,CAAE,EAAEjB,GAAG,EAAEe,KAAK,CAAC,CAAC,CAChG,CACF;MACD,OAAO;QACLjC,EAAE;QACF6B,gBAAgB,EAAEA,gBAAgB,CAACG,GAAG,CAAEC,KAAK,IAAK,IAAIL,UAAU,CAACK,KAAK,CAAC;OACxE;IACH,CAAC,CAAC;IACJG,OAAO,EAAEA,CAAC5B,QAAQ,EAAEa,OAAO,KACzBxD,MAAM,CAACyD,GAAG,CAAC,aAAS;MAClB,MAAMJ,GAAG,GAAG,OAAOX,MAAM,CAACC,QAAQ,CAAC;MACnC,MAAM6B,aAAa,GAAG,CAAC,OAAOxE,MAAM,CAAC8C,OAAO,CAAC,MAC3CmB,OAAO,CAACC,GAAG,CAACV,OAAO,CAACW,GAAG,CAAET,IAAI,IAC3BnB,MAAM,CAACQ,MAAM,CAACwB,OAAO,CACnB;QAAEF,IAAI,EAAE,SAAS;QAAElC,EAAE,EAAEuB,IAAI,CAACvB,EAAE;QAAEmC,SAAS,EAAE;MAAG,CAAE,EAChDjB,GAAG,EACHK,IAAI,CAAC5B,cAAc,CACpB,CACF,CAAC,CACH,EAAEqC,GAAG,CAAEM,MAAM,IAAK,IAAIV,UAAU,CAACU,MAAM,CAAC,CAAC;MAC1C,MAAMC,OAAO,GAAG,OAAO1E,MAAM,CAAC2D,KAAK,CAACC,mBAAK,CAACe,WAAW,CAACH,aAAa,CAAC,CAAC;MACrE,OAAOE,OAAO,CAACP,GAAG,CAAC,CAACC,KAAK,EAAE7C,CAAC,KAAK,IAAIqD,yBAAW,CAAC;QAAEC,cAAc,EAAErB,OAAO,CAACjC,CAAC,CAAC,CAACU,QAAQ;QAAEmC;MAAK,CAAE,CAAC,CAAC;IACnG,CAAC,CAAC;IACJU,MAAM,EAAGpB,IAAI,IACX1D,MAAM,CAAC8C,OAAO,CAAC,MAAMP,MAAM,CAACQ,MAAM,CAACgC,MAAM,CAAC,SAAS,EAAErB,IAAI,CAAC,CAAC,CAACP,IAAI,CAC9DnD,MAAM,CAACmE,GAAG,CAAEa,IAAI,IAAK,IAAIjB,UAAU,CAACiB,IAAI,CAAC,CAAC,CAC3C;IACHC,YAAY,EAAGvB,IAAI,IACjB1D,MAAM,CAACmE,GAAG,CACRnE,MAAM,CAAC8C,OAAO,CAAC,MAAMP,MAAM,CAACQ,MAAM,CAACgC,MAAM,CAAC,SAAS,EAAErB,IAAI,CAAC,CAAC,EAC1DsB,IAAI,IAAI;MACP,MAAME,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAIrB,UAAU,CAACiB,IAAI,CAAC,CAAC;MAClD,MAAMK,OAAO,GAAGH,SAAS,CACtBf,GAAG,CAAEmB,KAAK,IAAKA,KAAK,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CACnDC,IAAI,CAAC,EAAE,CAAC;MACX,OAAOJ,OAAO;IAChB,CAAC;GAEN,CAAC;AACJ,CAAC,CAAC;AAEJ;;;;AAAA3D,OAAA,CAAAY,oBAAA,GAAAA,oBAAA;AAIO,MAAMoD,WAAW,GAAAhE,OAAA,CAAAgE,WAAA,gBAAoCzF,KAAK,CAAC2C,OAAO,CAAC,MACxE3C,KAAK,CAAC0F,MAAM,CAACvD,kBAAkB,EAAEE,oBAAoB,CAACsD,UAAU,CAACrD,MAAM,CAAC,CAAC,CAC1E","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLogRemote/Node.js b/dist/cjs/EventLogRemote/Node.js
new file mode 100644
index 0000000000000000000000000000000000000000..67f9c87522f4ac53ffd333727ef2248021be2ad8
--- /dev/null
+++ b/dist/cjs/EventLogRemote/Node.js
@@ -0,0 +1,23 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.layerWebSocket = void 0;
+var NodeSocket = _interopRequireWildcard(require("@effect/platform-node/NodeSocket"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var EventLogEncryption = _interopRequireWildcard(require("../EventLogEncryption.js"));
+var EventLogRemote = _interopRequireWildcard(require("../EventLogRemote.js"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+const layerWebSocket = url => EventLogRemote.layerWebSocket(url).pipe(Layer.provide([EventLogEncryption.layerSubtle, NodeSocket.layerWebSocketConstructor]));
+exports.layerWebSocket = layerWebSocket;
+//# sourceMappingURL=Node.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLogRemote/Node.js.map b/dist/cjs/EventLogRemote/Node.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..76e736a9f9e7d9bd350ab634d2f87cab8450f15b
--- /dev/null
+++ b/dist/cjs/EventLogRemote/Node.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Node.js","names":["NodeSocket","_interopRequireWildcard","require","Layer","EventLogEncryption","EventLogRemote","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","layerWebSocket","url","pipe","provide","layerSubtle","layerWebSocketConstructor","exports"],"sources":["../../../src/EventLogRemote/Node.ts"],"sourcesContent":[null],"mappings":";;;;;;AAGA,IAAAA,UAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,uBAAA,CAAAC,OAAA;AAEA,IAAAE,kBAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,cAAA,GAAAJ,uBAAA,CAAAC,OAAA;AAAsD,SAAAI,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAN,wBAAAM,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAPtD;;;;AASA;;;;AAIO,MAAMW,cAAc,GACzBC,GAAW,IAEXtB,cAAc,CAACqB,cAAc,CAACC,GAAG,CAAC,CAACC,IAAI,CACrCzB,KAAK,CAAC0B,OAAO,CAAC,CAACzB,kBAAkB,CAAC0B,WAAW,EAAE9B,UAAU,CAAC+B,yBAAyB,CAAC,CAAC,CACtF;AAAAC,OAAA,CAAAN,cAAA,GAAAA,cAAA","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLogRemote.js b/dist/cjs/EventLogRemote.js
new file mode 100644
index 0000000000000000000000000000000000000000..70f39777728a91d60eb6c9a00cfd56c395c0d38e
--- /dev/null
+++ b/dist/cjs/EventLogRemote.js
@@ -0,0 +1,362 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.layerWebSocketBrowser = exports.layerWebSocket = exports.fromWebSocket = exports.fromSocket = exports.encodeResponse = exports.encodeRequest = exports.decodeResponse = exports.decodeRequest = exports.WriteEntries = exports.StopChanges = exports.RequestChanges = exports.RemoteAdditions = exports.ProtocolResponseMsgPack = exports.ProtocolResponse = exports.ProtocolRequestMsgPack = exports.ProtocolRequest = exports.Pong = exports.Ping = exports.Hello = exports.ChunkedMessage = exports.Changes = exports.Ack = void 0;
+var MsgPack = _interopRequireWildcard(require("@effect/platform/MsgPack"));
+var Socket = _interopRequireWildcard(require("@effect/platform/Socket"));
+var Deferred = _interopRequireWildcard(require("effect/Deferred"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Exit = _interopRequireWildcard(require("effect/Exit"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
+var RcMap = _interopRequireWildcard(require("effect/RcMap"));
+var Schedule = _interopRequireWildcard(require("effect/Schedule"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+var Scope = _interopRequireWildcard(require("effect/Scope"));
+var _EventJournal = require("./EventJournal.js");
+var _EventLog = require("./EventLog.js");
+var _EventLogEncryption = require("./EventLogEncryption.js");
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+class Hello extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Hello")("Hello", {
+  remoteId: _EventJournal.RemoteId
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.Hello = Hello;
+class ChunkedMessage extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/ChunkedMessage")("ChunkedMessage", {
+  id: Schema.Number,
+  part: /*#__PURE__*/Schema.Tuple(Schema.Number, Schema.Number),
+  data: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static split(id, data) {
+    const parts = Math.ceil(data.byteLength / constChunkSize);
+    const result = new Array(parts);
+    for (let i = 0; i < parts; i++) {
+      const start = i * constChunkSize;
+      const end = Math.min((i + 1) * constChunkSize, data.byteLength);
+      result[i] = new ChunkedMessage({
+        id,
+        part: [i, parts],
+        data: data.subarray(start, end)
+      });
+    }
+    return result;
+  }
+  /**
+   * @since 1.0.0
+   */
+  static join(map, part) {
+    const [index, total] = part.part;
+    let entry = map.get(part.id);
+    if (!entry) {
+      entry = {
+        parts: new Array(total),
+        count: 0,
+        bytes: 0
+      };
+      map.set(part.id, entry);
+    }
+    entry.parts[index] = part.data;
+    entry.count++;
+    entry.bytes += part.data.byteLength;
+    if (entry.count !== total) {
+      return;
+    }
+    const data = new Uint8Array(entry.bytes);
+    let offset = 0;
+    for (const part of entry.parts) {
+      data.set(part, offset);
+      offset += part.byteLength;
+    }
+    map.delete(part.id);
+    return data;
+  }
+}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.ChunkedMessage = ChunkedMessage;
+class WriteEntries extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/WriteEntries")("WriteEntries", {
+  publicKey: Schema.String,
+  id: Schema.Number,
+  iv: Schema.Uint8ArrayFromSelf,
+  encryptedEntries: /*#__PURE__*/Schema.Array(_EventLogEncryption.EncryptedEntry)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.WriteEntries = WriteEntries;
+class Ack extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Ack")("Ack", {
+  id: Schema.Number,
+  sequenceNumbers: /*#__PURE__*/Schema.Array(Schema.Number)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.Ack = Ack;
+class RequestChanges extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/RequestChanges")("RequestChanges", {
+  publicKey: Schema.String,
+  startSequence: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.RequestChanges = RequestChanges;
+class Changes extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Changes")("Changes", {
+  publicKey: Schema.String,
+  entries: /*#__PURE__*/Schema.Array(_EventLogEncryption.EncryptedRemoteEntry)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.Changes = Changes;
+class StopChanges extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/StopChanges")("StopChanges", {
+  publicKey: Schema.String
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.StopChanges = StopChanges;
+class Ping extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Ping")("Ping", {
+  id: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.Ping = Ping;
+class Pong extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Pong")("Pong", {
+  id: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+exports.Pong = Pong;
+const ProtocolRequest = exports.ProtocolRequest = /*#__PURE__*/Schema.Union(WriteEntries, RequestChanges, StopChanges, ChunkedMessage, Ping);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const ProtocolRequestMsgPack = exports.ProtocolRequestMsgPack = /*#__PURE__*/MsgPack.schema(ProtocolRequest);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const decodeRequest = exports.decodeRequest = /*#__PURE__*/Schema.decodeSync(ProtocolRequestMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const encodeRequest = exports.encodeRequest = /*#__PURE__*/Schema.encodeSync(ProtocolRequestMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const ProtocolResponse = exports.ProtocolResponse = /*#__PURE__*/Schema.Union(Hello, Ack, Changes, ChunkedMessage, Pong);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const ProtocolResponseMsgPack = exports.ProtocolResponseMsgPack = /*#__PURE__*/MsgPack.schema(ProtocolResponse);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const decodeResponse = exports.decodeResponse = /*#__PURE__*/Schema.decodeSync(ProtocolResponseMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+const encodeResponse = exports.encodeResponse = /*#__PURE__*/Schema.encodeSync(ProtocolResponseMsgPack);
+/**
+ * @since 1.0.0
+ * @category change
+ */
+class RemoteAdditions extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/RemoveAdditions")("RemoveAdditions", {
+  entries: /*#__PURE__*/Schema.Array(_EventJournal.RemoteEntry)
+}) {}
+exports.RemoteAdditions = RemoteAdditions;
+const constChunkSize = 512_000;
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+const fromSocket = options => Effect.gen(function* () {
+  const log = yield* _EventLog.EventLog;
+  const socket = yield* Socket.Socket;
+  const encryption = yield* _EventLogEncryption.EventLogEncryption;
+  const scope = yield* Effect.scope;
+  const writeRaw = yield* socket.writer;
+  function* writeGen(request) {
+    const data = encodeRequest(request);
+    if (request._tag !== "WriteEntries" || data.byteLength <= constChunkSize) {
+      return yield* writeRaw(data);
+    }
+    const id = request.id;
+    for (const part of ChunkedMessage.split(id, data)) {
+      yield* writeRaw(encodeRequest(part));
+    }
+  }
+  const write = request => Effect.gen(() => writeGen(request));
+  yield* Effect.gen(function* () {
+    let pendingCounter = 0;
+    const pending = new Map();
+    const chunks = new Map();
+    const subscriptions = yield* RcMap.make({
+      lookup: publicKey => Effect.acquireRelease(Mailbox.make(), mailbox => Effect.zipRight(mailbox.shutdown, Effect.ignoreLogged(write(new StopChanges({
+        publicKey
+      })))))
+    });
+    const identities = new WeakMap();
+    const badPing = yield* Deferred.make();
+    let latestPing = 0;
+    let latestPong = 0;
+    if (options?.disablePing !== true) {
+      yield* Effect.suspend(() => {
+        if (latestPing !== latestPong) {
+          return Deferred.fail(badPing, new Error("Ping timeout"));
+        }
+        return write(new Ping({
+          id: ++latestPing
+        }));
+      }).pipe(Effect.delay(10000), Effect.forever, Effect.fork, Effect.interruptible);
+    }
+    function handleMessage(res) {
+      switch (res._tag) {
+        case "Hello":
+          {
+            return log.registerRemote({
+              id: res.remoteId,
+              write: (identity, entries) => Effect.gen(function* () {
+                const encrypted = yield* encryption.encrypt(identity, entries);
+                const deferred = yield* Deferred.make();
+                const id = pendingCounter++;
+                pending.set(id, {
+                  entries,
+                  deferred,
+                  publicKey: identity.publicKey
+                });
+                yield* Effect.orDie(write(new WriteEntries({
+                  publicKey: identity.publicKey,
+                  id,
+                  iv: encrypted.iv,
+                  encryptedEntries: encrypted.encryptedEntries.map((encryptedEntry, i) => ({
+                    entryId: entries[i].id,
+                    encryptedEntry
+                  }))
+                })));
+                yield* Deferred.await(deferred);
+              }),
+              changes: (identity, startSequence) => Effect.gen(function* () {
+                const mailbox = yield* RcMap.get(subscriptions, identity.publicKey);
+                identities.set(mailbox, identity);
+                yield* Effect.orDie(write(new RequestChanges({
+                  publicKey: identity.publicKey,
+                  startSequence
+                })));
+                return mailbox;
+              })
+            }).pipe(Scope.extend(scope));
+          }
+        case "Ack":
+          {
+            return Effect.gen(function* () {
+              const entry = pending.get(res.id);
+              if (!entry) return;
+              pending.delete(res.id);
+              const {
+                deferred,
+                entries,
+                publicKey
+              } = entry;
+              const remoteEntries = res.sequenceNumbers.map((sequenceNumber, i) => {
+                const entry = entries[i];
+                return new _EventJournal.RemoteEntry({
+                  remoteSequence: sequenceNumber,
+                  entry
+                });
+              });
+              const mailbox = yield* RcMap.get(subscriptions, publicKey);
+              yield* mailbox.offerAll(remoteEntries);
+              yield* Deferred.done(deferred, Exit.void);
+            });
+          }
+        case "Pong":
+          {
+            latestPong = res.id;
+            if (res.id === latestPing) {
+              return;
+            }
+            return Effect.fail(new Error("Pong id mismatch"));
+          }
+        case "Changes":
+          {
+            return Effect.gen(function* () {
+              const mailbox = yield* RcMap.get(subscriptions, res.publicKey);
+              const identity = identities.get(mailbox);
+              const entries = yield* encryption.decrypt(identity, res.entries);
+              yield* mailbox.offerAll(entries);
+            }).pipe(Effect.scoped);
+          }
+        case "ChunkedMessage":
+          {
+            const data = ChunkedMessage.join(chunks, res);
+            if (!data) return;
+            return handleMessage(decodeResponse(data));
+          }
+      }
+    }
+    return yield* socket.run(data => handleMessage(decodeResponse(data))).pipe(Effect.raceFirst(Deferred.await(badPing)));
+  }).pipe(Effect.scoped, Effect.tapErrorCause(Effect.logDebug), Effect.retry({
+    schedule: Schedule.exponential(100).pipe(Schedule.union(Schedule.spaced(5000)))
+  }), Effect.annotateLogs({
+    service: "EventLogRemote",
+    method: "fromSocket"
+  }), Effect.forkScoped, Effect.interruptible);
+});
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+exports.fromSocket = fromSocket;
+const fromWebSocket = (url, options) => Effect.gen(function* () {
+  const socket = yield* Socket.makeWebSocket(url);
+  return yield* fromSocket(options).pipe(Effect.provideService(Socket.Socket, socket));
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+exports.fromWebSocket = fromWebSocket;
+const layerWebSocket = (url, options) => Layer.scopedDiscard(fromWebSocket(url, options));
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+exports.layerWebSocket = layerWebSocket;
+const layerWebSocketBrowser = (url, options) => layerWebSocket(url, options).pipe(Layer.provide([_EventLogEncryption.layerSubtle, Socket.layerWebSocketConstructorGlobal]));
+exports.layerWebSocketBrowser = layerWebSocketBrowser;
+//# sourceMappingURL=EventLogRemote.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLogRemote.js.map b/dist/cjs/EventLogRemote.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..7e90ce1dc40cff61899ba7e170eeae7446e5c79a
--- /dev/null
+++ b/dist/cjs/EventLogRemote.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogRemote.js","names":["MsgPack","_interopRequireWildcard","require","Socket","Deferred","Effect","Exit","Layer","Mailbox","RcMap","Schedule","Schema","Scope","_EventJournal","_EventLog","_EventLogEncryption","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Hello","TaggedClass","remoteId","RemoteId","exports","ChunkedMessage","id","Number","part","Tuple","data","Uint8ArrayFromSelf","split","parts","Math","ceil","byteLength","constChunkSize","result","Array","start","end","min","subarray","join","map","index","total","entry","count","bytes","Uint8Array","offset","delete","WriteEntries","publicKey","String","iv","encryptedEntries","EncryptedEntry","Ack","sequenceNumbers","RequestChanges","startSequence","Changes","entries","EncryptedRemoteEntry","StopChanges","Ping","Pong","ProtocolRequest","Union","ProtocolRequestMsgPack","schema","decodeRequest","decodeSync","encodeRequest","encodeSync","ProtocolResponse","ProtocolResponseMsgPack","decodeResponse","encodeResponse","RemoteAdditions","RemoteEntry","fromSocket","options","gen","log","EventLog","socket","encryption","EventLogEncryption","scope","writeRaw","writer","writeGen","request","_tag","write","pendingCounter","pending","Map","chunks","subscriptions","make","lookup","acquireRelease","mailbox","zipRight","shutdown","ignoreLogged","identities","badPing","latestPing","latestPong","disablePing","suspend","fail","Error","pipe","delay","forever","fork","interruptible","handleMessage","res","registerRemote","identity","encrypted","encrypt","deferred","orDie","encryptedEntry","entryId","await","changes","extend","remoteEntries","sequenceNumber","remoteSequence","offerAll","done","void","decrypt","scoped","run","raceFirst","tapErrorCause","logDebug","retry","schedule","exponential","union","spaced","annotateLogs","service","method","forkScoped","fromWebSocket","url","makeWebSocket","provideService","layerWebSocket","scopedDiscard","layerWebSocketBrowser","provide","layerSubtle","layerWebSocketConstructorGlobal"],"sources":["../../src/EventLogRemote.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLogServer/Cloudflare.js b/dist/cjs/EventLogServer/Cloudflare.js
new file mode 100644
index 0000000000000000000000000000000000000000..6424048797549e7d1f837efe1871e67b3a544bd4
--- /dev/null
+++ b/dist/cjs/EventLogServer/Cloudflare.js
@@ -0,0 +1,140 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.EventLogDurableObject = void 0;
+var _cloudflareWorkers = require("cloudflare:workers");
+var Cause = _interopRequireWildcard(require("effect/Cause"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var ManagedRuntime = _interopRequireWildcard(require("effect/ManagedRuntime"));
+var _EventJournal = require("../EventJournal.js");
+var EventLogRemote = _interopRequireWildcard(require("../EventLogRemote.js"));
+var EventLogServer = _interopRequireWildcard(require("../EventLogServer.js"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+/// <reference types="@cloudflare/workers-types" />
+
+/**
+ * @since 1.0.0
+ * @category DurableObject
+ */
+class EventLogDurableObject extends _cloudflareWorkers.DurableObject {
+  /**
+   * @since 1.0.0
+   */
+  runtime;
+  constructor(options) {
+    super(options.ctx, options.env);
+    this.ctx.setHibernatableWebSocketEventTimeout(5000);
+    this.runtime = ManagedRuntime.make(options.storageLayer);
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketMessage(ws, message) {
+    return this.handleRequest(ws, EventLogRemote.decodeRequest(message instanceof ArrayBuffer ? new Uint8Array(message) : new TextEncoder().encode(message)));
+  }
+  chunks = /*#__PURE__*/new Map();
+  /**
+   * @since 1.0.0
+   */
+  async handleRequest(ws, request) {
+    switch (request._tag) {
+      case "WriteEntries":
+        {
+          return Effect.gen(this, function* () {
+            const storage = yield* EventLogServer.Storage;
+            const entries = request.encryptedEntries.map(({
+              encryptedEntry,
+              entryId
+            }) => new EventLogServer.PersistedEntry({
+              entryId,
+              iv: request.iv,
+              encryptedEntry
+            }));
+            const encryptedEntries = yield* storage.write(request.publicKey, entries);
+            ws.send(EventLogRemote.encodeResponse(new EventLogRemote.Ack({
+              id: request.id,
+              sequenceNumbers: encryptedEntries.map(_ => _.sequence)
+            })));
+            const changes = this.encodeChanges(request.publicKey, encryptedEntries);
+            for (const peer of this.ctx.getWebSockets()) {
+              if (peer === ws) continue;
+              for (const change of changes) {
+                peer.send(change);
+              }
+            }
+          }).pipe(this.runtime.runPromise);
+        }
+      case "ChunkedMessage":
+        {
+          const data = EventLogRemote.ChunkedMessage.join(this.chunks, request);
+          if (!data) return;
+          return this.handleRequest(ws, EventLogRemote.decodeRequest(data));
+        }
+      case "RequestChanges":
+        {
+          return Effect.gen(this, function* () {
+            const storage = yield* EventLogServer.Storage;
+            const entries = yield* storage.entries(request.publicKey, request.startSequence);
+            if (entries.length === 0) return;
+            const changes = this.encodeChanges(request.publicKey, entries);
+            for (const change of changes) {
+              ws.send(change);
+            }
+          }).pipe(this.runtime.runPromise);
+        }
+    }
+  }
+  /**
+   * @since 1.0.0
+   */
+  encodeChanges(publicKey, entries) {
+    let changes = [EventLogRemote.encodeResponse(new EventLogRemote.Changes({
+      publicKey,
+      entries
+    }))];
+    if (changes[0].byteLength > 512_000) {
+      changes = EventLogRemote.ChunkedMessage.split(Math.floor(Math.random() * 1_000_000_000), changes[0]).map(_ => EventLogRemote.encodeResponse(_));
+    }
+    return changes;
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketError(_ws, error) {
+    this.runtime.runFork(Effect.logWarning(Cause.fail(error)));
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketClose(_ws, code, reason) {
+    this.runtime.runFork(Effect.logWarning("WebSocket closed", {
+      code,
+      reason
+    }));
+  }
+  /**
+   * @since 1.0.0
+   */
+  async fetch() {
+    const webSocketPair = new WebSocketPair();
+    const [client, server] = Object.values(webSocketPair);
+    this.ctx.acceptWebSocket(server);
+    EventLogServer.Storage.pipe(Effect.flatMap(_ => _.getId), Effect.tap(remoteId => {
+      server.send(EventLogRemote.encodeResponse(new EventLogRemote.Hello({
+        remoteId: _EventJournal.RemoteId.make(remoteId)
+      })));
+    }), this.runtime.runFork);
+    return new Response(null, {
+      status: 101,
+      webSocket: client
+    });
+  }
+}
+exports.EventLogDurableObject = EventLogDurableObject;
+//# sourceMappingURL=Cloudflare.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLogServer/Cloudflare.js.map b/dist/cjs/EventLogServer/Cloudflare.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..e3be71c8a4e48e8d87fb6d760a3bb4de9a4dab28
--- /dev/null
+++ b/dist/cjs/EventLogServer/Cloudflare.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Cloudflare.js","names":["_cloudflareWorkers","require","Cause","_interopRequireWildcard","Effect","ManagedRuntime","_EventJournal","EventLogRemote","EventLogServer","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","EventLogDurableObject","DurableObject","runtime","constructor","options","ctx","env","setHibernatableWebSocketEventTimeout","make","storageLayer","webSocketMessage","ws","message","handleRequest","decodeRequest","ArrayBuffer","Uint8Array","TextEncoder","encode","chunks","Map","request","_tag","gen","storage","Storage","entries","encryptedEntries","map","encryptedEntry","entryId","PersistedEntry","iv","write","publicKey","send","encodeResponse","Ack","id","sequenceNumbers","_","sequence","changes","encodeChanges","peer","getWebSockets","change","pipe","runPromise","data","ChunkedMessage","join","startSequence","length","Changes","byteLength","split","Math","floor","random","webSocketError","_ws","error","runFork","logWarning","fail","webSocketClose","code","reason","fetch","webSocketPair","WebSocketPair","client","server","values","acceptWebSocket","flatMap","getId","tap","remoteId","Hello","RemoteId","Response","status","webSocket"],"sources":["../../../src/EventLogServer/Cloudflare.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/EventLogServer.js b/dist/cjs/EventLogServer.js
new file mode 100644
index 0000000000000000000000000000000000000000..19ae5ad5e6317163f40f9d11996ce8d8d1f20211
--- /dev/null
+++ b/dist/cjs/EventLogServer.js
@@ -0,0 +1,227 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.makeStorageMemory = exports.makeHandlerHttp = exports.makeHandler = exports.layerStorageMemory = exports.Storage = exports.PersistedEntry = void 0;
+var HttpServerRequest = _interopRequireWildcard(require("@effect/platform/HttpServerRequest"));
+var HttpServerResponse = _interopRequireWildcard(require("@effect/platform/HttpServerResponse"));
+var MsgPack = _interopRequireWildcard(require("@effect/platform/MsgPack"));
+var Chunk = _interopRequireWildcard(require("effect/Chunk"));
+var Context = _interopRequireWildcard(require("effect/Context"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var FiberMap = _interopRequireWildcard(require("effect/FiberMap"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
+var PubSub = _interopRequireWildcard(require("effect/PubSub"));
+var RcMap = _interopRequireWildcard(require("effect/RcMap"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
+var Uuid = _interopRequireWildcard(require("uuid"));
+var _EventJournal = require("./EventJournal.js");
+var _EventLogEncryption = require("./EventLogEncryption.js");
+var _EventLogRemote = require("./EventLogRemote.js");
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+const constChunkSize = 512_000;
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+const makeHandler = exports.makeHandler = /*#__PURE__*/Effect.gen(function* () {
+  const storage = yield* Storage;
+  const remoteId = yield* storage.getId;
+  let chunkId = 0;
+  function* handler(socket) {
+    const subscriptions = yield* FiberMap.make();
+    const writeRaw = yield* socket.writer;
+    const chunks = new Map();
+    let latestSequence = -1;
+    function* writeGen(response) {
+      const data = (0, _EventLogRemote.encodeResponse)(response);
+      if (response._tag !== "Changes" || data.byteLength <= constChunkSize) {
+        return yield* writeRaw(data);
+      }
+      const id = chunkId++;
+      for (const part of _EventLogRemote.ChunkedMessage.split(id, data)) {
+        yield* writeRaw((0, _EventLogRemote.encodeResponse)(part));
+      }
+    }
+    const write = response => Effect.gen(() => writeGen(response));
+    yield* Effect.fork(write(new _EventLogRemote.Hello({
+      remoteId
+    })));
+    function handleRequest(request) {
+      switch (request._tag) {
+        case "Ping":
+          {
+            return write(new _EventLogRemote.Pong({
+              id: request.id
+            }));
+          }
+        case "WriteEntries":
+          {
+            if (request.encryptedEntries.length === 0) {
+              return write(new _EventLogRemote.Ack({
+                id: request.id,
+                sequenceNumbers: []
+              }));
+            }
+            return Effect.gen(function* () {
+              const entries = request.encryptedEntries.map(({
+                encryptedEntry,
+                entryId
+              }) => new PersistedEntry({
+                entryId,
+                iv: request.iv,
+                encryptedEntry
+              }));
+              const encrypted = yield* storage.write(request.publicKey, entries);
+              latestSequence = encrypted[encrypted.length - 1].sequence;
+              return yield* write(new _EventLogRemote.Ack({
+                id: request.id,
+                sequenceNumbers: encrypted.map(e => e.sequence)
+              }));
+            });
+          }
+        case "RequestChanges":
+          {
+            return Effect.gen(function* () {
+              const changes = yield* storage.changes(request.publicKey, request.startSequence);
+              yield* changes.takeAll.pipe(Effect.flatMap(function ([entries]) {
+                const latestEntries = [];
+                for (const entry of entries) {
+                  if (entry.sequence <= latestSequence) continue;
+                  latestEntries.push(entry);
+                  latestSequence = entry.sequence;
+                }
+                if (latestEntries.length === 0) return Effect.void;
+                return write(new _EventLogRemote.Changes({
+                  publicKey: request.publicKey,
+                  entries: Chunk.toReadonlyArray(entries)
+                }));
+              }), Effect.forever);
+            }).pipe(Effect.scoped, FiberMap.run(subscriptions, request.publicKey));
+          }
+        case "StopChanges":
+          {
+            return FiberMap.remove(subscriptions, request.publicKey);
+          }
+        case "ChunkedMessage":
+          {
+            const data = _EventLogRemote.ChunkedMessage.join(chunks, request);
+            if (!data) return;
+            return handleRequest((0, _EventLogRemote.decodeRequest)(data));
+          }
+      }
+    }
+    yield* socket.run(data => handleRequest((0, _EventLogRemote.decodeRequest)(data))).pipe(Effect.catchAllCause(Effect.logDebug));
+  }
+  return socket => Effect.gen(() => handler(socket)).pipe(Effect.annotateLogs({
+    module: "EventLogServer"
+  }));
+});
+/**
+ * @since 1.0.0
+ * @category websockets
+ */
+const makeHandlerHttp = exports.makeHandlerHttp = /*#__PURE__*/Effect.gen(function* () {
+  const handler = yield* makeHandler;
+  return Effect.gen(function* () {
+    const request = yield* HttpServerRequest.HttpServerRequest;
+    const socket = yield* request.upgrade;
+    yield* handler(socket);
+    return HttpServerResponse.empty();
+  }).pipe(Effect.annotateLogs({
+    module: "EventLogServer"
+  }));
+});
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+class PersistedEntry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventLogServer/PersistedEntry")({
+  entryId: _EventJournal.EntryId,
+  iv: Schema.Uint8ArrayFromSelf,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static fromMsgPack = /*#__PURE__*/MsgPack.schema(PersistedEntry);
+  /**
+   * @since 1.0.0
+   */
+  static encode = /*#__PURE__*/Schema.encodeSync(this.fromMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  get entryIdString() {
+    return Uuid.stringify(this.entryId);
+  }
+}
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+exports.PersistedEntry = PersistedEntry;
+class Storage extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLogServer/Storage")() {}
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+exports.Storage = Storage;
+const makeStorageMemory = exports.makeStorageMemory = /*#__PURE__*/Effect.gen(function* () {
+  const knownIds = new Map();
+  const journals = new Map();
+  const remoteId = (0, _EventJournal.makeRemoteId)();
+  const ensureJournal = publicKey => {
+    let journal = journals.get(publicKey);
+    if (journal) return journal;
+    journal = [];
+    journals.set(publicKey, journal);
+    return journal;
+  };
+  const pubsubs = yield* RcMap.make({
+    lookup: _publicKey => Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown),
+    idleTimeToLive: 60000
+  });
+  return Storage.of({
+    getId: Effect.succeed(remoteId),
+    write: (publicKey, entries) => Effect.gen(function* () {
+      const active = yield* RcMap.keys(pubsubs);
+      const pubsub = active.includes(publicKey) ? yield* RcMap.get(pubsubs, publicKey) : undefined;
+      const journal = ensureJournal(publicKey);
+      const encryptedEntries = [];
+      for (const entry of entries) {
+        const idString = entry.entryIdString;
+        if (knownIds.has(idString)) continue;
+        const encrypted = _EventLogEncryption.EncryptedRemoteEntry.make({
+          sequence: journal.length,
+          entryId: entry.entryId,
+          iv: entry.iv,
+          encryptedEntry: entry.encryptedEntry
+        });
+        encryptedEntries.push(encrypted);
+        knownIds.set(idString, encrypted.sequence);
+        journal.push(encrypted);
+        pubsub?.unsafeOffer(encrypted);
+      }
+      return encryptedEntries;
+    }).pipe(Effect.scoped),
+    entries: (publicKey, startSequence) => Effect.sync(() => ensureJournal(publicKey).slice(startSequence)),
+    changes: (publicKey, startSequence) => Effect.gen(function* () {
+      const mailbox = yield* Mailbox.make();
+      const pubsub = yield* RcMap.get(pubsubs, publicKey);
+      const queue = yield* pubsub.subscribe;
+      yield* mailbox.offerAll(ensureJournal(publicKey).slice(startSequence));
+      yield* queue.takeBetween(1, Number.MAX_SAFE_INTEGER).pipe(Effect.tap(chunk => mailbox.offerAll(chunk)), Effect.forever, Effect.forkScoped, Effect.interruptible);
+      return mailbox;
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+const layerStorageMemory = exports.layerStorageMemory = /*#__PURE__*/Layer.scoped(Storage, makeStorageMemory);
+//# sourceMappingURL=EventLogServer.js.map
\ No newline at end of file
diff --git a/dist/cjs/EventLogServer.js.map b/dist/cjs/EventLogServer.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..d6c4069b3b8e0ed983a7bc33042f44d22be39591
--- /dev/null
+++ b/dist/cjs/EventLogServer.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogServer.js","names":["HttpServerRequest","_interopRequireWildcard","require","HttpServerResponse","MsgPack","Chunk","Context","Effect","FiberMap","Layer","Mailbox","PubSub","RcMap","Schema","Uuid","_EventJournal","_EventLogEncryption","_EventLogRemote","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","constChunkSize","makeHandler","exports","gen","storage","Storage","remoteId","getId","chunkId","handler","socket","subscriptions","make","writeRaw","writer","chunks","Map","latestSequence","writeGen","response","data","encodeResponse","_tag","byteLength","id","part","ChunkedMessage","split","write","fork","Hello","handleRequest","request","Pong","encryptedEntries","length","Ack","sequenceNumbers","entries","map","encryptedEntry","entryId","PersistedEntry","iv","encrypted","publicKey","sequence","changes","startSequence","takeAll","pipe","flatMap","latestEntries","entry","push","void","Changes","toReadonlyArray","forever","scoped","run","remove","join","decodeRequest","catchAllCause","logDebug","annotateLogs","module","makeHandlerHttp","upgrade","empty","Class","EntryId","Uint8ArrayFromSelf","fromMsgPack","schema","encode","encodeSync","entryIdString","stringify","Tag","makeStorageMemory","knownIds","journals","makeRemoteId","ensureJournal","journal","pubsubs","lookup","_publicKey","acquireRelease","unbounded","shutdown","idleTimeToLive","of","succeed","active","keys","pubsub","includes","undefined","idString","EncryptedRemoteEntry","unsafeOffer","sync","slice","mailbox","queue","subscribe","offerAll","takeBetween","Number","MAX_SAFE_INTEGER","tap","chunk","forkScoped","interruptible","layerStorageMemory"],"sources":["../../src/EventLogServer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Machine/Procedure.js.map b/dist/cjs/Machine/Procedure.js.map
index fd8ce4c8c65a2a9179038b33bf893c7f595aa8eb..9920d055d984e49ef1b7e276f06b09c3dee7d3da 100644
--- a/dist/cjs/Machine/Procedure.js.map
+++ b/dist/cjs/Machine/Procedure.js.map
@@ -1 +1 @@
-{"version":3,"file":"Procedure.js","names":["_Pipeable","require","Predicate","_interopRequireWildcard","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","SerializableTypeId","isSerializable","hasProperty","NoReply","make","tag","handler","pipe","pipeArguments","arguments","makeSerializable","schema","_tag"],"sources":["../../../src/Machine/Procedure.ts"],"sourcesContent":[null],"mappings":";;;;;;AAOA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AAA6C,SAAAG,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAF,wBAAAE,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAG7C;;;;AAIO,MAAMW,MAAM,GAAAC,OAAA,CAAAD,MAAA,gBAAkBE,MAAM,CAACC,GAAG,CAAC,wCAAwC,CAAC;AAwCzF;;;;AAIO,MAAMC,kBAAkB,GAAAH,OAAA,CAAAG,kBAAA,gBAAkBF,MAAM,CAACC,GAAG,CAAC,oDAAoD,CAAC;AAQjH;;;;AAIO,MAAME,cAAc,GAAIV,CAAU,IACvCjB,SAAS,CAAC4B,WAAW,CAACX,CAAC,EAAES,kBAAkB,CAAC;AAa9C;;;;AAAAH,OAAA,CAAAI,cAAA,GAAAA,cAAA;AAIO,MAAME,OAAO,GAAAN,OAAA,CAAAM,OAAA,gBAAGL,MAAM,CAACC,GAAG,CAAC,gDAAgD,CAAC;AA0HnF;;;;AAIO,MAAMK,IAAI,GAAGA,CAAA,KACpB,MACA,CACEC,GAAgB,EAChBC,OAAyC,MACX;EAC9B,CAACV,MAAM,GAAGA,MAAM;EAChBU,OAAO;EACPD,GAAG;EACHE,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAAAZ,OAAA,CAAAO,IAAA,GAAAA,IAAA;AAIO,MAAMM,gBAAgB,GAAGA,CAAA,KAIhC,CAMEC,MAAmE,EACnEL,OAAyC,MACoD;EAC7F,CAACV,MAAM,GAAGA,MAAM;EAChB,CAACI,kBAAkB,GAAGA,kBAAkB;EACxCW,MAAM,EAAEA,MAAa;EACrBL,OAAO;EACPD,GAAG,EAAEM,MAAM,CAACC,IAAI;EAChBL,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAC;AAAAZ,OAAA,CAAAa,gBAAA,GAAAA,gBAAA","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Procedure.js","names":["_Pipeable","require","Predicate","_interopRequireWildcard","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","SerializableTypeId","isSerializable","hasProperty","NoReply","make","tag","handler","pipe","pipeArguments","arguments","makeSerializable","schema","_tag"],"sources":["../../../src/Machine/Procedure.ts"],"sourcesContent":[null],"mappings":";;;;;;AAKA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AAA6C,SAAAG,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAF,wBAAAE,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAI7C;;;;AAIO,MAAMW,MAAM,GAAAC,OAAA,CAAAD,MAAA,gBAAkBE,MAAM,CAACC,GAAG,CAAC,wCAAwC,CAAC;AAwCzF;;;;AAIO,MAAMC,kBAAkB,GAAAH,OAAA,CAAAG,kBAAA,gBAAkBF,MAAM,CAACC,GAAG,CAAC,oDAAoD,CAAC;AAQjH;;;;AAIO,MAAME,cAAc,GAAIV,CAAU,IACvCjB,SAAS,CAAC4B,WAAW,CAACX,CAAC,EAAES,kBAAkB,CAAC;AAa9C;;;;AAAAH,OAAA,CAAAI,cAAA,GAAAA,cAAA;AAIO,MAAME,OAAO,GAAAN,OAAA,CAAAM,OAAA,gBAAGL,MAAM,CAACC,GAAG,CAAC,gDAAgD,CAAC;AA0HnF;;;;AAIO,MAAMK,IAAI,GAAGA,CAAA,KACpB,MACA,CACEC,GAAgB,EAChBC,OAAyC,MACX;EAC9B,CAACV,MAAM,GAAGA,MAAM;EAChBU,OAAO;EACPD,GAAG;EACHE,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAAAZ,OAAA,CAAAO,IAAA,GAAAA,IAAA;AAIO,MAAMM,gBAAgB,GAAGA,CAAA,KAIhC,CAMEC,MAAmE,EACnEL,OAAyC,MAC8C;EACvF,CAACV,MAAM,GAAGA,MAAM;EAChB,CAACI,kBAAkB,GAAGA,kBAAkB;EACxCW,MAAM,EAAEA,MAAa;EACrBL,OAAO;EACPD,GAAG,EAAEM,MAAM,CAACC,IAAI;EAChBL,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAC;AAAAZ,OAAA,CAAAa,gBAAA,GAAAA,gBAAA","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Machine/ProcedureList.js.map b/dist/cjs/Machine/ProcedureList.js.map
index 685307c87114304eebb9df5d363645f835938937..243113f327e473c51d08c1cb4af2fd6c16ed72a6 100644
--- a/dist/cjs/Machine/ProcedureList.js.map
+++ b/dist/cjs/Machine/ProcedureList.js.map
@@ -1 +1 @@
-{"version":3,"file":"ProcedureList.js","names":["Effect","_interopRequireWildcard","require","Effectable","_Function","Procedure","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","Proto","CommitPrototype","commit","succeed","makeProto","options","assign","create","make","initialState","public","private","identifier","addProcedure","dual","self","procedure","addProcedurePrivate","add","tag","handler","addPrivate","withInitialState"],"sources":["../../../src/Machine/ProcedureList.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"ProcedureList.js","names":["Effect","_interopRequireWildcard","require","Effectable","_Function","Procedure","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","Proto","CommitPrototype","commit","succeed","makeProto","options","assign","create","make","initialState","public","private","identifier","addProcedure","dual","self","procedure","addProcedurePrivate","add","tag","handler","addPrivate","withInitialState"],"sources":["../../../src/Machine/ProcedureList.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Machine/SerializableProcedureList.js.map b/dist/cjs/Machine/SerializableProcedureList.js.map
index f08a50dfba1a223e16ac7ece47b0dec6bccc45e8..cc68ebe359316006013c6dd6701080dcc3a91c0e 100644
--- a/dist/cjs/Machine/SerializableProcedureList.js.map
+++ b/dist/cjs/Machine/SerializableProcedureList.js.map
@@ -1 +1 @@
-{"version":3,"file":"SerializableProcedureList.js","names":["_Function","require","Procedure","_interopRequireWildcard","ProcedureList","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","exports","add","dual","self","schema","handler","addProcedure","makeSerializable","addPrivate","addProcedurePrivate","withInitialState"],"sources":["../../../src/Machine/SerializableProcedureList.ts"],"sourcesContent":[null],"mappings":";;;;;;AAMA,IAAAA,SAAA,GAAAC,OAAA;AAEA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,aAAA,GAAAD,uBAAA,CAAAF,OAAA;AAAmD,SAAAI,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAH,wBAAAG,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAmBnD;;;;AAIO,MAAMW,IAAI,GAAAC,OAAA,CAAAD,IAAA,GAK4CrB,aAAa,CAACqB,IAAW;AAEtF;;;;AAIO,MAAME,GAAG,GAAAD,OAAA,CAAAC,GAAA,gBAkCZ,IAAAC,cAAI,EACN,CAAC,EACD,CAUEC,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAMtG3B,aAAa,CAAC4B,YAAY,CAACH,IAAI,EAAE3B,SAAS,CAAC+B,gBAAgB,EAAY,CAACH,MAAM,EAAEC,OAAO,CAAC,CAAQ,CACtG;AAED;;;;AAIO,MAAMG,UAAU,GAAAR,OAAA,CAAAQ,UAAA,gBAkCnB,IAAAN,cAAI,EACN,CAAC,EACD,CAUEC,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAMtG3B,aAAa,CAAC+B,mBAAmB,CAACN,IAAI,EAAE3B,SAAS,CAAC+B,gBAAgB,EAAY,CAACH,MAAM,EAAEC,OAAO,CAAC,CAAQ,CAC7G;AAED;;;;AAIO,MAAMK,gBAAgB,GAAAV,OAAA,CAAAU,gBAAA,GAUzBhC,aAAa,CAACgC,gBAAuB","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"SerializableProcedureList.js","names":["_Function","require","Procedure","_interopRequireWildcard","ProcedureList","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","exports","add","dual","self","schema","handler","addProcedure","makeSerializable","addPrivate","addProcedurePrivate","withInitialState"],"sources":["../../../src/Machine/SerializableProcedureList.ts"],"sourcesContent":[null],"mappings":";;;;;;AAIA,IAAAA,SAAA,GAAAC,OAAA;AAGA,IAAAC,SAAA,GAAAC,uBAAA,CAAAF,OAAA;AACA,IAAAG,aAAA,GAAAD,uBAAA,CAAAF,OAAA;AAAmD,SAAAI,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAH,wBAAAG,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAmBnD;;;;AAIO,MAAMW,IAAI,GAAAC,OAAA,CAAAD,IAAA,GAK4CrB,aAAa,CAACqB,IAAW;AAEtF;;;;AAIO,MAAME,GAAG,GAAAD,OAAA,CAAAC,GAAA,gBA0CZ,IAAAC,cAAI,EACN,CAAC,EACD,CAUEC,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAOzG3B,aAAa,CAAC4B,YAAY,CACxBH,IAAI,EACJ3B,SAAS,CAAC+B,gBAAgB,EAUvB,CAACH,MAAM,EAAEC,OAAO,CAAC,CACd,CACX;AAED;;;;AAIO,MAAMG,UAAU,GAAAR,OAAA,CAAAQ,UAAA,gBA0CnB,IAAAN,cAAI,EACN,CAAC,EACD,CAUEC,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAOzG3B,aAAa,CAAC+B,mBAAmB,CAC/BN,IAAI,EACJ3B,SAAS,CAAC+B,gBAAgB,EAUvB,CAACH,MAAM,EAAEC,OAAO,CAAC,CACd,CACX;AAED;;;;AAIO,MAAMK,gBAAgB,GAAAV,OAAA,CAAAU,gBAAA,GAkBzBhC,aAAa,CAACgC,gBAAuB","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Machine.js b/dist/cjs/Machine.js
index c0da90bf35a63229da710537cc215f10029a8832..9fe5bedc3ccca06b564f2eaefa9fe1a5410be633 100644
--- a/dist/cjs/Machine.js
+++ b/dist/cjs/Machine.js
@@ -11,8 +11,6 @@ Object.defineProperty(exports, "NoReply", {
   }
 });
 exports.withTracingEnabled = exports.snapshot = exports.serializable = exports.retry = exports.restore = exports.procedures = exports.makeWith = exports.makeSerializable = exports.make = exports.currentTracingEnabled = exports.boot = exports.TypeId = exports.SerializableTypeId = void 0;
-var Schema = _interopRequireWildcard(require("@effect/schema/Schema"));
-var Serializable = _interopRequireWildcard(require("@effect/schema/Serializable"));
 var Arr = _interopRequireWildcard(require("effect/Array"));
 var Cause = _interopRequireWildcard(require("effect/Cause"));
 var Context = _interopRequireWildcard(require("effect/Context"));
@@ -30,6 +28,7 @@ var _Pipeable = require("effect/Pipeable");
 var PubSub = _interopRequireWildcard(require("effect/PubSub"));
 var Queue = _interopRequireWildcard(require("effect/Queue"));
 var Readable = _interopRequireWildcard(require("effect/Readable"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
 var Stream = _interopRequireWildcard(require("effect/Stream"));
 var Subscribable = _interopRequireWildcard(require("effect/Subscribable"));
 var Tracer = _interopRequireWildcard(require("effect/Tracer"));
@@ -40,6 +39,10 @@ var _serializable = _interopRequireWildcard(require("./Machine/SerializableProce
 exports.serializable = _serializable;
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
 /**
  * @since 1.0.0
  * @category procedures
@@ -154,11 +157,11 @@ const withTracingEnabled = exports.withTracingEnabled = /*#__PURE__*/(0, _Functi
  * @since 1.0.0
  * @category runtime
  */
-const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
-  const context = yield* _(Effect.context());
-  const requests = yield* _(Queue.unbounded());
-  const pubsub = yield* _(Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown));
-  const latch = yield* _(Deferred.make());
+const boot = (self, ...[input, options]) => Effect.gen(function* () {
+  const context = yield* Effect.context();
+  const requests = yield* Queue.unbounded();
+  const pubsub = yield* Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown);
+  const latch = yield* Deferred.make();
   let currentState = undefined;
   let runState = {
     identifier: "Unknown",
@@ -205,7 +208,7 @@ const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
     }, span => Queue.offer(requests, [request, deferred, span, true]));
   });
   const sendExternal = request => Effect.suspend(() => runState.publicTags.has(request._tag) ? send(request) : Effect.die(`Request ${request._tag} marked as internal`));
-  const sendUnknown = u => Effect.suspend(() => runState.decodeRequest(u).pipe(Effect.flatMap(req => Effect.flatMap(Effect.exit(send(req)), exit => Serializable.serializeExit(req, exit))), Effect.provide(context)));
+  const sendUnknown = u => Effect.suspend(() => runState.decodeRequest(u).pipe(Effect.flatMap(req => Effect.flatMap(Effect.exit(send(req)), exit => Schema.serializeExit(req, exit))), Effect.provide(context)));
   const publishState = newState => {
     if (currentState !== newState) {
       currentState = newState;
@@ -213,9 +216,9 @@ const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
     }
     return Effect.void;
   };
-  const run = Effect.gen(function* (_) {
-    const fiberSet = yield* _(FiberSet.make());
-    const fiberMap = yield* _(FiberMap.make());
+  const run = Effect.gen(function* () {
+    const fiberSet = yield* FiberSet.make();
+    const fiberMap = yield* FiberMap.make();
     const fork = effect => Effect.asVoid(FiberSet.run(fiberSet, MachineDefect.wrap(effect)));
     const forkWith = (0, _Function.dual)(2, (effect, state) => Effect.map(fork(effect), _ => [_, state]));
     const forkReplace = (0, _Function.dual)(2, (effect, id) => Effect.asVoid(FiberMap.run(fiberMap, id, MachineDefect.wrap(effect))));
@@ -236,15 +239,15 @@ const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       forkReplace,
       forkReplaceWith
     };
-    const procedures = yield* _(self.initialize(input, currentState ?? options?.previousState), Effect.provideService(MachineContext, contextProto));
+    const procedures = yield* (0, _Function.pipe)(self.initialize(input, currentState ?? options?.previousState), Effect.provideService(MachineContext, contextProto));
     const procedureMap = Object.fromEntries(procedures.private.map(p => [p.tag, p]).concat(procedures.public.map(p => [p.tag, p])));
     runState = {
       identifier: procedures.identifier,
       publicTags: new Set(procedures.public.map(p => p.tag)),
       decodeRequest: Schema.decodeUnknown(Schema.Union(...Arr.filter(procedures.public, Procedure.isSerializable).map(p => p.schema)))
     };
-    yield* _(publishState(procedures.initialState));
-    yield* _(Deferred.succeed(latch, void 0));
+    yield* publishState(procedures.initialState);
+    yield* Deferred.succeed(latch, void 0);
     const process = (0, _Function.pipe)(Queue.take(requests), Effect.flatMap(([request, deferred, span, addSpan]) => Effect.flatMap(Deferred.isDone(deferred), done => {
       if (done) {
         return Effect.void;
@@ -286,7 +289,7 @@ const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       }
       return handler;
     })), Effect.forever, Effect.provideService(MachineContext, contextProto));
-    yield* _(Effect.all([process, FiberSet.join(fiberSet), FiberMap.join(fiberMap)], {
+    yield* (0, _Function.pipe)(Effect.all([process, FiberSet.join(fiberSet), FiberMap.join(fiberMap)], {
       concurrency: "unbounded",
       discard: true
     }), Effect.onExit(exit => {
@@ -299,8 +302,8 @@ const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       cause
     }))));
   }).pipe(Effect.scoped);
-  const fiber = yield* _(run, self.retryPolicy ? Effect.retry(self.retryPolicy) : _Function.identity, Effect.forkScoped, Effect.interruptible);
-  yield* _(Deferred.await(latch));
+  const fiber = yield* (0, _Function.pipe)(run, self.retryPolicy ? Effect.retry(self.retryPolicy) : _Function.identity, Effect.forkScoped, Effect.interruptible);
+  yield* Deferred.await(latch);
   return (0, _Function.identity)(Object.assign(Object.create(ActorProto), {
     machine: self,
     input: input,
diff --git a/dist/cjs/Machine.js.map b/dist/cjs/Machine.js.map
index 4109332c9b6b00b79b6e043d52a76fede5a91ee8..65dbb2436091693e7e7f9a8185efffabed7e8301 100644
--- a/dist/cjs/Machine.js.map
+++ b/dist/cjs/Machine.js.map
@@ -1 +1 @@
-{"version":3,"file":"Machine.js","names":["Schema","_interopRequireWildcard","require","Serializable","Arr","Cause","Context","Deferred","Effect","Fiber","FiberMap","FiberRef","FiberRefs","FiberSet","_Function","_GlobalValue","Option","_Pipeable","PubSub","Queue","Readable","Stream","Subscribable","Tracer","Procedure","_procedures","exports","procedures","_serializable","serializable","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","Symbol","for","SerializableTypeId","ActorTypeId","MachineDefect","TaggedError","cause","Defect","wrap","effect","catchAllCause","orDie","fail","squash","MachineContext","Tag","ActorProto","pipe","pipeArguments","arguments","make","initialize","isEffect","retryPolicy","undefined","makeWith","makeSerializable","options","identifier","schemaInput","input","schemaState","state","retry","dual","self","currentTracingEnabled","globalValue","unsafeMake","withTracingEnabled","enabled","locally","boot","gen","_","context","requests","unbounded","pubsub","acquireRelease","shutdown","latch","currentState","runState","publicTags","Set","decodeRequest","requestContext","request","sync","fiber","getOrThrow","getCurrentFiber","fiberRefs","getFiberRefs","getOrDefault","currentContext","deferred","id","span","unsafeMap","ParentSpan","key","addSpans","send","flatMap","item","offer","zipRight","await","onInterrupt","interrupt","useSpan","_tag","parent","attributes","kind","captureStackTrace","sendIgnore","sendExternal","suspend","die","sendUnknown","req","exit","serializeExit","provide","publishState","newState","publish","void","run","fiberSet","fiberMap","fork","asVoid","forkWith","map","forkReplace","forkReplaceWith","forkOne","onlyIfMissing","forkOneWith","contextProto","sendAwait","unsafeSend","unsafeSendAwait","previousState","provideService","procedureMap","fromEntries","private","p","tag","concat","public","decodeUnknown","Union","filter","isSerializable","schema","initialState","succeed","process","take","addSpan","isDone","done","procedure","create","handler","matchCauseEffect","onFailure","isFailure","failCause","onSuccess","response","NoReply","withSpan","forever","all","join","concurrency","discard","onExit","takeAll","forEach","tapErrorCause","getWith","unhandledErrorLogLevel","match","onNone","onSome","level","log","currentLogLevel","catchAllDefect","scoped","identity","forkScoped","interruptible","assign","machine","changes","fromPubSub","snapshot","zip","encode","restore","Tuple"],"sources":["../../src/Machine.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Machine.js","names":["Arr","_interopRequireWildcard","require","Cause","Context","Deferred","Effect","Fiber","FiberMap","FiberRef","FiberRefs","FiberSet","_Function","_GlobalValue","Option","_Pipeable","PubSub","Queue","Readable","Schema","Stream","Subscribable","Tracer","Procedure","_procedures","exports","procedures","_serializable","serializable","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","Symbol","for","SerializableTypeId","ActorTypeId","MachineDefect","TaggedError","cause","Defect","wrap","effect","catchAllCause","orDie","fail","squash","MachineContext","Tag","ActorProto","pipe","pipeArguments","arguments","make","initialize","isEffect","retryPolicy","undefined","makeWith","makeSerializable","options","identifier","schemaInput","input","schemaState","state","retry","dual","self","currentTracingEnabled","globalValue","unsafeMake","withTracingEnabled","enabled","locally","boot","gen","context","requests","unbounded","pubsub","acquireRelease","shutdown","latch","currentState","runState","publicTags","Set","decodeRequest","requestContext","request","sync","fiber","getOrThrow","getCurrentFiber","fiberRefs","getFiberRefs","getOrDefault","currentContext","deferred","id","span","unsafeMap","ParentSpan","key","addSpans","send","flatMap","item","offer","zipRight","await","onInterrupt","interrupt","useSpan","_tag","parent","attributes","kind","captureStackTrace","sendIgnore","sendExternal","suspend","die","sendUnknown","req","exit","serializeExit","provide","publishState","newState","publish","void","run","fiberSet","fiberMap","fork","asVoid","forkWith","map","_","forkReplace","forkReplaceWith","forkOne","onlyIfMissing","forkOneWith","contextProto","sendAwait","unsafeSend","unsafeSendAwait","previousState","provideService","procedureMap","fromEntries","private","p","tag","concat","public","decodeUnknown","Union","filter","isSerializable","schema","initialState","succeed","process","take","addSpan","isDone","done","procedure","create","handler","matchCauseEffect","onFailure","isFailure","failCause","onSuccess","response","NoReply","withSpan","forever","all","join","concurrency","discard","onExit","takeAll","forEach","tapErrorCause","getWith","unhandledErrorLogLevel","match","onNone","onSome","level","log","currentLogLevel","catchAllDefect","scoped","identity","forkScoped","interruptible","assign","machine","changes","fromPubSub","snapshot","zip","encode","restore","Tuple"],"sources":["../../src/Machine.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;AAGA,IAAAA,GAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,KAAA,GAAAF,uBAAA,CAAAC,OAAA;AACA,IAAAE,OAAA,GAAAH,uBAAA,CAAAC,OAAA;AACA,IAAAG,QAAA,GAAAJ,uBAAA,CAAAC,OAAA;AACA,IAAAI,MAAA,GAAAL,uBAAA,CAAAC,OAAA;AACA,IAAAK,KAAA,GAAAN,uBAAA,CAAAC,OAAA;AACA,IAAAM,QAAA,GAAAP,uBAAA,CAAAC,OAAA;AACA,IAAAO,QAAA,GAAAR,uBAAA,CAAAC,OAAA;AACA,IAAAQ,SAAA,GAAAT,uBAAA,CAAAC,OAAA;AACA,IAAAS,QAAA,GAAAV,uBAAA,CAAAC,OAAA;AACA,IAAAU,SAAA,GAAAV,OAAA;AACA,IAAAW,YAAA,GAAAX,OAAA;AACA,IAAAY,MAAA,GAAAb,uBAAA,CAAAC,OAAA;AAGA,IAAAa,SAAA,GAAAb,OAAA;AACA,IAAAc,MAAA,GAAAf,uBAAA,CAAAC,OAAA;AACA,IAAAe,KAAA,GAAAhB,uBAAA,CAAAC,OAAA;AACA,IAAAgB,QAAA,GAAAjB,uBAAA,CAAAC,OAAA;AAGA,IAAAiB,MAAA,GAAAlB,uBAAA,CAAAC,OAAA;AAEA,IAAAkB,MAAA,GAAAnB,uBAAA,CAAAC,OAAA;AACA,IAAAmB,YAAA,GAAApB,uBAAA,CAAAC,OAAA;AACA,IAAAoB,MAAA,GAAArB,uBAAA,CAAAC,OAAA;AACA,IAAAqB,SAAA,GAAAtB,uBAAA,CAAAC,OAAA;AAAmD,IAAAsB,WAAA,GAAAvB,uBAAA,CAAAC,OAAA;AAAAuB,OAAA,CAAAC,UAAA,GAAAF,WAAA;AAAA,IAAAG,aAAA,GAAA1B,uBAAA,CAAAC,OAAA;AAAAuB,OAAA,CAAAG,YAAA,GAAAD,aAAA;AAAA,SAAAE,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAA7B,wBAAA6B,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AA7BnD;;;;AAiCA;;;;;AAMA;;;;;AAcA;;;;AAIO,MAAMW,MAAM,GAAAxB,OAAA,CAAAwB,MAAA,gBAAkBC,MAAM,CAACC,GAAG,CAAC,8BAA8B,CAAC;AAyB/E;;;;AAIO,MAAMC,kBAAkB,GAAA3B,OAAA,CAAA2B,kBAAA,gBAAkBF,MAAM,CAACC,GAAG,CAAC,2CAA2C,CAAC;AAmCxG;;;;AAIO,MAAME,WAAW,GAAA5B,OAAA,CAAA4B,WAAA,gBAAkBH,MAAM,CAACC,GAAG,CAAC,oCAAoC,CAAC;AAQ1F;;;;AAIM,MAAOG,aAAc,sBAAQnC,MAAM,CAACoC,WAAW,EAAiB,CAAC,eAAe,EAAE;EACtFC,KAAK,EAAErC,MAAM,CAACsC;CACf,CAAC;EACA;;;EAGA,OAAOC,IAAIA,CAAUC,MAA8B;IACjD,OAAOrD,MAAM,CAACsD,aAAa,CACzBtD,MAAM,CAACuD,KAAK,CAACF,MAAM,CAAC,EACnBH,KAAK,IAAKlD,MAAM,CAACwD,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE,KAAK,EAAErD,KAAK,CAAC4D,MAAM,CAACP,KAAK;IAAC,CAAE,CAAC,CAAC,CAC1E;EACH;;AAGF;;;;AAAA/B,OAAA,CAAA6B,aAAA,GAAAA,aAAA;AAIM,MAAOU,cAAe,sBAAQ5D,OAAO,CAAC6D,GAAG,CAAC,sCAAsC,CAAC,EAGpF;AAAAxC,OAAA,CAAAuC,cAAA,GAAAA,cAAA;AAwIH,MAAME,UAAU,GAAG;EACjB,CAACb,WAAW,GAAGA,WAAW;EAC1B,CAACnC,QAAQ,CAAC+B,MAAM,GAAG/B,QAAQ,CAAC+B,MAAM;EAClC,CAAC5B,YAAY,CAAC4B,MAAM,GAAG5B,YAAY,CAAC4B,MAAM;EAC1CkB,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD;AAaD;;;;AAIO,MAAMC,IAAI,GAgBfC,UAEuE,KACwB;EAC/F,CAACtB,MAAM,GAAGA,MAAM;EAChBsB,UAAU,EAAEjE,MAAM,CAACkE,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFE,WAAW,EAAEC,SAAS;EACtBP,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAAA5C,OAAA,CAAA6C,IAAA,GAAAA,IAAA;AAIO,MAAMK,QAAQ,GAAGA,CAAA,KAOnBL,IAAI;AAET;;;;AAAA7C,OAAA,CAAAkD,QAAA,GAAAA,QAAA;AAIO,MAAMC,gBAAgB,GA4CzBA,CAYFC,OAGC,EACDN,UAEmF,MACkC;EACrH,CAACtB,MAAM,GAAGA,MAAM;EAChB,CAACG,kBAAkB,GAAGA,kBAAkB;EACxCmB,UAAU,EAAEjE,MAAM,CAACkE,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFO,UAAU,EAAE,qBAAqB;EACjCL,WAAW,EAAEC,SAAS;EACtBK,WAAW,EAAEF,OAAO,CAACG,KAAY;EACjCC,WAAW,EAAEJ,OAAO,CAACK,KAAY;EAEjCf,IAAIA,CAAA;IACF,OAAO,IAAAC,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD,CAAS;AAEV;;;;AAAA5C,OAAA,CAAAmD,gBAAA,GAAAA,gBAAA;AAIO,MAAMO,KAAK,GAAA1D,OAAA,CAAA0D,KAAA,gBAgBd,IAAAC,cAAI,EAAC,CAAC,EAAE,CACVC,IAAO,EACPZ,WAA0C,MACX;EAC/B,GAAGY,IAAI;EACPZ;CACD,CAAS,CAAC;AAEX;;;;AAIO,MAAMa,qBAAqB,GAAA7D,OAAA,CAAA6D,qBAAA,gBAA+B,IAAAC,wBAAW,EAC1E,oDAAoD,EACpD,MAAM9E,QAAQ,CAAC+E,UAAU,CAAC,IAAI,CAAC,CAChC;AAED;;;;AAIO,MAAMC,kBAAkB,GAAAhE,OAAA,CAAAgE,kBAAA,gBAW3B,IAAAL,cAAI,EACN,CAAC,EACD,CAAUC,IAA4B,EAAEK,OAAgB,KAAKpF,MAAM,CAACqF,OAAO,CAACN,IAAI,EAAEC,qBAAqB,EAAEI,OAAO,CAAC,CAClH;AAED;;;;AAIO,MAAME,IAAI,GAAGA,CAGlBP,IAAO,EACP,GAAG,CAACL,KAAK,EAAEH,OAAO,CAOf,KAMHvE,MAAM,CAACuF,GAAG,CAAC,aAAS;EAClB,MAAMC,OAAO,GAAG,OAAOxF,MAAM,CAACwF,OAAO,EAAsB;EAC3D,MAAMC,QAAQ,GAAG,OAAO9E,KAAK,CAAC+E,SAAS,EAOpC;EACH,MAAMC,MAAM,GAAG,OAAO3F,MAAM,CAAC4F,cAAc,CACzClF,MAAM,CAACgF,SAAS,EAAoB,EACpChF,MAAM,CAACmF,QAAQ,CAChB;EACD,MAAMC,KAAK,GAAG,OAAO/F,QAAQ,CAACiE,IAAI,EAAQ;EAE1C,IAAI+B,YAAY,GAAqB3B,SAAgB;EACrD,IAAI4B,QAAQ,GAIR;IACFxB,UAAU,EAAE,SAAS;IACrByB,UAAU,EAAE,IAAIC,GAAG,EAAU;IAC7BC,aAAa,EAAE/B;GAChB;EAED,MAAMgC,cAAc,GAAiCC,OAAU,IAC7DrG,MAAM,CAACsG,IAAI,CAAC,MAAK;IACf,MAAMC,KAAK,GAAG/F,MAAM,CAACgG,UAAU,CAACvG,KAAK,CAACwG,eAAe,EAAE,CAAC;IACxD,MAAMC,SAAS,GAAGH,KAAK,CAACI,YAAY,EAAE;IACtC,MAAMnB,OAAO,GAAGpF,SAAS,CAACwG,YAAY,CAACF,SAAS,EAAEvG,QAAQ,CAAC0G,cAAc,CAAC;IAE1E,MAAMC,QAAQ,GAAG/G,QAAQ,CAACmF,UAAU,CAAuCqB,KAAK,CAACQ,EAAE,EAAE,CAAC;IACtF,MAAMC,IAAI,GAA+BxB,OAAO,CAACyB,SAAS,CAAClF,GAAG,CAACf,MAAM,CAACkG,UAAU,CAACC,GAAG,CAAC;IACrF,MAAMC,QAAQ,GAAGhH,SAAS,CAACwG,YAAY,CAACF,SAAS,EAAE1B,qBAAqB,CAAC;IAEzE,OAAO,CAACqB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEI,QAAQ,CAAU;EACrD,CAAC,CAAC;EAEJ,MAAMC,IAAI,GAAiChB,OAAU,IACnDrG,MAAM,CAACsH,OAAO,CACZlB,cAAc,CAACC,OAAO,CAAC,EACtBkB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAO5G,KAAK,CAAC6G,KAAK,CAAC/B,QAAQ,EAAE8B,IAAI,CAAC,CAAC1D,IAAI,CACrC7D,MAAM,CAACyH,QAAQ,CAAC1H,QAAQ,CAAC2H,KAAK,CAACH,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EACxCvH,MAAM,CAAC2H,WAAW,CAAC,MAAM5H,QAAQ,CAAC6H,SAAS,CAACL,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACtD;IACH;IACA,MAAM,GAAGT,QAAQ,EAAEE,IAAI,CAAC,GAAGO,IAAI;IAC/B,OAAOvH,MAAM,CAAC6H,OAAO,CAAC,gBAAgBxB,OAAO,CAACyB,IAAI,EAAE,EAAE;MACpDC,MAAM,EAAEf,IAAI;MACZgB,UAAU,EAAE;QACV,gBAAgB,EAAEhC,QAAQ,CAACxB,UAAU;QACrC,GAAG6B;OACJ;MACD4B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGlB,IAAI,IACNrG,KAAK,CAAC6G,KAAK,CAAC/B,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAACnD,IAAI,CACzD7D,MAAM,CAACyH,QAAQ,CAAC1H,QAAQ,CAAC2H,KAAK,CAACZ,QAAQ,CAAC,CAAC,EACzC9G,MAAM,CAAC2H,WAAW,CAAC,MAAM5H,QAAQ,CAAC6H,SAAS,CAACd,QAAQ,CAAC,CAAC,CACvD,CAAC;EACN,CAAC,CACF;EAEH,MAAMqB,UAAU,GAAiC9B,OAAU,IACzDrG,MAAM,CAACsH,OAAO,CACZlB,cAAc,CAACC,OAAO,CAAC,EACtBkB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAO5G,KAAK,CAAC6G,KAAK,CAAC/B,QAAQ,EAAE8B,IAAI,CAAC;IACpC;IACA,MAAM,GAAGT,QAAQ,EAAEE,IAAI,CAAC,GAAGO,IAAI;IAC/B,OAAOvH,MAAM,CAAC6H,OAAO,CAAC,sBAAsBxB,OAAO,CAACyB,IAAI,EAAE,EAAE;MAC1DC,MAAM,EAAEf,IAAI;MACZgB,UAAU,EAAE;QACV,gBAAgB,EAAEhC,QAAQ,CAACxB,UAAU;QACrC,GAAG6B;OACJ;MACD4B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGlB,IAAI,IAAKrG,KAAK,CAAC6G,KAAK,CAAC/B,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;EACtE,CAAC,CACF;EAEH,MAAMoB,YAAY,GAAiC/B,OAAU,IAC3DrG,MAAM,CAACqI,OAAO,CAAC,MACbrC,QAAQ,CAACC,UAAU,CAACnE,GAAG,CAACuE,OAAO,CAACyB,IAAI,CAAC,GACjCT,IAAI,CAAChB,OAAO,CAAC,GACbrG,MAAM,CAACsI,GAAG,CAAC,WAAWjC,OAAO,CAACyB,IAAI,qBAAqB,CAAC,CAC7D;EAEH,MAAMS,WAAW,GAAIjG,CAAU,IAC7BtC,MAAM,CAACqI,OAAO,CAAC,MACbrC,QAAQ,CAACG,aAAa,CAAC7D,CAAC,CAAC,CAACuB,IAAI,CAC5B7D,MAAM,CAACsH,OAAO,CAAEkB,GAAG,IACjBxI,MAAM,CAACsH,OAAO,CACZtH,MAAM,CAACyI,IAAI,CAACpB,IAAI,CAACmB,GAAG,CAAC,CAAC,EACrBC,IAAI,IAAK5H,MAAM,CAAC6H,aAAa,CAACF,GAAG,EAAEC,IAAI,CAAC,CAC1C,CACF,EACDzI,MAAM,CAAC2I,OAAO,CAACnD,OAAO,CAAC,CACxB,CACsF;EAE3F,MAAMoD,YAAY,GAAIC,QAA0B,IAAI;IAClD,IAAI9C,YAAY,KAAK8C,QAAQ,EAAE;MAC7B9C,YAAY,GAAG8C,QAAQ;MACvB,OAAOnI,MAAM,CAACoI,OAAO,CAACnD,MAAM,EAAEkD,QAAQ,CAAC;IACzC;IACA,OAAO7I,MAAM,CAAC+I,IAAI;EACpB,CAAC;EAED,MAAMC,GAAG,GAAGhJ,MAAM,CAACuF,GAAG,CAAC,aAAS;IAC9B,MAAM0D,QAAQ,GAAG,OAAO5I,QAAQ,CAAC2D,IAAI,EAAsB;IAC3D,MAAMkF,QAAQ,GAAG,OAAOhJ,QAAQ,CAAC8D,IAAI,EAA8B;IAEnE,MAAMmF,IAAI,GAAa9F,MAA8B,IACnDrD,MAAM,CAACoJ,MAAM,CAAC/I,QAAQ,CAAC2I,GAAG,CAACC,QAAQ,EAAEjG,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;IACnE,MAAMgG,QAAQ,GAQV,IAAAvE,cAAI,EAAC,CAAC,EAAE,CACVzB,MAA8B,EAC9BuB,KAAuB,KAEvB5E,MAAM,CAACsJ,GAAG,CAACH,IAAI,CAAC9F,MAAM,CAAC,EAAGkG,CAAC,IAAK,CAACA,CAAC,EAAE3E,KAAK,CAAU,CAAC,CAAC;IAEvD,MAAM4E,WAAW,GAGb,IAAA1E,cAAI,EAAC,CAAC,EAAE,CAAUzB,MAA8B,EAAE0D,EAAU,KAC9D/G,MAAM,CAACoJ,MAAM,CACXlJ,QAAQ,CAAC8I,GAAG,CAACE,QAAQ,EAAEnC,EAAE,EAAE/D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CACvD,CAAC;IACJ,MAAMoG,eAAe,GAUjB,IAAA3E,cAAI,EAAC,CAAC,EAAE,CACVzB,MAA8B,EAC9B0D,EAAU,EACVnC,KAAuB,KAEvB5E,MAAM,CAACsJ,GAAG,CAACE,WAAW,CAACnG,MAAM,EAAE0D,EAAE,CAAC,EAAGwC,CAAC,IAAK,CAACA,CAAC,EAAE3E,KAAK,CAAU,CAAC,CAAC;IAElE,MAAM8E,OAAO,GAGT,IAAA5E,cAAI,EAAC,CAAC,EAAE,CAAUzB,MAA8B,EAAE0D,EAAU,KAC9D/G,MAAM,CAACoJ,MAAM,CAAClJ,QAAQ,CAAC8I,GAAG,CAACE,QAAQ,EAAEnC,EAAE,EAAE/D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,EAAE;MAAEsG,aAAa,EAAE;IAAI,CAAE,CAAC,CAAC,CAAC;IAEjG,MAAMC,WAAW,GAUb,IAAA9E,cAAI,EAAC,CAAC,EAAE,CACVzB,MAA8B,EAC9B0D,EAAU,EACVnC,KAAuB,KAEvB5E,MAAM,CAACsJ,GAAG,CACRI,OAAO,CAACrG,MAAM,EAAE0D,EAAE,CAAC,EAClBwC,CAAC,IACA,CAACA,CAAC,EAAE3E,KAAK,CAAU,CACtB,CAAC;IAEJ,MAAMiF,YAAY,GAA0E;MAC1FC,SAAS,EAAEzC,IAAI;MACfA,IAAI,EAAEc,UAAU;MAChB4B,UAAU,EAAE5B,UAAiB;MAC7B6B,eAAe,EAAE3C,IAAW;MAC5B8B,IAAI;MACJE,QAAQ;MACRK,OAAO;MACPE,WAAW;MACXJ,WAAW;MACXC;KACD;IAED,MAAMrI,UAAU,GAAG,OAAO,IAAAyC,cAAI,EAC5BkB,IAAI,CAACd,UAAU,CAACS,KAAK,EAAEqB,YAAY,IAAIxB,OAAO,EAAE0F,aAAa,CAG5D,EACDjK,MAAM,CAACkK,cAAc,CAACxG,cAAc,EAAEmG,YAAY,CAAC,CACpD;IACD,MAAMM,YAAY,GAGdhI,MAAM,CAACiI,WAAW,CACpBhJ,UAAU,CAACiJ,OAAO,CAACf,GAAG,CAAEgB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CAACE,MAAM,CAC9CpJ,UAAU,CAACqJ,MAAM,CAACnB,GAAG,CAAEgB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CACzC,CACF;IAEDtE,QAAQ,GAAG;MACTxB,UAAU,EAAEpD,UAAU,CAACoD,UAAU;MACjCyB,UAAU,EAAE,IAAIC,GAAG,CAAC9E,UAAU,CAACqJ,MAAM,CAACnB,GAAG,CAAEgB,CAAC,IAC1CA,CAAC,CAACC,GAAG,CACN,CAAC;MACFpE,aAAa,EAAEtF,MAAM,CAAC6J,aAAa,CACjC7J,MAAM,CAAC8J,KAAK,CACV,GAAGjL,GAAG,CAACkL,MAAM,CACXxJ,UAAU,CAACqJ,MAAM,EACjBxJ,SAAS,CAAC4J,cAAc,CACzB,CAACvB,GAAG,CAAEgB,CAAC,IAAKA,CAAC,CAACQ,MAAM,CAAC,CACvB;KAEJ;IACD,OAAOlC,YAAY,CAACxH,UAAU,CAAC2J,YAAY,CAAC;IAC5C,OAAOhL,QAAQ,CAACiL,OAAO,CAAClF,KAAK,EAAE,KAAK,CAAC,CAAC;IAEtC,MAAMmF,OAAO,GAAG,IAAApH,cAAI,EAClBlD,KAAK,CAACuK,IAAI,CAACzF,QAAQ,CAAC,EACpBzF,MAAM,CAACsH,OAAO,CAAC,CAAC,CAACjB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEmE,OAAO,CAAC,KAChDnL,MAAM,CAACsH,OAAO,CAACvH,QAAQ,CAACqL,MAAM,CAACtE,QAAQ,CAAC,EAAGuE,IAAI,IAAI;MACjD,IAAIA,IAAI,EAAE;QACR,OAAOrL,MAAM,CAAC+I,IAAI;MACpB;MAEA,MAAMuC,SAAS,GAAGnB,YAAY,CAAC9D,OAAO,CAACyB,IAAI,CAAC;MAC5C,IAAIwD,SAAS,KAAKlH,SAAS,EAAE;QAC3B,OAAOrE,QAAQ,CAACuI,GAAG,CAACxB,QAAQ,EAAE,mBAAmBT,OAAO,CAACyB,IAAI,EAAE,CAAC;MAClE;MACA,MAAMtC,OAAO,GAAGrD,MAAM,CAACoJ,MAAM,CAAC1B,YAAY,CAAC;MAC3CrE,OAAO,CAACZ,KAAK,GAAGmB,YAAY;MAC5BP,OAAO,CAACa,OAAO,GAAGA,OAAO;MACzBb,OAAO,CAACsB,QAAQ,GAAGA,QAAQ;MAE3B,IAAI0E,OAAO,GAAGxL,MAAM,CAACyL,gBAAgB,CACnCH,SAAS,CAACE,OAAO,CAAChG,OAAO,CAAC,EAC1B;QACEkG,SAAS,EAAGlK,CAAC,IAAI;UACf,IAAI3B,KAAK,CAAC8L,SAAS,CAACnK,CAAC,CAAC,EAAE;YACtB,OAAOzB,QAAQ,CAAC6L,SAAS,CAAC9E,QAAQ,EAAEtF,CAAC,CAAC;UACxC;UACA;UACA,OAAOxB,MAAM,CAACyH,QAAQ,CACpB1H,QAAQ,CAAC6L,SAAS,CAAC9E,QAAQ,EAAEtF,CAAC,CAAC,EAC/BxB,MAAM,CAAC4L,SAAS,CAACpK,CAAC,CAAC,CACpB;QACH,CAAC;QACDqK,SAAS,EAAEA,CAAC,CAACC,QAAQ,EAAEjD,QAAQ,CAAC,KAAI;UAClC,IAAIiD,QAAQ,KAAK7K,SAAS,CAAC8K,OAAO,EAAE;YAClC,OAAOnD,YAAY,CAACC,QAAQ,CAAC;UAC/B;UACA,OAAO7I,MAAM,CAACyH,QAAQ,CACpBmB,YAAY,CAACC,QAAQ,CAAC,EACtB9I,QAAQ,CAACiL,OAAO,CAAClE,QAAQ,EAAEgF,QAAQ,CAAC,CACrC;QACH;OACD,CACF;MACD,IAAIX,OAAO,EAAE;QACXK,OAAO,GAAGxL,MAAM,CAACgM,QAAQ,CAACR,OAAO,EAAE,mBAAmBnF,OAAO,CAACyB,IAAI,EAAE,EAAE;UACpEG,IAAI,EAAE,QAAQ;UACdF,MAAM,EAAEf,IAAI;UACZgB,UAAU,EAAE;YACV,gBAAgB,EAAEhC,QAAQ,CAACxB;WAC5B;UACD0D,iBAAiB,EAAE;SACpB,CAAC;MACJ,CAAC,MAAM,IAAIlB,IAAI,KAAK5C,SAAS,EAAE;QAC7BoH,OAAO,GAAGxL,MAAM,CAACkK,cAAc,CAACsB,OAAO,EAAExK,MAAM,CAACkG,UAAU,EAAEF,IAAI,CAAC;MACnE;MAEA,OAAOwE,OAAO;IAChB,CAAC,CAAC,CACH,EACDxL,MAAM,CAACiM,OAAO,EACdjM,MAAM,CAACkK,cAAc,CAACxG,cAAc,EAAEmG,YAAY,CAAC,CACpD;IAED,OAAO,IAAAhG,cAAI,EACT7D,MAAM,CAACkM,GAAG,CAAC,CACTjB,OAAO,EACP5K,QAAQ,CAAC8L,IAAI,CAAClD,QAAQ,CAAC,EACvB/I,QAAQ,CAACiM,IAAI,CAACjD,QAAQ,CAAC,CACxB,EAAE;MAAEkD,WAAW,EAAE,WAAW;MAAEC,OAAO,EAAE;IAAI,CAAE,CAAC,EAC/CrM,MAAM,CAACsM,MAAM,CAAE7D,IAAI,IAAI;MACrB,IAAIA,IAAI,CAACX,IAAI,KAAK,SAAS,EAAE,OAAO9H,MAAM,CAACsI,GAAG,CAAC,QAAQ,CAAC;MACxD,OAAOtI,MAAM,CAACsH,OAAO,CACnB3G,KAAK,CAAC4L,OAAO,CAAC9G,QAAQ,CAAC,EACvBzF,MAAM,CAACwM,OAAO,CAAC,CAAC,GAAG1F,QAAQ,CAAC,KAAK/G,QAAQ,CAAC6L,SAAS,CAAC9E,QAAQ,EAAE2B,IAAI,CAACvF,KAAK,CAAC,CAAC,CAC3E;IACH,CAAC,CAAC,EACFlD,MAAM,CAACyM,aAAa,CAAEvJ,KAAK,IACzB/C,QAAQ,CAACuM,OAAO,CACdvM,QAAQ,CAACwM,sBAAsB,EAC/BnM,MAAM,CAACoM,KAAK,CAAC;MACXC,MAAM,EAAEA,CAAA,KAAM7M,MAAM,CAAC+I,IAAI;MACzB+D,MAAM,EAAGC,KAAK,IACZ/M,MAAM,CAACgN,GAAG,CAAC,sBAAsBhH,QAAQ,CAACxB,UAAU,WAAW,EAAEtB,KAAK,CAAC,CAACW,IAAI,CAC1E7D,MAAM,CAACqF,OAAO,CAAClF,QAAQ,CAAC8M,eAAe,EAAEF,KAAK,CAAC;KAEpD,CAAC,CACH,CACF,EACD/M,MAAM,CAACkN,cAAc,CAAEhK,KAAK,IAAKlD,MAAM,CAACwD,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE;IAAK,CAAE,CAAC,CAAC,CAAC,CAC5E;EACH,CAAC,CAAC,CAACW,IAAI,CAAC7D,MAAM,CAACmN,MAAM,CAGpB;EAED,MAAM5G,KAAK,GAAG,OAAO,IAAA1C,cAAI,EACvBmF,GAAG,EACHjE,IAAI,CAACZ,WAAW,GACdnE,MAAM,CAAC6E,KAAK,CAACE,IAAI,CAACZ,WAAW,CAAC,GAC9BiJ,kBAAQ,EACVpN,MAAM,CAACqN,UAAU,EACjBrN,MAAM,CAACsN,aAAa,CACrB;EAED,OAAOvN,QAAQ,CAAC2H,KAAK,CAAC5B,KAAK,CAAC;EAE5B,OAAO,IAAAsH,kBAAQ,EAAuBjL,MAAM,CAACoL,MAAM,CAACpL,MAAM,CAACoJ,MAAM,CAAC3H,UAAU,CAAC,EAAE;IAC7E4J,OAAO,EAAEzI,IAAI;IACbL,KAAK,EAAEA,KAAM;IACb3C,GAAG,EAAE/B,MAAM,CAACsG,IAAI,CAAC,MAAMP,YAAY,CAAC;IACpC0H,OAAO,EAAE3M,MAAM,CAAC0J,MAAM,CACpB1J,MAAM,CAACwF,IAAI,CAAC,MAAMP,YAAY,CAAC,EAC/BjF,MAAM,CAAC4M,UAAU,CAAC/H,MAAM,CAAC,CAC1B;IACD0B,IAAI,EAAEe,YAAY;IAClBG,WAAW;IACX4D,IAAI,EAAElM,KAAK,CAACkM,IAAI,CAAC5F,KAAK;GACvB,CAAC,CAAQ;AACZ,CAAC,CAAC;AAEJ;;;;AAAApF,OAAA,CAAAmE,IAAA,GAAAA,IAAA;AAIO,MAAMqI,QAAQ,GASnB5I,IAUC,IAED/E,MAAM,CAAC4N,GAAG,CACR/M,MAAM,CAACgN,MAAM,CAAC9I,IAAI,CAACyI,OAAO,CAAC/I,WAAW,CAAC,CAACM,IAAI,CAACL,KAAK,CAAC,EACnD1E,MAAM,CAACsH,OAAO,CAACvC,IAAI,CAAChD,GAAG,EAAElB,MAAM,CAACgN,MAAM,CAAC9I,IAAI,CAACyI,OAAO,CAAC7I,WAAW,CAAC,CAAC,CAClE;AAEH;;;;AAAAxD,OAAA,CAAAwM,QAAA,GAAAA,QAAA;AAIO,MAAMG,OAAO,GAAGA,CASrB/I,IAQC,EACD4I,QAAmD,KAgBnD3N,MAAM,CAACsH,OAAO,CACZzG,MAAM,CAAC6J,aAAa,CAAC7J,MAAM,CAACkN,KAAK,CAAChJ,IAAI,CAACN,WAAW,EAAEM,IAAI,CAACJ,WAAW,CAAC,CAAC,CAACgJ,QAAQ,CAAC,EAChF,CAAC,CAACjJ,KAAK,EAAEuF,aAAa,CAAC,KAAM3E,IAAY,CAACP,IAAI,EAAEL,KAAK,EAAE;EAAEuF;AAAa,CAAE,CAAC,CAC1E;AAAA9I,OAAA,CAAA2M,OAAA,GAAAA,OAAA","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/PersistedCache.js b/dist/cjs/PersistedCache.js
index 60e4ae423d5fdb33e8b88b4c199549bcd0b2d7f3..67b9f9c1cacdb81bc939a13a01859f92753bdc3b 100644
--- a/dist/cjs/PersistedCache.js
+++ b/dist/cjs/PersistedCache.js
@@ -15,6 +15,10 @@ var Tracer = _interopRequireWildcard(require("effect/Tracer"));
 var Persistence = _interopRequireWildcard(require("./Persistence.js"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
 class CacheRequest extends Data.Class {
   [Equal.symbol](that) {
     return Equal.equals(this.key, that.key);
diff --git a/dist/cjs/PersistedCache.js.map b/dist/cjs/PersistedCache.js.map
index acd6349b614d4f9b205424ab44cf537a19c80553..84a619281bbc3548aa1321745c15b0345f67c935 100644
--- a/dist/cjs/PersistedCache.js.map
+++ b/dist/cjs/PersistedCache.js.map
@@ -1 +1 @@
-{"version":3,"file":"PersistedCache.js","names":["Cache","_interopRequireWildcard","require","Data","Effect","Equal","_Function","Hash","Option","Tracer","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","CacheRequest","Class","symbol","that","equals","key","hash","make","options","ResultPersistence","pipe","flatMap","_","storeId","timeToLive","bindTo","bind","store","lookup","request","effect","match","onNone","exit","tap","flatten","onSome","identity","span","_tag","withParentSpan","value","capacity","inMemoryCapacity","inMemoryTTL","map","inMemoryCache","serviceOption","ParentSpan","invalidate","remove","zipRight","none","exports"],"sources":["../../src/PersistedCache.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"PersistedCache.js","names":["Cache","_interopRequireWildcard","require","Data","Effect","Equal","_Function","Hash","Option","Tracer","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","CacheRequest","Class","symbol","that","equals","key","hash","make","options","ResultPersistence","pipe","flatMap","_","storeId","timeToLive","bindTo","bind","store","lookup","request","effect","match","onNone","exit","tap","flatten","onSome","identity","span","_tag","withParentSpan","value","capacity","inMemoryCapacity","inMemoryTTL","map","inMemoryCache","serviceOption","ParentSpan","invalidate","remove","zipRight","none","exports"],"sources":["../../src/PersistedCache.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Persistence/Lmdb.js b/dist/cjs/Persistence/Lmdb.js
index 42f3bbc4992f7bf8f083306c63dfcc800eff0585..ea4279dc93748741aa1b90a6984eea8a80b6a2f1 100644
--- a/dist/cjs/Persistence/Lmdb.js
+++ b/dist/cjs/Persistence/Lmdb.js
@@ -21,15 +21,15 @@ function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e;
  * @since 1.0.0
  * @category constructors
  */
-const make = options => Effect.gen(function* (_) {
-  const lmdb = yield* _(Effect.acquireRelease(Effect.sync(() => Lmdb.open(options)), lmdb => Effect.promise(() => lmdb.close())));
+const make = options => Effect.gen(function* () {
+  const lmdb = yield* Effect.acquireRelease(Effect.sync(() => Lmdb.open(options)), lmdb => Effect.promise(() => lmdb.close()));
   return Persistence.BackingPersistence.of({
     [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
-    make: storeId => Effect.gen(function* (_) {
-      const clock = yield* _(Effect.clock);
-      const store = yield* _(Effect.acquireRelease(Effect.sync(() => lmdb.openDB({
+    make: storeId => Effect.gen(function* () {
+      const clock = yield* Effect.clock;
+      const store = yield* Effect.acquireRelease(Effect.sync(() => lmdb.openDB({
         name: storeId
-      })), store => Effect.promise(() => store.close())));
+      })), store => Effect.promise(() => store.close()));
       const valueToOption = (key, _) => {
         if (!Arr.isArray(_)) return Option.none();
         const [value, expires] = _;
diff --git a/dist/cjs/Persistence/Lmdb.js.map b/dist/cjs/Persistence/Lmdb.js.map
index 3dfe43a44d0e6d5694350d8aa3ab9811de1efdf4..957fac5f538e256e35aeb137cbfa4f4658803985 100644
--- a/dist/cjs/Persistence/Lmdb.js.map
+++ b/dist/cjs/Persistence/Lmdb.js.map
@@ -1 +1 @@
-{"version":3,"file":"Lmdb.js","names":["Arr","_interopRequireWildcard","require","Effect","_Function","Layer","Option","Lmdb","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","options","gen","_","lmdb","acquireRelease","sync","open","promise","close","BackingPersistence","of","BackingPersistenceTypeId","storeId","clock","store","openDB","name","valueToOption","key","isArray","none","value","expires","unsafeCurrentTimeMillis","remove","some","identity","try","catch","error","PersistenceBackingError","getMany","keys","map","tryPromise","ttl","put","unsafeTtlToExpires","clear","clearAsync","exports","layer","scoped","layerResult","pipe","provide"],"sources":["../../../src/Persistence/Lmdb.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Lmdb.js","names":["Arr","_interopRequireWildcard","require","Effect","_Function","Layer","Option","Lmdb","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","options","gen","lmdb","acquireRelease","sync","open","promise","close","BackingPersistence","of","BackingPersistenceTypeId","storeId","clock","store","openDB","name","valueToOption","key","_","isArray","none","value","expires","unsafeCurrentTimeMillis","remove","some","identity","try","catch","error","PersistenceBackingError","getMany","keys","map","tryPromise","ttl","put","unsafeTtlToExpires","clear","clearAsync","exports","layer","scoped","layerResult","pipe","provide"],"sources":["../../../src/Persistence/Lmdb.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Persistence/Redis.js b/dist/cjs/Persistence/Redis.js
index 22c50c9bcc7de57046cddeb39b4672d34383625f..793bdb5a0f62bc3e97a80fbbbcc271be4b05b127 100644
--- a/dist/cjs/Persistence/Redis.js
+++ b/dist/cjs/Persistence/Redis.js
@@ -22,8 +22,8 @@ function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e;
  * @since 1.0.0
  * @category constructors
  */
-const make = options => Effect.gen(function* (_) {
-  const redis = yield* _(Effect.acquireRelease(Effect.sync(() => new _ioredis.Redis(options)), redis => Effect.promise(() => redis.quit())));
+const make = options => Effect.gen(function* () {
+  const redis = yield* Effect.acquireRelease(Effect.sync(() => new _ioredis.Redis(options)), redis => Effect.promise(() => redis.quit()));
   return Persistence.BackingPersistence.of({
     [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
     make: prefix => Effect.sync(() => {
diff --git a/dist/cjs/Persistence/Redis.js.map b/dist/cjs/Persistence/Redis.js.map
index 3dde026564d468651cae44bf45a703fa5b0ae378..c2753d1717ee858077b2797db107505e03a48912 100644
--- a/dist/cjs/Persistence/Redis.js.map
+++ b/dist/cjs/Persistence/Redis.js.map
@@ -1 +1 @@
-{"version":3,"file":"Redis.js","names":["Config","_interopRequireWildcard","require","Duration","Effect","_Function","Layer","Option","_ioredis","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","options","gen","_","redis","acquireRelease","sync","Redis","promise","quit","BackingPersistence","of","BackingPersistenceTypeId","prefix","prefixed","key","parse","method","str","succeedNone","try","some","JSON","catch","error","PersistenceBackingError","identity","flatMap","tryPromise","getMany","keys","mget","map","forEach","value","ttl","tryMapPromise","stringify","_tag","toMillis","remove","del","clear","then","exports","layer","scoped","layerConfig","unwrap","layerResult","pipe","provide","layerResultConfig"],"sources":["../../../src/Persistence/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Redis.js","names":["Config","_interopRequireWildcard","require","Duration","Effect","_Function","Layer","Option","_ioredis","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","make","options","gen","redis","acquireRelease","sync","Redis","promise","quit","BackingPersistence","of","BackingPersistenceTypeId","prefix","prefixed","key","parse","method","str","succeedNone","try","some","JSON","catch","error","PersistenceBackingError","identity","flatMap","tryPromise","getMany","keys","mget","map","forEach","value","ttl","tryMapPromise","stringify","_tag","toMillis","remove","del","clear","then","exports","layer","scoped","layerConfig","unwrap","layerResult","pipe","provide","layerResultConfig"],"sources":["../../../src/Persistence/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Persistence.js b/dist/cjs/Persistence.js
index 465b27823a9d5efbd223f13af6ecffe9e9c44cfb..9b58423a296bf64d2a96031b7e8a3e2c1aa56763 100644
--- a/dist/cjs/Persistence.js
+++ b/dist/cjs/Persistence.js
@@ -6,15 +6,15 @@ Object.defineProperty(exports, "__esModule", {
 exports.unsafeTtlToExpires = exports.layerResultMemory = exports.layerResultKeyValueStore = exports.layerResult = exports.layerMemory = exports.layerKeyValueStore = exports.ResultPersistenceTypeId = exports.ResultPersistence = exports.PersistenceParseError = exports.PersistenceBackingError = exports.ErrorTypeId = exports.BackingPersistenceTypeId = exports.BackingPersistence = void 0;
 var _Error = require("@effect/platform/Error");
 var KeyValueStore = _interopRequireWildcard(require("@effect/platform/KeyValueStore"));
-var Serializable = _interopRequireWildcard(require("@effect/schema/Serializable"));
-var TreeFormatter = _interopRequireWildcard(require("@effect/schema/TreeFormatter"));
 var Context = _interopRequireWildcard(require("effect/Context"));
 var Duration = _interopRequireWildcard(require("effect/Duration"));
 var Effect = _interopRequireWildcard(require("effect/Effect"));
 var _Function = require("effect/Function");
 var Layer = _interopRequireWildcard(require("effect/Layer"));
 var Option = _interopRequireWildcard(require("effect/Option"));
+var ParseResult = _interopRequireWildcard(require("effect/ParseResult"));
 var PrimaryKey = _interopRequireWildcard(require("effect/PrimaryKey"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
 /**
@@ -42,7 +42,7 @@ class PersistenceParseError extends /*#__PURE__*/(0, _Error.TypeIdError)(ErrorTy
     });
   }
   get message() {
-    return TreeFormatter.formatIssueSync(this.error);
+    return ParseResult.TreeFormatter.formatIssueSync(this.error);
   }
 }
 /**
@@ -90,15 +90,15 @@ const ResultPersistence = exports.ResultPersistence = /*#__PURE__*/Context.Gener
  * @since 1.0.0
  * @category layers
  */
-const layerResult = exports.layerResult = /*#__PURE__*/Layer.effect(ResultPersistence, /*#__PURE__*/Effect.gen(function* (_) {
-  const backing = yield* _(BackingPersistence);
+const layerResult = exports.layerResult = /*#__PURE__*/Layer.effect(ResultPersistence, /*#__PURE__*/Effect.gen(function* () {
+  const backing = yield* BackingPersistence;
   return ResultPersistence.of({
     [ResultPersistenceTypeId]: ResultPersistenceTypeId,
     make: options => Effect.gen(function* () {
       const storage = yield* backing.make(options.storeId);
       const timeToLive = options.timeToLive ?? (() => Duration.infinity);
-      const parse = (method, key, value) => Effect.mapError(Serializable.deserializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
-      const encode = (method, key, value) => Effect.mapError(Serializable.serializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
+      const parse = (method, key, value) => Effect.mapError(Schema.deserializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
+      const encode = (method, key, value) => Effect.mapError(Schema.serializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
       const makeKey = key => key[PrimaryKey.symbol]();
       return (0, _Function.identity)({
         get: key => Effect.flatMap(storage.get(makeKey(key)), Option.match({
@@ -167,8 +167,8 @@ const layerMemory = exports.layerMemory = /*#__PURE__*/Layer.sync(BackingPersist
  * @since 1.0.0
  * @category layers
  */
-const layerKeyValueStore = exports.layerKeyValueStore = /*#__PURE__*/Layer.effect(BackingPersistence, /*#__PURE__*/Effect.gen(function* (_) {
-  const backing = yield* _(KeyValueStore.KeyValueStore);
+const layerKeyValueStore = exports.layerKeyValueStore = /*#__PURE__*/Layer.effect(BackingPersistence, /*#__PURE__*/Effect.gen(function* () {
+  const backing = yield* KeyValueStore.KeyValueStore;
   return BackingPersistence.of({
     [BackingPersistenceTypeId]: BackingPersistenceTypeId,
     make: storeId => Effect.map(Effect.clock, clock => {
diff --git a/dist/cjs/Persistence.js.map b/dist/cjs/Persistence.js.map
index 4c5d4b04be271956143b4a7b9b4b8139b5d903e4..f845e10c3b5725b88d4c80b632972daddfbfa2ab 100644
--- a/dist/cjs/Persistence.js.map
+++ b/dist/cjs/Persistence.js.map
@@ -1 +1 @@
-{"version":3,"file":"Persistence.js","names":["_Error","require","KeyValueStore","_interopRequireWildcard","Serializable","TreeFormatter","Context","Duration","Effect","_Function","Layer","Option","PrimaryKey","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ErrorTypeId","exports","Symbol","for","PersistenceParseError","TypeIdError","make","method","error","reason","message","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","_","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","issue","encode","serializeExit","makeKey","symbol","identity","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","pipe","tapError","remove","option","ttl","decode","isZero","void","encoded","isFinite","some","none","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","stringify","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Persistence.js","names":["_Error","require","KeyValueStore","_interopRequireWildcard","Context","Duration","Effect","_Function","Layer","Option","ParseResult","PrimaryKey","Schema","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ErrorTypeId","exports","Symbol","for","PersistenceParseError","TypeIdError","make","method","error","reason","message","TreeFormatter","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","_","issue","encode","serializeExit","makeKey","symbol","identity","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","pipe","tapError","remove","option","ttl","decode","isZero","void","encoded","isFinite","some","none","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","stringify","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Reactivity.js b/dist/cjs/Reactivity.js
new file mode 100644
index 0000000000000000000000000000000000000000..ab1b8c9eb5195beb2fbde3f704ee3c9ee115c54e
--- /dev/null
+++ b/dist/cjs/Reactivity.js
@@ -0,0 +1,141 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.make = exports.layer = exports.Reactivity = void 0;
+var Context = _interopRequireWildcard(require("effect/Context"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Exit = _interopRequireWildcard(require("effect/Exit"));
+var FiberHandle = _interopRequireWildcard(require("effect/FiberHandle"));
+var Hash = _interopRequireWildcard(require("effect/Hash"));
+var Layer = _interopRequireWildcard(require("effect/Layer"));
+var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
+var Scope = _interopRequireWildcard(require("effect/Scope"));
+var Stream = _interopRequireWildcard(require("effect/Stream"));
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+class Reactivity extends /*#__PURE__*/Context.Tag("@effect/experimental/Reactivity")() {}
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+exports.Reactivity = Reactivity;
+const make = exports.make = /*#__PURE__*/Effect.sync(() => {
+  const handlers = new Map();
+  const unsafeInvalidate = keys => {
+    if (Array.isArray(keys)) {
+      for (let i = 0; i < keys.length; i++) {
+        const set = handlers.get(stringOrHash(keys[i]));
+        if (set === undefined) continue;
+        for (const run of set) run();
+      }
+    } else {
+      const record = keys;
+      for (const key in record) {
+        const hashes = idHashes(key, record[key]);
+        for (let i = 0; i < hashes.length; i++) {
+          const set = handlers.get(hashes[i]);
+          if (set === undefined) continue;
+          for (const run of set) run();
+        }
+        const set = handlers.get(key);
+        if (set !== undefined) {
+          for (const run of set) run();
+        }
+      }
+    }
+  };
+  const invalidate = keys => Effect.sync(() => unsafeInvalidate(keys));
+  const mutation = (keys, effect) => Effect.ensuring(effect, invalidate(keys));
+  const query = (keys, effect) => Effect.gen(function* () {
+    const resolvedKeys = Array.isArray(keys) ? keys.map(stringOrHash) : recordHashes(keys);
+    const scope = yield* Effect.scope;
+    const results = yield* Mailbox.make();
+    const runFork = yield* FiberHandle.makeRuntime();
+    let running = false;
+    let pending = false;
+    const handleExit = exit => {
+      if (exit._tag === "Failure") {
+        results.unsafeDone(Exit.failCause(exit.cause));
+      } else {
+        results.unsafeOffer(exit.value);
+      }
+      if (pending) {
+        pending = false;
+        runFork(effect).addObserver(handleExit);
+      } else {
+        running = false;
+      }
+    };
+    function run() {
+      if (running) {
+        pending = true;
+        return;
+      }
+      running = true;
+      runFork(effect).addObserver(handleExit);
+    }
+    yield* Scope.addFinalizer(scope, Effect.sync(() => {
+      for (let i = 0; i < resolvedKeys.length; i++) {
+        const set = handlers.get(resolvedKeys[i]);
+        set.delete(run);
+        if (set.size === 0) {
+          handlers.delete(resolvedKeys[i]);
+        }
+      }
+    }));
+    for (let i = 0; i < resolvedKeys.length; i++) {
+      let set = handlers.get(resolvedKeys[i]);
+      if (set === undefined) {
+        set = new Set();
+        handlers.set(resolvedKeys[i], set);
+      }
+      set.add(run);
+    }
+    run();
+    return results;
+  });
+  const stream = (tables, effect) => query(tables, effect).pipe(Effect.map(Mailbox.toStream), Stream.unwrapScoped);
+  return Reactivity.of({
+    mutation,
+    query,
+    stream,
+    unsafeInvalidate,
+    invalidate
+  });
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+const layer = exports.layer = /*#__PURE__*/Layer.scoped(Reactivity, make);
+function stringOrHash(u) {
+  return typeof u === "string" ? u : Hash.hash(u);
+}
+const idHashes = (keyHash, ids) => {
+  const hashes = new Array(ids.length);
+  for (let i = 0; i < ids.length; i++) {
+    hashes[i] = `${keyHash}:${stringOrHash(ids[i])}`;
+  }
+  return hashes;
+};
+const recordHashes = record => {
+  const hashes = [];
+  for (const key in record) {
+    hashes.push(key);
+    for (const idHash of idHashes(key, record[key])) {
+      hashes.push(idHash);
+    }
+  }
+  return hashes;
+};
+//# sourceMappingURL=Reactivity.js.map
\ No newline at end of file
diff --git a/dist/cjs/Reactivity.js.map b/dist/cjs/Reactivity.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..83f2a8923b80a746d7a3974a455dde10602356c9
--- /dev/null
+++ b/dist/cjs/Reactivity.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Reactivity.js","names":["Context","_interopRequireWildcard","require","Effect","Exit","FiberHandle","Hash","Layer","Mailbox","Scope","Stream","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","Reactivity","Tag","exports","make","sync","handlers","Map","unsafeInvalidate","keys","Array","isArray","length","stringOrHash","undefined","run","record","key","hashes","idHashes","invalidate","mutation","effect","ensuring","query","gen","resolvedKeys","map","recordHashes","scope","results","runFork","makeRuntime","running","pending","handleExit","exit","_tag","unsafeDone","failCause","cause","unsafeOffer","value","addObserver","addFinalizer","delete","size","Set","add","stream","tables","pipe","toStream","unwrapScoped","of","layer","scoped","hash","keyHash","ids","push","idHash"],"sources":["../../src/Reactivity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/RequestResolver.js b/dist/cjs/RequestResolver.js
index ce53b40bab065215e1d594ca5543595154f585a8..7bb3eabecbc7f2661b11ba7de6f4d77aed93ba75 100644
--- a/dist/cjs/RequestResolver.js
+++ b/dist/cjs/RequestResolver.js
@@ -16,11 +16,15 @@ var RequestResolver = _interopRequireWildcard(require("effect/RequestResolver"))
 var Persistence = _interopRequireWildcard(require("./Persistence.js"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
 /**
  * @since 1.0.0
  * @category combinators
  */
-const dataLoader = exports.dataLoader = /*#__PURE__*/(0, _Function.dual)(2, (self, options) => Effect.gen(function* (_) {
+const dataLoader = exports.dataLoader = /*#__PURE__*/(0, _Function.dual)(2, (self, options) => Effect.gen(function* () {
   const scope = yield* Effect.scope;
   const handle = yield* FiberHandle.make();
   const maxSize = options.maxBatchSize ?? Infinity;
@@ -71,7 +75,7 @@ const dataLoader = exports.dataLoader = /*#__PURE__*/(0, _Function.dual)(2, (sel
  * @since 1.0.0
  * @category combinators
  */
-const persisted = exports.persisted = /*#__PURE__*/(0, _Function.dual)(2, (self, options) => Effect.gen(function* (_) {
+const persisted = exports.persisted = /*#__PURE__*/(0, _Function.dual)(2, (self, options) => Effect.gen(function* () {
   const storage = yield* (yield* Persistence.ResultPersistence).make({
     storeId: options.storeId,
     timeToLive: options.timeToLive
diff --git a/dist/cjs/RequestResolver.js.map b/dist/cjs/RequestResolver.js.map
index f779c70cce92aafb822e2177a2e0cb8eaa12a089..1a242d8820c84bc3be5002f6c9eb45ff6d69b8dc 100644
--- a/dist/cjs/RequestResolver.js.map
+++ b/dist/cjs/RequestResolver.js.map
@@ -1 +1 @@
-{"version":3,"file":"RequestResolver.js","names":["Arr","_interopRequireWildcard","require","Deferred","Effect","Either","FiberHandle","_Function","Option","Request","RequestResolver","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","dataLoader","exports","dual","self","options","gen","_","scope","handle","make","maxSize","maxBatchSize","Infinity","batch","empty","process","items","forEach","deferred","request","pipe","withRequestCaching","exit","flatMap","done","batching","discard","loop","suspend","length","void","sleep","window","forkIn","zipRight","interruptible","runLoop","run","onlyIfMissing","runLoopReset","splice","uninterruptible","fromEffect","item","push","await","onInterrupt","sync","index","indexOf","persisted","storage","ResultPersistence","storeId","timeToLive","partition","requests","getMany","map","partitionMap","match","onNone","left","onSome","right","orElseSucceed","result","ignoreLogged","makeBatched","remaining","results","completeCached","complete","completeUncached"],"sources":["../../src/RequestResolver.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"RequestResolver.js","names":["Arr","_interopRequireWildcard","require","Deferred","Effect","Either","FiberHandle","_Function","Option","Request","RequestResolver","Persistence","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","dataLoader","exports","dual","self","options","gen","scope","handle","make","maxSize","maxBatchSize","Infinity","batch","empty","process","items","forEach","deferred","request","pipe","withRequestCaching","exit","flatMap","done","batching","discard","loop","suspend","length","void","sleep","window","forkIn","zipRight","interruptible","runLoop","run","onlyIfMissing","runLoopReset","splice","uninterruptible","fromEffect","item","push","await","onInterrupt","sync","index","indexOf","persisted","storage","ResultPersistence","storeId","timeToLive","partition","requests","getMany","map","partitionMap","_","match","onNone","left","onSome","right","orElseSucceed","result","ignoreLogged","makeBatched","remaining","results","completeCached","complete","completeUncached"],"sources":["../../src/RequestResolver.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/Sse.js b/dist/cjs/Sse.js
new file mode 100644
index 0000000000000000000000000000000000000000..bd2e401fd3c67127e19bdb5e494ee984606f727c
--- /dev/null
+++ b/dist/cjs/Sse.js
@@ -0,0 +1,227 @@
+"use strict";
+
+Object.defineProperty(exports, "__esModule", {
+  value: true
+});
+exports.makeChannel = exports.RetryTypeId = exports.Retry = void 0;
+exports.makeParser = makeParser;
+var Channel = _interopRequireWildcard(require("effect/Channel"));
+var Chunk = _interopRequireWildcard(require("effect/Chunk"));
+var Data = _interopRequireWildcard(require("effect/Data"));
+var Duration = _interopRequireWildcard(require("effect/Duration"));
+var Effect = _interopRequireWildcard(require("effect/Effect"));
+var Mailbox = _interopRequireWildcard(require("effect/Mailbox"));
+var _Predicate = require("effect/Predicate");
+function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
+function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
+/**
+ * @since 1.0.0
+ */
+
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+const makeChannel = options => {
+  const events = Mailbox.make(options?.bufferSize ?? 16).pipe(Effect.map(mailbox => {
+    let events = [];
+    let retry;
+    const parser = makeParser(event => {
+      switch (event._tag) {
+        case "Retry":
+          return retry = event;
+        case "Event":
+          return events.push(event);
+      }
+    });
+    const input = {
+      awaitRead() {
+        return Effect.void;
+      },
+      emit(chunks) {
+        Chunk.forEach(chunks, parser.feed);
+        const toEmit = events;
+        events = [];
+        return retry ? Effect.zipRight(mailbox.offerAll(toEmit), mailbox.fail(retry)) : mailbox.offerAll(toEmit);
+      },
+      error(cause) {
+        return mailbox.failCause(cause);
+      },
+      done(_) {
+        return mailbox.end;
+      }
+    };
+    return Channel.embedInput(Mailbox.toChannel(mailbox), input);
+  }), Channel.unwrap);
+  const withRetry = Channel.catchAll(events, error => Retry.is(error) ? Effect.sleep(error.duration).pipe(Effect.as(withRetry), Channel.unwrap) : Channel.fail(error));
+  return withRetry;
+};
+/**
+ * Create a SSE parser.
+ *
+ * Adapted from https://github.com/rexxars/eventsource-parser under MIT license.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+exports.makeChannel = makeChannel;
+function makeParser(onParse) {
+  // Processing state
+  let isFirstChunk;
+  let buffer;
+  let startingPosition;
+  let startingFieldLength;
+  // Event state
+  let eventId;
+  let lastEventId;
+  let eventName;
+  let data;
+  reset();
+  return {
+    feed,
+    reset
+  };
+  function reset() {
+    isFirstChunk = true;
+    buffer = "";
+    startingPosition = 0;
+    startingFieldLength = -1;
+    eventId = undefined;
+    eventName = undefined;
+    data = "";
+  }
+  function feed(chunk) {
+    buffer = buffer ? buffer + chunk : chunk;
+    // Strip any UTF8 byte order mark (BOM) at the start of the stream.
+    // Note that we do not strip any non - UTF8 BOM, as eventsource streams are
+    // always decoded as UTF8 as per the specification.
+    if (isFirstChunk && hasBom(buffer)) {
+      buffer = buffer.slice(BOM.length);
+    }
+    isFirstChunk = false;
+    // Set up chunk-specific processing state
+    const length = buffer.length;
+    let position = 0;
+    let discardTrailingNewline = false;
+    // Read the current buffer byte by byte
+    while (position < length) {
+      // EventSource allows for carriage return + line feed, which means we
+      // need to ignore a linefeed character if the previous character was a
+      // carriage return
+      // @todo refactor to reduce nesting, consider checking previous byte?
+      // @todo but consider multiple chunks etc
+      if (discardTrailingNewline) {
+        if (buffer[position] === "\n") {
+          ;
+          ++position;
+        }
+        discardTrailingNewline = false;
+      }
+      let lineLength = -1;
+      let fieldLength = startingFieldLength;
+      let character;
+      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {
+        character = buffer[index];
+        if (character === ":" && fieldLength < 0) {
+          fieldLength = index - position;
+        } else if (character === "\r") {
+          discardTrailingNewline = true;
+          lineLength = index - position;
+        } else if (character === "\n") {
+          lineLength = index - position;
+        }
+      }
+      if (lineLength < 0) {
+        startingPosition = length - position;
+        startingFieldLength = fieldLength;
+        break;
+      } else {
+        startingPosition = 0;
+        startingFieldLength = -1;
+      }
+      parseEventStreamLine(buffer, position, fieldLength, lineLength);
+      position += lineLength + 1;
+    }
+    if (position === length) {
+      // If we consumed the entire buffer to read the event, reset the buffer
+      buffer = "";
+    } else if (position > 0) {
+      // If there are bytes left to process, set the buffer to the unprocessed
+      // portion of the buffer only
+      buffer = buffer.slice(position);
+    }
+  }
+  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {
+    if (lineLength === 0) {
+      // We reached the last line of this event
+      if (data.length > 0) {
+        onParse({
+          _tag: "Event",
+          id: eventId,
+          event: eventName ?? "message",
+          data: data.slice(0, -1) // remove trailing newline
+        });
+        data = "";
+        eventId = undefined;
+      }
+      eventName = undefined;
+      return;
+    }
+    const noValue = fieldLength < 0;
+    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));
+    let step = 0;
+    if (noValue) {
+      step = lineLength;
+    } else if (lineBuffer[index + fieldLength + 1] === " ") {
+      step = fieldLength + 2;
+    } else {
+      step = fieldLength + 1;
+    }
+    const position = index + step;
+    const valueLength = lineLength - step;
+    const value = lineBuffer.slice(position, position + valueLength).toString();
+    if (field === "data") {
+      data += value ? `${value}\n` : "\n";
+    } else if (field === "event") {
+      eventName = value;
+    } else if (field === "id" && !value.includes("\u0000")) {
+      eventId = value;
+      lastEventId = value;
+    } else if (field === "retry") {
+      const retry = parseInt(value, 10);
+      if (!Number.isNaN(retry)) {
+        onParse(new Retry({
+          duration: Duration.millis(retry),
+          lastEventId
+        }));
+      }
+    }
+  }
+}
+const BOM = [239, 187, 191];
+function hasBom(buffer) {
+  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);
+}
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+const RetryTypeId = exports.RetryTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/Sse/Retry");
+/**
+ * @since 1.0.0
+ * @category models
+ */
+class Retry extends /*#__PURE__*/Data.TaggedClass("Retry") {
+  /**
+   * @since 1.0.0
+   */
+  [RetryTypeId] = RetryTypeId;
+  /**
+   * @since 1.0.0
+   */
+  static is(u) {
+    return (0, _Predicate.hasProperty)(u, RetryTypeId);
+  }
+}
+exports.Retry = Retry;
+//# sourceMappingURL=Sse.js.map
\ No newline at end of file
diff --git a/dist/cjs/Sse.js.map b/dist/cjs/Sse.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..e71baeaaa9177052110f50b00dde0c0d36c65df2
--- /dev/null
+++ b/dist/cjs/Sse.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Sse.js","names":["Channel","_interopRequireWildcard","require","Chunk","Data","Duration","Effect","Mailbox","_Predicate","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","makeChannel","options","events","make","bufferSize","pipe","map","mailbox","retry","parser","makeParser","event","_tag","push","input","awaitRead","void","emit","chunks","forEach","feed","toEmit","zipRight","offerAll","fail","error","cause","failCause","done","_","end","embedInput","toChannel","unwrap","withRetry","catchAll","Retry","is","sleep","duration","as","exports","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","lastEventId","eventName","data","reset","undefined","chunk","hasBom","slice","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","id","noValue","field","step","valueLength","value","toString","includes","parseInt","Number","isNaN","millis","every","charCode","charCodeAt","RetryTypeId","Symbol","for","TaggedClass","hasProperty"],"sources":["../../src/Sse.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/VariantSchema.js b/dist/cjs/VariantSchema.js
index 40e8532843afeff54f387c4a41b425aa0ffe2568..e3e2b521def3e9278b6fcbc96041ea0ab72d1437 100644
--- a/dist/cjs/VariantSchema.js
+++ b/dist/cjs/VariantSchema.js
@@ -4,12 +4,12 @@ Object.defineProperty(exports, "__esModule", {
   value: true
 });
 exports.make = exports.isStruct = exports.isField = exports.fields = exports.TypeId = exports.Overrideable = exports.Override = exports.FieldTypeId = void 0;
-var ParseResult = _interopRequireWildcard(require("@effect/schema/ParseResult"));
-var Schema = _interopRequireWildcard(require("@effect/schema/Schema"));
 var _Function = require("effect/Function");
 var Option = _interopRequireWildcard(require("effect/Option"));
+var ParseResult = _interopRequireWildcard(require("effect/ParseResult"));
 var _Pipeable = require("effect/Pipeable");
 var Predicate = _interopRequireWildcard(require("effect/Predicate"));
+var Schema = _interopRequireWildcard(require("effect/Schema"));
 var Struct_ = _interopRequireWildcard(require("effect/Struct"));
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
 function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
@@ -83,7 +83,10 @@ const make = options => {
       }
       for (const variant of options.variants) {
         Object.defineProperty(Base, variant, {
-          value: extract(variantStruct, variant)
+          value: extract(variantStruct, variant).annotations({
+            identifier: `${identifier}.${variant}`,
+            title: `${identifier}.${variant}`
+          })
         });
       }
       return Base;
@@ -155,10 +158,10 @@ const Override = value => value;
  * @category overrideable
  */
 exports.Override = Override;
-const Overrideable = (from, to, options) => Schema.transformOrFail(from, Schema.Union(Schema.Undefined, to.pipe(Schema.brand("Override"))), {
-  decode: _ => ParseResult.succeed(undefined),
+const Overrideable = (from, to, options) => Schema.transformOrFail(from, Schema.Union(Schema.Undefined, to), {
+  decode: _ => options.decode ? ParseResult.decode(options.decode)(_) : ParseResult.succeed(undefined),
   encode: dt => options.generate(dt === undefined ? Option.none() : Option.some(dt))
-}).pipe(Schema.propertySignature, Schema.withConstructorDefault(_Function.constUndefined));
+}).pipe(Schema.propertySignature, Schema.withConstructorDefault(options.constructorDefault ?? _Function.constUndefined));
 exports.Overrideable = Overrideable;
 const StructProto = {
   pipe() {
diff --git a/dist/cjs/VariantSchema.js.map b/dist/cjs/VariantSchema.js.map
index 24b8d3f818982b6b9917de8ac34bcefe4dcaa968..c3d10bd1627d69abdce19fe6701ebd342a4aa2f1 100644
--- a/dist/cjs/VariantSchema.js.map
+++ b/dist/cjs/VariantSchema.js.map
@@ -1 +1 @@
-{"version":3,"file":"VariantSchema.js","names":["ParseResult","_interopRequireWildcard","require","Schema","_Function","Option","_Pipeable","Predicate","Struct_","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","cacheSymbol","isStruct","hasProperty","FieldTypeId","isField","extract","dual","args","self","variant","options","cache","cacheKey","isDefault","undefined","fields","key","keys","value","isSchema","schemas","Struct","make","Class","identifier","annotations","variantStruct","schema","defaultVariant","Base","variants","FieldOnly","obj","Field","FieldExcept","includes","UnionVariants","members","Union","fieldEvolve","f","field","fromEntries","map","evolve","fieldFromKey","mapping","entries","renameFieldValue","extractVariants","Override","Overrideable","from","to","transformOrFail","Undefined","pipe","brand","decode","_","succeed","encode","dt","generate","none","some","propertySignature","withConstructorDefault","constUndefined","StructProto","pipeArguments","arguments","create","FieldProto","VariantUnion","filter","member","isPropertySignature","fromKey"],"sources":["../../src/VariantSchema.ts"],"sourcesContent":[null],"mappings":";;;;;;AAIA,IAAAA,WAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,MAAA,GAAAF,uBAAA,CAAAC,OAAA;AAGA,IAAAE,SAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAJ,uBAAA,CAAAC,OAAA;AACA,IAAAI,SAAA,GAAAJ,OAAA;AACA,IAAAK,SAAA,GAAAN,uBAAA,CAAAC,OAAA;AACA,IAAAM,OAAA,GAAAP,uBAAA,CAAAC,OAAA;AAAwC,SAAAO,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAT,wBAAAS,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAExC;;;;AAIO,MAAMW,MAAM,GAAAC,OAAA,CAAAD,MAAA,gBAAkBE,MAAM,CAACC,GAAG,CAAC,oCAAoC,CAAC;AAQrF,MAAMC,WAAW,gBAAGF,MAAM,CAACC,GAAG,CAAC,0CAA0C,CAAC;AAY1E;;;;AAIO,MAAME,QAAQ,GAAIV,CAAU,IAAuBjB,SAAS,CAAC4B,WAAW,CAACX,CAAC,EAAEK,MAAM,CAAC;AAqC1F;;;;AAAAC,OAAA,CAAAI,QAAA,GAAAA,QAAA;AAIO,MAAME,WAAW,GAAAN,OAAA,CAAAM,WAAA,gBAAkBL,MAAM,CAACC,GAAG,CAClD,0CAA0C,CAC3C;AAiBD;;;;AAIO,MAAMK,OAAO,GAAIb,CAAU,IAAsBjB,SAAS,CAAC4B,WAAW,CAACX,CAAC,EAAEY,WAAW,CAAC;AAAAN,OAAA,CAAAO,OAAA,GAAAA,OAAA;AA8E7F,MAAMC,OAAO,gBAUT,IAAAC,cAAI,EACLC,IAAI,IAAKN,QAAQ,CAACM,IAAI,CAAC,CAAC,CAAC,CAAC,EAC3B,CACEC,IAAO,EACPC,OAAU,EACVC,OAEC,KACgB;EACjB,MAAMC,KAAK,GAAGH,IAAI,CAACR,WAAW,CAAC,KAAKQ,IAAI,CAACR,WAAW,CAAC,GAAG,EAAE,CAAC;EAC3D,MAAMY,QAAQ,GAAGF,OAAO,EAAEG,SAAS,KAAK,IAAI,GAAG,WAAW,GAAGJ,OAAO;EACpE,IAAIE,KAAK,CAACC,QAAQ,CAAC,KAAKE,SAAS,EAAE;IACjC,OAAOH,KAAK,CAACC,QAAQ,CAAQ;EAC/B;EACA,MAAMG,MAAM,GAAwB,EAAE;EACtC,KAAK,MAAMC,GAAG,IAAI5B,MAAM,CAAC6B,IAAI,CAACT,IAAI,CAACZ,MAAM,CAAC,CAAC,EAAE;IAC3C,MAAMsB,KAAK,GAAGV,IAAI,CAACZ,MAAM,CAAC,CAACoB,GAAG,CAAC;IAC/B,IAAIpB,MAAM,IAAIsB,KAAK,EAAE;MACnB,IAAIR,OAAO,EAAEG,SAAS,KAAK,IAAI,IAAI3C,MAAM,CAACiD,QAAQ,CAACD,KAAK,CAAC,EAAE;QACzDH,MAAM,CAACC,GAAG,CAAC,GAAGE,KAAK;MACrB,CAAC,MAAM;QACLH,MAAM,CAACC,GAAG,CAAC,GAAGX,OAAO,CAACa,KAAK,EAAET,OAAO,CAAC;MACvC;IACF,CAAC,MAAM,IAAIN,WAAW,IAAIe,KAAK,EAAE;MAC/B,IAAIT,OAAO,IAAIS,KAAK,CAACE,OAAO,EAAE;QAC5BL,MAAM,CAACC,GAAG,CAAC,GAAGE,KAAK,CAACE,OAAO,CAACX,OAAO,CAAC;MACtC;IACF,CAAC,MAAM;MACLM,MAAM,CAACC,GAAG,CAAC,GAAGE,KAAK;IACrB;EACF;EACA,OAAOP,KAAK,CAACC,QAAQ,CAAC,GAAG1C,MAAM,CAACmD,MAAM,CAACN,MAAM,CAAQ;AACvD,CAAC,CACF;AAED;;;;AAIO,MAAMA,MAAM,GAA2BP,IAAO,IAAgBA,IAAI,CAACZ,MAAM,CAAC;AA8HjF;;;;AAAAC,OAAA,CAAAkB,MAAA,GAAAA,MAAA;AAIO,MAAMO,IAAI,GAGfZ,OAGD,IA4HG;EACF,SAASa,KAAKA,CAAOC,UAAkB;IACrC,OAAO,UACLT,MAAqB,EACrBU,WAA6C;MAE7C,MAAMC,aAAa,GAAGL,MAAM,CAACN,MAAM,CAAC;MACpC,MAAMY,MAAM,GAAGtB,OAAO,CAACqB,aAAa,EAAEhB,OAAO,CAACkB,cAAc,EAAE;QAC5Df,SAAS,EAAE;OACZ,CAAC;MACF,MAAMgB,IAAK,SAAQ3D,MAAM,CAACqD,KAAK,CAAMC,UAAU,CAAC,CAACG,MAAM,CAACZ,MAAM,EAAEU,WAAW,CAAC;QAC1E,QAAQ7B,MAAM,IAAImB,MAAM;;MAE1B,KAAK,MAAMN,OAAO,IAAIC,OAAO,CAACoB,QAAQ,EAAE;QACtC1C,MAAM,CAACC,cAAc,CAACwC,IAAI,EAAEpB,OAAO,EAAE;UACnCS,KAAK,EAAEb,OAAO,CAACqB,aAAa,EAAEjB,OAAO;SACtC,CAAC;MACJ;MACA,OAAOoB,IAAI;IACb,CAAC;EACH;EACA,SAASE,SAASA,CAAwB,GAAGd,IAAU;IACrD,OAAO,UAAqEU,MAAS;MACnF,MAAMK,GAAG,GAAsB,EAAE;MACjC,KAAK,MAAMhB,GAAG,IAAIC,IAAI,EAAE;QACtBe,GAAG,CAAChB,GAAG,CAAC,GAAGW,MAAM;MACnB;MACA,OAAOM,KAAK,CAACD,GAAG,CAAC;IACnB,CAAC;EACH;EACA,SAASE,WAAWA,CAAwB,GAAGjB,IAAU;IACvD,OAAO,UAAqEU,MAAS;MACnF,MAAMK,GAAG,GAAsB,EAAE;MACjC,KAAK,MAAMvB,OAAO,IAAIC,OAAO,CAACoB,QAAQ,EAAE;QACtC,IAAI,CAACb,IAAI,CAACkB,QAAQ,CAAC1B,OAAO,CAAC,EAAE;UAC3BuB,GAAG,CAACvB,OAAO,CAAC,GAAGkB,MAAM;QACvB;MACF;MACA,OAAOM,KAAK,CAACD,GAAG,CAAC;IACnB,CAAC;EACH;EACA,SAASI,aAAaA,CAAC,GAAGC,OAAmC;IAC3D,OAAOC,KAAK,CAACD,OAAO,EAAE3B,OAAO,CAACoB,QAAQ,CAAC;EACzC;EACA,MAAMS,WAAW,GAAG,IAAAjC,cAAI,EACtB,CAAC,EACD,CACEE,IAAmE,EACnEgC,CAA6D,KAC/C;IACd,MAAMC,KAAK,GAAGrC,OAAO,CAACI,IAAI,CAAC,GAAGA,IAAI,GAAGyB,KAAK,CAAC7C,MAAM,CAACsD,WAAW,CAC3DhC,OAAO,CAACoB,QAAQ,CAACa,GAAG,CAAElC,OAAO,IAAK,CAACA,OAAO,EAAED,IAAI,CAAC,CAAC,CACnD,CAAC;IACF,OAAOyB,KAAK,CAAC1D,OAAO,CAACqE,MAAM,CAACH,KAAK,CAACrB,OAAO,EAAEoB,CAAC,CAAC,CAAC;EAChD,CAAC,CACF;EACD,MAAMK,YAAY,GAAG,IAAAvC,cAAI,EACvB,CAAC,EACD,CACEE,IAKgC,EAChCsC,OAA+B,KACjB;IACd,MAAMd,GAAG,GAAwB,EAAE;IACnC,IAAI5B,OAAO,CAACI,IAAI,CAAC,EAAE;MACjB,KAAK,MAAM,CAACQ,GAAG,EAAEW,MAAM,CAAC,IAAIvC,MAAM,CAAC2D,OAAO,CAACvC,IAAI,CAACY,OAAO,CAAC,EAAE;QACxDY,GAAG,CAAChB,GAAG,CAAC,GAAG8B,OAAO,CAAC9B,GAAG,CAAC,KAAKF,SAAS,GAAGkC,gBAAgB,CAACrB,MAAa,EAAEmB,OAAO,CAAC9B,GAAG,CAAC,CAAC,GAAGW,MAAM;MAChG;IACF,CAAC,MAAM;MACL,KAAK,MAAMX,GAAG,IAAIN,OAAO,CAACoB,QAAQ,EAAE;QAClCE,GAAG,CAAChB,GAAG,CAAC,GAAG8B,OAAO,CAAC9B,GAAG,CAAC,KAAKF,SAAS,GAAGkC,gBAAgB,CAACxC,IAAW,EAAEsC,OAAO,CAAC9B,GAAG,CAAC,CAAC,GAAGR,IAAI;MAC5F;IACF;IACA,OAAOyB,KAAK,CAACD,GAAG,CAAC;EACnB,CAAC,CACF;EACD,MAAMiB,eAAe,GAAG,IAAA3C,cAAI,EAC1B,CAAC,EACD,CAACE,IAAiB,EAAEC,OAAe,KACjCJ,OAAO,CAACG,IAAI,EAAEC,OAAO,EAAE;IACrBI,SAAS,EAAEJ,OAAO,KAAKC,OAAO,CAACkB;GAChC,CAAC,CACL;EACD,OAAO;IACLP,MAAM;IACNY,KAAK;IACLF,SAAS;IACTG,WAAW;IACXX,KAAK;IACLe,KAAK,EAAEF,aAAa;IACpBG,WAAW;IACXM,YAAY;IACZxC,OAAO,EAAE4C;GACH;AACV,CAAC;AAED;;;;AAAApD,OAAA,CAAAyB,IAAA,GAAAA,IAAA;AAIO,MAAM4B,QAAQ,GAAOhC,KAAQ,IAA4BA,KAAY;AAU5E;;;;AAAArB,OAAA,CAAAqD,QAAA,GAAAA,QAAA;AAIO,MAAMC,YAAY,GAAGA,CAC1BC,IAAuC,EACvCC,EAA0B,EAC1B3C,OAEC,KAEDxC,MAAM,CAACoF,eAAe,CAACF,IAAI,EAAElF,MAAM,CAACoE,KAAK,CAACpE,MAAM,CAACqF,SAAS,EAAEF,EAAE,CAACG,IAAI,CAACtF,MAAM,CAACuF,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;EAC9FC,MAAM,EAAGC,CAAC,IAAK5F,WAAW,CAAC6F,OAAO,CAAC9C,SAAS,CAAC;EAC7C+C,MAAM,EAAGC,EAAE,IAAKpD,OAAO,CAACqD,QAAQ,CAACD,EAAE,KAAKhD,SAAS,GAAG1C,MAAM,CAAC4F,IAAI,EAAE,GAAG5F,MAAM,CAAC6F,IAAI,CAACH,EAAE,CAAC;CACpF,CAAC,CAACN,IAAI,CAACtF,MAAM,CAACgG,iBAAiB,EAAEhG,MAAM,CAACiG,sBAAsB,CAACC,wBAAc,CAAC,CAAC;AAAAvE,OAAA,CAAAsD,YAAA,GAAAA,YAAA;AAElF,MAAMkB,WAAW,GAAG;EAClBb,IAAIA,CAAA;IACF,OAAO,IAAAc,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD;AAED,MAAMlD,MAAM,GAAkCN,MAAS,IAAe;EACpE,MAAMP,IAAI,GAAGpB,MAAM,CAACoF,MAAM,CAACH,WAAW,CAAC;EACvC7D,IAAI,CAACZ,MAAM,CAAC,GAAGmB,MAAM;EACrB,OAAOP,IAAI;AACb,CAAC;AAED,MAAMiE,UAAU,GAAG;EACjB,CAACtE,WAAW,GAAGA,WAAW;EAC1BqD,IAAIA,CAAA;IACF,OAAO,IAAAc,uBAAa,EAAC,IAAI,EAAEC,SAAS,CAAC;EACvC;CACD;AAED,MAAMtC,KAAK,GAAkCb,OAAU,IAAc;EACnE,MAAMZ,IAAI,GAAGpB,MAAM,CAACoF,MAAM,CAACC,UAAU,CAAC;EACtCjE,IAAI,CAACY,OAAO,GAAGA,OAAO;EACtB,OAAOZ,IAAI;AACb,CAAC;AAED,MAAM8B,KAAK,GAAGA,CACZD,OAAgB,EAChBP,QAAkB,KAChB;EACF,MAAM4C,YAAa,SAASxG,MAAM,CAACoE,KAAK,CAAC,GAAGD,OAAO,CAACsC,MAAM,CAAEC,MAAM,IAAK1G,MAAM,CAACiD,QAAQ,CAACyD,MAAM,CAAC,CAAC,CAAS;EACxG,KAAK,MAAMnE,OAAO,IAAIqB,QAAQ,EAAE;IAC9B1C,MAAM,CAACC,cAAc,CAACqF,YAAY,EAAEjE,OAAO,EAAE;MAC3CS,KAAK,EAAEhD,MAAM,CAACoE,KAAK,CAAC,GAAGD,OAAO,CAACM,GAAG,CAAEiC,MAAM,IAAKvE,OAAO,CAACuE,MAAM,EAAEnE,OAAO,CAAC,CAAC;KACzE,CAAC;EACJ;EACA,OAAOiE,YAAY;AACrB,CAAC;AAED,MAAM1B,gBAAgB,GAAGA,CACvBxC,IAAO,EACPQ,GAAW,KAEX9C,MAAM,CAAC2G,mBAAmB,CAACrE,IAAI,CAAC,GAC5BtC,MAAM,CAAC4G,OAAO,CAACtE,IAAI,EAAEQ,GAAG,CAAC,GACzB9C,MAAM,CAAC4G,OAAO,CAAC5G,MAAM,CAACgG,iBAAiB,CAAC1D,IAAI,CAAC,EAAEQ,GAAG,CAAC","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"VariantSchema.js","names":["_Function","require","Option","_interopRequireWildcard","ParseResult","_Pipeable","Predicate","Schema","Struct_","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","TypeId","exports","Symbol","for","cacheSymbol","isStruct","hasProperty","FieldTypeId","isField","extract","dual","args","self","variant","options","cache","cacheKey","isDefault","undefined","fields","key","keys","value","isSchema","schemas","Struct","make","Class","identifier","annotations","variantStruct","schema","defaultVariant","Base","variants","title","FieldOnly","obj","Field","FieldExcept","includes","UnionVariants","members","Union","fieldEvolve","f","field","fromEntries","map","evolve","fieldFromKey","mapping","entries","renameFieldValue","extractVariants","Override","Overrideable","from","to","transformOrFail","Undefined","decode","_","succeed","encode","dt","generate","none","some","pipe","propertySignature","withConstructorDefault","constructorDefault","constUndefined","StructProto","pipeArguments","arguments","create","FieldProto","VariantUnion","filter","member","isPropertySignature","fromKey"],"sources":["../../src/VariantSchema.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/cjs/index.js b/dist/cjs/index.js
index 8abd1729baef2f780a3566613b171d2c8ea357eb..ae18931deb93986b870224fb22327d55c8d57c58 100644
--- a/dist/cjs/index.js
+++ b/dist/cjs/index.js
@@ -3,25 +3,35 @@
 Object.defineProperty(exports, "__esModule", {
   value: true
 });
-exports.VariantSchema = exports.SocketServer = exports.RequestResolver = exports.Persistence = exports.PersistedCache = exports.Ndjson = exports.MsgPack = exports.Machine = exports.DevTools = exports.ChannelSchema = void 0;
-var _ChannelSchema = _interopRequireWildcard(require("./ChannelSchema.js"));
-exports.ChannelSchema = _ChannelSchema;
+exports.VariantSchema = exports.Sse = exports.RequestResolver = exports.Reactivity = exports.Persistence = exports.PersistedCache = exports.Machine = exports.EventLogServer = exports.EventLogRemote = exports.EventLogEncryption = exports.EventLog = exports.EventJournal = exports.EventGroup = exports.Event = exports.DevTools = void 0;
 var _DevTools = _interopRequireWildcard(require("./DevTools.js"));
 exports.DevTools = _DevTools;
+var _Event = _interopRequireWildcard(require("./Event.js"));
+exports.Event = _Event;
+var _EventGroup = _interopRequireWildcard(require("./EventGroup.js"));
+exports.EventGroup = _EventGroup;
+var _EventJournal = _interopRequireWildcard(require("./EventJournal.js"));
+exports.EventJournal = _EventJournal;
+var _EventLog = _interopRequireWildcard(require("./EventLog.js"));
+exports.EventLog = _EventLog;
+var _EventLogEncryption = _interopRequireWildcard(require("./EventLogEncryption.js"));
+exports.EventLogEncryption = _EventLogEncryption;
+var _EventLogRemote = _interopRequireWildcard(require("./EventLogRemote.js"));
+exports.EventLogRemote = _EventLogRemote;
+var _EventLogServer = _interopRequireWildcard(require("./EventLogServer.js"));
+exports.EventLogServer = _EventLogServer;
 var _Machine = _interopRequireWildcard(require("./Machine.js"));
 exports.Machine = _Machine;
-var _MsgPack = _interopRequireWildcard(require("./MsgPack.js"));
-exports.MsgPack = _MsgPack;
-var _Ndjson = _interopRequireWildcard(require("./Ndjson.js"));
-exports.Ndjson = _Ndjson;
 var _PersistedCache = _interopRequireWildcard(require("./PersistedCache.js"));
 exports.PersistedCache = _PersistedCache;
 var _Persistence = _interopRequireWildcard(require("./Persistence.js"));
 exports.Persistence = _Persistence;
+var _Reactivity = _interopRequireWildcard(require("./Reactivity.js"));
+exports.Reactivity = _Reactivity;
 var _RequestResolver = _interopRequireWildcard(require("./RequestResolver.js"));
 exports.RequestResolver = _RequestResolver;
-var _SocketServer = _interopRequireWildcard(require("./SocketServer.js"));
-exports.SocketServer = _SocketServer;
+var _Sse = _interopRequireWildcard(require("./Sse.js"));
+exports.Sse = _Sse;
 var _VariantSchema = _interopRequireWildcard(require("./VariantSchema.js"));
 exports.VariantSchema = _VariantSchema;
 function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
diff --git a/dist/dts/DevTools/Client.d.ts b/dist/dts/DevTools/Client.d.ts
index 37db9b1af87f2903bdc425bcf18a109b6a7d3a7d..ebde7619f6abd586bf3ff1d13c66c5479d7d9d86 100644
--- a/dist/dts/DevTools/Client.d.ts
+++ b/dist/dts/DevTools/Client.d.ts
@@ -1,6 +1,3 @@
-/**
- * @since 1.0.0
- */
 import * as Socket from "@effect/platform/Socket";
 import * as Context from "effect/Context";
 import * as Effect from "effect/Effect";
diff --git a/dist/dts/DevTools/Client.d.ts.map b/dist/dts/DevTools/Client.d.ts.map
index 84d21beeb6561852b6d2b23bf6f99202c35d86b0..85eaf47ce491425798da791a82e060fb4d1fae3d 100644
--- a/dist/dts/DevTools/Client.d.ts.map
+++ b/dist/dts/DevTools/Client.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Client.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Client.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,MAAM,MAAM,yBAAyB,CAAA;AAEjD,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAEvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AAKrC,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAEvC,OAAO,KAAK,MAAM,MAAM,aAAa,CAAA;AAErC;;;GAGG;AACH,MAAM,WAAW,UAAU;IACzB,QAAQ,CAAC,aAAa,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,SAAS,KAAK,IAAI,CAAA;CACpE;AAED;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,QAAQ,CAAC,CAAC,EAAE,OAAO,MAAM,CAAA;CAC1B;AAED;;;GAGG;AACH,eAAO,MAAM,MAAM,iCAAiF,CAAA;AAEpG;;;GAGG;AACH,eAAO,MAAM,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAyG9E,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAA8B,CAAA;AAE1F;;;GAGG;AACH,eAAO,MAAM,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAmClE,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAKhE,CAAA"}
\ No newline at end of file
+{"version":3,"file":"Client.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Client.ts"],"names":[],"mappings":"AAIA,OAAO,KAAK,MAAM,MAAM,yBAAyB,CAAA;AAEjD,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AAEzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAGvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AAKrC,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,MAAM,MAAM,aAAa,CAAA;AAErC;;;GAGG;AACH,MAAM,WAAW,UAAU;IACzB,QAAQ,CAAC,aAAa,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,SAAS,KAAK,IAAI,CAAA;CACpE;AAED;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,QAAQ,CAAC,CAAC,EAAE,OAAO,MAAM,CAAA;CAC1B;AAED;;;GAGG;AACH,eAAO,MAAM,MAAM,iCAAiF,CAAA;AAEpG;;;GAGG;AACH,eAAO,MAAM,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAgH9E,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAA8B,CAAA;AAE1F;;;GAGG;AACH,eAAO,MAAM,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAmClE,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAKhE,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/DevTools/Domain.d.ts b/dist/dts/DevTools/Domain.d.ts
index e1a74f34f00a0e04b356890170451df3ec7b01a0..ff3476505ca0848e359a95aa5f5cd8bb1f232080 100644
--- a/dist/dts/DevTools/Domain.d.ts
+++ b/dist/dts/DevTools/Domain.d.ts
@@ -1,8 +1,8 @@
 /**
  * @since 1.0.0
  */
-import * as Schema from "@effect/schema/Schema";
 import type { Option } from "effect/Option";
+import * as Schema from "effect/Schema";
 /**
  * @since 1.0.0
  * @category schemas
@@ -301,19 +301,24 @@ export declare const Summary: Schema.Struct<{
         value: typeof Schema.String;
     }>>;
     state: Schema.Schema<{
-        readonly error: number;
         readonly count: number;
         readonly min: number;
         readonly max: number;
         readonly sum: number;
+        readonly error: number;
         readonly quantiles: readonly (readonly [number, Option<number>])[];
     }, {
-        readonly error: number;
         readonly count: number;
         readonly min: number;
         readonly max: number;
         readonly sum: number;
-        readonly quantiles: readonly (readonly [number, Schema.OptionEncoded<number>])[];
+        readonly error: number;
+        readonly quantiles: readonly (readonly [number, {
+            readonly _tag: "None";
+        } | {
+            readonly _tag: "Some";
+            readonly value: number;
+        }])[];
     }, never>;
 }>;
 /**
@@ -403,19 +408,24 @@ export declare const Metric: Schema.Union<[Schema.Struct<{
         value: typeof Schema.String;
     }>>;
     state: Schema.Schema<{
-        readonly error: number;
         readonly count: number;
         readonly min: number;
         readonly max: number;
         readonly sum: number;
+        readonly error: number;
         readonly quantiles: readonly (readonly [number, Option<number>])[];
     }, {
-        readonly error: number;
         readonly count: number;
         readonly min: number;
         readonly max: number;
         readonly sum: number;
-        readonly quantiles: readonly (readonly [number, Schema.OptionEncoded<number>])[];
+        readonly error: number;
+        readonly quantiles: readonly (readonly [number, {
+            readonly _tag: "None";
+        } | {
+            readonly _tag: "Some";
+            readonly value: number;
+        }])[];
     }, never>;
 }>]>;
 /**
@@ -517,19 +527,24 @@ export declare const MetricsSnapshot: Schema.Struct<{
             value: typeof Schema.String;
         }>>;
         state: Schema.Schema<{
-            readonly error: number;
             readonly count: number;
             readonly min: number;
             readonly max: number;
             readonly sum: number;
+            readonly error: number;
             readonly quantiles: readonly (readonly [number, Option<number>])[];
         }, {
-            readonly error: number;
             readonly count: number;
             readonly min: number;
             readonly max: number;
             readonly sum: number;
-            readonly quantiles: readonly (readonly [number, Schema.OptionEncoded<number>])[];
+            readonly error: number;
+            readonly quantiles: readonly (readonly [number, {
+                readonly _tag: "None";
+            } | {
+                readonly _tag: "Some";
+                readonly value: number;
+            }])[];
         }, never>;
     }>]>>;
 }>;
@@ -643,19 +658,24 @@ export declare const Request: Schema.Union<[Schema.Struct<{
             value: typeof Schema.String;
         }>>;
         state: Schema.Schema<{
-            readonly error: number;
             readonly count: number;
             readonly min: number;
             readonly max: number;
             readonly sum: number;
+            readonly error: number;
             readonly quantiles: readonly (readonly [number, Option<number>])[];
         }, {
-            readonly error: number;
             readonly count: number;
             readonly min: number;
             readonly max: number;
             readonly sum: number;
-            readonly quantiles: readonly (readonly [number, Schema.OptionEncoded<number>])[];
+            readonly error: number;
+            readonly quantiles: readonly (readonly [number, {
+                readonly _tag: "None";
+            } | {
+                readonly _tag: "Some";
+                readonly value: number;
+            }])[];
         }, never>;
     }>]>>;
 }>]>;
diff --git a/dist/dts/DevTools/Domain.d.ts.map b/dist/dts/DevTools/Domain.d.ts.map
index e394b0bb37a666f8bb80fb3b70416f959783731a..e7f287712d40713dee5fbd32639b7cdb46126049 100644
--- a/dist/dts/DevTools/Domain.d.ts.map
+++ b/dist/dts/DevTools/Domain.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Domain.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Domain.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"Domain.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Domain.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/DevTools/Server.d.ts b/dist/dts/DevTools/Server.d.ts
index 4ee1173cc4d95f5da2b21858abfe6b9b5c90a9c8..d44b970a7cf743089459894820d36a22cd77c5a7 100644
--- a/dist/dts/DevTools/Server.d.ts
+++ b/dist/dts/DevTools/Server.d.ts
@@ -1,38 +1,18 @@
-import * as Context from "effect/Context";
+import * as SocketServer from "@effect/platform/SocketServer";
 import * as Effect from "effect/Effect";
-import * as Queue from "effect/Queue";
-import * as SocketServer from "../SocketServer/Node.js";
+import * as Mailbox from "effect/Mailbox";
 import * as Domain from "./Domain.js";
-/**
- * @since 1.0.0
- * @category models
- */
-export interface ServerImpl {
-    readonly run: <R, E, _>(handle: (client: Client) => Effect.Effect<_, E, R>) => Effect.Effect<never, SocketServer.SocketServerError | E, R>;
-}
 /**
  * @since 1.0.0
  * @category models
  */
 export interface Client {
-    readonly queue: Queue.Dequeue<Domain.Request.WithoutPing>;
+    readonly queue: Mailbox.ReadonlyMailbox<Domain.Request.WithoutPing>;
     readonly request: (_: Domain.Response.WithoutPong) => Effect.Effect<void>;
 }
-/**
- * @since 1.0.0
- * @category tags
- */
-export interface Server {
-    readonly _: unique symbol;
-}
-/**
- * @since 1.0.0
- * @category tags
- */
-export declare const Server: Context.Tag<Server, ServerImpl>;
 /**
  * @since 1.0.0
  * @category constructors
  */
-export declare const make: Effect.Effect<ServerImpl, never, SocketServer.SocketServer>;
+export declare const run: <R, E, _>(handle: (client: Client) => Effect.Effect<_, E, R>) => Effect.Effect<never, SocketServer.SocketServerError, R | SocketServer.SocketServer>;
 //# sourceMappingURL=Server.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/DevTools/Server.d.ts.map b/dist/dts/DevTools/Server.d.ts.map
index f4e5508df5d7ab452f1b14d3452a5f85116c1d8b..773d58dc1366442114341e33bd8d9e5d5454a462 100644
--- a/dist/dts/DevTools/Server.d.ts.map
+++ b/dist/dts/DevTools/Server.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Server.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Server.ts"],"names":[],"mappings":"AAIA,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AAGrC,OAAO,KAAK,YAAY,MAAM,yBAAyB,CAAA;AACvD,OAAO,KAAK,MAAM,MAAM,aAAa,CAAA;AAErC;;;GAGG;AACH,MAAM,WAAW,UAAU;IACzB,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EACpB,MAAM,EAAE,CAAC,MAAM,EAAE,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,KAC/C,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,YAAY,CAAC,iBAAiB,GAAG,CAAC,EAAE,CAAC,CAAC,CAAA;CACjE;AAED;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,QAAQ,CAAC,KAAK,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;IACzD,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;CAC1E;AAED;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,QAAQ,CAAC,CAAC,EAAE,OAAO,MAAM,CAAA;CAC1B;AAED;;;GAGG;AACH,eAAO,MAAM,MAAM,iCAAiF,CAAA;AAEpG;;;GAGG;AACH,eAAO,MAAM,IAAI,6DAuCf,CAAA"}
\ No newline at end of file
+{"version":3,"file":"Server.d.ts","sourceRoot":"","sources":["../../../src/DevTools/Server.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,YAAY,MAAM,+BAA+B,CAAA;AAC7D,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AAEzC,OAAO,KAAK,MAAM,MAAM,aAAa,CAAA;AAErC;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,eAAe,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;IACnE,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,WAAW,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;CAC1E;AAED;;;GAGG;AACH,eAAO,MAAM,GAAG,GAA+B,CAAC,EAAE,CAAC,EAAE,CAAC,mBAAmB,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,wFA+BxG,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/Event.d.ts b/dist/dts/Event.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..a7bd21ffd21bf606cd65ae0d14bf6c638c3c5783
--- /dev/null
+++ b/dist/dts/Event.d.ts
@@ -0,0 +1,167 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Schema from "effect/Schema";
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export declare const TypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type TypeId = typeof TypeId;
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export declare const isEvent: (u: unknown) => u is Event<any, any, any, any>;
+/**
+ * Represents an event in an EventLog.
+ *
+ * @since 1.0.0
+ * @category models
+ */
+export interface Event<out Tag extends string, in out Payload extends Schema.Schema.Any = typeof Schema.Void, in out Success extends Schema.Schema.Any = typeof Schema.Void, in out Error extends Schema.Schema.All = typeof Schema.Never> {
+    readonly [TypeId]: TypeId;
+    readonly tag: Tag;
+    readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string;
+    readonly payload: Payload;
+    readonly payloadMsgPack: MsgPack.schema<Payload>;
+    readonly success: Success;
+    readonly error: Error;
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventHandler<in out Tag extends string> {
+    readonly _: unique symbol;
+    readonly tag: Tag;
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare namespace Event {
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    interface Any {
+        readonly [TypeId]: TypeId;
+        readonly tag: string;
+    }
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    interface AnyWithProps extends Event<string, Schema.Schema.Any, Schema.Schema.Any, Schema.Schema.Any> {
+    }
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ToService<A> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? EventHandler<_Tag> : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Tag<A> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? _Tag : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ErrorSchema<A extends Any> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? _Error : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Error<A extends Any> = Schema.Schema.Type<ErrorSchema<A>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type AddError<A extends Any, Error extends Schema.Schema.Any> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? Event<_Tag, _Payload, _Success, _Error | Error> : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type PayloadSchema<A extends Any> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? _Payload : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Payload<A extends Any> = Schema.Schema.Type<PayloadSchema<A>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type TaggedPayload<A extends Any> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? {
+        readonly _tag: _Tag;
+        readonly payload: Schema.Schema.Type<_Payload>;
+    } : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type SuccessSchema<A extends Any> = A extends Event<infer _Tag, infer _Payload, infer _Success, infer _Error> ? _Success : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Success<A extends Any> = Schema.Schema.Type<SuccessSchema<A>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Context<A> = A extends Event<infer _Name, infer _Payload, infer _Success, infer _Error> ? Schema.Schema.Context<_Payload> | Schema.Schema.Context<_Success> | Schema.Schema.Context<_Error> : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type WithTag<Events extends Any, Tag extends string> = Extract<Events, {
+        readonly tag: Tag;
+    }>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ExcludeTag<Events extends Any, Tag extends string> = Exclude<Events, {
+        readonly tag: Tag;
+    }>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type PayloadWithTag<Events extends Any, Tag extends string> = Payload<WithTag<Events, Tag>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type SuccessWithTag<Events extends Any, Tag extends string> = Success<WithTag<Events, Tag>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ErrorWithTag<Events extends Any, Tag extends string> = Error<WithTag<Events, Tag>>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ContextWithTag<Events extends Any, Tag extends string> = Context<WithTag<Events, Tag>>;
+}
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare const make: <Tag extends string, Payload extends Schema.Schema.Any = typeof Schema.Void, Success extends Schema.Schema.Any = typeof Schema.Void, Error extends Schema.Schema.All = typeof Schema.Never>(options: {
+    readonly tag: Tag;
+    readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string;
+    readonly payload?: Payload;
+    readonly success?: Success;
+    readonly error?: Error;
+}) => Event<Tag, Payload, Success, Error>;
+//# sourceMappingURL=Event.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Event.d.ts.map b/dist/dts/Event.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..8efd9e43721c96d12b685d28268bb54f2164576a
--- /dev/null
+++ b/dist/dts/Event.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"Event.d.ts","sourceRoot":"","sources":["../../src/Event.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/EventGroup.d.ts b/dist/dts/EventGroup.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..23feb4945a637abbca708ae87f770330f42570cb
--- /dev/null
+++ b/dist/dts/EventGroup.d.ts
@@ -0,0 +1,91 @@
+import { type Pipeable } from "effect/Pipeable";
+import * as Record from "effect/Record";
+import type * as Schema from "effect/Schema";
+import type { Event } from "./Event.js";
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export declare const TypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type TypeId = typeof TypeId;
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export declare const isEventGroup: (u: unknown) => u is EventGroup.Any;
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLogBuilder.group` api.
+ *
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventGroup<out Events extends Event.Any = never> extends Pipeable {
+    new (_: never): {};
+    readonly [TypeId]: TypeId;
+    readonly events: Record.ReadonlyRecord<string, Events>;
+    /**
+     * Add an `Event` to the `EventGroup`.
+     */
+    add<Tag extends string, Payload extends Schema.Schema.Any = typeof Schema.Void, Success extends Schema.Schema.Any = typeof Schema.Void, Error extends Schema.Schema.All = typeof Schema.Never>(options: {
+        readonly tag: Tag;
+        readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string;
+        readonly payload?: Payload;
+        readonly success?: Success;
+        readonly error?: Error;
+    }): EventGroup<Events | Event<Tag, Payload, Success, Error>>;
+    /**
+     * Add an error schema to all the events in the `EventGroup`.
+     */
+    addError<Error extends Schema.Schema.Any>(error: Error): EventGroup<Event.AddError<Events, Error>>;
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare namespace EventGroup {
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    interface Any {
+        readonly [TypeId]: TypeId;
+    }
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type AnyWithProps = EventGroup<Event.AnyWithProps>;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type ToService<A> = A extends EventGroup<infer _Events> ? Event.ToService<_Events> : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Events<Group> = Group extends EventGroup<infer _Events> ? _Events : never;
+    /**
+     * @since 1.0.0
+     * @category models
+     */
+    type Context<Group> = Event.Context<Events<Group>>;
+}
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLog.group` api.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare const empty: EventGroup<never>;
+//# sourceMappingURL=EventGroup.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventGroup.d.ts.map b/dist/dts/EventGroup.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..c79775aa9ca698b8f0217acbea9a1441859ca945
--- /dev/null
+++ b/dist/dts/EventGroup.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventGroup.d.ts","sourceRoot":"","sources":["../../src/EventGroup.ts"],"names":[],"mappings":"AAIA,OAAO,EAAE,KAAK,QAAQ,EAAiB,MAAM,iBAAiB,CAAA;AAE9D,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,MAAM,MAAM,eAAe,CAAA;AAC5C,OAAO,KAAK,EAAE,KAAK,EAAE,MAAM,YAAY,CAAA;AAGvC;;;GAGG;AACH,eAAO,MAAM,MAAM,EAAE,OAAO,MAAsD,CAAA;AAElF;;;GAGG;AACH,MAAM,MAAM,MAAM,GAAG,OAAO,MAAM,CAAA;AAElC;;;GAGG;AACH,eAAO,MAAM,YAAY,MAAO,OAAO,KAAG,CAAC,IAAI,UAAU,CAAC,GAAuC,CAAA;AAEjG;;;;;;;;GAQG;AACH,MAAM,WAAW,UAAU,CACzB,GAAG,CAAC,MAAM,SAAS,KAAK,CAAC,GAAG,GAAG,KAAK,CACpC,SAAQ,QAAQ;IAChB,KAAI,CAAC,EAAE,KAAK,GAAG,EAAE,CAAA;IAEjB,QAAQ,CAAC,CAAC,MAAM,CAAC,EAAE,MAAM,CAAA;IACzB,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;IAEtD;;OAEG;IACH,GAAG,CACD,GAAG,SAAS,MAAM,EAClB,OAAO,SAAS,MAAM,CAAC,MAAM,CAAC,GAAG,GAAG,OAAO,MAAM,CAAC,IAAI,EACtD,OAAO,SAAS,MAAM,CAAC,MAAM,CAAC,GAAG,GAAG,OAAO,MAAM,CAAC,IAAI,EACtD,KAAK,SAAS,MAAM,CAAC,MAAM,CAAC,GAAG,GAAG,OAAO,MAAM,CAAC,KAAK,EACrD,OAAO,EAAE;QACT,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAA;QACjB,QAAQ,CAAC,UAAU,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,MAAM,CAAA;QACrE,QAAQ,CAAC,OAAO,CAAC,EAAE,OAAO,CAAA;QAC1B,QAAQ,CAAC,OAAO,CAAC,EAAE,OAAO,CAAA;QAC1B,QAAQ,CAAC,KAAK,CAAC,EAAE,KAAK,CAAA;KACvB,GAAG,UAAU,CAAC,MAAM,GAAG,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC,CAAA;IAE5D;;OAEG;IACH,QAAQ,CAAC,KAAK,SAAS,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAA;CACnG;AAED;;;GAGG;AACH,MAAM,CAAC,OAAO,WAAW,UAAU,CAAC;IAClC;;;OAGG;IACH,UAAiB,GAAG;QAClB,QAAQ,CAAC,CAAC,MAAM,CAAC,EAAE,MAAM,CAAA;KAC1B;IAED;;;OAGG;IACH,KAAY,YAAY,GAAG,UAAU,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;IAEzD;;;OAGG;IACH,KAAY,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,UAAU,CAAC,MAAM,OAAO,CAAC,GAAG,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,GACrF,KAAK,CAAA;IAET;;;OAGG;IACH,KAAY,MAAM,CAAC,KAAK,IAAI,KAAK,SAAS,UAAU,CAAC,MAAM,OAAO,CAAC,GAAG,OAAO,GACzE,KAAK,CAAA;IAET;;;OAGG;IACH,KAAY,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAA;CAC1D;AA0CD;;;;;;;;GAQG;AACH,eAAO,MAAM,KAAK,EAAE,UAAU,CAAC,KAAK,CAAyC,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/EventJournal.d.ts b/dist/dts/EventJournal.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..3858fbd6c9b73eaa8158d7e5bb6c7c88ab1b3d12
--- /dev/null
+++ b/dist/dts/EventJournal.d.ts
@@ -0,0 +1,226 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Context from "effect/Context";
+import * as DateTime from "effect/DateTime";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import type * as Queue from "effect/Queue";
+import * as Schema from "effect/Schema";
+import type { Scope } from "effect/Scope";
+declare const EventJournal_base: Context.TagClass<EventJournal, "@effect/experimental/EventJournal", {
+    /**
+     * Read all the entries in the journal.
+     */
+    readonly entries: Effect.Effect<ReadonlyArray<Entry>, EventJournalError>;
+    /**
+     * Write an event to the journal, performing an effect before committing the
+     * event.
+     */
+    readonly write: <A, E, R>(options: {
+        readonly event: string;
+        readonly primaryKey: string;
+        readonly payload: Uint8Array;
+        readonly effect: (entry: Entry) => Effect.Effect<A, E, R>;
+    }) => Effect.Effect<A, EventJournalError | E, R>;
+    /**
+     * Write events from a remote source to the journal.
+     */
+    readonly writeFromRemote: (options: {
+        readonly remoteId: RemoteId;
+        readonly entries: ReadonlyArray<RemoteEntry>;
+        readonly compact?: ((uncommitted: ReadonlyArray<RemoteEntry>) => Effect.Effect<ReadonlyArray<[compacted: ReadonlyArray<Entry>, remoteEntries: ReadonlyArray<RemoteEntry>]>, EventJournalError>) | undefined;
+        readonly effect: (options: {
+            readonly entry: Entry;
+            readonly conflicts: ReadonlyArray<Entry>;
+        }) => Effect.Effect<void, EventJournalError>;
+    }) => Effect.Effect<void, EventJournalError>;
+    /**
+     * Return the uncommitted entries for a remote source.
+     */
+    readonly withRemoteUncommited: <A, E, R>(remoteId: RemoteId, f: (entries: ReadonlyArray<Entry>) => Effect.Effect<A, E, R>) => Effect.Effect<A, EventJournalError | E, R>;
+    /**
+     * Retrieve the last known sequence number for a remote source.
+     */
+    readonly nextRemoteSequence: (remoteId: RemoteId) => Effect.Effect<number, EventJournalError>;
+    /**
+     * The entries added to the local journal.
+     */
+    readonly changes: Effect.Effect<Queue.Dequeue<Entry>, never, Scope>;
+    /**
+     * Remove all data
+     */
+    readonly destroy: Effect.Effect<void, EventJournalError>;
+}>;
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export declare class EventJournal extends EventJournal_base {
+}
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export declare const ErrorTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export type ErrorTypeId = typeof ErrorTypeId;
+declare const EventJournalError_base: Schema.TaggedClass<EventJournalError, "EventJournalError", {
+    readonly _tag: Schema.tag<"EventJournalError">;
+} & {
+    method: typeof Schema.String;
+    cause: typeof Schema.Defect;
+}>;
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export declare class EventJournalError extends EventJournalError_base {
+    /**
+     * @since 1.0.0
+     */
+    readonly [ErrorTypeId]: ErrorTypeId;
+}
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export declare const RemoteIdTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export declare const RemoteId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof RemoteIdTypeId>;
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export type RemoteId = typeof RemoteId.Type;
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export declare const makeRemoteId: () => RemoteId;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare const EntryIdTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare const EntryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof EntryIdTypeId>;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export type EntryId = typeof EntryId.Type;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare const makeEntryId: (options?: {
+    msecs?: number;
+}) => EntryId;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare const entryIdMillis: (entryId: EntryId) => number;
+declare const Entry_base: Schema.Class<Entry, {
+    id: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof EntryIdTypeId>;
+    event: typeof Schema.String;
+    primaryKey: typeof Schema.String;
+    payload: typeof Schema.Uint8ArrayFromSelf;
+}, Schema.Struct.Encoded<{
+    id: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof EntryIdTypeId>;
+    event: typeof Schema.String;
+    primaryKey: typeof Schema.String;
+    payload: typeof Schema.Uint8ArrayFromSelf;
+}>, never, {
+    readonly id: Uint8Array<ArrayBufferLike> & import("effect/Brand").Brand<typeof EntryIdTypeId>;
+} & {
+    readonly event: string;
+} & {
+    readonly primaryKey: string;
+} & {
+    readonly payload: Uint8Array<ArrayBufferLike>;
+}, {}, {}>;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare class Entry extends Entry_base {
+    /**
+     * @since 1.0.0
+     */
+    static arrayMsgPack: Schema.Array$<MsgPack.schema<typeof Entry>>;
+    /**
+     * @since 1.0.0
+     */
+    static encodeArray: (a: readonly Entry[], overrideOptions?: import("effect/SchemaAST").ParseOptions) => Effect.Effect<readonly Uint8Array<ArrayBufferLike>[], import("effect/ParseResult").ParseError, never>;
+    /**
+     * @since 1.0.0
+     */
+    static decodeArray: (i: readonly Uint8Array<ArrayBufferLike>[], overrideOptions?: import("effect/SchemaAST").ParseOptions) => Effect.Effect<readonly Entry[], import("effect/ParseResult").ParseError, never>;
+    /**
+     * @since 1.0.0
+     */
+    get idString(): string;
+    /**
+     * @since 1.0.0
+     */
+    get createdAtMillis(): number;
+    /**
+     * @since 1.0.0
+     */
+    get createdAt(): DateTime.Utc;
+}
+declare const RemoteEntry_base: Schema.Class<RemoteEntry, {
+    remoteSequence: typeof Schema.Number;
+    entry: typeof Entry;
+}, Schema.Struct.Encoded<{
+    remoteSequence: typeof Schema.Number;
+    entry: typeof Entry;
+}>, never, {
+    readonly remoteSequence: number;
+} & {
+    readonly entry: Entry;
+}, {}, {}>;
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export declare class RemoteEntry extends RemoteEntry_base {
+}
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export declare const makeMemory: Effect.Effect<typeof EventJournal.Service>;
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export declare const layerMemory: Layer.Layer<EventJournal>;
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export declare const makeIndexedDb: (options?: {
+    readonly database?: string;
+}) => Effect.Effect<typeof EventJournal.Service, EventJournalError, Scope>;
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export declare const layerIndexedDb: (options?: {
+    readonly database?: string;
+}) => Layer.Layer<EventJournal, EventJournalError>;
+export {};
+//# sourceMappingURL=EventJournal.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventJournal.d.ts.map b/dist/dts/EventJournal.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..5ee56e7d4a59f96f39303272e341aef9852ccad7
--- /dev/null
+++ b/dist/dts/EventJournal.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventJournal.d.ts","sourceRoot":"","sources":["../../src/EventJournal.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/EventLog.d.ts b/dist/dts/EventLog.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..06fd29b6db6395d539aae8d66fda11d3fd4523f5
--- /dev/null
+++ b/dist/dts/EventLog.d.ts
@@ -0,0 +1,206 @@
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import { type Pipeable } from "effect/Pipeable";
+import type * as Record from "effect/Record";
+import type * as Redacted from "effect/Redacted";
+import type { Scope } from "effect/Scope";
+import type { Covariant } from "effect/Types";
+import type { Event } from "./Event.js";
+import type { EventGroup } from "./EventGroup.js";
+import type { EventJournalError } from "./EventJournal.js";
+import { Entry, EventJournal } from "./EventJournal.js";
+import { type EventLogRemote } from "./EventLogRemote.js";
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export declare const SchemaTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export type SchemaTypeId = typeof SchemaTypeId;
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export declare const isEventLogSchema: (u: unknown) => u is EventLogSchema<any>;
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export interface EventLogSchema<Groups extends EventGroup.Any> {
+    new (_: never): {};
+    readonly [SchemaTypeId]: SchemaTypeId;
+    readonly groups: ReadonlyArray<Groups>;
+}
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export declare const schema: <Groups extends ReadonlyArray<EventGroup.Any>>(...groups: Groups) => EventLogSchema<Groups[number]>;
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export declare const HandlersTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export type HandlersTypeId = typeof HandlersTypeId;
+/**
+ * Represents a handled `EventGroup`.
+ *
+ * @since 1.0.0
+ * @category handlers
+ */
+export interface Handlers<R, Events extends Event.Any = never> extends Pipeable {
+    readonly [HandlersTypeId]: {
+        _Endpoints: Covariant<Events>;
+    };
+    readonly group: EventGroup.AnyWithProps;
+    readonly handlers: Record.ReadonlyRecord<string, Handlers.Item<R>>;
+    readonly context: Context.Context<any>;
+    /**
+     * Add the implementation for an `Event` to a `Handlers` group.
+     */
+    handle<Tag extends Events["tag"], R1>(name: Tag, handler: (options: {
+        readonly payload: Event.PayloadWithTag<Events, Tag>;
+        readonly entry: Entry;
+        readonly conflicts: Array<{
+            readonly entry: Entry;
+            readonly payload: Event.PayloadWithTag<Events, Tag>;
+        }>;
+    }) => Effect.Effect<Event.SuccessWithTag<Events, Tag>, Event.ErrorWithTag<Events, Tag>, R1>): Handlers<R | R1, Event.ExcludeTag<Events, Tag>>;
+}
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export declare namespace Handlers {
+    /**
+     * @since 1.0.0
+     * @category handlers
+     */
+    interface Any {
+        readonly [HandlersTypeId]: any;
+    }
+    /**
+     * @since 1.0.0
+     * @category handlers
+     */
+    type Item<R> = {
+        readonly event: Event.AnyWithProps;
+        readonly context: Context.Context<any>;
+        readonly handler: (options: {
+            readonly payload: any;
+            readonly entry: Entry;
+            readonly conflicts: Array<{
+                readonly entry: Entry;
+                readonly payload: any;
+            }>;
+        }) => Effect.Effect<any, R>;
+    };
+    /**
+     * @since 1.0.0
+     * @category handlers
+     */
+    type ValidateReturn<A> = A extends (Handlers<infer _R, infer _Events> | Effect.Effect<Handlers<infer _R, infer _Events>, infer _EX, infer _RX>) ? [_Events] extends [never] ? A : `Event not handled: ${Event.Tag<_Events>}` : `Must return the implemented handlers`;
+    /**
+     * @since 1.0.0
+     * @category handlers
+     */
+    type Error<A> = A extends Effect.Effect<Handlers<infer _R, infer _Events>, infer _EX, infer _RX> ? _EX : never;
+    /**
+     * @since 1.0.0
+     * @category handlers
+     */
+    type Context<A> = A extends Handlers<infer _R, infer _Events> ? _R | Event.Context<_Events> : A extends Effect.Effect<Handlers<infer _R, infer _Events>, infer _EX, infer _RX> ? _R | _RX | Event.Context<_Events> : never;
+}
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export declare const group: <Events extends Event.Any, Return>(group: EventGroup<Events>, f: (handlers: Handlers<never, Events>) => Handlers.ValidateReturn<Return>) => Layer.Layer<Event.ToService<Events>, Handlers.Error<Return>, Exclude<Handlers.Context<Return>, Scope>>;
+/**
+ * @since 1.0.0
+ * @category compaction
+ */
+export declare const groupCompaction: <Events extends Event.Any, R>(group: EventGroup<Events>, effect: (options: {
+    readonly primaryKey: string;
+    readonly entries: Array<Entry>;
+    readonly events: Array<Event.TaggedPayload<Events>>;
+    readonly write: <Tag extends Event.Tag<Events>>(tag: Tag, payload: Event.PayloadWithTag<Events, Tag>) => Effect.Effect<void>;
+}) => Effect.Effect<void, never, R>) => Layer.Layer<never, never, EventLog | R | Event.Context<Events>>;
+/**
+ * @since 1.0.0
+ * @category reactivity
+ */
+export declare const groupReactivity: <Events extends Event.Any>(group: EventGroup<Events>, keys: { readonly [Tag in Event.Tag<Events>]?: ReadonlyArray<string>; } | ReadonlyArray<string>) => Layer.Layer<never, never, EventLog>;
+declare const Registry_base: Context.TagClass<Registry, "@effect/experimental/EventLog/Registry", {
+    readonly add: (handlers: Handlers.Any) => Effect.Effect<void>;
+    readonly handlers: Effect.Effect<Record.ReadonlyRecord<string, Handlers.Item<any>>>;
+}>;
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare class Registry extends Registry_base {
+    /**
+     * @since 1.0.0
+     */
+    static layer: Layer.Layer<Registry, never, never>;
+}
+declare const Identity_base: Context.TagClass<Identity, "@effect/experimental/EventLog/Identity", {
+    readonly publicKey: string;
+    readonly privateKey: Redacted.Redacted<Uint8Array>;
+}>;
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export declare class Identity extends Identity_base {
+}
+declare const EventLog_base: Context.TagClass<EventLog, "@effect/experimental/EventLog/EventLog", {
+    readonly write: <Groups extends EventGroup.Any, Tag extends Event.Tag<EventGroup.Events<Groups>>>(options: {
+        readonly schema: EventLogSchema<Groups>;
+        readonly event: Tag;
+        readonly payload: Event.PayloadWithTag<EventGroup.Events<Groups>, Tag>;
+    }) => Effect.Effect<Event.SuccessWithTag<EventGroup.Events<Groups>, Tag>, Event.ErrorWithTag<EventGroup.Events<Groups>, Tag> | EventJournalError>;
+    readonly registerRemote: (remote: EventLogRemote) => Effect.Effect<void, never, Scope>;
+    readonly registerCompaction: (options: {
+        readonly events: ReadonlyArray<string>;
+        readonly effect: (options: {
+            readonly entries: ReadonlyArray<Entry>;
+            readonly write: (entry: Entry) => Effect.Effect<void>;
+        }) => Effect.Effect<void>;
+    }) => Effect.Effect<void, never, Scope>;
+    readonly registerReactivity: (keys: Record<string, ReadonlyArray<string>>) => Effect.Effect<void, never, Scope>;
+    readonly entries: Effect.Effect<ReadonlyArray<Entry>, EventJournalError>;
+    readonly destroy: Effect.Effect<void, EventJournalError>;
+}>;
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export declare class EventLog extends EventLog_base {
+}
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layerEventLog: Layer.Layer<EventLog, never, EventJournal | Identity>;
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layer: <Groups extends EventGroup.Any>(_schema: EventLogSchema<Groups>) => Layer.Layer<EventLog, never, EventGroup.ToService<Groups> | EventJournal | Identity>;
+/**
+ * @since 1.0.0
+ * @category client
+ */
+export declare const makeClient: <Groups extends EventGroup.Any>(schema: EventLogSchema<Groups>) => Effect.Effect<(<Tag extends Event.Tag<EventGroup.Events<Groups>>>(event: Tag, payload: Event.PayloadWithTag<EventGroup.Events<Groups>, Tag>) => Effect.Effect<Event.SuccessWithTag<EventGroup.Events<Groups>, Tag>, Event.ErrorWithTag<EventGroup.Events<Groups>, Tag> | EventJournalError>), never, EventLog>;
+export {};
+//# sourceMappingURL=EventLog.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLog.d.ts.map b/dist/dts/EventLog.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..29a2c2e67348a202282a40f3029aaa1f40423414
--- /dev/null
+++ b/dist/dts/EventLog.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLog.d.ts","sourceRoot":"","sources":["../../src/EventLog.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/EventLogEncryption.d.ts b/dist/dts/EventLogEncryption.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..b17345bbe528a815837031246cf85fbe8b7a9d22
--- /dev/null
+++ b/dist/dts/EventLogEncryption.d.ts
@@ -0,0 +1,60 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as Schema from "effect/Schema";
+import { Entry, RemoteEntry } from "./EventJournal.js";
+import type { Identity } from "./EventLog.js";
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare const EncryptedEntry: Schema.Struct<{
+    entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+    encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+}>;
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EncryptedRemoteEntry extends Schema.Schema.Type<typeof EncryptedRemoteEntry> {
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare const EncryptedRemoteEntry: Schema.Struct<{
+    sequence: typeof Schema.Number;
+    iv: typeof Schema.Uint8ArrayFromSelf;
+    entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+    encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+}>;
+declare const EventLogEncryption_base: Context.TagClass<EventLogEncryption, "@effect/experimental/EventLogEncryption", {
+    readonly encrypt: (identity: typeof Identity.Service, entries: ReadonlyArray<Entry>) => Effect.Effect<{
+        readonly iv: Uint8Array;
+        readonly encryptedEntries: ReadonlyArray<Uint8Array>;
+    }>;
+    readonly decrypt: (identity: typeof Identity.Service, entries: ReadonlyArray<EncryptedRemoteEntry>) => Effect.Effect<Array<RemoteEntry>>;
+    readonly sha256String: (data: Uint8Array) => Effect.Effect<string>;
+    readonly sha256: (data: Uint8Array) => Effect.Effect<Uint8Array>;
+}>;
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export declare class EventLogEncryption extends EventLogEncryption_base {
+}
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export declare const makeEncryptionSubtle: (crypto: Crypto) => Effect.Effect<typeof EventLogEncryption.Service>;
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export declare const layerSubtle: Layer.Layer<EventLogEncryption>;
+export {};
+//# sourceMappingURL=EventLogEncryption.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLogEncryption.d.ts.map b/dist/dts/EventLogEncryption.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..634753e988b65956011acb4d649515a28b7c24a0
--- /dev/null
+++ b/dist/dts/EventLogEncryption.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogEncryption.d.ts","sourceRoot":"","sources":["../../src/EventLogEncryption.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AAErC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,EAAE,KAAK,EAAW,WAAW,EAAE,MAAM,mBAAmB,CAAA;AAC/D,OAAO,KAAK,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAA;AAE7C;;;GAGG;AACH,eAAO,MAAM,cAAc;;;EAGzB,CAAA;AAEF;;;GAGG;AACH,MAAM,WAAW,oBAAqB,SAAQ,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,oBAAoB,CAAC;CAAG;AAEhG;;;GAGG;AACH,eAAO,MAAM,oBAAoB;;;;;EAK/B,CAAA;;sBASoB,CAChB,QAAQ,EAAE,OAAO,QAAQ,CAAC,OAAO,EACjC,OAAO,EAAE,aAAa,CAAC,KAAK,CAAC,KAC1B,MAAM,CAAC,MAAM,CAAC;QACjB,QAAQ,CAAC,EAAE,EAAE,UAAU,CAAA;QACvB,QAAQ,CAAC,gBAAgB,EAAE,aAAa,CAAC,UAAU,CAAC,CAAA;KACrD,CAAC;sBACgB,CAChB,QAAQ,EAAE,OAAO,QAAQ,CAAC,OAAO,EACjC,OAAO,EAAE,aAAa,CAAC,oBAAoB,CAAC,KACzC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;2BACf,CAAC,IAAI,EAAE,UAAU,KAAK,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC;qBACjD,CAAC,IAAI,EAAE,UAAU,KAAK,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC;;AAnBpE;;;GAGG;AACH,qBAAa,kBAAmB,SAAQ,uBAiBrC;CAAG;AAEN;;;GAGG;AACH,eAAO,MAAM,oBAAoB,WAAY,MAAM,KAAG,MAAM,CAAC,MAAM,CAAC,OAAO,kBAAkB,CAAC,OAAO,CAsEjG,CAAA;AAEJ;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,KAAK,CAAC,KAAK,CAAC,kBAAkB,CAEvD,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/EventLogRemote/Node.d.ts b/dist/dts/EventLogRemote/Node.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..69bb5aa0378616c2f70fdae8269c0171a17959b4
--- /dev/null
+++ b/dist/dts/EventLogRemote/Node.d.ts
@@ -0,0 +1,8 @@
+import * as Layer from "effect/Layer";
+import type { EventLog } from "../EventLog.js";
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layerWebSocket: (url: string) => Layer.Layer<never, never, EventLog>;
+//# sourceMappingURL=Node.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLogRemote/Node.d.ts.map b/dist/dts/EventLogRemote/Node.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..274f019bae1d58a7cb26afadeb9fca8cd7982432
--- /dev/null
+++ b/dist/dts/EventLogRemote/Node.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"Node.d.ts","sourceRoot":"","sources":["../../../src/EventLogRemote/Node.ts"],"names":[],"mappings":"AAIA,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAA;AAI9C;;;GAGG;AACH,eAAO,MAAM,cAAc,QACpB,MAAM,KACV,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,CAGlC,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/EventLogRemote.d.ts b/dist/dts/EventLogRemote.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..0b44a89f0756c7929ba986a2cdc8897ac60d62b1
--- /dev/null
+++ b/dist/dts/EventLogRemote.d.ts
@@ -0,0 +1,232 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Socket from "@effect/platform/Socket";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import * as Schema from "effect/Schema";
+import * as Scope from "effect/Scope";
+import type { Entry } from "./EventJournal.js";
+import { RemoteEntry, RemoteId } from "./EventJournal.js";
+import type { Identity } from "./EventLog.js";
+import { EventLog } from "./EventLog.js";
+import { EventLogEncryption } from "./EventLogEncryption.js";
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventLogRemote {
+    readonly id: RemoteId;
+    readonly changes: (identity: typeof Identity.Service, startSequence: number) => Effect.Effect<Mailbox.ReadonlyMailbox<RemoteEntry>, never, Scope.Scope>;
+    readonly write: (identity: typeof Identity.Service, entries: ReadonlyArray<Entry>) => Effect.Effect<void>;
+}
+declare const Hello_base: Schema.TaggedClass<Hello, "Hello", {
+    readonly _tag: Schema.tag<"Hello">;
+} & {
+    remoteId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").RemoteIdTypeId>;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class Hello extends Hello_base {
+}
+declare const ChunkedMessage_base: Schema.TaggedClass<ChunkedMessage, "ChunkedMessage", {
+    readonly _tag: Schema.tag<"ChunkedMessage">;
+} & {
+    id: typeof Schema.Number;
+    part: Schema.Tuple2<typeof Schema.Number, typeof Schema.Number>;
+    data: typeof Schema.Uint8ArrayFromSelf;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class ChunkedMessage extends ChunkedMessage_base {
+    /**
+     * @since 1.0.0
+     */
+    static split(id: number, data: Uint8Array): ReadonlyArray<ChunkedMessage>;
+    /**
+     * @since 1.0.0
+     */
+    static join(map: Map<number, {
+        readonly parts: Array<Uint8Array>;
+        count: number;
+        bytes: number;
+    }>, part: ChunkedMessage): Uint8Array | undefined;
+}
+declare const WriteEntries_base: Schema.TaggedClass<WriteEntries, "WriteEntries", {
+    readonly _tag: Schema.tag<"WriteEntries">;
+} & {
+    publicKey: typeof Schema.String;
+    id: typeof Schema.Number;
+    iv: typeof Schema.Uint8ArrayFromSelf;
+    encryptedEntries: Schema.Array$<Schema.Struct<{
+        entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+        encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+    }>>;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class WriteEntries extends WriteEntries_base {
+}
+declare const Ack_base: Schema.TaggedClass<Ack, "Ack", {
+    readonly _tag: Schema.tag<"Ack">;
+} & {
+    id: typeof Schema.Number;
+    sequenceNumbers: Schema.Array$<typeof Schema.Number>;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class Ack extends Ack_base {
+}
+declare const RequestChanges_base: Schema.TaggedClass<RequestChanges, "RequestChanges", {
+    readonly _tag: Schema.tag<"RequestChanges">;
+} & {
+    publicKey: typeof Schema.String;
+    startSequence: typeof Schema.Number;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class RequestChanges extends RequestChanges_base {
+}
+declare const Changes_base: Schema.TaggedClass<Changes, "Changes", {
+    readonly _tag: Schema.tag<"Changes">;
+} & {
+    publicKey: typeof Schema.String;
+    entries: Schema.Array$<Schema.Struct<{
+        sequence: typeof Schema.Number;
+        iv: typeof Schema.Uint8ArrayFromSelf;
+        entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+        encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+    }>>;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class Changes extends Changes_base {
+}
+declare const StopChanges_base: Schema.TaggedClass<StopChanges, "StopChanges", {
+    readonly _tag: Schema.tag<"StopChanges">;
+} & {
+    publicKey: typeof Schema.String;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class StopChanges extends StopChanges_base {
+}
+declare const Ping_base: Schema.TaggedClass<Ping, "Ping", {
+    readonly _tag: Schema.tag<"Ping">;
+} & {
+    id: typeof Schema.Number;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class Ping extends Ping_base {
+}
+declare const Pong_base: Schema.TaggedClass<Pong, "Pong", {
+    readonly _tag: Schema.tag<"Pong">;
+} & {
+    id: typeof Schema.Number;
+}>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare class Pong extends Pong_base {
+}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const ProtocolRequest: Schema.Union<[typeof WriteEntries, typeof RequestChanges, typeof StopChanges, typeof ChunkedMessage, typeof Ping]>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const ProtocolRequestMsgPack: MsgPack.schema<Schema.Union<[typeof WriteEntries, typeof RequestChanges, typeof StopChanges, typeof ChunkedMessage, typeof Ping]>>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const decodeRequest: (i: Uint8Array<ArrayBufferLike>, overrideOptions?: import("effect/SchemaAST").ParseOptions) => ChunkedMessage | WriteEntries | RequestChanges | StopChanges | Ping;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const encodeRequest: (a: ChunkedMessage | WriteEntries | RequestChanges | StopChanges | Ping, overrideOptions?: import("effect/SchemaAST").ParseOptions) => Uint8Array<ArrayBufferLike>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const ProtocolResponse: Schema.Union<[typeof Hello, typeof Ack, typeof Changes, typeof ChunkedMessage, typeof Pong]>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const ProtocolResponseMsgPack: MsgPack.schema<Schema.Union<[typeof Hello, typeof Ack, typeof Changes, typeof ChunkedMessage, typeof Pong]>>;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const decodeResponse: (i: Uint8Array<ArrayBufferLike>, overrideOptions?: import("effect/SchemaAST").ParseOptions) => Hello | ChunkedMessage | Ack | Changes | Pong;
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export declare const encodeResponse: (a: Hello | ChunkedMessage | Ack | Changes | Pong, overrideOptions?: import("effect/SchemaAST").ParseOptions) => Uint8Array<ArrayBufferLike>;
+declare const RemoteAdditions_base: Schema.TaggedClass<RemoteAdditions, "RemoveAdditions", {
+    readonly _tag: Schema.tag<"RemoveAdditions">;
+} & {
+    entries: Schema.Array$<typeof RemoteEntry>;
+}>;
+/**
+ * @since 1.0.0
+ * @category change
+ */
+export declare class RemoteAdditions extends RemoteAdditions_base {
+}
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export declare const fromSocket: (options?: {
+    readonly disablePing?: boolean;
+}) => Effect.Effect<void, never, Scope.Scope | EventLog | EventLogEncryption | Socket.Socket>;
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export declare const fromWebSocket: (url: string, options?: {
+    readonly disablePing?: boolean;
+}) => Effect.Effect<void, never, Scope.Scope | EventLogEncryption | EventLog | Socket.WebSocketConstructor>;
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layerWebSocket: (url: string, options?: {
+    readonly disablePing?: boolean;
+}) => Layer.Layer<never, never, Socket.WebSocketConstructor | EventLog | EventLogEncryption>;
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layerWebSocketBrowser: (url: string, options?: {
+    readonly disablePing?: boolean;
+}) => Layer.Layer<never, never, EventLog>;
+export {};
+//# sourceMappingURL=EventLogRemote.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLogRemote.d.ts.map b/dist/dts/EventLogRemote.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..fa76c392c5f12a3415d36223fbb9836d2068ffe1
--- /dev/null
+++ b/dist/dts/EventLogRemote.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogRemote.d.ts","sourceRoot":"","sources":["../../src/EventLogRemote.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,0BAA0B,CAAA;AACnD,OAAO,KAAK,MAAM,MAAM,yBAAyB,CAAA;AAEjD,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAEvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AAGzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,EAAE,KAAK,EAAE,MAAM,mBAAmB,CAAA;AAC9C,OAAO,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAA;AACzD,OAAO,KAAK,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAA;AAC7C,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAA;AACxC,OAAO,EAAwC,kBAAkB,EAAe,MAAM,yBAAyB,CAAA;AAE/G;;;GAGG;AACH,MAAM,WAAW,cAAc;IAC7B,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAA;IACrB,QAAQ,CAAC,OAAO,EAAE,CAChB,QAAQ,EAAE,OAAO,QAAQ,CAAC,OAAO,EACjC,aAAa,EAAE,MAAM,KAClB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,WAAW,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAA;IAC5E,QAAQ,CAAC,KAAK,EAAE,CAAC,QAAQ,EAAE,OAAO,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,aAAa,CAAC,KAAK,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;CAC1G;;;;;;AAED;;;GAGG;AACH,qBAAa,KAAM,SAAQ,UAEzB;CAAG;;;;;;;;AAEL;;;GAGG;AACH,qBAAa,cACX,SAAQ,mBAIN;IAEF;;OAEG;IACH,MAAM,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,UAAU,GAAG,aAAa,CAAC,cAAc,CAAC;IAWzE;;OAEG;IACH,MAAM,CAAC,IAAI,CACT,GAAG,EAAE,GAAG,CAAC,MAAM,EAAE;QACf,QAAQ,CAAC,KAAK,EAAE,KAAK,CAAC,UAAU,CAAC,CAAA;QACjC,KAAK,EAAE,MAAM,CAAA;QACb,KAAK,EAAE,MAAM,CAAA;KACd,CAAC,EACF,IAAI,EAAE,cAAc,GACnB,UAAU,GAAG,SAAS;CA0B1B;;;;;;;;;;;;AAED;;;GAGG;AACH,qBAAa,YACX,SAAQ,iBAKN;CACF;;;;;;;AAEF;;;GAGG;AACH,qBAAa,GAAI,SAAQ,QAGvB;CAAG;;;;;;;AAEL;;;GAGG;AACH,qBAAa,cACX,SAAQ,mBAGN;CACF;;;;;;;;;;;;AAEF;;;GAGG;AACH,qBAAa,OAAQ,SAAQ,YAG3B;CAAG;;;;;;AAEL;;;GAGG;AACH,qBAAa,WACX,SAAQ,gBAEN;CACF;;;;;;AAEF;;;GAGG;AACH,qBAAa,IAAK,SAAQ,SAExB;CAAG;;;;;;AAEL;;;GAGG;AACH,qBAAa,IAAK,SAAQ,SAExB;CAAG;AAEL;;;GAGG;AACH,eAAO,MAAM,eAAe,oHAM3B,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,sBAAsB,oIAAkC,CAAA;AAErE;;;GAGG;AACH,eAAO,MAAM,aAAa,oKAA4C,CAAA;AAEtE;;;GAGG;AACH,eAAO,MAAM,aAAa,oKAA4C,CAAA;AAEtE;;;GAGG;AACH,eAAO,MAAM,gBAAgB,8FAM5B,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,uBAAuB,8GAAmC,CAAA;AAEvE;;;GAGG;AACH,eAAO,MAAM,cAAc,8IAA6C,CAAA;AAExE;;;GAGG;AACH,eAAO,MAAM,cAAc,8IAA6C,CAAA;;;;;;AAExE;;;GAGG;AACH,qBAAa,eACX,SAAQ,oBAGP;CACD;AAIF;;;GAGG;AACH,eAAO,MAAM,UAAU,aAAc;IACnC,QAAQ,CAAC,WAAW,CAAC,EAAE,OAAO,CAAA;CAC/B,KAAG,MAAM,CAAC,MAAM,CACf,IAAI,EACJ,KAAK,EACL,KAAK,CAAC,KAAK,GAAG,QAAQ,GAAG,kBAAkB,GAAG,MAAM,CAAC,MAAM,CAuKzD,CAAA;AAEJ;;;GAGG;AACH,eAAO,MAAM,aAAa,QACnB,MAAM,YACD;IACR,QAAQ,CAAC,WAAW,CAAC,EAAE,OAAO,CAAA;CAC/B,KACA,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,GAAG,kBAAkB,GAAG,QAAQ,GAAG,MAAM,CAAC,oBAAoB,CAMnG,CAAA;AAEJ;;;GAGG;AACH,eAAO,MAAM,cAAc,QACpB,MAAM,YACD;IACR,QAAQ,CAAC,WAAW,CAAC,EAAE,OAAO,CAAA;CAC/B,KACA,KAAK,CAAC,KAAK,CACZ,KAAK,EACL,KAAK,EACH,MAAM,CAAC,oBAAoB,GAC3B,QAAQ,GACR,kBAAkB,CAC+B,CAAA;AAErD;;;GAGG;AACH,eAAO,MAAM,qBAAqB,QAC3B,MAAM,YACD;IACR,QAAQ,CAAC,WAAW,CAAC,EAAE,OAAO,CAAA;CAC/B,KACA,KAAK,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,CAGlC,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/EventLogServer/Cloudflare.d.ts b/dist/dts/EventLogServer/Cloudflare.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e6a00c7e244935668a1be546699edeed2b7f3b3b
--- /dev/null
+++ b/dist/dts/EventLogServer/Cloudflare.d.ts
@@ -0,0 +1,48 @@
+/**
+ * @since 1.0.0
+ */
+import { DurableObject } from "cloudflare:workers";
+import type * as Layer from "effect/Layer";
+import * as ManagedRuntime from "effect/ManagedRuntime";
+import * as EventLogServer from "../EventLogServer.js";
+/**
+ * @since 1.0.0
+ * @category DurableObject
+ */
+export declare abstract class EventLogDurableObject extends DurableObject {
+    /**
+     * @since 1.0.0
+     */
+    readonly runtime: ManagedRuntime.ManagedRuntime<EventLogServer.Storage, never>;
+    constructor(options: {
+        readonly ctx: DurableObjectState;
+        readonly env: unknown;
+        readonly storageLayer: Layer.Layer<EventLogServer.Storage>;
+    });
+    /**
+     * @since 1.0.0
+     */
+    webSocketMessage(ws: WebSocket, message: string | ArrayBuffer): Promise<void>;
+    private chunks;
+    /**
+     * @since 1.0.0
+     */
+    private handleRequest;
+    /**
+     * @since 1.0.0
+     */
+    private encodeChanges;
+    /**
+     * @since 1.0.0
+     */
+    webSocketError(_ws: WebSocket, error: Error): void;
+    /**
+     * @since 1.0.0
+     */
+    webSocketClose(_ws: WebSocket, code: number, reason: string): void;
+    /**
+     * @since 1.0.0
+     */
+    fetch(): Promise<Response>;
+}
+//# sourceMappingURL=Cloudflare.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLogServer/Cloudflare.d.ts.map b/dist/dts/EventLogServer/Cloudflare.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..8634d6d360b99cb90fb8ad5363eac279964db93d
--- /dev/null
+++ b/dist/dts/EventLogServer/Cloudflare.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"Cloudflare.d.ts","sourceRoot":"","sources":["../../../src/EventLogServer/Cloudflare.ts"],"names":[],"mappings":"AAAA;;GAEG;AAEH,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAA;AAGlD,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAC1C,OAAO,KAAK,cAAc,MAAM,uBAAuB,CAAA;AAIvD,OAAO,KAAK,cAAc,MAAM,sBAAsB,CAAA;AAEtD;;;GAGG;AACH,8BAAsB,qBAAsB,SAAQ,aAAa;IAC/D;;OAEG;IACH,QAAQ,CAAC,OAAO,EAAE,cAAc,CAAC,cAAc,CAAC,cAAc,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;gBAElE,OAAO,EAAE;QACnB,QAAQ,CAAC,GAAG,EAAE,kBAAkB,CAAA;QAChC,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAA;QACrB,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,CAAA;KAC3D;IAMD;;OAEG;IACH,gBAAgB,CAAC,EAAE,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,GAAG,WAAW;IAW7D,OAAO,CAAC,MAAM,CAOX;IACH;;OAEG;YACW,aAAa;IA8D3B;;OAEG;IACH,OAAO,CAAC,aAAa;IAqBrB;;OAEG;IACH,cAAc,CAAC,GAAG,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,GAAG,IAAI;IAIlD;;OAEG;IACH,cAAc,CAAC,GAAG,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,GAAG,IAAI;IAIlE;;OAEG;IACG,KAAK,IAAI,OAAO,CAAC,QAAQ,CAAC;CAyBjC"}
\ No newline at end of file
diff --git a/dist/dts/EventLogServer.d.ts b/dist/dts/EventLogServer.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2b401f938e446934e56d1fbed1a5661300c091a9
--- /dev/null
+++ b/dist/dts/EventLogServer.d.ts
@@ -0,0 +1,83 @@
+/**
+ * @since 1.0.0
+ */
+import type * as HttpServerError from "@effect/platform/HttpServerError";
+import * as HttpServerRequest from "@effect/platform/HttpServerRequest";
+import * as HttpServerResponse from "@effect/platform/HttpServerResponse";
+import * as MsgPack from "@effect/platform/MsgPack";
+import type * as Socket from "@effect/platform/Socket";
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import * as Schema from "effect/Schema";
+import type * as Scope from "effect/Scope";
+import type { RemoteId } from "./EventJournal.js";
+import { EncryptedRemoteEntry } from "./EventLogEncryption.js";
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare const makeHandler: Effect.Effect<(socket: Socket.Socket) => Effect.Effect<void, Socket.SocketError, Scope.Scope>, never, Storage>;
+/**
+ * @since 1.0.0
+ * @category websockets
+ */
+export declare const makeHandlerHttp: Effect.Effect<Effect.Effect<HttpServerResponse.HttpServerResponse, HttpServerError.RequestError | Socket.SocketError, HttpServerRequest.HttpServerRequest | Scope.Scope>, never, Storage>;
+declare const PersistedEntry_base: Schema.Class<PersistedEntry, {
+    entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+    iv: typeof Schema.Uint8ArrayFromSelf;
+    encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+}, Schema.Struct.Encoded<{
+    entryId: Schema.brand<typeof Schema.Uint8ArrayFromSelf, typeof import("./EventJournal.js").EntryIdTypeId>;
+    iv: typeof Schema.Uint8ArrayFromSelf;
+    encryptedEntry: typeof Schema.Uint8ArrayFromSelf;
+}>, never, {
+    readonly entryId: Uint8Array<ArrayBufferLike> & import("effect/Brand").Brand<typeof import("./EventJournal.js").EntryIdTypeId>;
+} & {
+    readonly encryptedEntry: Uint8Array<ArrayBufferLike>;
+} & {
+    readonly iv: Uint8Array<ArrayBufferLike>;
+}, {}, {}>;
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export declare class PersistedEntry extends PersistedEntry_base {
+    /**
+     * @since 1.0.0
+     */
+    static fromMsgPack: MsgPack.schema<typeof PersistedEntry>;
+    /**
+     * @since 1.0.0
+     */
+    static encode: (a: PersistedEntry, overrideOptions?: import("effect/SchemaAST").ParseOptions) => Uint8Array<ArrayBufferLike>;
+    /**
+     * @since 1.0.0
+     */
+    get entryIdString(): string;
+}
+declare const Storage_base: Context.TagClass<Storage, "@effect/experimental/EventLogServer/Storage", {
+    readonly getId: Effect.Effect<RemoteId>;
+    readonly write: (publicKey: string, entries: ReadonlyArray<PersistedEntry>) => Effect.Effect<ReadonlyArray<EncryptedRemoteEntry>>;
+    readonly entries: (publicKey: string, startSequence: number) => Effect.Effect<ReadonlyArray<EncryptedRemoteEntry>>;
+    readonly changes: (publicKey: string, startSequence: number) => Effect.Effect<Mailbox.ReadonlyMailbox<EncryptedRemoteEntry>, never, Scope.Scope>;
+}>;
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export declare class Storage extends Storage_base {
+}
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export declare const makeStorageMemory: Effect.Effect<typeof Storage.Service, never, Scope.Scope>;
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export declare const layerStorageMemory: Layer.Layer<Storage>;
+export {};
+//# sourceMappingURL=EventLogServer.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/EventLogServer.d.ts.map b/dist/dts/EventLogServer.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..b143ca3325e2e06831c3b000f7fad15996774e99
--- /dev/null
+++ b/dist/dts/EventLogServer.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogServer.d.ts","sourceRoot":"","sources":["../../src/EventLogServer.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,KAAK,eAAe,MAAM,kCAAkC,CAAA;AACxE,OAAO,KAAK,iBAAiB,MAAM,oCAAoC,CAAA;AACvE,OAAO,KAAK,kBAAkB,MAAM,qCAAqC,CAAA;AACzE,OAAO,KAAK,OAAO,MAAM,0BAA0B,CAAA;AACnD,OAAO,KAAK,KAAK,MAAM,MAAM,yBAAyB,CAAA;AAEtD,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAEvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AAGzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAA;AAEjD,OAAO,EAAE,oBAAoB,EAAE,MAAM,yBAAyB,CAAA;AAM9D;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,MAAM,CAAC,MAAM,CACrC,CAAC,MAAM,EAAE,MAAM,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,WAAW,EAAE,KAAK,CAAC,KAAK,CAAC,EAC/E,KAAK,EACL,OAAO,CA0GP,CAAA;AAEF;;;GAGG;AACH,eAAO,MAAM,eAAe,EAAE,MAAM,CAAC,MAAM,CACzC,MAAM,CAAC,MAAM,CACX,kBAAkB,CAAC,kBAAkB,EACrC,eAAe,CAAC,YAAY,GAAG,MAAM,CAAC,WAAW,EACjD,iBAAiB,CAAC,iBAAiB,GAAG,KAAK,CAAC,KAAK,CAClD,EACD,KAAK,EACL,OAAO,CAYP,CAAA;;;;;;;;;;;;;;;;AAEF;;;GAGG;AACH,qBAAa,cAAe,SAAQ,mBAIlC;IACA;;OAEG;IACH,MAAM,CAAC,WAAW,wCAAiC;IAEnD;;OAEG;IACH,MAAM,CAAC,MAAM,gHAAsC;IAEnD;;OAEG;IACH,IAAI,aAAa,IAAI,MAAM,CAE1B;CACF;;oBASmB,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;oBACvB,CACd,SAAS,EAAE,MAAM,EACjB,OAAO,EAAE,aAAa,CAAC,cAAc,CAAC,KACnC,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;sBACrC,CAChB,SAAS,EAAE,MAAM,EACjB,aAAa,EAAE,MAAM,KAClB,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;sBACrC,CAChB,SAAS,EAAE,MAAM,EACjB,aAAa,EAAE,MAAM,KAClB,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,oBAAoB,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC;;AAnBzF;;;GAGG;AACH,qBAAa,OAAQ,SAAQ,YAiB1B;CAAG;AAEN;;;GAGG;AACH,eAAO,MAAM,iBAAiB,EAAE,MAAM,CAAC,MAAM,CAAC,OAAO,OAAO,CAAC,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,CA4DtF,CAAA;AAEF;;;GAGG;AACH,eAAO,MAAM,kBAAkB,EAAE,KAAK,CAAC,KAAK,CAAC,OAAO,CAA4C,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/Machine/Procedure.d.ts b/dist/dts/Machine/Procedure.d.ts
index 6a9c519d5876a648b22e2252e44d85b4337a25da..331a0d23b159c1eaf33c7dd7410bb04c4c6290db 100644
--- a/dist/dts/Machine/Procedure.d.ts
+++ b/dist/dts/Machine/Procedure.d.ts
@@ -1,12 +1,11 @@
 /**
  * @since 1.0.0
  */
-import type * as Schema from "@effect/schema/Schema";
-import type * as Serializable from "@effect/schema/Serializable";
 import type * as Deferred from "effect/Deferred";
 import type * as Effect from "effect/Effect";
 import { type Pipeable } from "effect/Pipeable";
 import type { Request } from "effect/Request";
+import type * as Schema from "effect/Schema";
 /**
  * @since 1.0.0
  * @category type ids
@@ -155,5 +154,5 @@ export declare const make: <Requests extends TaggedRequest.Any, State>() => <Req
  */
 export declare const makeSerializable: <Requests extends TaggedRequest.Any, State>() => <Req extends Schema.TaggedRequest.All, IS, R, RS>(schema: Schema.Schema<Req, IS, RS> & {
     readonly _tag: Req["_tag"];
-}, handler: Handler<Req, State, Requests, R>) => SerializableProcedure<Req, State, R | Serializable.SerializableWithResult.Context<Req>>;
+}, handler: Handler<Req, State, Requests, R>) => SerializableProcedure<Req, State, R | Schema.SerializableWithResult.Context<Req>>;
 //# sourceMappingURL=Procedure.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Machine/Procedure.d.ts.map b/dist/dts/Machine/Procedure.d.ts.map
index 6875b97cff84ecd198a9d237506cedfafa60accc..32f8fdaa277d18fa2b5633261bc0ac788e85d136 100644
--- a/dist/dts/Machine/Procedure.d.ts.map
+++ b/dist/dts/Machine/Procedure.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Procedure.d.ts","sourceRoot":"","sources":["../../../src/Machine/Procedure.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"Procedure.d.ts","sourceRoot":"","sources":["../../../src/Machine/Procedure.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/Machine/ProcedureList.d.ts b/dist/dts/Machine/ProcedureList.d.ts
index e462cf6926c306c405d46620d9788c38df282436..615e15c52487df3052bb047ae01f34d91879bde6 100644
--- a/dist/dts/Machine/ProcedureList.d.ts
+++ b/dist/dts/Machine/ProcedureList.d.ts
@@ -37,7 +37,15 @@ export declare const make: <State>(initialState: State, options?: {
  * @category combinators
  */
 export declare const addProcedure: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends Procedure.TaggedRequest.Any, State, R2>(procedure: Procedure.Procedure<Req, State, R2>): <Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(self: ProcedureList<State, Public, Private, R>) => ProcedureList<State, Req | Public, Private, R | R2>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R, Req extends Procedure.TaggedRequest.Any, R2>(self: ProcedureList<State, Public, Private, R>, procedure: Procedure.Procedure<Req, State, R2>): ProcedureList<State, Req | Public, Private, R | R2>;
 };
 /**
@@ -45,7 +53,15 @@ export declare const addProcedure: {
  * @category combinators
  */
 export declare const addProcedurePrivate: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends Procedure.TaggedRequest.Any, State, R2>(procedure: Procedure.Procedure<Req, State, R2>): <Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(self: ProcedureList<State, Public, Private, R>) => ProcedureList<State, Public, Private | Req, R | R2>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R, Req extends Procedure.TaggedRequest.Any, R2>(self: ProcedureList<State, Public, Private, R>, procedure: Procedure.Procedure<Req, State, R2>): ProcedureList<State, Public, Private | Req, R | R2>;
 };
 /**
@@ -69,7 +85,15 @@ export declare const addPrivate: <Req extends Procedure.TaggedRequest.Any>() =>
  * @category combinators
  */
 export declare const withInitialState: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State>(initialState: Types.NoInfer<State>): <Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(self: ProcedureList<State, Public, Private, R>) => ProcedureList<State, Public, Private, R>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(self: ProcedureList<State, Public, Private, R>, initialState: Types.NoInfer<State>): ProcedureList<State, Public, Private, R>;
 };
 //# sourceMappingURL=ProcedureList.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Machine/ProcedureList.d.ts.map b/dist/dts/Machine/ProcedureList.d.ts.map
index b2c46c3c26c460ff6cd3388d85a94d36f07380f5..d62a47dad64d287e4b6b795f4ddd8728177beb77 100644
--- a/dist/dts/Machine/ProcedureList.d.ts.map
+++ b/dist/dts/Machine/ProcedureList.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"ProcedureList.d.ts","sourceRoot":"","sources":["../../../src/Machine/ProcedureList.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"ProcedureList.d.ts","sourceRoot":"","sources":["../../../src/Machine/ProcedureList.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/Machine/SerializableProcedureList.d.ts b/dist/dts/Machine/SerializableProcedureList.d.ts
index 86e6157f106b9051ed1a8024dc7bf45357fa6940..377096845e81fef63f9ca4cb7f2915f6c1c5b9f1 100644
--- a/dist/dts/Machine/SerializableProcedureList.d.ts
+++ b/dist/dts/Machine/SerializableProcedureList.d.ts
@@ -1,9 +1,8 @@
 /**
  * @since 1.0.0
  */
-import type * as Schema from "@effect/schema/Schema";
-import type * as Serializable from "@effect/schema/Serializable";
 import type * as Effect from "effect/Effect";
+import type * as Schema from "effect/Schema";
 import type * as Types from "effect/Types";
 import * as Procedure from "./Procedure.js";
 import * as ProcedureList from "./ProcedureList.js";
@@ -30,31 +29,55 @@ export declare const make: <State>(initialState: State, options?: {
  * @category combinators
  */
 export declare const add: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends Schema.TaggedRequest.All, I, ReqR, State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R2>(schema: Schema.Schema<Req, I, ReqR> & {
         readonly _tag: Req["_tag"];
-    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): <R>(self: SerializableProcedureList<State, Public, Private, R>) => SerializableProcedureList<State, Req | Public, Private, R | R2 | Serializable.SerializableWithResult.Context<Req>>;
+    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): <R>(self: SerializableProcedureList<State, Public, Private, R>) => SerializableProcedureList<State, Req | Public, Private, R | R2 | Schema.SerializableWithResult.Context<Req>>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R, Req extends Schema.TaggedRequest.All, I, ReqR, R2>(self: SerializableProcedureList<State, Public, Private, R>, schema: Schema.Schema<Req, I, ReqR> & {
         readonly _tag: Req["_tag"];
-    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): SerializableProcedureList<State, Req | Public, Private, R | R2 | Serializable.SerializableWithResult.Context<Req>>;
+    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): SerializableProcedureList<State, Req | Public, Private, R | R2 | Schema.SerializableWithResult.Context<Req>>;
 };
 /**
  * @since 1.0.0
  * @category combinators
  */
 export declare const addPrivate: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends Schema.TaggedRequest.All, I, ReqR, State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R2>(schema: Schema.Schema<Req, I, ReqR> & {
         readonly _tag: Req["_tag"];
-    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): <R>(self: SerializableProcedureList<State, Public, Private, R>) => SerializableProcedureList<State, Public, Private | Req, R | R2 | Serializable.SerializableWithResult.Context<Req>>;
+    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): <R>(self: SerializableProcedureList<State, Public, Private, R>) => SerializableProcedureList<State, Public, Private | Req, R | R2 | Schema.SerializableWithResult.Context<Req>>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R, Req extends Schema.TaggedRequest.All, I, ReqR, R2>(self: SerializableProcedureList<State, Public, Private, R>, schema: Schema.Schema<Req, I, ReqR> & {
         readonly _tag: Req["_tag"];
-    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): SerializableProcedureList<State, Public, Private | Req, R | R2 | Serializable.SerializableWithResult.Context<Req>>;
+    }, handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>): SerializableProcedureList<State, Public, Private | Req, R | R2 | Schema.SerializableWithResult.Context<Req>>;
 };
 /**
  * @since 1.0.0
  * @category combinators
  */
 export declare const withInitialState: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State>(initialState: Types.NoInfer<State>): <Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R>(self: SerializableProcedureList<State, Public, Private, R>) => SerializableProcedureList<State, Public, Private, R>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R>(self: SerializableProcedureList<State, Public, Private, R>, initialState: Types.NoInfer<State>): SerializableProcedureList<State, Public, Private, R>;
 };
 //# sourceMappingURL=SerializableProcedureList.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Machine/SerializableProcedureList.d.ts.map b/dist/dts/Machine/SerializableProcedureList.d.ts.map
index a2d027c98ee53ffdc03be0b6ccc1992c37038794..4dd39cbef0d5f35129072a249f6bfaca22a2ff05 100644
--- a/dist/dts/Machine/SerializableProcedureList.d.ts.map
+++ b/dist/dts/Machine/SerializableProcedureList.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"SerializableProcedureList.d.ts","sourceRoot":"","sources":["../../../src/Machine/SerializableProcedureList.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,KAAK,MAAM,MAAM,uBAAuB,CAAA;AACpD,OAAO,KAAK,KAAK,YAAY,MAAM,6BAA6B,CAAA;AAChE,OAAO,KAAK,KAAK,MAAM,MAAM,eAAe,CAAA;AAE5C,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAC1C,OAAO,KAAK,SAAS,MAAM,gBAAgB,CAAA;AAC3C,OAAO,KAAK,aAAa,MAAM,oBAAoB,CAAA;AAEnD;;;GAGG;AACH,MAAM,WAAW,yBAAyB,CACxC,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,CAAC,CACD,SAAQ,MAAM,CAAC,MAAM,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;IAC3E,QAAQ,CAAC,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE,aAAa,CAAC,MAAM,CAAA;IACrD,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAA;IAC5B,QAAQ,CAAC,MAAM,EAAE,aAAa,CAAC,SAAS,CAAC,qBAAqB,CAAC,MAAM,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,CAAA;IACjF,QAAQ,CAAC,OAAO,EAAE,aAAa,CAAC,SAAS,CAAC,qBAAqB,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,CAAA;IACnF,QAAQ,CAAC,UAAU,EAAE,MAAM,CAAA;CAC5B;AAED;;;GAGG;AACH,eAAO,MAAM,IAAI,EAAE,CAAC,KAAK,EACvB,YAAY,EAAE,KAAK,EACnB,OAAO,CAAC,EAAE;IACR,QAAQ,CAAC,UAAU,CAAC,EAAE,MAAM,CAAA;CAC7B,KACE,yBAAyB,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAA6B,CAAA;AAEtF;;;GAGG;AACH,eAAO,MAAM,GAAG,EAAE;IAChB,CACE,GAAG,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACpC,CAAC,EACD,IAAI,EACJ,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,EAAE,EAEF,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG;QAAE,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;KAAE,EACpE,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,GACxG,CAAC,CAAC,EACH,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,KACvD,yBAAyB,CAC5B,KAAK,EACL,GAAG,GAAG,MAAM,EACZ,OAAO,EACP,CAAC,GAAG,EAAE,GAAG,YAAY,CAAC,sBAAsB,CAAC,OAAO,CAAC,GAAG,CAAC,CAC1D,CAAA;IACD,CACE,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,CAAC,EACD,GAAG,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACpC,CAAC,EACD,IAAI,EACJ,EAAE,EAEF,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAC1D,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG;QAAE,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;KAAE,EACpE,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,GACxG,yBAAyB,CAAC,KAAK,EAAE,GAAG,GAAG,MAAM,EAAE,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,YAAY,CAAC,sBAAsB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAA;CAsBtH,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,UAAU,EAAE;IACvB,CACE,GAAG,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACpC,CAAC,EACD,IAAI,EACJ,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,EAAE,EAEF,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG;QAAE,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;KAAE,EACpE,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,GACxG,CAAC,CAAC,EACH,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,KACvD,yBAAyB,CAC5B,KAAK,EACL,MAAM,EACN,OAAO,GAAG,GAAG,EACb,CAAC,GAAG,EAAE,GAAG,YAAY,CAAC,sBAAsB,CAAC,OAAO,CAAC,GAAG,CAAC,CAC1D,CAAA;IACD,CACE,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,CAAC,EACD,GAAG,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACpC,CAAC,EACD,IAAI,EACJ,EAAE,EAEF,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAC1D,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG;QAAE,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,CAAA;KAAE,EACpE,OAAO,EAAE,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,GACxG,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,GAAG,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,YAAY,CAAC,sBAAsB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAA;CAsBtH,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,gBAAgB,EAAE;IAC7B,CAAC,KAAK,EACJ,YAAY,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,GACjC,CAAC,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC,EACtF,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,KACvD,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,CAAA;IACzD,CAAC,KAAK,EAAE,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC,EAC1F,IAAI,EAAE,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAC1D,YAAY,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,GACjC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,CAAA;CAChB,CAAA"}
\ No newline at end of file
+{"version":3,"file":"SerializableProcedureList.d.ts","sourceRoot":"","sources":["../../../src/Machine/SerializableProcedureList.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/Machine.d.ts b/dist/dts/Machine.d.ts
index 0fc3735bf14c11c8abdde3b02ec52ee1f8a0a164..70f57c16075e5f09600391b1f02bc9ce87818b81 100644
--- a/dist/dts/Machine.d.ts
+++ b/dist/dts/Machine.d.ts
@@ -1,14 +1,11 @@
-/**
- * @since 1.0.0
- */
-import type * as ParseResult from "@effect/schema/ParseResult";
-import * as Schema from "@effect/schema/Schema";
 import * as Context from "effect/Context";
 import * as Effect from "effect/Effect";
 import * as FiberRef from "effect/FiberRef";
+import type * as ParseResult from "effect/ParseResult";
 import type { Pipeable } from "effect/Pipeable";
 import type { Request } from "effect/Request";
 import type * as Schedule from "effect/Schedule";
+import * as Schema from "effect/Schema";
 import type * as Scope from "effect/Scope";
 import * as Subscribable from "effect/Subscribable";
 import * as Procedure from "./Machine/Procedure.js";
@@ -81,7 +78,7 @@ export type ActorTypeId = typeof ActorTypeId;
 declare const MachineDefect_base: Schema.TaggedErrorClass<MachineDefect, "MachineDefect", {
     readonly _tag: Schema.tag<"MachineDefect">;
 } & {
-    cause: Schema.Defect;
+    cause: typeof Schema.Defect;
 }>;
 /**
  * @since 1.0.0
@@ -172,7 +169,15 @@ export interface SerializableActor<M extends Machine.Any> extends Actor<M> {
  * @category constructors
  */
 export declare const make: {
+    /**
+     * @since 1.0.0
+     * @category constructors
+     */
     <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, InitErr, R>(initialize: Effect.Effect<ProcedureList<State, Public, Private, R>, InitErr, R>): Machine<State, Public, Private, void, InitErr, Exclude<R, Scope.Scope | MachineContext>>;
+    /**
+     * @since 1.0.0
+     * @category constructors
+     */
     <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, Input, InitErr, R>(initialize: Machine.Initialize<Input, State, Public, Private, R, InitErr, R>): Machine<State, Public, Private, Input, InitErr, Exclude<R, Scope.Scope | MachineContext>>;
 };
 /**
@@ -188,10 +193,18 @@ export declare const makeWith: <State, Input = void>() => {
  * @category constructors
  */
 export declare const makeSerializable: {
+    /**
+     * @since 1.0.0
+     * @category constructors
+     */
     <State, IS, RS, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, InitErr, R>(options: {
         readonly state: Schema.Schema<State, IS, RS>;
         readonly input?: undefined;
     }, initialize: Effect.Effect<SerializableProcedureList<State, Public, Private, R>, InitErr, R> | Machine.InitializeSerializable<void, State, Public, Private, R, InitErr, R>): SerializableMachine<State, Public, Private, void, InitErr, Exclude<R, Scope.Scope | MachineContext>, RS>;
+    /**
+     * @since 1.0.0
+     * @category constructors
+     */
     <State, IS, RS, Input, II, RI, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, InitErr, R>(options: {
         readonly state: Schema.Schema<State, IS, RS>;
         readonly input: Schema.Schema<Input, II, RI>;
@@ -202,7 +215,15 @@ export declare const makeSerializable: {
  * @category combinators
  */
 export declare const retry: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <M extends Machine.Any, Out, In extends Machine.InitError<M> | MachineDefect, R>(policy: Schedule.Schedule<Out, In, R>): (self: M) => Machine.AddContext<M, R>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <M extends Machine.Any, Out, In extends Machine.InitError<M> | MachineDefect, R>(self: M, policy: Schedule.Schedule<Out, In, R>): Machine.AddContext<M, R>;
 };
 /**
@@ -215,7 +236,15 @@ export declare const currentTracingEnabled: FiberRef.FiberRef<boolean>;
  * @category tracing
  */
 export declare const withTracingEnabled: {
+    /**
+     * @since 1.0.0
+     * @category tracing
+     */
     (enabled: boolean): <A, E, R>(effect: Effect.Effect<A, E, R>) => Effect.Effect<A, E, R>;
+    /**
+     * @since 1.0.0
+     * @category tracing
+     */
     <A, E, R>(effect: Effect.Effect<A, E, R>, enabled: boolean): Effect.Effect<A, E, R>;
 };
 /**
diff --git a/dist/dts/Machine.d.ts.map b/dist/dts/Machine.d.ts.map
index a52a58ef2f75d6927bd212972e205f952e9c1d4b..8267ccc86b4e3a0b55c6af3a60d6947bd70c221f 100644
--- a/dist/dts/Machine.d.ts.map
+++ b/dist/dts/Machine.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Machine.d.ts","sourceRoot":"","sources":["../../src/Machine.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"Machine.d.ts","sourceRoot":"","sources":["../../src/Machine.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AAEzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAGvC,OAAO,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAM3C,OAAO,KAAK,KAAK,WAAW,MAAM,oBAAoB,CAAA;AACtD,OAAO,KAAK,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAA;AAK/C,OAAO,KAAK,EAAE,OAAO,EAAE,MAAM,gBAAgB,CAAA;AAC7C,OAAO,KAAK,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAChD,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,YAAY,MAAM,qBAAqB,CAAA;AAEnD,OAAO,KAAK,SAAS,MAAM,wBAAwB,CAAA;AACnD,OAAO,KAAK,EAAE,aAAa,EAAE,MAAM,4BAA4B,CAAA;AAC/D,OAAO,KAAK,EAAE,yBAAyB,EAAE,MAAM,wCAAwC,CAAA;AAEvF;;;GAGG;AACH,OAAO,KAAK,UAAU,MAAM,4BAA4B,CAAA;AAExD;;;GAGG;AACH,OAAO,KAAK,YAAY,MAAM,wCAAwC,CAAA;AAEtE,OAAO;AACL;;;GAGG;AACH,OAAO,EACR,MAAM,wBAAwB,CAAA;AAE/B;;;GAGG;AACH,eAAO,MAAM,MAAM,EAAE,OAAO,MAAmD,CAAA;AAE/E;;;GAGG;AACH,MAAM,MAAM,MAAM,GAAG,OAAO,MAAM,CAAA;AAElC;;;GAGG;AACH,MAAM,WAAW,OAAO,CACtB,KAAK,EACL,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAC1C,OAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAC3C,KAAK,EACL,OAAO,EACP,CAAC,CACD,SAAQ,QAAQ;IAChB,QAAQ,CAAC,CAAC,MAAM,CAAC,EAAE,MAAM,CAAA;IACzB,QAAQ,CAAC,UAAU,EAAE,OAAO,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;IACrF,QAAQ,CAAC,WAAW,EAAE,QAAQ,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,GAAG,aAAa,EAAE,CAAC,CAAC,GAAG,SAAS,CAAA;CACzF;AAED;;;GAGG;AACH,eAAO,MAAM,kBAAkB,EAAE,OAAO,MAAgE,CAAA;AAExG;;;GAGG;AACH,MAAM,MAAM,kBAAkB,GAAG,OAAO,kBAAkB,CAAA;AAE1D;;;GAGG;AACH,MAAM,WAAW,mBAAmB,CAClC,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,CACF,SACA,OAAO,CACL,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,EACP,CAAC,CACF;IAED,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAAE,kBAAkB,CAAA;IACjD,QAAQ,CAAC,WAAW,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE,CAAC,CAAA;IACvD,QAAQ,CAAC,WAAW,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,EAAE,CAAC,CAAA;CACxD;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,OAAO,MAAyD,CAAA;AAE1F;;;GAGG;AACH,MAAM,MAAM,WAAW,GAAG,OAAO,WAAW,CAAA;;;;;;AAE5C;;;GAGG;AACH,qBAAa,aAAc,SAAQ,kBAEjC;IACA;;OAEG;IACH,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,aAAa,EAAE,CAAC,CAAC;CAMzF;;AAED;;;GAGG;AACH,qBAAa,cAAe,SAAQ,mBAGjC;CAAG;AAEN;;;GAGG;AACH,MAAM,CAAC,OAAO,WAAW,OAAO,CAAC;IAC/B;;;OAGG;IACH,KAAY,GAAG,GACX,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,GACrC,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,GACvC,OAAO,CAAC,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,GACzC,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,GACzC,OAAO,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,CAAC,CAAA;IAE/C;;;OAGG;IACH,KAAY,UAAU,CACpB,KAAK,EACL,KAAK,EACL,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAC1C,OAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAC3C,CAAC,EACD,CAAC,EACD,KAAK,IACH,CACF,KAAK,EAAE,KAAK,EACZ,aAAa,CAAC,EAAE,KAAK,GAAG,SAAS,KAC9B,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAA;IAEtE;;;OAGG;IACH,KAAY,sBAAsB,CAChC,KAAK,EACL,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,CAAC,EACD,CAAC,EACD,KAAK,IACH,CACF,KAAK,EAAE,KAAK,EACZ,aAAa,CAAC,EAAE,KAAK,GAAG,SAAS,KAC9B,MAAM,CAAC,MAAM,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAA;IAElF;;OAEG;IACH,KAAY,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,EAAE,EAAE,MAAM,MAAM,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,GAAG,MAAM,GAChH,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,GAC3G,OAAO,GACL,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,KAAK,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,GAAG,KAAK,GAC9G,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,CAAC,GAC7G,OAAO,GACL,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,CAAC,CAAC,GAAG,CAAC,GACxG,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,OAAO,CAAC,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,EAAE,MAAM,KAAK,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,GAAG,KAAK,GAC9G,KAAK,CAAA;IAET;;OAEG;IACH,KAAY,UAAU,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,KAAK,IAAI,CAAC,SAAS,mBAAmB,CACrE,MAAM,KAAK,EACX,MAAM,MAAM,EACZ,MAAM,OAAO,EACb,MAAM,KAAK,EACX,MAAM,OAAO,EACb,MAAM,EAAE,EACR,MAAM,EAAE,CACT,GAAG,mBAAmB,CACnB,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,GAAG,CAAC,EACX,CAAC,GAAG,EAAE,EACN,EAAE,CACH,GACD,CAAC,SAAS,OAAO,CAAC,MAAM,KAAK,EAAE,MAAM,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,KAAK,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,CAAC,GAAG,OAAO,CACvG,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,GAAG,CAAC,EACX,CAAC,GAAG,EAAE,CACP,GACH,KAAK,CAAA;CACR;AAED;;;GAGG;AACH,MAAM,WAAW,KAAK,CAAC,CAAC,SAAS,OAAO,CAAC,GAAG,CAAE,SAAQ,YAAY,CAAC,YAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC/F,QAAQ,CAAC,CAAC,WAAW,CAAC,EAAE,WAAW,CAAA;IACnC,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAA;IACnB,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;IAChC,QAAQ,CAAC,IAAI,EAAE,CAAC,GAAG,SAAS,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,GAAG,KAAK,MAAM,CAAC,MAAM,CAC3E,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,EACpB,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CACnB,CAAA;IACD,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,aAAa,CAAC,CAAA;CAC1E;AAWD;;;GAGG;AACH,MAAM,WAAW,iBAAiB,CAAC,CAAC,SAAS,OAAO,CAAC,GAAG,CAAE,SAAQ,KAAK,CAAC,CAAC,CAAC;IACxE,QAAQ,CAAC,WAAW,EAAE,CAAC,OAAO,EAAE,OAAO,KAAK,MAAM,CAAC,MAAM,CACvD,MAAM,CAAC,WAAW,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,EAC7C,WAAW,CAAC,UAAU,CACvB,CAAA;CACF;AAED;;;GAGG;AACH,eAAO,MAAM,IAAI,EAAE;IACjB;;;OAGG;IACH,CAAC,KAAK,EAAE,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EACzG,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GAC9E,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,CAAC,CAAA;IAC3F;;;OAGG;IACH,CAAC,KAAK,EAAE,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,EAChH,UAAU,EAAE,OAAO,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GAC3E,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,CAAC,CAAA;CAY5F,CAAA;AAEF;;;GAGG;AACH,eAAO,MAAM,QAAQ,GAAI,KAAK,EAAE,KAAK,cAAY;IAC/C,CAAC,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,OAAO,EAAE,CAAC,EAClG,UAAU,EAAE,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GAC9E,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,CAAC,CAAA;IAC3F,CAAC,MAAM,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,SAAO,SAAS,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,SAAO,EAAE,GAAC,EAClG,UAAU,EAAE,OAAO,CAAC,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,SAAO,EAAE,GAAC,EAAE,SAAO,EAAE,GAAC,CAAC,GAC3E,OAAO,CAAC,KAAK,EAAE,MAAM,EAAE,SAAO,EAAE,KAAK,EAAE,SAAO,EAAE,OAAO,CAAC,GAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,CAAC,CAAA;CACrF,CAAA;AAET;;;GAGG;AACH,eAAO,MAAM,gBAAgB,EAAE;IAC7B;;;OAGG;IACH,CACE,KAAK,EACL,EAAE,EACF,EAAE,EACF,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,OAAO,EACP,CAAC,EAED,OAAO,EAAE;QACP,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;QAC5C,QAAQ,CAAC,KAAK,CAAC,EAAE,SAAS,CAAA;KAC3B,EACD,UAAU,EACN,MAAM,CAAC,MAAM,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GAC/E,OAAO,CAAC,sBAAsB,CAAC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GAC9E,mBAAmB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,EAAE,EAAE,CAAC,CAAA;IAC3G;;;OAGG;IACH,CACE,KAAK,EACL,EAAE,EACF,EAAE,EACF,KAAK,EACL,EAAE,EACF,EAAE,EACF,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,OAAO,EACP,CAAC,EAED,OAAO,EAAE;QACP,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;QAC5C,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,EAAE,CAAC,CAAA;KAC7C,EACD,UAAU,EAAE,OAAO,CAAC,sBAAsB,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,GACvF,mBAAmB,CAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,GAAG,cAAc,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAA;CAgCzG,CAAA;AAEV;;;GAGG;AACH,eAAO,MAAM,KAAK,EAAE;IAClB;;;OAGG;IACH,CAAC,CAAC,SAAS,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,SAAS,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,aAAa,EAAE,CAAC,EAC7E,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,GACpC,CAAC,IAAI,EAAE,CAAC,KAAK,OAAO,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;IACxC;;;OAGG;IACH,CAAC,CAAC,SAAS,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,SAAS,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,aAAa,EAAE,CAAC,EAC7E,IAAI,EAAE,CAAC,EACP,MAAM,EAAE,QAAQ,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,CAAC,GACpC,OAAO,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;CAOlB,CAAA;AAEX;;;GAGG;AACH,eAAO,MAAM,qBAAqB,EAAE,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAG5D,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,kBAAkB,EAAE;IAC/B;;;OAGG;IACH,CAAC,OAAO,EAAE,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;IACvF;;;OAGG;IACH,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;CAIpF,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,IAAI,GACf,CAAC,SAAS,OAAO,CAAC,GAAG,QAEf,CAAC,uBACc,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CACrD,KAAK,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EACxB,OAAO,CAAC,EAAE;IAAE,QAAQ,CAAC,aAAa,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;CAAE,CACxD,GACD,CACE,KAAK,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EACvB,OAAO,CAAC,EAAE;IAAE,QAAQ,CAAC,aAAa,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;CAAE,CACxD,KACF,MAAM,CAAC,MAAM,CACd,CAAC,SAAS;IAAE,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAAE,kBAAkB,CAAA;CAAE,GAAG,iBAAiB,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,EACjG,KAAK,EACL,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,KAAK,CA8V9B,CAAA;AAEJ;;;GAGG;AACH,eAAO,MAAM,QAAQ,GACnB,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,QAEI,KAAK,CACT,mBAAmB,CACjB,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,CACH,CACF,KACA,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,CAAC,EAAE,WAAW,CAAC,UAAU,EAAE,EAAE,CAI1E,CAAA;AAEH;;;GAGG;AACH,eAAO,MAAM,OAAO,GAClB,KAAK,EACL,MAAM,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACvC,OAAO,SAAS,MAAM,CAAC,aAAa,CAAC,GAAG,EACxC,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,QAEI,mBAAmB,CACvB,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,CACH,YACS,SAAS,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,CAAC,KAClD,MAAM,CAAC,MAAM,CACd,KAAK,CACH,mBAAmB,CACjB,KAAK,EACL,MAAM,EACN,OAAO,EACP,KAAK,EACL,OAAO,EACP,CAAC,EACD,EAAE,CACH,CACF,EACD,WAAW,CAAC,UAAU,EACtB,CAAC,GAAG,EAAE,CAKL,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/PersistedCache.d.ts b/dist/dts/PersistedCache.d.ts
index f2a249dc8d86225ec6a7ff055080e2d2f3a80670..d0c20e8965d96f59b22521377062e9dba67fd941 100644
--- a/dist/dts/PersistedCache.d.ts
+++ b/dist/dts/PersistedCache.d.ts
@@ -1,9 +1,6 @@
-/**
- * @since 1.0.0
- */
-import type * as Serializable from "@effect/schema/Serializable";
 import type * as Duration from "effect/Duration";
 import * as Effect from "effect/Effect";
+import type * as Schema from "effect/Schema";
 import type * as Scope from "effect/Scope";
 import * as Persistence from "./Persistence.js";
 /**
@@ -11,7 +8,7 @@ import * as Persistence from "./Persistence.js";
  * @category models
  */
 export interface PersistedCache<K extends Persistence.ResultPersistence.KeyAny> {
-    readonly get: (key: K) => Effect.Effect<Serializable.WithResult.Success<K>, Serializable.WithResult.Failure<K> | Persistence.PersistenceError>;
+    readonly get: (key: K) => Effect.Effect<Schema.WithResult.Success<K>, Schema.WithResult.Failure<K> | Persistence.PersistenceError>;
     readonly invalidate: (key: K) => Effect.Effect<void, Persistence.PersistenceError>;
 }
 /**
@@ -20,9 +17,9 @@ export interface PersistedCache<K extends Persistence.ResultPersistence.KeyAny>
  */
 export declare const make: <K extends Persistence.ResultPersistence.KeyAny, R>(options: {
     readonly storeId: string;
-    readonly lookup: (key: K) => Effect.Effect<Serializable.WithResult.Success<K>, Serializable.WithResult.Failure<K>, R>;
+    readonly lookup: (key: K) => Effect.Effect<Schema.WithResult.Success<K>, Schema.WithResult.Failure<K>, R>;
     readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<K>) => Duration.DurationInput;
     readonly inMemoryCapacity?: number | undefined;
     readonly inMemoryTTL?: Duration.DurationInput | undefined;
-}) => Effect.Effect<PersistedCache<K>, never, Serializable.SerializableWithResult.Context<K> | R | Persistence.ResultPersistence | Scope.Scope>;
+}) => Effect.Effect<PersistedCache<K>, never, Schema.SerializableWithResult.Context<K> | R | Persistence.ResultPersistence | Scope.Scope>;
 //# sourceMappingURL=PersistedCache.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/PersistedCache.d.ts.map b/dist/dts/PersistedCache.d.ts.map
index d830cb04d8df3f7d47c2eed9dfd125032ec21789..09ac4ee84283f54aaf72b533878a965cc813c5db 100644
--- a/dist/dts/PersistedCache.d.ts.map
+++ b/dist/dts/PersistedCache.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"PersistedCache.d.ts","sourceRoot":"","sources":["../../src/PersistedCache.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,KAAK,YAAY,MAAM,6BAA6B,CAAA;AAGhE,OAAO,KAAK,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAChD,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAKvC,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,WAAW,MAAM,kBAAkB,CAAA;AAc/C;;;GAGG;AACH,MAAM,WAAW,cAAc,CAAC,CAAC,SAAS,WAAW,CAAC,iBAAiB,CAAC,MAAM;IAC5E,QAAQ,CAAC,GAAG,EAAE,CACZ,GAAG,EAAE,CAAC,KACH,MAAM,CAAC,MAAM,CAChB,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAClC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,gBAAgB,CAClE,CAAA;IACD,QAAQ,CAAC,UAAU,EAAE,CAAC,GAAG,EAAE,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,WAAW,CAAC,gBAAgB,CAAC,CAAA;CACnF;AAED;;;GAGG;AACH,eAAO,MAAM,IAAI,GAAI,CAAC,SAAS,WAAW,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,WAAW;IAC/E,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAA;IACxB,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;IACrH,QAAQ,CAAC,UAAU,EAAE,CAAC,GAAG,IAAI,EAAE,WAAW,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,QAAQ,CAAC,aAAa,CAAA;IACzG,QAAQ,CAAC,gBAAgB,CAAC,EAAE,MAAM,GAAG,SAAS,CAAA;IAC9C,QAAQ,CAAC,WAAW,CAAC,EAAE,QAAQ,CAAC,aAAa,GAAG,SAAS,CAAA;CAC1D,KAAG,MAAM,CAAC,MAAM,CACf,cAAc,CAAC,CAAC,CAAC,EACjB,KAAK,EACL,YAAY,CAAC,sBAAsB,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,WAAW,CAAC,iBAAiB,GAAG,KAAK,CAAC,KAAK,CA8C/F,CAAA"}
\ No newline at end of file
+{"version":3,"file":"PersistedCache.d.ts","sourceRoot":"","sources":["../../src/PersistedCache.ts"],"names":[],"mappings":"AAKA,OAAO,KAAK,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAChD,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAKvC,OAAO,KAAK,KAAK,MAAM,MAAM,eAAe,CAAA;AAC5C,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C,OAAO,KAAK,WAAW,MAAM,kBAAkB,CAAA;AAc/C;;;GAGG;AACH,MAAM,WAAW,cAAc,CAAC,CAAC,SAAS,WAAW,CAAC,iBAAiB,CAAC,MAAM;IAC5E,QAAQ,CAAC,GAAG,EAAE,CACZ,GAAG,EAAE,CAAC,KACH,MAAM,CAAC,MAAM,CAChB,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAC5B,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC,gBAAgB,CAC5D,CAAA;IACD,QAAQ,CAAC,UAAU,EAAE,CAAC,GAAG,EAAE,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,WAAW,CAAC,gBAAgB,CAAC,CAAA;CACnF;AAED;;;GAGG;AACH,eAAO,MAAM,IAAI,GAAI,CAAC,SAAS,WAAW,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,WAAW;IAC/E,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAA;IACxB,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;IACzG,QAAQ,CAAC,UAAU,EAAE,CAAC,GAAG,IAAI,EAAE,WAAW,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,QAAQ,CAAC,aAAa,CAAA;IACzG,QAAQ,CAAC,gBAAgB,CAAC,EAAE,MAAM,GAAG,SAAS,CAAA;IAC9C,QAAQ,CAAC,WAAW,CAAC,EAAE,QAAQ,CAAC,aAAa,GAAG,SAAS,CAAA;CAC1D,KAAG,MAAM,CAAC,MAAM,CACf,cAAc,CAAC,CAAC,CAAC,EACjB,KAAK,EACL,MAAM,CAAC,sBAAsB,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,WAAW,CAAC,iBAAiB,GAAG,KAAK,CAAC,KAAK,CA8CzF,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/Persistence.d.ts b/dist/dts/Persistence.d.ts
index 895fe3d4c34b9ab7cf04b0bd3496afec10cadc4c..30f4769cf49984318a907d65955ccf9ab07c3659 100644
--- a/dist/dts/Persistence.d.ts
+++ b/dist/dts/Persistence.d.ts
@@ -1,6 +1,4 @@
 import * as KeyValueStore from "@effect/platform/KeyValueStore";
-import type * as ParseResult from "@effect/schema/ParseResult";
-import * as Serializable from "@effect/schema/Serializable";
 import type * as Clock from "effect/Clock";
 import * as Context from "effect/Context";
 import * as Duration from "effect/Duration";
@@ -8,7 +6,9 @@ import * as Effect from "effect/Effect";
 import type * as Exit from "effect/Exit";
 import * as Layer from "effect/Layer";
 import * as Option from "effect/Option";
+import * as ParseResult from "effect/ParseResult";
 import * as PrimaryKey from "effect/PrimaryKey";
+import * as Schema from "effect/Schema";
 import type * as Scope from "effect/Scope";
 /**
  * @since 1.0.0
@@ -136,7 +136,7 @@ export declare namespace ResultPersistence {
      * @since 1.0.0
      * @category models
      */
-    interface Key<R, IE, E, IA, A> extends Serializable.WithResult<A, IA, E, IE, R>, PrimaryKey.PrimaryKey {
+    interface Key<R, IE, E, IA, A> extends Schema.WithResult<A, IA, E, IE, R>, PrimaryKey.PrimaryKey {
     }
     /**
      * @since 1.0.0
diff --git a/dist/dts/Persistence.d.ts.map b/dist/dts/Persistence.d.ts.map
index 4766e3cd14c47a65a5633b08f558010daf5fb6d7..6c4931a82c329deba4fd354da97d206d824eab88 100644
--- a/dist/dts/Persistence.d.ts.map
+++ b/dist/dts/Persistence.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"Persistence.d.ts","sourceRoot":"","sources":["../../src/Persistence.ts"],"names":[],"mappings":"AAIA,OAAO,KAAK,aAAa,MAAM,gCAAgC,CAAA;AAC/D,OAAO,KAAK,KAAK,WAAW,MAAM,4BAA4B,CAAA;AAC9D,OAAO,KAAK,YAAY,MAAM,6BAA6B,CAAA;AAE3D,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAC1C,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAC3C,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,KAAK,IAAI,MAAM,aAAa,CAAA;AAExC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AACvC,OAAO,KAAK,UAAU,MAAM,mBAAmB,CAAA;AAC/C,OAAO,KAAK,KAAK,KAAK,MAAM,cAAc,CAAA;AAE1C;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,OAAO,MAA4D,CAAA;AAE7F;;;GAGG;AACH,MAAM,MAAM,WAAW,GAAG,OAAO,WAAW,CAAA;AAE5C;;;GAGG;AACH,MAAM,MAAM,gBAAgB,GAAG,qBAAqB,GAAG,uBAAuB,CAAA;;;;AAE9E;;;GAGG;AACH,qBAAa,qBAAsB,SAAQ,2BAA6C;IACtF,QAAQ,CAAC,MAAM,EAAE,YAAY,CAAA;IAC7B,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAA;IACvB,QAAQ,CAAC,KAAK,EAAE,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,CAAA;CAChD,CAAC;IACA;;OAEG;IACH,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC;IAIlE,IAAI,OAAO,WAEV;CACF;;;;AAED;;;GAGG;AACH,qBAAa,uBAAwB,SAAQ,6BAA6C;IACxF,QAAQ,CAAC,MAAM,EAAE,cAAc,CAAA;IAC/B,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAA;IACvB,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAA;CACxB,CAAC;IACA;;OAEG;IACH,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO;IAI1C,IAAI,OAAO,mBAEV;CACF;AAED;;;GAGG;AACH,eAAO,MAAM,wBAAwB,EAAE,OAAO,MAA8D,CAAA;AAE5G;;;GAGG;AACH,MAAM,MAAM,wBAAwB,GAAG,OAAO,wBAAwB,CAAA;AAEtE;;;GAGG;AACH,MAAM,WAAW,kBAAkB;IACjC,QAAQ,CAAC,CAAC,wBAAwB,CAAC,EAAE,wBAAwB,CAAA;IAC7D,QAAQ,CAAC,IAAI,EAAE,CAAC,OAAO,EAAE,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,uBAAuB,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAA;CAC/F;AAED;;;GAGG;AACH,MAAM,WAAW,uBAAuB;IACtC,QAAQ,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,gBAAgB,CAAC,CAAA;IACtF,QAAQ,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAA;IACxG,QAAQ,CAAC,GAAG,EAAE,CACZ,GAAG,EAAE,MAAM,EACX,KAAK,EAAE,OAAO,EACd,GAAG,EAAE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAClC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;IAC1C,QAAQ,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,MAAM,KAAK,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;IACvE,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;CACtD;AAED;;;GAGG;AACH,eAAO,MAAM,kBAAkB,EAAE,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,kBAAkB,CAIlF,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,uBAAuB,EAAE,OAAO,MAA6D,CAAA;AAE1G;;;GAGG;AACH,MAAM,MAAM,uBAAuB,GAAG,OAAO,uBAAuB,CAAA;AAEpE;;;GAGG;AACH,MAAM,WAAW,iBAAiB;IAChC,QAAQ,CAAC,CAAC,uBAAuB,CAAC,EAAE,uBAAuB,CAAA;IAC3D,QAAQ,CAAC,IAAI,EAAE,CAAC,OAAO,EAAE;QACvB,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAA;QACxB,QAAQ,CAAC,UAAU,CAAC,EAAE,CAAC,GAAG,EAAE,iBAAiB,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,QAAQ,CAAC,aAAa,CAAA;KACnH,KAAK,MAAM,CAAC,MAAM,CAAC,sBAAsB,EAAE,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,CAAA;CAChE;AAED;;;GAGG;AACH,MAAM,WAAW,sBAAsB;IACrC,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAC5B,GAAG,EAAE,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,KACxC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,gBAAgB,EAAE,CAAC,CAAC,CAAA;IACvE,QAAQ,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAChC,GAAG,EAAE,aAAa,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,KACvD,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,gBAAgB,EAAE,CAAC,CAAC,CAAA;IAC9E,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAC5B,GAAG,EAAE,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAC3C,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,KACnB,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,EAAE,CAAC,CAAC,CAAA;IAC7C,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,EAC/B,GAAG,EAAE,iBAAiB,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,KACxC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;IAC1C,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAA;CACtD;AAED;;;GAGG;AACH,MAAM,CAAC,OAAO,WAAW,iBAAiB,CAAC;IACzC;;;OAGG;IACH,UAAiB,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAE,SAAQ,YAAY,CAAC,UAAU,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC,UAAU;KAAG;IAEhH;;;OAGG;IACH,KAAY,MAAM,GAAG,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,GAAG,GAAG,CAAC,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,CAAC,CAAA;IAEpF;;;OAGG;IACH,KAAY,cAAc,CAAC,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC,GAC7C,CAAC,SAAS,GAAG,CAAC,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,EAAE,MAAM,GAAG,EAAE,MAAM,EAAE,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,GACzG,KAAK,GACL,KAAK,CAAA;CACV;AAED;;;GAGG;AACH,eAAO,MAAM,iBAAiB,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB,EAAE,iBAAiB,CAI/E,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,2DAyEvB,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,KAAK,CAAC,KAAK,CAAC,kBAAkB,CAqCvD,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,kBAAkB,EAAE,KAAK,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,EAAE,aAAa,CAAC,aAAa,CA2DlG,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,iBAAiB,EAAE,KAAK,CAAC,KAAK,CAAC,iBAAiB,CAE5D,CAAA;AAED;;;GAGG;AACH,eAAO,MAAM,wBAAwB,EAAE,KAAK,CAAC,KAAK,CAAC,iBAAiB,EAAE,KAAK,EAAE,aAAa,CAAC,aAAa,CAGrG,CAAA;AAEH;;GAEG;AACH,eAAO,MAAM,kBAAkB,UAAW,KAAK,CAAC,KAAK,OAAO,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAG,MAAM,GAAG,IACX,CAAA"}
\ No newline at end of file
+{"version":3,"file":"Persistence.d.ts","sourceRoot":"","sources":["../../src/Persistence.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/Reactivity.d.ts b/dist/dts/Reactivity.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..9330af1a50ce1eaf74c27dcdcd7eeffe1d387c8c
--- /dev/null
+++ b/dist/dts/Reactivity.d.ts
@@ -0,0 +1,46 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import type { ReadonlyRecord } from "effect/Record";
+import * as Scope from "effect/Scope";
+import * as Stream from "effect/Stream";
+declare const Reactivity_base: Context.TagClass<Reactivity, "@effect/experimental/Reactivity", Reactivity.Service>;
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export declare class Reactivity extends Reactivity_base {
+}
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare const make: Effect.Effect<Reactivity.Service, never, never>;
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export declare const layer: Layer.Layer<Reactivity>;
+/**
+ * @since 1.0.0
+ * @category model
+ */
+export declare namespace Reactivity {
+    /**
+     * @since 1.0.0
+     * @category model
+     */
+    interface Service {
+        readonly unsafeInvalidate: (keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>) => void;
+        readonly invalidate: (keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>) => Effect.Effect<void>;
+        readonly mutation: <A, E, R>(keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>, effect: Effect.Effect<A, E, R>) => Effect.Effect<A, E, R>;
+        readonly query: <A, E, R>(keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>, effect: Effect.Effect<A, E, R>) => Effect.Effect<Mailbox.ReadonlyMailbox<A, E>, never, R | Scope.Scope>;
+        readonly stream: <A, E, R>(keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>, effect: Effect.Effect<A, E, R>) => Stream.Stream<A, E, Exclude<R, Scope.Scope>>;
+    }
+}
+export {};
+//# sourceMappingURL=Reactivity.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Reactivity.d.ts.map b/dist/dts/Reactivity.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..791b133ec8fb0f476b47caff4734553dd001e78f
--- /dev/null
+++ b/dist/dts/Reactivity.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"Reactivity.d.ts","sourceRoot":"","sources":["../../src/Reactivity.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;AAIvC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,EAAE,cAAc,EAAE,MAAM,eAAe,CAAA;AACnD,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AACrC,OAAO,KAAK,MAAM,MAAM,eAAe,CAAA;;AAEvC;;;GAGG;AACH,qBAAa,UAAW,SAAQ,eAG7B;CAAG;AAEN;;;GAGG;AACH,eAAO,MAAM,IAAI,iDA4Gf,CAAA;AAEF;;;GAGG;AACH,eAAO,MAAM,KAAK,EAAE,KAAK,CAAC,KAAK,CAAC,UAAU,CAAkC,CAAA;AAE5E;;;GAGG;AACH,MAAM,CAAC,OAAO,WAAW,UAAU,CAAC;IAClC;;;OAGG;IACH,UAAiB,OAAO;QACtB,QAAQ,CAAC,gBAAgB,EAAE,CAAC,IAAI,EAAE,aAAa,CAAC,OAAO,CAAC,GAAG,cAAc,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC,KAAK,IAAI,CAAA;QAClH,QAAQ,CAAC,UAAU,EAAE,CACnB,IAAI,EAAE,aAAa,CAAC,OAAO,CAAC,GAAG,cAAc,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC,KAC1E,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;QACxB,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EACzB,IAAI,EAAE,aAAa,CAAC,OAAO,CAAC,GAAG,cAAc,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC,EAC7E,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,KAC3B,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAA;QAC3B,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EACtB,IAAI,EAAE,aAAa,CAAC,OAAO,CAAC,GAAG,cAAc,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC,EAC7E,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,KAC3B,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,CAAA;QACzE,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EACvB,IAAI,EAAE,aAAa,CAAC,OAAO,CAAC,GAAG,cAAc,CAAC,MAAM,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC,EAC7E,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,KAC3B,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,CAAA;KAClD;CACF"}
\ No newline at end of file
diff --git a/dist/dts/RequestResolver.d.ts b/dist/dts/RequestResolver.d.ts
index 87e1c7016cf479c6ffa90815376387d7eb34af4f..aad99345a982405d0d76a7552f281dc1814ca7a7 100644
--- a/dist/dts/RequestResolver.d.ts
+++ b/dist/dts/RequestResolver.d.ts
@@ -1,11 +1,8 @@
-/**
- * @since 1.0.0
- */
-import type * as Serializable from "@effect/schema/Serializable";
 import type * as Duration from "effect/Duration";
 import * as Effect from "effect/Effect";
 import * as Request from "effect/Request";
 import * as RequestResolver from "effect/RequestResolver";
+import type * as Schema from "effect/Schema";
 import type * as Scope from "effect/Scope";
 import * as Persistence from "./Persistence.js";
 /**
@@ -23,7 +20,7 @@ export declare const dataLoader: ((options: {
  * @since 1.0.0
  * @category model
  */
-export interface PersistedRequest<R, IE, E, IA, A> extends Request.Request<A, E>, Serializable.WithResult<A, IA, E, IE, R> {
+export interface PersistedRequest<R, IE, E, IA, A> extends Request.Request<A, E>, Schema.WithResult<A, IA, E, IE, R> {
 }
 /**
  * @since 1.0.0
@@ -41,13 +38,21 @@ export declare namespace PersistedRequest {
  * @category combinators
  */
 export declare const persisted: {
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends PersistedRequest.Any>(options: {
         readonly storeId: string;
         readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput;
-    }): (self: RequestResolver.RequestResolver<Req, never>) => Effect.Effect<RequestResolver.RequestResolver<Req, Serializable.WithResult.Context<Req>>, never, Persistence.ResultPersistence | Scope.Scope>;
+    }): (self: RequestResolver.RequestResolver<Req, never>) => Effect.Effect<RequestResolver.RequestResolver<Req, Schema.WithResult.Context<Req>>, never, Persistence.ResultPersistence | Scope.Scope>;
+    /**
+     * @since 1.0.0
+     * @category combinators
+     */
     <Req extends PersistedRequest.Any>(self: RequestResolver.RequestResolver<Req, never>, options: {
         readonly storeId: string;
         readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput;
-    }): Effect.Effect<RequestResolver.RequestResolver<Req, Serializable.WithResult.Context<Req>>, never, Persistence.ResultPersistence | Scope.Scope>;
+    }): Effect.Effect<RequestResolver.RequestResolver<Req, Schema.WithResult.Context<Req>>, never, Persistence.ResultPersistence | Scope.Scope>;
 };
 //# sourceMappingURL=RequestResolver.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/RequestResolver.d.ts.map b/dist/dts/RequestResolver.d.ts.map
index f3fee53c91f2aac36b8cc2ecdd86c1eb68f7cda0..4dce4d661303d9c6dd145d84d2f55a584f9c1d67 100644
--- a/dist/dts/RequestResolver.d.ts.map
+++ b/dist/dts/RequestResolver.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"RequestResolver.d.ts","sourceRoot":"","sources":["../../src/RequestResolver.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"RequestResolver.d.ts","sourceRoot":"","sources":["../../src/RequestResolver.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/Sse.d.ts b/dist/dts/Sse.d.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e7d3711077b581fd872f1742093d7833722fa753
--- /dev/null
+++ b/dist/dts/Sse.d.ts
@@ -0,0 +1,77 @@
+/**
+ * @since 1.0.0
+ */
+import * as Channel from "effect/Channel";
+import * as Chunk from "effect/Chunk";
+import * as Duration from "effect/Duration";
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare const makeChannel: <IE, Done>(options?: {
+    readonly bufferSize?: number;
+}) => Channel.Channel<Chunk.Chunk<Event>, Chunk.Chunk<string>, IE, IE, void, Done>;
+/**
+ * Create a SSE parser.
+ *
+ * Adapted from https://github.com/rexxars/eventsource-parser under MIT license.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export declare function makeParser(onParse: (event: AnyEvent) => void): Parser;
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface Parser {
+    feed(chunk: string): void;
+    reset(): void;
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface Event {
+    readonly _tag: "Event";
+    readonly event: string;
+    readonly id: string | undefined;
+    readonly data: string;
+}
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export declare const RetryTypeId: unique symbol;
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type RetryTypeId = typeof RetryTypeId;
+declare const Retry_base: new <A extends Record<string, any> = {}>(args: import("effect/Types").Equals<A, {}> extends true ? void : { readonly [P in keyof A as P extends "_tag" ? never : P]: A[P]; }) => Readonly<A> & {
+    readonly _tag: "Retry";
+};
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare class Retry extends Retry_base<{
+    readonly duration: Duration.Duration;
+    readonly lastEventId: string | undefined;
+}> {
+    /**
+     * @since 1.0.0
+     */
+    readonly [RetryTypeId]: RetryTypeId;
+    /**
+     * @since 1.0.0
+     */
+    static is(u: unknown): u is Retry;
+}
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export type AnyEvent = Event | Retry;
+export {};
+//# sourceMappingURL=Sse.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/Sse.d.ts.map b/dist/dts/Sse.d.ts.map
new file mode 100644
index 0000000000000000000000000000000000000000..1d69afda3bf80f485bfddb8495d3e2a671f77eed
--- /dev/null
+++ b/dist/dts/Sse.d.ts.map
@@ -0,0 +1 @@
+{"version":3,"file":"Sse.d.ts","sourceRoot":"","sources":["../../src/Sse.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,gBAAgB,CAAA;AACzC,OAAO,KAAK,KAAK,MAAM,cAAc,CAAA;AAErC,OAAO,KAAK,QAAQ,MAAM,iBAAiB,CAAA;AAM3C;;;GAGG;AACH,eAAO,MAAM,WAAW,GAAI,EAAE,EAAE,IAAI,YAAY;IAC9C,QAAQ,CAAC,UAAU,CAAC,EAAE,MAAM,CAAA;CAC7B,KAAG,OAAO,CAAC,OAAO,CACjB,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,EAClB,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,EACnB,EAAE,EACF,EAAE,EACF,IAAI,EACJ,IAAI,CA0DL,CAAA;AAED;;;;;;;GAOG;AACH,wBAAgB,UAAU,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,QAAQ,KAAK,IAAI,GAAG,MAAM,CAsJrE;AAQD;;;GAGG;AACH,MAAM,WAAW,MAAM;IACrB,IAAI,CAAC,KAAK,EAAE,MAAM,GAAG,IAAI,CAAA;IACzB,KAAK,IAAI,IAAI,CAAA;CACd;AAED;;;GAGG;AACH,MAAM,WAAW,KAAK;IACpB,QAAQ,CAAC,IAAI,EAAE,OAAO,CAAA;IACtB,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAA;IACtB,QAAQ,CAAC,EAAE,EAAE,MAAM,GAAG,SAAS,CAAA;IAC/B,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAA;CACtB;AAED;;;GAGG;AACH,eAAO,MAAM,WAAW,EAAE,OAAO,MAAqD,CAAA;AAEtF;;;GAGG;AACH,MAAM,MAAM,WAAW,GAAG,OAAO,WAAW,CAAA;;;;AAE5C;;;GAGG;AACH,qBAAa,KAAM,SAAQ,WAA0B;IACnD,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,QAAQ,CAAA;IACpC,QAAQ,CAAC,WAAW,EAAE,MAAM,GAAG,SAAS,CAAA;CACzC,CAAC;IACA;;OAEG;IACH,QAAQ,CAAC,CAAC,WAAW,CAAC,EAAE,WAAW,CAAc;IACjD;;OAEG;IACH,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG,CAAC,IAAI,KAAK;CAGlC;AAED;;;GAGG;AACH,MAAM,MAAM,QAAQ,GAAG,KAAK,GAAG,KAAK,CAAA"}
\ No newline at end of file
diff --git a/dist/dts/VariantSchema.d.ts b/dist/dts/VariantSchema.d.ts
index 514081a596bb941fb2eb6dcdcbec6648bcf50615..507fc0c13fdadf2ed5bdab37f075b2f50c1dc2d6 100644
--- a/dist/dts/VariantSchema.d.ts
+++ b/dist/dts/VariantSchema.d.ts
@@ -1,13 +1,13 @@
 /**
  * @since 1.0.0
  */
-import type * as AST from "@effect/schema/AST";
-import * as ParseResult from "@effect/schema/ParseResult";
-import * as Schema from "@effect/schema/Schema";
 import type { Brand } from "effect/Brand";
 import type * as Effect from "effect/Effect";
 import * as Option from "effect/Option";
+import * as ParseResult from "effect/ParseResult";
 import { type Pipeable } from "effect/Pipeable";
+import * as Schema from "effect/Schema";
+import type * as AST from "effect/SchemaAST";
 /**
  * @since 1.0.0
  * @category type ids
@@ -244,6 +244,8 @@ export interface Overrideable<To, From, R = never> extends Schema.PropertySignat
  */
 export declare const Overrideable: <From, IFrom, RFrom, To, ITo, R>(from: Schema.Schema<From, IFrom, RFrom>, to: Schema.Schema<To, ITo>, options: {
     readonly generate: (_: Option.Option<ITo>) => Effect.Effect<From, ParseResult.ParseIssue, R>;
+    readonly decode?: Schema.Schema<ITo, From>;
+    readonly constructorDefault?: () => To;
 }) => Overrideable<To, IFrom, RFrom | R>;
 export {};
 //# sourceMappingURL=VariantSchema.d.ts.map
\ No newline at end of file
diff --git a/dist/dts/VariantSchema.d.ts.map b/dist/dts/VariantSchema.d.ts.map
index a7fa2d7a1dec7c2425446d221dcfd2806a23870a..f92957788fa44dd3e751343282a7b29773d690b3 100644
--- a/dist/dts/VariantSchema.d.ts.map
+++ b/dist/dts/VariantSchema.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"VariantSchema.d.ts","sourceRoot":"","sources":["../../src/VariantSchema.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"VariantSchema.d.ts","sourceRoot":"","sources":["../../src/VariantSchema.ts"],"names":[],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/dts/index.d.ts b/dist/dts/index.d.ts
index 2558212ea79faba2ade13d1196ec3336d7a047bc..a63e8ec52e68deb220e1449330a52b90f176e11b 100644
--- a/dist/dts/index.d.ts
+++ b/dist/dts/index.d.ts
@@ -1,23 +1,39 @@
 /**
  * @since 1.0.0
  */
-export * as ChannelSchema from "./ChannelSchema.js";
+export * as DevTools from "./DevTools.js";
 /**
  * @since 1.0.0
  */
-export * as DevTools from "./DevTools.js";
+export * as Event from "./Event.js";
 /**
  * @since 1.0.0
  */
-export * as Machine from "./Machine.js";
+export * as EventGroup from "./EventGroup.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventJournal from "./EventJournal.js";
 /**
  * @since 1.0.0
  */
-export * as MsgPack from "./MsgPack.js";
+export * as EventLog from "./EventLog.js";
 /**
  * @since 1.0.0
  */
-export * as Ndjson from "./Ndjson.js";
+export * as EventLogEncryption from "./EventLogEncryption.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventLogRemote from "./EventLogRemote.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventLogServer from "./EventLogServer.js";
+/**
+ * @since 1.0.0
+ */
+export * as Machine from "./Machine.js";
 /**
  * @since 1.0.0
  */
@@ -26,6 +42,10 @@ export * as PersistedCache from "./PersistedCache.js";
  * @since 1.0.0
  */
 export * as Persistence from "./Persistence.js";
+/**
+ * @since 1.0.0
+ */
+export * as Reactivity from "./Reactivity.js";
 /**
  * @since 1.0.0
  */
@@ -33,7 +53,7 @@ export * as RequestResolver from "./RequestResolver.js";
 /**
  * @since 1.0.0
  */
-export * as SocketServer from "./SocketServer.js";
+export * as Sse from "./Sse.js";
 /**
  * @since 1.0.0
  */
diff --git a/dist/dts/index.d.ts.map b/dist/dts/index.d.ts.map
index d8a2a2a3acf7a6945f4f055fdb5aa7bef0232672..ab45a1637b97d259043ddbc88ff09704ee308f0f 100644
--- a/dist/dts/index.d.ts.map
+++ b/dist/dts/index.d.ts.map
@@ -1 +1 @@
-{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,aAAa,MAAM,oBAAoB,CAAA;AAEnD;;GAEG;AACH,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAA;AAEzC;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,cAAc,CAAA;AAEvC;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,cAAc,CAAA;AAEvC;;GAEG;AACH,OAAO,KAAK,MAAM,MAAM,aAAa,CAAA;AAErC;;GAEG;AACH,OAAO,KAAK,cAAc,MAAM,qBAAqB,CAAA;AAErD;;GAEG;AACH,OAAO,KAAK,WAAW,MAAM,kBAAkB,CAAA;AAE/C;;GAEG;AACH,OAAO,KAAK,eAAe,MAAM,sBAAsB,CAAA;AAEvD;;GAEG;AACH,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAA;AAEjD;;GAEG;AACH,OAAO,KAAK,aAAa,MAAM,oBAAoB,CAAA"}
\ No newline at end of file
+{"version":3,"file":"index.d.ts","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"AAAA;;GAEG;AACH,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAA;AAEzC;;GAEG;AACH,OAAO,KAAK,KAAK,MAAM,YAAY,CAAA;AAEnC;;GAEG;AACH,OAAO,KAAK,UAAU,MAAM,iBAAiB,CAAA;AAE7C;;GAEG;AACH,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAA;AAEjD;;GAEG;AACH,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAA;AAEzC;;GAEG;AACH,OAAO,KAAK,kBAAkB,MAAM,yBAAyB,CAAA;AAE7D;;GAEG;AACH,OAAO,KAAK,cAAc,MAAM,qBAAqB,CAAA;AAErD;;GAEG;AACH,OAAO,KAAK,cAAc,MAAM,qBAAqB,CAAA;AAErD;;GAEG;AACH,OAAO,KAAK,OAAO,MAAM,cAAc,CAAA;AAEvC;;GAEG;AACH,OAAO,KAAK,cAAc,MAAM,qBAAqB,CAAA;AAErD;;GAEG;AACH,OAAO,KAAK,WAAW,MAAM,kBAAkB,CAAA;AAE/C;;GAEG;AACH,OAAO,KAAK,UAAU,MAAM,iBAAiB,CAAA;AAE7C;;GAEG;AACH,OAAO,KAAK,eAAe,MAAM,sBAAsB,CAAA;AAEvD;;GAEG;AACH,OAAO,KAAK,GAAG,MAAM,UAAU,CAAA;AAE/B;;GAEG;AACH,OAAO,KAAK,aAAa,MAAM,oBAAoB,CAAA"}
\ No newline at end of file
diff --git a/dist/esm/DevTools/Client.js b/dist/esm/DevTools/Client.js
index 0217e3d8f25d7f44d39ff73d3abf864c99d6638e..23af43fc5c662e3ce7260ea7d269b11316c328c4 100644
--- a/dist/esm/DevTools/Client.js
+++ b/dist/esm/DevTools/Client.js
@@ -1,10 +1,13 @@
 /**
  * @since 1.0.0
  */
+import * as Ndjson from "@effect/platform/Ndjson";
 import * as Socket from "@effect/platform/Socket";
 import * as Cause from "effect/Cause";
 import * as Context from "effect/Context";
+import * as Deferred from "effect/Deferred";
 import * as Effect from "effect/Effect";
+import * as Exit from "effect/Exit";
 import { pipe } from "effect/Function";
 import * as Layer from "effect/Layer";
 import * as Mailbox from "effect/Mailbox";
@@ -13,7 +16,6 @@ import * as MetricState from "effect/MetricState";
 import * as Schedule from "effect/Schedule";
 import * as Stream from "effect/Stream";
 import * as Tracer from "effect/Tracer";
-import * as Ndjson from "../Ndjson.js";
 import * as Domain from "./Domain.js";
 /**
  * @since 1.0.0
@@ -81,10 +83,12 @@ export const make = /*#__PURE__*/Effect.gen(function* () {
       metrics
     };
   }
+  const connected = yield* Deferred.make();
   yield* Mailbox.toStream(requests).pipe(Stream.pipeThroughChannel(Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
     inputSchema: Domain.Request,
     outputSchema: Domain.Response
   })), Stream.runForEach(req => {
+    Deferred.unsafeDone(connected, Exit.void);
     switch (req._tag) {
       case "MetricsRequest":
         {
@@ -95,11 +99,12 @@ export const make = /*#__PURE__*/Effect.gen(function* () {
           return Effect.void;
         }
     }
-  }), Effect.retry(Schedule.spaced("1 seconds")), Effect.catchAllCause(Effect.logDebug), Effect.forkScoped, Effect.uninterruptible);
+  }), Effect.tapErrorCause(Effect.logDebug), Effect.retry(Schedule.spaced("1 seconds")), Effect.forkScoped, Effect.uninterruptible);
   yield* Effect.addFinalizer(() => requests.offer(metricsSnapshot()).pipe(Effect.zipRight(Effect.fiberIdWith(id => requests.failCause(Cause.interrupt(id))))));
   yield* requests.offer({
     _tag: "Ping"
   }).pipe(Effect.delay("3 seconds"), Effect.forever, Effect.forkScoped, Effect.interruptible);
+  yield* Deferred.await(connected).pipe(Effect.timeoutOption("1 second"));
   return Client.of({
     unsafeAddSpan: request => requests.unsafeOffer(request)
   });
@@ -117,9 +122,9 @@ export const layer = /*#__PURE__*/Layer.scoped(Client, make);
  * @since 1.0.0
  * @category constructors
  */
-export const makeTracer = /*#__PURE__*/Effect.gen(function* (_) {
-  const client = yield* _(Client);
-  const currentTracer = yield* _(Effect.tracer);
+export const makeTracer = /*#__PURE__*/Effect.gen(function* () {
+  const client = yield* Client;
+  const currentTracer = yield* Effect.tracer;
   return Tracer.make({
     span(name, parent, context, links, startTime, kind) {
       const span = currentTracer.span(name, parent, context, links, startTime, kind);
diff --git a/dist/esm/DevTools/Client.js.map b/dist/esm/DevTools/Client.js.map
index ec03c79d779d5220db6d4c6cccfb2b8ddeae1e8b..82753c8209ee43aa41fec0a0a88f6ce8bbeb00d6 100644
--- a/dist/esm/DevTools/Client.js.map
+++ b/dist/esm/DevTools/Client.js.map
@@ -1 +1 @@
-{"version":3,"file":"Client.js","names":["Socket","Cause","Context","Effect","pipe","Layer","Mailbox","Metric","MetricState","Schedule","Stream","Tracer","Ndjson","Domain","Client","GenericTag","make","gen","socket","requests","metricsSnapshot","snapshot","unsafeSnapshot","metrics","i","len","length","metricPair","isCounterState","metricState","push","_tag","name","metricKey","description","tags","state","isGaugeState","isHistogramState","isSummaryState","isFrequencyState","occurrences","Object","fromEntries","entries","toStream","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Request","outputSchema","Response","runForEach","req","offer","void","retry","spaced","catchAllCause","logDebug","forkScoped","uninterruptible","addFinalizer","zipRight","fiberIdWith","id","failCause","interrupt","delay","forever","interruptible","of","unsafeAddSpan","request","unsafeOffer","annotateLogs","package","module","service","layer","scoped","makeTracer","_","client","currentTracer","tracer","span","parent","context","links","startTime","kind","oldEvent","event","attributes","traceId","spanId","call","oldEnd","end","apply","arguments","layerTracer","map","setTracer","unwrapEffect","provide"],"sources":["../../../src/DevTools/Client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Client.js","names":["Ndjson","Socket","Cause","Context","Deferred","Effect","Exit","pipe","Layer","Mailbox","Metric","MetricState","Schedule","Stream","Tracer","Domain","Client","GenericTag","make","gen","socket","requests","metricsSnapshot","snapshot","unsafeSnapshot","metrics","i","len","length","metricPair","isCounterState","metricState","push","_tag","name","metricKey","description","tags","state","isGaugeState","isHistogramState","isSummaryState","isFrequencyState","occurrences","Object","fromEntries","entries","connected","toStream","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Request","outputSchema","Response","runForEach","req","unsafeDone","void","offer","tapErrorCause","logDebug","retry","spaced","forkScoped","uninterruptible","addFinalizer","zipRight","fiberIdWith","id","failCause","interrupt","delay","forever","interruptible","await","timeoutOption","of","unsafeAddSpan","request","unsafeOffer","annotateLogs","package","module","service","layer","scoped","makeTracer","client","currentTracer","tracer","span","parent","context","links","startTime","kind","oldEvent","event","attributes","traceId","spanId","call","oldEnd","end","apply","arguments","layerTracer","map","setTracer","unwrapEffect","provide"],"sources":["../../../src/DevTools/Client.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/DevTools/Domain.js b/dist/esm/DevTools/Domain.js
index 0f45ccf588dbacd478ca7ab689122e14adcfc0d4..aaeabd8f35fcb65b3d3624785fb716cd393cf6ef 100644
--- a/dist/esm/DevTools/Domain.js
+++ b/dist/esm/DevTools/Domain.js
@@ -1,7 +1,4 @@
-/**
- * @since 1.0.0
- */
-import * as Schema from "@effect/schema/Schema";
+import * as Schema from "effect/Schema";
 /**
  * @since 1.0.0
  * @category schemas
@@ -49,7 +46,11 @@ export const Span = /*#__PURE__*/Schema.Struct({
     value: Schema.Unknown
   }),
   status: SpanStatus,
-  parent: /*#__PURE__*/Schema.Option( /*#__PURE__*/Schema.suspend(() => ParentSpan))
+  parent: /*#__PURE__*/Schema.Option( /*#__PURE__*/Schema.suspend(() => ParentSpan)
+  // add a title annotation to avoid "Cannot access 'ParentSpan' before initialization" error during module initialization
+  .annotations({
+    title: "ParentSpan"
+  }))
 });
 /**
  * @since 1.0.0
diff --git a/dist/esm/DevTools/Domain.js.map b/dist/esm/DevTools/Domain.js.map
index cb9eab144099fe1b66a28c554ce371b22fc703d2..c698f4cd98b234dbb422a38eacccb2c32f266519 100644
--- a/dist/esm/DevTools/Domain.js.map
+++ b/dist/esm/DevTools/Domain.js.map
@@ -1 +1 @@
-{"version":3,"file":"Domain.js","names":["Schema","SpanStatusStarted","Struct","_tag","Literal","startTime","BigInt","SpanStatusEnded","endTime","SpanStatus","Union","ExternalSpan","spanId","String","traceId","sampled","Boolean","Span","name","attributes","ReadonlyMap","key","value","Unknown","status","parent","Option","suspend","ParentSpan","SpanEvent","Record","Ping","Pong","MetricsRequest","MetricLabel","metric","tag","state","description","optionalWith","as","tags","Array","Counter","count","Number","Frequency","occurrences","Gauge","numberOrInfinity","transform","Null","strict","decode","i","POSITIVE_INFINITY","encode","isFinite","Histogram","buckets","Tuple","min","max","sum","Summary","error","quantiles","Metric","MetricsSnapshot","metrics","Request","Response"],"sources":["../../../src/DevTools/Domain.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Domain.js","names":["Schema","SpanStatusStarted","Struct","_tag","Literal","startTime","BigInt","SpanStatusEnded","endTime","SpanStatus","Union","ExternalSpan","spanId","String","traceId","sampled","Boolean","Span","name","attributes","ReadonlyMap","key","value","Unknown","status","parent","Option","suspend","ParentSpan","annotations","title","SpanEvent","Record","Ping","Pong","MetricsRequest","MetricLabel","metric","tag","state","description","optionalWith","as","tags","Array","Counter","count","Number","Frequency","occurrences","Gauge","numberOrInfinity","transform","Null","strict","decode","i","POSITIVE_INFINITY","encode","isFinite","Histogram","buckets","Tuple","min","max","sum","Summary","error","quantiles","Metric","MetricsSnapshot","metrics","Request","Response"],"sources":["../../../src/DevTools/Domain.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/DevTools/Server.js b/dist/esm/DevTools/Server.js
index 7c3ff73eeb37ca8d9230e08cd1030b2f067708ca..43d2d5ac103f2c071ad71dac16d97538ec7a0310 100644
--- a/dist/esm/DevTools/Server.js
+++ b/dist/esm/DevTools/Server.js
@@ -1,42 +1,33 @@
 /**
  * @since 1.0.0
  */
+import * as Ndjson from "@effect/platform/Ndjson";
 import * as Socket from "@effect/platform/Socket";
-import * as Context from "effect/Context";
+import * as SocketServer from "@effect/platform/SocketServer";
 import * as Effect from "effect/Effect";
-import * as Queue from "effect/Queue";
+import * as Mailbox from "effect/Mailbox";
 import * as Stream from "effect/Stream";
-import * as Ndjson from "../Ndjson.js";
-import * as SocketServer from "../SocketServer/Node.js";
 import * as Domain from "./Domain.js";
-/**
- * @since 1.0.0
- * @category tags
- */
-export const Server = /*#__PURE__*/Context.GenericTag("@effect/experimental/DevTools/Server");
 /**
  * @since 1.0.0
  * @category constructors
  */
-export const make = /*#__PURE__*/Effect.gen(function* (_) {
-  const server = yield* _(SocketServer.SocketServer);
-  const run = handle => server.run(socket => Effect.gen(function* (_) {
-    const responses = yield* _(Queue.unbounded());
-    const requests = yield* _(Queue.unbounded());
+export const run = /*#__PURE__*/Effect.fnUntraced(function* (handle) {
+  const server = yield* SocketServer.SocketServer;
+  return yield* server.run(socket => Effect.gen(function* () {
+    const responses = yield* Mailbox.make();
+    const requests = yield* Mailbox.make();
     const client = {
       queue: requests,
       request: res => responses.offer(res)
     };
-    yield* _(Stream.fromQueue(responses), Stream.pipeThroughChannel(Ndjson.duplexSchema(Socket.toChannel(socket), {
+    yield* Mailbox.toStream(responses).pipe(Stream.pipeThroughChannel(Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
       inputSchema: Domain.Response,
       outputSchema: Domain.Request
     })), Stream.runForEach(req => req._tag === "Ping" ? responses.offer({
       _tag: "Pong"
-    }) : requests.offer(req)), Effect.ensuring(Effect.all([requests.shutdown, responses.shutdown])), Effect.fork);
-    return yield* _(handle(client));
+    }) : requests.offer(req)), Effect.ensuring(Effect.zipRight(responses.shutdown, requests.shutdown)), Effect.fork);
+    yield* handle(client);
   }));
-  return Server.of({
-    run
-  });
 });
 //# sourceMappingURL=Server.js.map
\ No newline at end of file
diff --git a/dist/esm/DevTools/Server.js.map b/dist/esm/DevTools/Server.js.map
index 51324adbff44d9f07aa8a3928fdf64acd70f0f36..873bd0ff74366ecc6ade2df7224a0ab4b88ba542 100644
--- a/dist/esm/DevTools/Server.js.map
+++ b/dist/esm/DevTools/Server.js.map
@@ -1 +1 @@
-{"version":3,"file":"Server.js","names":["Socket","Context","Effect","Queue","Stream","Ndjson","SocketServer","Domain","Server","GenericTag","make","gen","_","server","run","handle","socket","responses","unbounded","requests","client","queue","request","res","offer","fromQueue","pipeThroughChannel","duplexSchema","toChannel","inputSchema","Response","outputSchema","Request","runForEach","req","_tag","ensuring","all","shutdown","fork","of"],"sources":["../../../src/DevTools/Server.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,MAAM,MAAM,yBAAyB;AACjD,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,MAAM,MAAM,cAAc;AACtC,OAAO,KAAKC,YAAY,MAAM,yBAAyB;AACvD,OAAO,KAAKC,MAAM,MAAM,aAAa;AA6BrC;;;;AAIA,OAAO,MAAMC,MAAM,gBAAGP,OAAO,CAACQ,UAAU,CAAqB,sCAAsC,CAAC;AAEpG;;;;AAIA,OAAO,MAAMC,IAAI,gBAAGR,MAAM,CAACS,GAAG,CAAC,WAAUC,CAAC;EACxC,MAAMC,MAAM,GAAG,OAAOD,CAAC,CAACN,YAAY,CAACA,YAAY,CAAC;EAElD,MAAMQ,GAAG,GAAaC,MAAkD,IACtEF,MAAM,CAACC,GAAG,CAAEE,MAAM,IAChBd,MAAM,CAACS,GAAG,CAAC,WAAUC,CAAC;IACpB,MAAMK,SAAS,GAAG,OAAOL,CAAC,CAACT,KAAK,CAACe,SAAS,EAAmB,CAAC;IAC9D,MAAMC,QAAQ,GAAG,OAAOP,CAAC,CAACT,KAAK,CAACe,SAAS,EAA8B,CAAC;IAExE,MAAME,MAAM,GAAW;MACrBC,KAAK,EAAEF,QAAQ;MACfG,OAAO,EAAGC,GAAG,IAAKN,SAAS,CAACO,KAAK,CAACD,GAAG;KACtC;IAED,OAAOX,CAAC,CACNR,MAAM,CAACqB,SAAS,CAACR,SAAS,CAAC,EAC3Bb,MAAM,CAACsB,kBAAkB,CACvBrB,MAAM,CAACsB,YAAY,CAAC3B,MAAM,CAAC4B,SAAS,CAACZ,MAAM,CAAC,EAAE;MAC5Ca,WAAW,EAAEtB,MAAM,CAACuB,QAAQ;MAC5BC,YAAY,EAAExB,MAAM,CAACyB;KACtB,CAAC,CACH,EACD5B,MAAM,CAAC6B,UAAU,CAAEC,GAAG,IACpBA,GAAG,CAACC,IAAI,KAAK,MAAM,GACflB,SAAS,CAACO,KAAK,CAAC;MAAEW,IAAI,EAAE;IAAM,CAAE,CAAC,GACjChB,QAAQ,CAACK,KAAK,CAACU,GAAG,CAAC,CACxB,EACDhC,MAAM,CAACkC,QAAQ,CAAClC,MAAM,CAACmC,GAAG,CAAC,CACzBlB,QAAQ,CAACmB,QAAQ,EACjBrB,SAAS,CAACqB,QAAQ,CACnB,CAAC,CAAC,EACHpC,MAAM,CAACqC,IAAI,CACZ;IAED,OAAO,OAAO3B,CAAC,CAACG,MAAM,CAACK,MAAM,CAAC,CAAC;EACjC,CAAC,CAAC,CACH;EAEH,OAAOZ,MAAM,CAACgC,EAAE,CAAC;IAAE1B;EAAG,CAAE,CAAC;AAC3B,CAAC,CAAC","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Server.js","names":["Ndjson","Socket","SocketServer","Effect","Mailbox","Stream","Domain","run","fnUntraced","handle","server","socket","gen","responses","make","requests","client","queue","request","res","offer","toStream","pipe","pipeThroughChannel","duplexSchemaString","toChannelString","inputSchema","Response","outputSchema","Request","runForEach","req","_tag","ensuring","zipRight","shutdown","fork"],"sources":["../../../src/DevTools/Server.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,MAAM,MAAM,yBAAyB;AACjD,OAAO,KAAKC,MAAM,MAAM,yBAAyB;AACjD,OAAO,KAAKC,YAAY,MAAM,+BAA+B;AAC7D,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,MAAM,MAAM,aAAa;AAWrC;;;;AAIA,OAAO,MAAMC,GAAG,gBAAGJ,MAAM,CAACK,UAAU,CAAC,WAAmBC,MAAkD;EACxG,MAAMC,MAAM,GAAG,OAAOR,YAAY,CAACA,YAAY;EAC/C,OAAO,OAAOQ,MAAM,CAACH,GAAG,CAAEI,MAAM,IAC9BR,MAAM,CAACS,GAAG,CAAC,aAAS;IAClB,MAAMC,SAAS,GAAG,OAAOT,OAAO,CAACU,IAAI,EAAmB;IACxD,MAAMC,QAAQ,GAAG,OAAOX,OAAO,CAACU,IAAI,EAA8B;IAElE,MAAME,MAAM,GAAW;MACrBC,KAAK,EAAEF,QAAQ;MACfG,OAAO,EAAGC,GAAG,IAAKN,SAAS,CAACO,KAAK,CAACD,GAAG;KACtC;IAED,OAAOf,OAAO,CAACiB,QAAQ,CAACR,SAAS,CAAC,CAACS,IAAI,CACrCjB,MAAM,CAACkB,kBAAkB,CACvBvB,MAAM,CAACwB,kBAAkB,CAACvB,MAAM,CAACwB,eAAe,CAACd,MAAM,CAAC,EAAE;MACxDe,WAAW,EAAEpB,MAAM,CAACqB,QAAQ;MAC5BC,YAAY,EAAEtB,MAAM,CAACuB;KACtB,CAAC,CACH,EACDxB,MAAM,CAACyB,UAAU,CAAEC,GAAG,IACpBA,GAAG,CAACC,IAAI,KAAK,MAAM,GACfnB,SAAS,CAACO,KAAK,CAAC;MAAEY,IAAI,EAAE;IAAM,CAAE,CAAC,GACjCjB,QAAQ,CAACK,KAAK,CAACW,GAAG,CAAC,CACxB,EACD5B,MAAM,CAAC8B,QAAQ,CAAC9B,MAAM,CAAC+B,QAAQ,CAACrB,SAAS,CAACsB,QAAQ,EAAEpB,QAAQ,CAACoB,QAAQ,CAAC,CAAC,EACvEhC,MAAM,CAACiC,IAAI,CACZ;IAED,OAAO3B,MAAM,CAACO,MAAM,CAAC;EACvB,CAAC,CAAC,CACH;AACH,CAAC,CAAC","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Event.js b/dist/esm/Event.js
new file mode 100644
index 0000000000000000000000000000000000000000..72a3e8796846060087e270d827ca7a9b7cdaa921
--- /dev/null
+++ b/dist/esm/Event.js
@@ -0,0 +1,36 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import { pipeArguments } from "effect/Pipeable";
+import * as Predicate from "effect/Predicate";
+import * as Schema from "effect/Schema";
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const TypeId = /*#__PURE__*/Symbol.for("@effect/experimental/Event");
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export const isEvent = u => Predicate.hasProperty(u, TypeId);
+const Proto = {
+  [TypeId]: TypeId,
+  pipe() {
+    return pipeArguments(this, arguments);
+  }
+};
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const make = options => Object.assign(Object.create(Proto), {
+  tag: options.tag,
+  primaryKey: options.primaryKey,
+  payload: options.payload ?? Schema.Void,
+  payloadMsgPack: MsgPack.schema(options.payload ?? Schema.Void),
+  success: options.success ?? Schema.Void,
+  error: options.error ?? Schema.Never
+});
+//# sourceMappingURL=Event.js.map
\ No newline at end of file
diff --git a/dist/esm/Event.js.map b/dist/esm/Event.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..f85098629b8c9a16bbdeddc67703d61b04b7a5a1
--- /dev/null
+++ b/dist/esm/Event.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Event.js","names":["MsgPack","pipeArguments","Predicate","Schema","TypeId","Symbol","for","isEvent","u","hasProperty","Proto","pipe","arguments","make","options","Object","assign","create","tag","primaryKey","payload","Void","payloadMsgPack","schema","success","error","Never"],"sources":["../../src/Event.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,OAAO,MAAM,0BAA0B;AACnD,SAASC,aAAa,QAAQ,iBAAiB;AAC/C,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAC7C,OAAO,KAAKC,MAAM,MAAM,eAAe;AAEvC;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,4BAA4B,CAAC;AAQ7E;;;;AAIA,OAAO,MAAMC,OAAO,GAAIC,CAAU,IAAqCN,SAAS,CAACO,WAAW,CAACD,CAAC,EAAEJ,MAAM,CAAC;AA8MvG,MAAMM,KAAK,GAAG;EACZ,CAACN,MAAM,GAAGA,MAAM;EAChBO,IAAIA,CAAA;IACF,OAAOV,aAAa,CAAC,IAAI,EAAEW,SAAS,CAAC;EACvC;CACD;AAED;;;;AAIA,OAAO,MAAMC,IAAI,GAKfC,OAMD,IACCC,MAAM,CAACC,MAAM,CAACD,MAAM,CAACE,MAAM,CAACP,KAAK,CAAC,EAAE;EAClCQ,GAAG,EAAEJ,OAAO,CAACI,GAAG;EAChBC,UAAU,EAAEL,OAAO,CAACK,UAAU;EAC9BC,OAAO,EAAEN,OAAO,CAACM,OAAO,IAAIjB,MAAM,CAACkB,IAAI;EACvCC,cAAc,EAAEtB,OAAO,CAACuB,MAAM,CAACT,OAAO,CAACM,OAAO,IAAIjB,MAAM,CAACkB,IAAI,CAAC;EAC9DG,OAAO,EAAEV,OAAO,CAACU,OAAO,IAAIrB,MAAM,CAACkB,IAAI;EACvCI,KAAK,EAAEX,OAAO,CAACW,KAAK,IAAItB,MAAM,CAACuB;CAChC,CAAC","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventGroup.js b/dist/esm/EventGroup.js
new file mode 100644
index 0000000000000000000000000000000000000000..b54e347c197f74a0782cf2a3bb268dc26802e2fe
--- /dev/null
+++ b/dist/esm/EventGroup.js
@@ -0,0 +1,58 @@
+/**
+ * @since 1.0.0
+ */
+import * as HttpApiSchema from "@effect/platform/HttpApiSchema";
+import { pipeArguments } from "effect/Pipeable";
+import * as Predicate from "effect/Predicate";
+import * as Record from "effect/Record";
+import * as EventApi from "./Event.js";
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const TypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventGroup");
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export const isEventGroup = u => Predicate.hasProperty(u, TypeId);
+const Proto = {
+  [TypeId]: TypeId,
+  add(options) {
+    return makeProto({
+      events: {
+        ...this.events,
+        [options.tag]: EventApi.make(options)
+      }
+    });
+  },
+  addError(error) {
+    return makeProto({
+      events: Record.map(this.events, event => EventApi.make({
+        ...event,
+        error: HttpApiSchema.UnionUnify(event.error, error)
+      }))
+    });
+  },
+  pipe() {
+    return pipeArguments(this, arguments);
+  }
+};
+const makeProto = options => {
+  function EventGroup() {}
+  Object.setPrototypeOf(EventGroup, Proto);
+  return Object.assign(EventGroup, options);
+};
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLog.group` api.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export const empty = /*#__PURE__*/makeProto({
+  events: /*#__PURE__*/Record.empty()
+});
+//# sourceMappingURL=EventGroup.js.map
\ No newline at end of file
diff --git a/dist/esm/EventGroup.js.map b/dist/esm/EventGroup.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..b4b4bee1d8eb7e827d741d36f4feb4a01d531e27
--- /dev/null
+++ b/dist/esm/EventGroup.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventGroup.js","names":["HttpApiSchema","pipeArguments","Predicate","Record","EventApi","TypeId","Symbol","for","isEventGroup","u","hasProperty","Proto","add","options","makeProto","events","tag","make","addError","error","map","event","UnionUnify","pipe","arguments","EventGroup","Object","setPrototypeOf","assign","empty"],"sources":["../../src/EventGroup.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,aAAa,MAAM,gCAAgC;AAC/D,SAAwBC,aAAa,QAAQ,iBAAiB;AAC9D,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAC7C,OAAO,KAAKC,MAAM,MAAM,eAAe;AAGvC,OAAO,KAAKC,QAAQ,MAAM,YAAY;AAEtC;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,iCAAiC,CAAC;AAQlF;;;;AAIA,OAAO,MAAMC,YAAY,GAAIC,CAAU,IAA0BP,SAAS,CAACQ,WAAW,CAACD,CAAC,EAAEJ,MAAM,CAAC;AAiFjG,MAAMM,KAAK,GAAG;EACZ,CAACN,MAAM,GAAGA,MAAM;EAChBO,GAAGA,CAAgCC,OAMlC;IACC,OAAOC,SAAS,CAAC;MACfC,MAAM,EAAE;QACN,GAAG,IAAI,CAACA,MAAM;QACd,CAACF,OAAO,CAACG,GAAG,GAAGZ,QAAQ,CAACa,IAAI,CAACJ,OAAO;;KAEvC,CAAC;EACJ,CAAC;EACDK,QAAQA,CAAgCC,KAAwB;IAC9D,OAAOL,SAAS,CAAC;MACfC,MAAM,EAAEZ,MAAM,CAACiB,GAAG,CAAC,IAAI,CAACL,MAAM,EAAGM,KAAK,IACpCjB,QAAQ,CAACa,IAAI,CAAC;QACZ,GAAGI,KAAK;QACRF,KAAK,EAAEnB,aAAa,CAACsB,UAAU,CAACD,KAAK,CAACF,KAAK,EAAEA,KAAK;OACnD,CAAC;KACL,CAAC;EACJ,CAAC;EACDI,IAAIA,CAAA;IACF,OAAOtB,aAAa,CAAC,IAAI,EAAEuB,SAAS,CAAC;EACvC;CACD;AAED,MAAMV,SAAS,GAEbD,OAED,IAAwB;EACvB,SAASY,UAAUA,CAAA,GAAI;EACvBC,MAAM,CAACC,cAAc,CAACF,UAAU,EAAEd,KAAK,CAAC;EACxC,OAAOe,MAAM,CAACE,MAAM,CAACH,UAAU,EAAEZ,OAAO,CAAQ;AAClD,CAAC;AAED;;;;;;;;;AASA,OAAO,MAAMgB,KAAK,gBAAsBf,SAAS,CAAC;EAAEC,MAAM,eAAEZ,MAAM,CAAC0B,KAAK;AAAE,CAAE,CAAC","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventJournal.js b/dist/esm/EventJournal.js
new file mode 100644
index 0000000000000000000000000000000000000000..44266e41bee97ed6930eb7e6b7d473b6914a8b7e
--- /dev/null
+++ b/dist/esm/EventJournal.js
@@ -0,0 +1,459 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Context from "effect/Context";
+import * as DateTime from "effect/DateTime";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as PubSub from "effect/PubSub";
+import * as Schema from "effect/Schema";
+import * as Uuid from "uuid";
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class EventJournal extends /*#__PURE__*/Context.Tag("@effect/experimental/EventJournal")() {}
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export const ErrorTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/ErrorId");
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export class EventJournalError extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventJournal/Error")("EventJournalError", {
+  method: Schema.String,
+  cause: Schema.Defect
+}) {
+  /**
+   * @since 1.0.0
+   */
+  [ErrorTypeId] = ErrorTypeId;
+}
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const RemoteIdTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/RemoteId");
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const RemoteId = /*#__PURE__*/Schema.Uint8ArrayFromSelf.pipe( /*#__PURE__*/Schema.brand(RemoteIdTypeId));
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const makeRemoteId = () => Uuid.v4({}, new Uint8Array(16));
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const EntryIdTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventJournal/EntryId");
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const EntryId = /*#__PURE__*/Schema.Uint8ArrayFromSelf.pipe( /*#__PURE__*/Schema.brand(EntryIdTypeId));
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const makeEntryId = (options = {}) => {
+  return Uuid.v7(options, new Uint8Array(16));
+};
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const entryIdMillis = entryId => {
+  const bytes = new Uint8Array(8);
+  bytes.set(entryId.subarray(0, 6), 2);
+  return Number(new DataView(bytes.buffer).getBigUint64(0));
+};
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export class Entry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventJournal/Entry")({
+  id: EntryId,
+  event: Schema.String,
+  primaryKey: Schema.String,
+  payload: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static arrayMsgPack = /*#__PURE__*/Schema.Array( /*#__PURE__*/MsgPack.schema(Entry));
+  /**
+   * @since 1.0.0
+   */
+  static encodeArray = /*#__PURE__*/Schema.encode(Entry.arrayMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  static decodeArray = /*#__PURE__*/Schema.decode(Entry.arrayMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  get idString() {
+    return Uuid.stringify(this.id);
+  }
+  /**
+   * @since 1.0.0
+   */
+  get createdAtMillis() {
+    return entryIdMillis(this.id);
+  }
+  /**
+   * @since 1.0.0
+   */
+  get createdAt() {
+    return DateTime.unsafeMake(this.createdAtMillis);
+  }
+}
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export class RemoteEntry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventJournal/RemoteEntry")({
+  remoteSequence: Schema.Number,
+  entry: Entry
+}) {}
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export const makeMemory = /*#__PURE__*/Effect.gen(function* () {
+  const journal = [];
+  const byId = new Map();
+  const remotes = new Map();
+  const pubsub = yield* PubSub.unbounded();
+  const ensureRemote = remoteId => {
+    const remoteIdString = Uuid.stringify(remoteId);
+    let remote = remotes.get(remoteIdString);
+    if (remote) return remote;
+    remote = {
+      sequence: 0,
+      missing: journal.slice()
+    };
+    remotes.set(remoteIdString, remote);
+    return remote;
+  };
+  return EventJournal.of({
+    entries: Effect.sync(() => journal.slice()),
+    write({
+      effect,
+      event,
+      payload,
+      primaryKey
+    }) {
+      return Effect.acquireUseRelease(Effect.sync(() => new Entry({
+        id: makeEntryId(),
+        event,
+        primaryKey,
+        payload
+      }, {
+        disableValidation: true
+      })), effect, (entry, exit) => Effect.suspend(() => {
+        if (exit._tag === "Failure" || byId.has(entry.idString)) return Effect.void;
+        journal.push(entry);
+        byId.set(entry.idString, entry);
+        remotes.forEach(remote => {
+          remote.missing.push(entry);
+        });
+        return pubsub.publish(entry);
+      }));
+    },
+    writeFromRemote: options => Effect.gen(function* () {
+      const remote = ensureRemote(options.remoteId);
+      const uncommittedRemotes = [];
+      const uncommitted = [];
+      for (const remoteEntry of options.entries) {
+        if (byId.has(remoteEntry.entry.idString)) {
+          if (remoteEntry.remoteSequence > remote.sequence) {
+            remote.sequence = remoteEntry.remoteSequence;
+          }
+          continue;
+        }
+        uncommittedRemotes.push(remoteEntry);
+        uncommitted.push(remoteEntry.entry);
+      }
+      const brackets = options.compact ? yield* options.compact(uncommittedRemotes) : [[uncommitted, uncommittedRemotes]];
+      for (const [compacted, remoteEntries] of brackets) {
+        for (const originEntry of compacted) {
+          const entryMillis = entryIdMillis(originEntry.id);
+          const conflicts = [];
+          for (let i = journal.length - 1; i >= -1; i--) {
+            const entry = journal[i];
+            if (entry !== undefined && entry.createdAtMillis > entryMillis) {
+              continue;
+            }
+            for (let j = i + 2; j < journal.length; j++) {
+              const entry = journal[j];
+              if (entry.event === originEntry.event && entry.primaryKey === originEntry.primaryKey) {
+                conflicts.push(entry);
+              }
+            }
+            yield* options.effect({
+              entry: originEntry,
+              conflicts
+            });
+            break;
+          }
+        }
+        for (let j = 0; j < remoteEntries.length; j++) {
+          const remoteEntry = remoteEntries[j];
+          journal.push(remoteEntry.entry);
+          if (remoteEntry.remoteSequence > remote.sequence) {
+            remote.sequence = remoteEntry.remoteSequence;
+          }
+        }
+        journal.sort((a, b) => a.createdAtMillis - b.createdAtMillis);
+      }
+    }),
+    withRemoteUncommited: (remoteId, f) => Effect.acquireUseRelease(Effect.sync(() => ensureRemote(remoteId).missing.slice()), f, (entries, exit) => Effect.sync(() => {
+      if (exit._tag === "Failure") return;
+      const last = entries[entries.length - 1];
+      if (!last) return;
+      const remote = ensureRemote(remoteId);
+      for (let i = remote.missing.length - 1; i >= 0; i--) {
+        if (remote.missing[i].id === last.id) {
+          remote.missing = remote.missing.slice(i + 1);
+          break;
+        }
+      }
+    })),
+    nextRemoteSequence: remoteId => Effect.sync(() => ensureRemote(remoteId).sequence),
+    changes: PubSub.subscribe(pubsub),
+    destroy: Effect.sync(() => {
+      journal.length = 0;
+      byId.clear();
+      remotes.clear();
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export const layerMemory = /*#__PURE__*/Layer.effect(EventJournal, makeMemory);
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export const makeIndexedDb = options => Effect.gen(function* () {
+  const database = options?.database ?? "effect_event_journal";
+  const openRequest = indexedDB.open(database, 1);
+  openRequest.onupgradeneeded = () => {
+    const db = openRequest.result;
+    const entries = db.createObjectStore("entries", {
+      keyPath: "id"
+    });
+    entries.createIndex("id", "id", {
+      unique: true
+    });
+    entries.createIndex("event", "event");
+    const remotes = db.createObjectStore("remotes", {
+      keyPath: ["remoteId", "entryId"]
+    });
+    remotes.createIndex("id", ["remoteId", "entryId"], {
+      unique: true
+    });
+    remotes.createIndex("sequence", ["remoteId", "sequence"], {
+      unique: true
+    });
+    const remoteEntryId = db.createObjectStore("remoteEntryId", {
+      keyPath: ["remoteId"]
+    });
+    remoteEntryId.createIndex("id", "remoteId", {
+      unique: true
+    });
+  };
+  const db = yield* Effect.acquireRelease(idbReq("open", () => openRequest), db => Effect.sync(() => db.close()));
+  const pubsub = yield* PubSub.unbounded();
+  return EventJournal.of({
+    entries: idbReq("entries", () => db.transaction("entries", "readonly").objectStore("entries").index("id").getAll()).pipe(Effect.flatMap(_ => decodeEntryIdbArray(_).pipe(Effect.mapError(cause => new EventJournalError({
+      method: "entries",
+      cause
+    }))))),
+    write: ({
+      effect,
+      event,
+      payload,
+      primaryKey
+    }) => Effect.uninterruptibleMask(restore => {
+      const entry = new Entry({
+        id: makeEntryId(),
+        event,
+        primaryKey,
+        payload
+      }, {
+        disableValidation: true
+      });
+      return restore(effect(entry)).pipe(Effect.zipLeft(idbReq("write", () => db.transaction("entries", "readwrite").objectStore("entries").put(encodeEntryIdb(entry)))), Effect.zipLeft(pubsub.publish(entry)));
+    }),
+    writeFromRemote: options => Effect.gen(function* () {
+      const uncommitted = [];
+      const uncommittedRemotes = [];
+      yield* Effect.async(resume => {
+        const tx = db.transaction(["entries", "remotes"], "readwrite");
+        const entries = tx.objectStore("entries");
+        const remotes = tx.objectStore("remotes");
+        const iterator = options.entries[Symbol.iterator]();
+        const handleNext = state => {
+          if (state.done) return;
+          const remoteEntry = state.value;
+          const entry = remoteEntry.entry;
+          entries.get(entry.id).onsuccess = event => {
+            if (event.target.result) {
+              remotes.put({
+                remoteId: options.remoteId,
+                entryId: remoteEntry.entry.id,
+                sequence: remoteEntry.remoteSequence
+              });
+              handleNext(iterator.next());
+              return;
+            }
+            uncommitted.push(entry);
+            uncommittedRemotes.push(remoteEntry);
+            handleNext(iterator.next());
+          };
+        };
+        handleNext(iterator.next());
+        tx.oncomplete = () => resume(Effect.void);
+        tx.onerror = () => resume(Effect.fail(new EventJournalError({
+          method: "writeFromRemote",
+          cause: tx.error
+        })));
+        return Effect.sync(() => tx.abort());
+      });
+      const brackets = options.compact ? yield* options.compact(uncommittedRemotes) : [[uncommitted, uncommittedRemotes]];
+      for (const [compacted, remoteEntries] of brackets) {
+        for (const originEntry of compacted) {
+          const conflicts = [];
+          yield* Effect.async(resume => {
+            const tx = db.transaction("entries", "readonly");
+            const entries = tx.objectStore("entries");
+            const cursorRequest = entries.index("id").openCursor(IDBKeyRange.lowerBound(originEntry.id, true), "next");
+            cursorRequest.onsuccess = () => {
+              const cursor = cursorRequest.result;
+              if (!cursor) return;
+              const decodedEntry = decodeEntryIdb(cursor.value);
+              if (decodedEntry.event === originEntry.event && decodedEntry.primaryKey === originEntry.primaryKey) {
+                conflicts.push(decodedEntry);
+              }
+              cursor.continue();
+            };
+            tx.oncomplete = () => resume(Effect.void);
+            tx.onerror = () => resume(Effect.fail(new EventJournalError({
+              method: "writeFromRemote",
+              cause: tx.error
+            })));
+            return Effect.sync(() => tx.abort());
+          });
+          yield* options.effect({
+            entry: originEntry,
+            conflicts
+          });
+        }
+        yield* Effect.async(resume => {
+          const tx = db.transaction(["entries", "remotes"], "readwrite");
+          const entries = tx.objectStore("entries");
+          const remotes = tx.objectStore("remotes");
+          for (const remoteEntry of remoteEntries) {
+            entries.add(encodeEntryIdb(remoteEntry.entry));
+            remotes.put({
+              remoteId: options.remoteId,
+              entryId: remoteEntry.entry.id,
+              sequence: remoteEntry.remoteSequence
+            });
+          }
+          tx.oncomplete = () => resume(Effect.void);
+          tx.onerror = () => resume(Effect.fail(new EventJournalError({
+            method: "writeFromRemote",
+            cause: tx.error
+          })));
+          return Effect.sync(() => tx.abort());
+        });
+      }
+    }),
+    withRemoteUncommited: (remoteId, f) => Effect.async(resume => {
+      const entries = [];
+      const tx = db.transaction(["entries", "remotes", "remoteEntryId"], "readwrite");
+      const entriesStore = tx.objectStore("entries");
+      const remotesStore = tx.objectStore("remotes");
+      const remoteEntryIdStore = tx.objectStore("remoteEntryId");
+      remoteEntryIdStore.get(remoteId).onsuccess = event => {
+        const startEntryId = event.target.result?.entryId;
+        const entryCursor = entriesStore.index("id").openCursor(startEntryId ? IDBKeyRange.lowerBound(startEntryId, true) : null, "next");
+        entryCursor.onsuccess = () => {
+          const cursor = entryCursor.result;
+          if (!cursor) return;
+          const entry = decodeEntryIdb(cursor.value);
+          remotesStore.get([remoteId, entry.id]).onsuccess = event => {
+            if (!event.target.result) entries.push(entry);
+            cursor.continue();
+          };
+        };
+      };
+      tx.oncomplete = () => resume(Effect.succeed(entries));
+      tx.onerror = () => resume(Effect.fail(new EventJournalError({
+        method: "withRemoteUncommited",
+        cause: tx.error
+      })));
+      return Effect.sync(() => tx.abort());
+    }).pipe(Effect.flatMap(entries => {
+      if (entries.length === 0) return f(entries);
+      const entryId = entries[entries.length - 1].id;
+      return Effect.uninterruptibleMask(restore => restore(f(entries)).pipe(Effect.zipLeft(idbReq("withRemoteUncommited", () => db.transaction("remoteEntryId", "readwrite").objectStore("remoteEntryId").put({
+        remoteId,
+        entryId
+      })))));
+    })),
+    nextRemoteSequence: remoteId => Effect.async(resume => {
+      const tx = db.transaction("remotes", "readonly");
+      let sequence = 0;
+      const cursorRequest = tx.objectStore("remotes").index("sequence").openCursor(IDBKeyRange.bound([remoteId, 0], [remoteId, Infinity]), "prev");
+      cursorRequest.onsuccess = () => {
+        const cursor = cursorRequest.result;
+        if (!cursor) return;
+        sequence = cursor.value.sequence + 1;
+      };
+      tx.oncomplete = () => resume(Effect.succeed(sequence));
+      tx.onerror = () => resume(Effect.fail(new EventJournalError({
+        method: "nextRemoteSequence",
+        cause: tx.error
+      })));
+      return Effect.sync(() => tx.abort());
+    }),
+    changes: PubSub.subscribe(pubsub),
+    destroy: Effect.sync(() => {
+      indexedDB.deleteDatabase(database);
+    })
+  });
+});
+const decodeEntryIdb = /*#__PURE__*/Schema.decodeSync(Entry);
+const encodeEntryIdb = /*#__PURE__*/Schema.encodeSync(Entry);
+const EntryIdbArray = /*#__PURE__*/Schema.Array(Entry);
+const decodeEntryIdbArray = /*#__PURE__*/Schema.decodeUnknown(EntryIdbArray);
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export const layerIndexedDb = options => Layer.scoped(EventJournal, makeIndexedDb(options));
+const idbReq = (method, evaluate) => Effect.async(resume => {
+  const request = evaluate();
+  if (request.readyState === "done") {
+    resume(Effect.succeed(request.result));
+    return;
+  }
+  request.onsuccess = () => resume(Effect.succeed(request.result));
+  request.onerror = () => resume(Effect.fail(new EventJournalError({
+    method,
+    cause: request.error
+  })));
+});
+//# sourceMappingURL=EventJournal.js.map
\ No newline at end of file
diff --git a/dist/esm/EventJournal.js.map b/dist/esm/EventJournal.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..1efab804187e35f63c1aec39ad8ccee6335ff223
--- /dev/null
+++ b/dist/esm/EventJournal.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventJournal.js","names":["MsgPack","Context","DateTime","Effect","Layer","PubSub","Schema","Uuid","EventJournal","Tag","ErrorTypeId","Symbol","for","EventJournalError","TaggedClass","method","String","cause","Defect","RemoteIdTypeId","RemoteId","Uint8ArrayFromSelf","pipe","brand","makeRemoteId","v4","Uint8Array","EntryIdTypeId","EntryId","makeEntryId","options","v7","entryIdMillis","entryId","bytes","set","subarray","Number","DataView","buffer","getBigUint64","Entry","Class","id","event","primaryKey","payload","arrayMsgPack","Array","schema","encodeArray","encode","decodeArray","decode","idString","stringify","createdAtMillis","createdAt","unsafeMake","RemoteEntry","remoteSequence","entry","makeMemory","gen","journal","byId","Map","remotes","pubsub","unbounded","ensureRemote","remoteId","remoteIdString","remote","get","sequence","missing","slice","of","entries","sync","write","effect","acquireUseRelease","disableValidation","exit","suspend","_tag","has","void","push","forEach","publish","writeFromRemote","uncommittedRemotes","uncommitted","remoteEntry","brackets","compact","compacted","remoteEntries","originEntry","entryMillis","conflicts","i","length","undefined","j","sort","a","b","withRemoteUncommited","f","last","nextRemoteSequence","changes","subscribe","destroy","clear","layerMemory","makeIndexedDb","database","openRequest","indexedDB","open","onupgradeneeded","db","result","createObjectStore","keyPath","createIndex","unique","remoteEntryId","acquireRelease","idbReq","close","transaction","objectStore","index","getAll","flatMap","_","decodeEntryIdbArray","mapError","uninterruptibleMask","restore","zipLeft","put","encodeEntryIdb","async","resume","tx","iterator","handleNext","state","done","value","onsuccess","target","next","oncomplete","onerror","fail","error","abort","cursorRequest","openCursor","IDBKeyRange","lowerBound","cursor","decodedEntry","decodeEntryIdb","continue","add","entriesStore","remotesStore","remoteEntryIdStore","startEntryId","entryCursor","succeed","bound","Infinity","deleteDatabase","decodeSync","encodeSync","EntryIdbArray","decodeUnknown","layerIndexedDb","scoped","evaluate","request","readyState"],"sources":["../../src/EventJournal.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLog.js b/dist/esm/EventLog.js
new file mode 100644
index 0000000000000000000000000000000000000000..ef79bc2fe03bcfa6c41f1995af789fbd339a1a82
--- /dev/null
+++ b/dist/esm/EventLog.js
@@ -0,0 +1,374 @@
+/**
+ * @since 1.0.0
+ */
+import * as Chunk from "effect/Chunk";
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as FiberMap from "effect/FiberMap";
+import * as FiberRef from "effect/FiberRef";
+import { identity } from "effect/Function";
+import * as Layer from "effect/Layer";
+import { pipeArguments } from "effect/Pipeable";
+import * as Predicate from "effect/Predicate";
+import * as Queue from "effect/Queue";
+import * as Schema from "effect/Schema";
+import { Entry, EventJournal, makeEntryId } from "./EventJournal.js";
+import * as Reactivity from "./Reactivity.js";
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const SchemaTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventLog/EventLogSchema");
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const isEventLogSchema = u => Predicate.hasProperty(u, SchemaTypeId);
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const schema = (...groups) => {
+  function EventLog() {}
+  EventLog[SchemaTypeId] = SchemaTypeId;
+  EventLog.groups = groups;
+  return EventLog;
+};
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export const HandlersTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/EventLog/Handlers");
+const handlersProto = {
+  [HandlersTypeId]: {
+    _Endpoints: identity
+  },
+  handle(tag, handler) {
+    return makeHandlers({
+      group: this.group,
+      context: this.context,
+      handlers: {
+        ...this.handlers,
+        [tag]: {
+          event: this.group.events[tag],
+          context: this.context,
+          handler
+        }
+      }
+    });
+  },
+  pipe() {
+    return pipeArguments(this, arguments);
+  }
+};
+const makeHandlers = options => Object.assign(Object.create(handlersProto), options);
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export const group = (group, f) => Effect.gen(function* () {
+  const context = yield* Effect.context();
+  const result = f(makeHandlers({
+    group: group,
+    handlers: {},
+    context
+  }));
+  const handlers = Effect.isEffect(result) ? yield* result : result;
+  const registry = yield* Registry;
+  yield* registry.add(handlers);
+}).pipe(Layer.scopedDiscard, Layer.provide(Registry.layer));
+/**
+ * @since 1.0.0
+ * @category compaction
+ */
+export const groupCompaction = (group, effect) => Effect.gen(function* () {
+  const log = yield* EventLog;
+  const context = yield* Effect.context();
+  yield* log.registerCompaction({
+    events: Object.keys(group.events),
+    effect: Effect.fnUntraced(function* ({
+      entries,
+      write
+    }) {
+      const writePayload = (timestamp, tag, payload) => Effect.gen(function* () {
+        const event = group.events[tag];
+        const entry = new Entry({
+          id: makeEntryId({
+            msecs: timestamp
+          }),
+          event: tag,
+          payload: yield* Schema.encode(event.payloadMsgPack)(payload).pipe(Effect.locally(FiberRef.currentContext, context), Effect.orDie),
+          primaryKey: event.primaryKey(payload)
+        }, {
+          disableValidation: true
+        });
+        yield* write(entry);
+      });
+      const byPrimaryKey = new Map();
+      for (const entry of entries) {
+        const payload = yield* Schema.decodeUnknown(group.events[entry.event].payloadMsgPack)(entry.payload).pipe(Effect.locally(FiberRef.currentContext, context));
+        if (byPrimaryKey.has(entry.primaryKey)) {
+          const record = byPrimaryKey.get(entry.primaryKey);
+          record.entries.push(entry);
+          record.taggedPayloads.push({
+            _tag: entry.event,
+            payload
+          });
+        } else {
+          byPrimaryKey.set(entry.primaryKey, {
+            entries: [entry],
+            taggedPayloads: [{
+              _tag: entry.event,
+              payload
+            }]
+          });
+        }
+      }
+      for (const [primaryKey, {
+        entries,
+        taggedPayloads
+      }] of byPrimaryKey) {
+        yield* effect({
+          primaryKey,
+          entries,
+          events: taggedPayloads,
+          write(tag, payload) {
+            return writePayload(entries[0].createdAtMillis, tag, payload);
+          }
+        }).pipe(Effect.locally(FiberRef.currentContext, context));
+      }
+    })
+  });
+}).pipe(Layer.scopedDiscard);
+/**
+ * @since 1.0.0
+ * @category reactivity
+ */
+export const groupReactivity = (group, keys) => Effect.gen(function* () {
+  const log = yield* EventLog;
+  if (!Array.isArray(keys)) {
+    yield* log.registerReactivity(keys);
+    return;
+  }
+  const obj = {};
+  for (const tag in group.events) {
+    obj[tag] = keys;
+  }
+  yield* log.registerReactivity(obj);
+}).pipe(Layer.scopedDiscard);
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export class Registry extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/Registry")() {
+  /**
+   * @since 1.0.0
+   */
+  static layer = /*#__PURE__*/Layer.sync(Registry, () => {
+    const items = {};
+    return {
+      add: handlers => Effect.sync(() => {
+        for (const tag in handlers.handlers) {
+          items[tag] = handlers.handlers[tag];
+        }
+      }),
+      handlers: Effect.sync(() => items)
+    };
+  });
+}
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class Identity extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/Identity")() {}
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class EventLog extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLog/EventLog")() {}
+const make = /*#__PURE__*/Effect.gen(function* () {
+  const identity = yield* Identity;
+  const registry = yield* Registry;
+  const journal = yield* EventJournal;
+  const handlers = yield* registry.handlers;
+  const remotes = yield* FiberMap.make();
+  const compactors = new Map();
+  const journalSemaphore = yield* Effect.makeSemaphore(1);
+  const reactivity = yield* Reactivity.Reactivity;
+  const reactivityKeys = {};
+  const runRemote = remote => Effect.gen(function* () {
+    const startSequence = yield* journal.nextRemoteSequence(remote.id);
+    const changes = yield* remote.changes(identity, startSequence);
+    yield* changes.takeAll.pipe(Effect.flatMap(([entries]) => journal.writeFromRemote({
+      remoteId: remote.id,
+      entries: Chunk.toReadonlyArray(entries),
+      compact: compactors.size > 0 ? remoteEntries => Effect.gen(function* () {
+        let unprocessed = remoteEntries;
+        const brackets = [];
+        let uncompacted = [];
+        let uncompactedRemote = [];
+        while (true) {
+          let i = 0;
+          for (; i < unprocessed.length; i++) {
+            const remoteEntry = unprocessed[i];
+            if (!compactors.has(remoteEntry.entry.event)) {
+              uncompacted.push(remoteEntry.entry);
+              uncompactedRemote.push(remoteEntry);
+              continue;
+            }
+            if (uncompacted.length > 0) {
+              brackets.push([uncompacted, uncompactedRemote]);
+              uncompacted = [];
+              uncompactedRemote = [];
+            }
+            const compactor = compactors.get(remoteEntry.entry.event);
+            const entry = remoteEntry.entry;
+            const entries = [entry];
+            const remoteEntries = [remoteEntry];
+            const compacted = [];
+            const currentEntries = unprocessed;
+            unprocessed = [];
+            for (let j = i + 1; j < currentEntries.length; j++) {
+              const nextRemoteEntry = currentEntries[j];
+              if (!compactor.events.has(nextRemoteEntry.entry.event)) {
+                unprocessed.push(nextRemoteEntry);
+                continue;
+              }
+              entries.push(nextRemoteEntry.entry);
+              remoteEntries.push(nextRemoteEntry);
+            }
+            yield* compactor.effect({
+              entries,
+              write(entry) {
+                return Effect.sync(() => {
+                  compacted.push(entry);
+                });
+              }
+            });
+            brackets.push([compacted, remoteEntries]);
+            break;
+          }
+          if (i === unprocessed.length) {
+            brackets.push([unprocessed.map(_ => _.entry), unprocessed]);
+            break;
+          }
+        }
+        return brackets;
+      }) : undefined,
+      effect: ({
+        conflicts,
+        entry
+      }) => {
+        const handler = handlers[entry.event];
+        if (!handler) return Effect.logDebug(`Event handler not found for: "${entry.event}"`);
+        const decodePayload = Schema.decode(handlers[entry.event].event.payloadMsgPack);
+        return Effect.gen(function* () {
+          const decodedConflicts = new Array(conflicts.length);
+          for (let i = 0; i < conflicts.length; i++) {
+            decodedConflicts[i] = {
+              entry: conflicts[i],
+              payload: yield* decodePayload(conflicts[i].payload)
+            };
+          }
+          yield* handler.handler({
+            payload: yield* decodePayload(entry.payload),
+            entry,
+            conflicts: decodedConflicts
+          });
+          if (reactivityKeys[entry.event]) {
+            for (const key of reactivityKeys[entry.event]) {
+              reactivity.unsafeInvalidate({
+                [key]: [entry.primaryKey]
+              });
+            }
+          }
+        }).pipe(Effect.catchAllCause(Effect.log), Effect.annotateLogs({
+          service: "EventLog",
+          effect: "writeFromRemote",
+          entryId: entry.idString
+        }));
+      }
+    }).pipe(journalSemaphore.withPermits(1))), Effect.catchAllCause(Effect.log), Effect.forever, Effect.annotateLogs({
+      service: "EventLog",
+      effect: "runRemote consume"
+    }), Effect.fork);
+    const write = journal.withRemoteUncommited(remote.id, entries => remote.write(identity, entries));
+    yield* Effect.addFinalizer(() => Effect.ignore(write));
+    yield* write;
+    yield* Queue.takeBetween(yield* journal.changes, 1, Number.MAX_SAFE_INTEGER).pipe(Effect.zipRight(Effect.sleep(500)), Effect.zipRight(write), Effect.catchAllCause(Effect.log), Effect.forever);
+  }).pipe(Effect.scoped, Effect.provideService(Identity, identity), Effect.interruptible);
+  return EventLog.of({
+    write: options => {
+      const handler = handlers[options.event];
+      if (handler === undefined) {
+        return Effect.die(`Event handler not found for: "${options.event}"`);
+      }
+      return Effect.gen(function* () {
+        const payload = yield* Effect.orDie(Schema.encode(handlers[options.event].event.payloadMsgPack)(options.payload));
+        return yield* journalSemaphore.withPermits(1)(journal.write({
+          event: options.event,
+          primaryKey: handler.event.primaryKey(options.payload),
+          payload,
+          effect: entry => Effect.tap(handler.handler({
+            payload: options.payload,
+            entry,
+            conflicts: []
+          }), () => {
+            if (reactivityKeys[entry.event]) {
+              for (const key of reactivityKeys[entry.event]) {
+                reactivity.unsafeInvalidate({
+                  [key]: [entry.primaryKey]
+                });
+              }
+            }
+          })
+        }));
+      }).pipe(Effect.mapInputContext(context => Context.merge(handler.context, context)));
+    },
+    entries: journal.entries,
+    registerRemote: remote => Effect.gen(function* () {
+      yield* Effect.acquireRelease(FiberMap.run(remotes, remote.id, runRemote(remote)), () => FiberMap.remove(remotes, remote.id));
+    }),
+    registerCompaction: options => Effect.acquireRelease(Effect.sync(() => {
+      const events = new Set(options.events);
+      const compactor = {
+        events,
+        effect: options.effect
+      };
+      for (const event of options.events) {
+        compactors.set(event, compactor);
+      }
+    }), () => Effect.sync(() => {
+      for (const event of options.events) {
+        compactors.delete(event);
+      }
+    })),
+    registerReactivity: keys => Effect.sync(() => {
+      Object.assign(reactivityKeys, keys);
+    }),
+    destroy: journal.destroy
+  });
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerEventLog = /*#__PURE__*/Layer.scoped(EventLog, make).pipe( /*#__PURE__*/Layer.provide([Registry.layer, Reactivity.layer]));
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layer = _schema => layerEventLog;
+/**
+ * @since 1.0.0
+ * @category client
+ */
+export const makeClient = schema => Effect.gen(function* () {
+  const log = yield* EventLog;
+  return (event, payload) => log.write({
+    schema,
+    event,
+    payload
+  });
+});
+//# sourceMappingURL=EventLog.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLog.js.map b/dist/esm/EventLog.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..84df397ae859347ecb8d06ea1a096f585374af24
--- /dev/null
+++ b/dist/esm/EventLog.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLog.js","names":["Chunk","Context","Effect","FiberMap","FiberRef","identity","Layer","pipeArguments","Predicate","Queue","Schema","Entry","EventJournal","makeEntryId","Reactivity","SchemaTypeId","Symbol","for","isEventLogSchema","u","hasProperty","schema","groups","EventLog","HandlersTypeId","handlersProto","_Endpoints","handle","tag","handler","makeHandlers","group","context","handlers","event","events","pipe","arguments","options","Object","assign","create","f","gen","result","isEffect","registry","Registry","add","scopedDiscard","provide","layer","groupCompaction","effect","log","registerCompaction","keys","fnUntraced","entries","write","writePayload","timestamp","payload","entry","id","msecs","encode","payloadMsgPack","locally","currentContext","orDie","primaryKey","disableValidation","byPrimaryKey","Map","decodeUnknown","has","record","get","push","taggedPayloads","_tag","set","createdAtMillis","groupReactivity","Array","isArray","registerReactivity","obj","Tag","sync","items","Identity","make","journal","remotes","compactors","journalSemaphore","makeSemaphore","reactivity","reactivityKeys","runRemote","remote","startSequence","nextRemoteSequence","changes","takeAll","flatMap","writeFromRemote","remoteId","toReadonlyArray","compact","size","remoteEntries","unprocessed","brackets","uncompacted","uncompactedRemote","i","length","remoteEntry","compactor","compacted","currentEntries","j","nextRemoteEntry","map","_","undefined","conflicts","logDebug","decodePayload","decode","decodedConflicts","key","unsafeInvalidate","catchAllCause","annotateLogs","service","entryId","idString","withPermits","forever","fork","withRemoteUncommited","addFinalizer","ignore","takeBetween","Number","MAX_SAFE_INTEGER","zipRight","sleep","scoped","provideService","interruptible","of","die","tap","mapInputContext","merge","registerRemote","acquireRelease","run","remove","Set","delete","destroy","layerEventLog","_schema","makeClient"],"sources":["../../src/EventLog.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLogEncryption.js b/dist/esm/EventLogEncryption.js
new file mode 100644
index 0000000000000000000000000000000000000000..060e510b42712cfb731bacf6a261ca31d145d26b
--- /dev/null
+++ b/dist/esm/EventLogEncryption.js
@@ -0,0 +1,88 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Layer from "effect/Layer";
+import * as Redacted from "effect/Redacted";
+import * as Schema from "effect/Schema";
+import { Entry, EntryId, RemoteEntry } from "./EventJournal.js";
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export const EncryptedEntry = /*#__PURE__*/Schema.Struct({
+  entryId: EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+});
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export const EncryptedRemoteEntry = /*#__PURE__*/Schema.Struct({
+  sequence: Schema.Number,
+  iv: Schema.Uint8ArrayFromSelf,
+  entryId: EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+});
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export class EventLogEncryption extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLogEncryption")() {}
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export const makeEncryptionSubtle = crypto => Effect.sync(() => {
+  const keyCache = new WeakMap();
+  const getKey = identity => Effect.suspend(() => {
+    if (keyCache.has(identity)) {
+      return Effect.succeed(keyCache.get(identity));
+    }
+    return Effect.promise(() => crypto.subtle.importKey("raw", Redacted.value(identity.privateKey), "AES-GCM", true, ["encrypt", "decrypt"])).pipe(Effect.tap(key => {
+      keyCache.set(identity, key);
+    }));
+  });
+  return EventLogEncryption.of({
+    encrypt: (identity, entries) => Effect.gen(function* () {
+      const data = yield* Effect.orDie(Entry.encodeArray(entries));
+      const key = yield* getKey(identity);
+      const iv = crypto.getRandomValues(new Uint8Array(12));
+      const encryptedEntries = yield* Effect.promise(() => Promise.all(data.map(entry => crypto.subtle.encrypt({
+        name: "AES-GCM",
+        iv,
+        tagLength: 128
+      }, key, entry))));
+      return {
+        iv,
+        encryptedEntries: encryptedEntries.map(entry => new Uint8Array(entry))
+      };
+    }),
+    decrypt: (identity, entries) => Effect.gen(function* () {
+      const key = yield* getKey(identity);
+      const decryptedData = (yield* Effect.promise(() => Promise.all(entries.map(data => crypto.subtle.decrypt({
+        name: "AES-GCM",
+        iv: data.iv,
+        tagLength: 128
+      }, key, data.encryptedEntry))))).map(buffer => new Uint8Array(buffer));
+      const decoded = yield* Effect.orDie(Entry.decodeArray(decryptedData));
+      return decoded.map((entry, i) => new RemoteEntry({
+        remoteSequence: entries[i].sequence,
+        entry
+      }));
+    }),
+    sha256: data => Effect.promise(() => crypto.subtle.digest("SHA-256", data)).pipe(Effect.map(hash => new Uint8Array(hash))),
+    sha256String: data => Effect.map(Effect.promise(() => crypto.subtle.digest("SHA-256", data)), hash => {
+      const hashArray = Array.from(new Uint8Array(hash));
+      const hashHex = hashArray.map(bytes => bytes.toString(16).padStart(2, "0")).join("");
+      return hashHex;
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export const layerSubtle = /*#__PURE__*/Layer.suspend(() => Layer.effect(EventLogEncryption, makeEncryptionSubtle(globalThis.crypto)));
+//# sourceMappingURL=EventLogEncryption.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLogEncryption.js.map b/dist/esm/EventLogEncryption.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..ab8cb595fc8fca099f4c7457202240f12c7d69bc
--- /dev/null
+++ b/dist/esm/EventLogEncryption.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogEncryption.js","names":["Context","Effect","Layer","Redacted","Schema","Entry","EntryId","RemoteEntry","EncryptedEntry","Struct","entryId","encryptedEntry","Uint8ArrayFromSelf","EncryptedRemoteEntry","sequence","Number","iv","EventLogEncryption","Tag","makeEncryptionSubtle","crypto","sync","keyCache","WeakMap","getKey","identity","suspend","has","succeed","get","promise","subtle","importKey","value","privateKey","pipe","tap","key","set","of","encrypt","entries","gen","data","orDie","encodeArray","getRandomValues","Uint8Array","encryptedEntries","Promise","all","map","entry","name","tagLength","decrypt","decryptedData","buffer","decoded","decodeArray","i","remoteSequence","sha256","digest","hash","sha256String","hashArray","Array","from","hashHex","bytes","toString","padStart","join","layerSubtle","effect","globalThis"],"sources":["../../src/EventLogEncryption.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLogRemote/Node.js b/dist/esm/EventLogRemote/Node.js
new file mode 100644
index 0000000000000000000000000000000000000000..5277e2cceeb2b6e6eab2669c168041000c4a92f4
--- /dev/null
+++ b/dist/esm/EventLogRemote/Node.js
@@ -0,0 +1,13 @@
+/**
+ * @since 1.0.0
+ */
+import * as NodeSocket from "@effect/platform-node/NodeSocket";
+import * as Layer from "effect/Layer";
+import * as EventLogEncryption from "../EventLogEncryption.js";
+import * as EventLogRemote from "../EventLogRemote.js";
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocket = url => EventLogRemote.layerWebSocket(url).pipe(Layer.provide([EventLogEncryption.layerSubtle, NodeSocket.layerWebSocketConstructor]));
+//# sourceMappingURL=Node.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLogRemote/Node.js.map b/dist/esm/EventLogRemote/Node.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..b2f9aa9c06f095858b8a5d3579974968eb1b7ed5
--- /dev/null
+++ b/dist/esm/EventLogRemote/Node.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Node.js","names":["NodeSocket","Layer","EventLogEncryption","EventLogRemote","layerWebSocket","url","pipe","provide","layerSubtle","layerWebSocketConstructor"],"sources":["../../../src/EventLogRemote/Node.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,UAAU,MAAM,kCAAkC;AAC9D,OAAO,KAAKC,KAAK,MAAM,cAAc;AAErC,OAAO,KAAKC,kBAAkB,MAAM,0BAA0B;AAC9D,OAAO,KAAKC,cAAc,MAAM,sBAAsB;AAEtD;;;;AAIA,OAAO,MAAMC,cAAc,GACzBC,GAAW,IAEXF,cAAc,CAACC,cAAc,CAACC,GAAG,CAAC,CAACC,IAAI,CACrCL,KAAK,CAACM,OAAO,CAAC,CAACL,kBAAkB,CAACM,WAAW,EAAER,UAAU,CAACS,yBAAyB,CAAC,CAAC,CACtF","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLogRemote.js b/dist/esm/EventLogRemote.js
new file mode 100644
index 0000000000000000000000000000000000000000..e6ef466369b3357585c0bfe5f94233d8f82c7bed
--- /dev/null
+++ b/dist/esm/EventLogRemote.js
@@ -0,0 +1,339 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Socket from "@effect/platform/Socket";
+import * as Deferred from "effect/Deferred";
+import * as Effect from "effect/Effect";
+import * as Exit from "effect/Exit";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import * as RcMap from "effect/RcMap";
+import * as Schedule from "effect/Schedule";
+import * as Schema from "effect/Schema";
+import * as Scope from "effect/Scope";
+import { RemoteEntry, RemoteId } from "./EventJournal.js";
+import { EventLog } from "./EventLog.js";
+import { EncryptedEntry, EncryptedRemoteEntry, EventLogEncryption, layerSubtle } from "./EventLogEncryption.js";
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Hello extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Hello")("Hello", {
+  remoteId: RemoteId
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class ChunkedMessage extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/ChunkedMessage")("ChunkedMessage", {
+  id: Schema.Number,
+  part: /*#__PURE__*/Schema.Tuple(Schema.Number, Schema.Number),
+  data: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static split(id, data) {
+    const parts = Math.ceil(data.byteLength / constChunkSize);
+    const result = new Array(parts);
+    for (let i = 0; i < parts; i++) {
+      const start = i * constChunkSize;
+      const end = Math.min((i + 1) * constChunkSize, data.byteLength);
+      result[i] = new ChunkedMessage({
+        id,
+        part: [i, parts],
+        data: data.subarray(start, end)
+      });
+    }
+    return result;
+  }
+  /**
+   * @since 1.0.0
+   */
+  static join(map, part) {
+    const [index, total] = part.part;
+    let entry = map.get(part.id);
+    if (!entry) {
+      entry = {
+        parts: new Array(total),
+        count: 0,
+        bytes: 0
+      };
+      map.set(part.id, entry);
+    }
+    entry.parts[index] = part.data;
+    entry.count++;
+    entry.bytes += part.data.byteLength;
+    if (entry.count !== total) {
+      return;
+    }
+    const data = new Uint8Array(entry.bytes);
+    let offset = 0;
+    for (const part of entry.parts) {
+      data.set(part, offset);
+      offset += part.byteLength;
+    }
+    map.delete(part.id);
+    return data;
+  }
+}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class WriteEntries extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/WriteEntries")("WriteEntries", {
+  publicKey: Schema.String,
+  id: Schema.Number,
+  iv: Schema.Uint8ArrayFromSelf,
+  encryptedEntries: /*#__PURE__*/Schema.Array(EncryptedEntry)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Ack extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Ack")("Ack", {
+  id: Schema.Number,
+  sequenceNumbers: /*#__PURE__*/Schema.Array(Schema.Number)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class RequestChanges extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/RequestChanges")("RequestChanges", {
+  publicKey: Schema.String,
+  startSequence: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Changes extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Changes")("Changes", {
+  publicKey: Schema.String,
+  entries: /*#__PURE__*/Schema.Array(EncryptedRemoteEntry)
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class StopChanges extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/StopChanges")("StopChanges", {
+  publicKey: Schema.String
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Ping extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Ping")("Ping", {
+  id: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Pong extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/Pong")("Pong", {
+  id: Schema.Number
+}) {}
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolRequest = /*#__PURE__*/Schema.Union(WriteEntries, RequestChanges, StopChanges, ChunkedMessage, Ping);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolRequestMsgPack = /*#__PURE__*/MsgPack.schema(ProtocolRequest);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const decodeRequest = /*#__PURE__*/Schema.decodeSync(ProtocolRequestMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const encodeRequest = /*#__PURE__*/Schema.encodeSync(ProtocolRequestMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolResponse = /*#__PURE__*/Schema.Union(Hello, Ack, Changes, ChunkedMessage, Pong);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolResponseMsgPack = /*#__PURE__*/MsgPack.schema(ProtocolResponse);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const decodeResponse = /*#__PURE__*/Schema.decodeSync(ProtocolResponseMsgPack);
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const encodeResponse = /*#__PURE__*/Schema.encodeSync(ProtocolResponseMsgPack);
+/**
+ * @since 1.0.0
+ * @category change
+ */
+export class RemoteAdditions extends /*#__PURE__*/Schema.TaggedClass("@effect/experimental/EventLogRemote/RemoveAdditions")("RemoveAdditions", {
+  entries: /*#__PURE__*/Schema.Array(RemoteEntry)
+}) {}
+const constChunkSize = 512_000;
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export const fromSocket = options => Effect.gen(function* () {
+  const log = yield* EventLog;
+  const socket = yield* Socket.Socket;
+  const encryption = yield* EventLogEncryption;
+  const scope = yield* Effect.scope;
+  const writeRaw = yield* socket.writer;
+  function* writeGen(request) {
+    const data = encodeRequest(request);
+    if (request._tag !== "WriteEntries" || data.byteLength <= constChunkSize) {
+      return yield* writeRaw(data);
+    }
+    const id = request.id;
+    for (const part of ChunkedMessage.split(id, data)) {
+      yield* writeRaw(encodeRequest(part));
+    }
+  }
+  const write = request => Effect.gen(() => writeGen(request));
+  yield* Effect.gen(function* () {
+    let pendingCounter = 0;
+    const pending = new Map();
+    const chunks = new Map();
+    const subscriptions = yield* RcMap.make({
+      lookup: publicKey => Effect.acquireRelease(Mailbox.make(), mailbox => Effect.zipRight(mailbox.shutdown, Effect.ignoreLogged(write(new StopChanges({
+        publicKey
+      })))))
+    });
+    const identities = new WeakMap();
+    const badPing = yield* Deferred.make();
+    let latestPing = 0;
+    let latestPong = 0;
+    if (options?.disablePing !== true) {
+      yield* Effect.suspend(() => {
+        if (latestPing !== latestPong) {
+          return Deferred.fail(badPing, new Error("Ping timeout"));
+        }
+        return write(new Ping({
+          id: ++latestPing
+        }));
+      }).pipe(Effect.delay(10000), Effect.forever, Effect.fork, Effect.interruptible);
+    }
+    function handleMessage(res) {
+      switch (res._tag) {
+        case "Hello":
+          {
+            return log.registerRemote({
+              id: res.remoteId,
+              write: (identity, entries) => Effect.gen(function* () {
+                const encrypted = yield* encryption.encrypt(identity, entries);
+                const deferred = yield* Deferred.make();
+                const id = pendingCounter++;
+                pending.set(id, {
+                  entries,
+                  deferred,
+                  publicKey: identity.publicKey
+                });
+                yield* Effect.orDie(write(new WriteEntries({
+                  publicKey: identity.publicKey,
+                  id,
+                  iv: encrypted.iv,
+                  encryptedEntries: encrypted.encryptedEntries.map((encryptedEntry, i) => ({
+                    entryId: entries[i].id,
+                    encryptedEntry
+                  }))
+                })));
+                yield* Deferred.await(deferred);
+              }),
+              changes: (identity, startSequence) => Effect.gen(function* () {
+                const mailbox = yield* RcMap.get(subscriptions, identity.publicKey);
+                identities.set(mailbox, identity);
+                yield* Effect.orDie(write(new RequestChanges({
+                  publicKey: identity.publicKey,
+                  startSequence
+                })));
+                return mailbox;
+              })
+            }).pipe(Scope.extend(scope));
+          }
+        case "Ack":
+          {
+            return Effect.gen(function* () {
+              const entry = pending.get(res.id);
+              if (!entry) return;
+              pending.delete(res.id);
+              const {
+                deferred,
+                entries,
+                publicKey
+              } = entry;
+              const remoteEntries = res.sequenceNumbers.map((sequenceNumber, i) => {
+                const entry = entries[i];
+                return new RemoteEntry({
+                  remoteSequence: sequenceNumber,
+                  entry
+                });
+              });
+              const mailbox = yield* RcMap.get(subscriptions, publicKey);
+              yield* mailbox.offerAll(remoteEntries);
+              yield* Deferred.done(deferred, Exit.void);
+            });
+          }
+        case "Pong":
+          {
+            latestPong = res.id;
+            if (res.id === latestPing) {
+              return;
+            }
+            return Effect.fail(new Error("Pong id mismatch"));
+          }
+        case "Changes":
+          {
+            return Effect.gen(function* () {
+              const mailbox = yield* RcMap.get(subscriptions, res.publicKey);
+              const identity = identities.get(mailbox);
+              const entries = yield* encryption.decrypt(identity, res.entries);
+              yield* mailbox.offerAll(entries);
+            }).pipe(Effect.scoped);
+          }
+        case "ChunkedMessage":
+          {
+            const data = ChunkedMessage.join(chunks, res);
+            if (!data) return;
+            return handleMessage(decodeResponse(data));
+          }
+      }
+    }
+    return yield* socket.run(data => handleMessage(decodeResponse(data))).pipe(Effect.raceFirst(Deferred.await(badPing)));
+  }).pipe(Effect.scoped, Effect.tapErrorCause(Effect.logDebug), Effect.retry({
+    schedule: Schedule.exponential(100).pipe(Schedule.union(Schedule.spaced(5000)))
+  }), Effect.annotateLogs({
+    service: "EventLogRemote",
+    method: "fromSocket"
+  }), Effect.forkScoped, Effect.interruptible);
+});
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export const fromWebSocket = (url, options) => Effect.gen(function* () {
+  const socket = yield* Socket.makeWebSocket(url);
+  return yield* fromSocket(options).pipe(Effect.provideService(Socket.Socket, socket));
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocket = (url, options) => Layer.scopedDiscard(fromWebSocket(url, options));
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocketBrowser = (url, options) => layerWebSocket(url, options).pipe(Layer.provide([layerSubtle, Socket.layerWebSocketConstructorGlobal]));
+//# sourceMappingURL=EventLogRemote.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLogRemote.js.map b/dist/esm/EventLogRemote.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..bc3c96eaa71fe6628de2658c6a1cba7d85383a84
--- /dev/null
+++ b/dist/esm/EventLogRemote.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogRemote.js","names":["MsgPack","Socket","Deferred","Effect","Exit","Layer","Mailbox","RcMap","Schedule","Schema","Scope","RemoteEntry","RemoteId","EventLog","EncryptedEntry","EncryptedRemoteEntry","EventLogEncryption","layerSubtle","Hello","TaggedClass","remoteId","ChunkedMessage","id","Number","part","Tuple","data","Uint8ArrayFromSelf","split","parts","Math","ceil","byteLength","constChunkSize","result","Array","i","start","end","min","subarray","join","map","index","total","entry","get","count","bytes","set","Uint8Array","offset","delete","WriteEntries","publicKey","String","iv","encryptedEntries","Ack","sequenceNumbers","RequestChanges","startSequence","Changes","entries","StopChanges","Ping","Pong","ProtocolRequest","Union","ProtocolRequestMsgPack","schema","decodeRequest","decodeSync","encodeRequest","encodeSync","ProtocolResponse","ProtocolResponseMsgPack","decodeResponse","encodeResponse","RemoteAdditions","fromSocket","options","gen","log","socket","encryption","scope","writeRaw","writer","writeGen","request","_tag","write","pendingCounter","pending","Map","chunks","subscriptions","make","lookup","acquireRelease","mailbox","zipRight","shutdown","ignoreLogged","identities","WeakMap","badPing","latestPing","latestPong","disablePing","suspend","fail","Error","pipe","delay","forever","fork","interruptible","handleMessage","res","registerRemote","identity","encrypted","encrypt","deferred","orDie","encryptedEntry","entryId","await","changes","extend","remoteEntries","sequenceNumber","remoteSequence","offerAll","done","void","decrypt","scoped","run","raceFirst","tapErrorCause","logDebug","retry","schedule","exponential","union","spaced","annotateLogs","service","method","forkScoped","fromWebSocket","url","makeWebSocket","provideService","layerWebSocket","scopedDiscard","layerWebSocketBrowser","provide","layerWebSocketConstructorGlobal"],"sources":["../../src/EventLogRemote.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLogServer/Cloudflare.js b/dist/esm/EventLogServer/Cloudflare.js
new file mode 100644
index 0000000000000000000000000000000000000000..ca53071d6331a0962d3563a9564ee4e869d16c2e
--- /dev/null
+++ b/dist/esm/EventLogServer/Cloudflare.js
@@ -0,0 +1,130 @@
+/**
+ * @since 1.0.0
+ */
+/// <reference types="@cloudflare/workers-types" />
+import { DurableObject } from "cloudflare:workers";
+import * as Cause from "effect/Cause";
+import * as Effect from "effect/Effect";
+import * as ManagedRuntime from "effect/ManagedRuntime";
+import { RemoteId } from "../EventJournal.js";
+import * as EventLogRemote from "../EventLogRemote.js";
+import * as EventLogServer from "../EventLogServer.js";
+/**
+ * @since 1.0.0
+ * @category DurableObject
+ */
+export class EventLogDurableObject extends DurableObject {
+  /**
+   * @since 1.0.0
+   */
+  runtime;
+  constructor(options) {
+    super(options.ctx, options.env);
+    this.ctx.setHibernatableWebSocketEventTimeout(5000);
+    this.runtime = ManagedRuntime.make(options.storageLayer);
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketMessage(ws, message) {
+    return this.handleRequest(ws, EventLogRemote.decodeRequest(message instanceof ArrayBuffer ? new Uint8Array(message) : new TextEncoder().encode(message)));
+  }
+  chunks = /*#__PURE__*/new Map();
+  /**
+   * @since 1.0.0
+   */
+  async handleRequest(ws, request) {
+    switch (request._tag) {
+      case "WriteEntries":
+        {
+          return Effect.gen(this, function* () {
+            const storage = yield* EventLogServer.Storage;
+            const entries = request.encryptedEntries.map(({
+              encryptedEntry,
+              entryId
+            }) => new EventLogServer.PersistedEntry({
+              entryId,
+              iv: request.iv,
+              encryptedEntry
+            }));
+            const encryptedEntries = yield* storage.write(request.publicKey, entries);
+            ws.send(EventLogRemote.encodeResponse(new EventLogRemote.Ack({
+              id: request.id,
+              sequenceNumbers: encryptedEntries.map(_ => _.sequence)
+            })));
+            const changes = this.encodeChanges(request.publicKey, encryptedEntries);
+            for (const peer of this.ctx.getWebSockets()) {
+              if (peer === ws) continue;
+              for (const change of changes) {
+                peer.send(change);
+              }
+            }
+          }).pipe(this.runtime.runPromise);
+        }
+      case "ChunkedMessage":
+        {
+          const data = EventLogRemote.ChunkedMessage.join(this.chunks, request);
+          if (!data) return;
+          return this.handleRequest(ws, EventLogRemote.decodeRequest(data));
+        }
+      case "RequestChanges":
+        {
+          return Effect.gen(this, function* () {
+            const storage = yield* EventLogServer.Storage;
+            const entries = yield* storage.entries(request.publicKey, request.startSequence);
+            if (entries.length === 0) return;
+            const changes = this.encodeChanges(request.publicKey, entries);
+            for (const change of changes) {
+              ws.send(change);
+            }
+          }).pipe(this.runtime.runPromise);
+        }
+    }
+  }
+  /**
+   * @since 1.0.0
+   */
+  encodeChanges(publicKey, entries) {
+    let changes = [EventLogRemote.encodeResponse(new EventLogRemote.Changes({
+      publicKey,
+      entries
+    }))];
+    if (changes[0].byteLength > 512_000) {
+      changes = EventLogRemote.ChunkedMessage.split(Math.floor(Math.random() * 1_000_000_000), changes[0]).map(_ => EventLogRemote.encodeResponse(_));
+    }
+    return changes;
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketError(_ws, error) {
+    this.runtime.runFork(Effect.logWarning(Cause.fail(error)));
+  }
+  /**
+   * @since 1.0.0
+   */
+  webSocketClose(_ws, code, reason) {
+    this.runtime.runFork(Effect.logWarning("WebSocket closed", {
+      code,
+      reason
+    }));
+  }
+  /**
+   * @since 1.0.0
+   */
+  async fetch() {
+    const webSocketPair = new WebSocketPair();
+    const [client, server] = Object.values(webSocketPair);
+    this.ctx.acceptWebSocket(server);
+    EventLogServer.Storage.pipe(Effect.flatMap(_ => _.getId), Effect.tap(remoteId => {
+      server.send(EventLogRemote.encodeResponse(new EventLogRemote.Hello({
+        remoteId: RemoteId.make(remoteId)
+      })));
+    }), this.runtime.runFork);
+    return new Response(null, {
+      status: 101,
+      webSocket: client
+    });
+  }
+}
+//# sourceMappingURL=Cloudflare.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLogServer/Cloudflare.js.map b/dist/esm/EventLogServer/Cloudflare.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..36c4ede46f167f579e2b37cf7cea687096f28293
--- /dev/null
+++ b/dist/esm/EventLogServer/Cloudflare.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Cloudflare.js","names":["DurableObject","Cause","Effect","ManagedRuntime","RemoteId","EventLogRemote","EventLogServer","EventLogDurableObject","runtime","constructor","options","ctx","env","setHibernatableWebSocketEventTimeout","make","storageLayer","webSocketMessage","ws","message","handleRequest","decodeRequest","ArrayBuffer","Uint8Array","TextEncoder","encode","chunks","Map","request","_tag","gen","storage","Storage","entries","encryptedEntries","map","encryptedEntry","entryId","PersistedEntry","iv","write","publicKey","send","encodeResponse","Ack","id","sequenceNumbers","_","sequence","changes","encodeChanges","peer","getWebSockets","change","pipe","runPromise","data","ChunkedMessage","join","startSequence","length","Changes","byteLength","split","Math","floor","random","webSocketError","_ws","error","runFork","logWarning","fail","webSocketClose","code","reason","fetch","webSocketPair","WebSocketPair","client","server","Object","values","acceptWebSocket","flatMap","getId","tap","remoteId","Hello","Response","status","webSocket"],"sources":["../../../src/EventLogServer/Cloudflare.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/EventLogServer.js b/dist/esm/EventLogServer.js
new file mode 100644
index 0000000000000000000000000000000000000000..e953dfc0287ec4a29fc99f31203a75ec02fc8433
--- /dev/null
+++ b/dist/esm/EventLogServer.js
@@ -0,0 +1,217 @@
+import * as HttpServerRequest from "@effect/platform/HttpServerRequest";
+import * as HttpServerResponse from "@effect/platform/HttpServerResponse";
+import * as MsgPack from "@effect/platform/MsgPack";
+import * as Chunk from "effect/Chunk";
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as FiberMap from "effect/FiberMap";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import * as PubSub from "effect/PubSub";
+import * as RcMap from "effect/RcMap";
+import * as Schema from "effect/Schema";
+import * as Uuid from "uuid";
+import { EntryId, makeRemoteId } from "./EventJournal.js";
+import { EncryptedRemoteEntry } from "./EventLogEncryption.js";
+import { Ack, Changes, ChunkedMessage, decodeRequest, encodeResponse, Hello, Pong } from "./EventLogRemote.js";
+const constChunkSize = 512_000;
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const makeHandler = /*#__PURE__*/Effect.gen(function* () {
+  const storage = yield* Storage;
+  const remoteId = yield* storage.getId;
+  let chunkId = 0;
+  function* handler(socket) {
+    const subscriptions = yield* FiberMap.make();
+    const writeRaw = yield* socket.writer;
+    const chunks = new Map();
+    let latestSequence = -1;
+    function* writeGen(response) {
+      const data = encodeResponse(response);
+      if (response._tag !== "Changes" || data.byteLength <= constChunkSize) {
+        return yield* writeRaw(data);
+      }
+      const id = chunkId++;
+      for (const part of ChunkedMessage.split(id, data)) {
+        yield* writeRaw(encodeResponse(part));
+      }
+    }
+    const write = response => Effect.gen(() => writeGen(response));
+    yield* Effect.fork(write(new Hello({
+      remoteId
+    })));
+    function handleRequest(request) {
+      switch (request._tag) {
+        case "Ping":
+          {
+            return write(new Pong({
+              id: request.id
+            }));
+          }
+        case "WriteEntries":
+          {
+            if (request.encryptedEntries.length === 0) {
+              return write(new Ack({
+                id: request.id,
+                sequenceNumbers: []
+              }));
+            }
+            return Effect.gen(function* () {
+              const entries = request.encryptedEntries.map(({
+                encryptedEntry,
+                entryId
+              }) => new PersistedEntry({
+                entryId,
+                iv: request.iv,
+                encryptedEntry
+              }));
+              const encrypted = yield* storage.write(request.publicKey, entries);
+              latestSequence = encrypted[encrypted.length - 1].sequence;
+              return yield* write(new Ack({
+                id: request.id,
+                sequenceNumbers: encrypted.map(e => e.sequence)
+              }));
+            });
+          }
+        case "RequestChanges":
+          {
+            return Effect.gen(function* () {
+              const changes = yield* storage.changes(request.publicKey, request.startSequence);
+              yield* changes.takeAll.pipe(Effect.flatMap(function ([entries]) {
+                const latestEntries = [];
+                for (const entry of entries) {
+                  if (entry.sequence <= latestSequence) continue;
+                  latestEntries.push(entry);
+                  latestSequence = entry.sequence;
+                }
+                if (latestEntries.length === 0) return Effect.void;
+                return write(new Changes({
+                  publicKey: request.publicKey,
+                  entries: Chunk.toReadonlyArray(entries)
+                }));
+              }), Effect.forever);
+            }).pipe(Effect.scoped, FiberMap.run(subscriptions, request.publicKey));
+          }
+        case "StopChanges":
+          {
+            return FiberMap.remove(subscriptions, request.publicKey);
+          }
+        case "ChunkedMessage":
+          {
+            const data = ChunkedMessage.join(chunks, request);
+            if (!data) return;
+            return handleRequest(decodeRequest(data));
+          }
+      }
+    }
+    yield* socket.run(data => handleRequest(decodeRequest(data))).pipe(Effect.catchAllCause(Effect.logDebug));
+  }
+  return socket => Effect.gen(() => handler(socket)).pipe(Effect.annotateLogs({
+    module: "EventLogServer"
+  }));
+});
+/**
+ * @since 1.0.0
+ * @category websockets
+ */
+export const makeHandlerHttp = /*#__PURE__*/Effect.gen(function* () {
+  const handler = yield* makeHandler;
+  return Effect.gen(function* () {
+    const request = yield* HttpServerRequest.HttpServerRequest;
+    const socket = yield* request.upgrade;
+    yield* handler(socket);
+    return HttpServerResponse.empty();
+  }).pipe(Effect.annotateLogs({
+    module: "EventLogServer"
+  }));
+});
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export class PersistedEntry extends /*#__PURE__*/Schema.Class("@effect/experimental/EventLogServer/PersistedEntry")({
+  entryId: EntryId,
+  iv: Schema.Uint8ArrayFromSelf,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static fromMsgPack = /*#__PURE__*/MsgPack.schema(PersistedEntry);
+  /**
+   * @since 1.0.0
+   */
+  static encode = /*#__PURE__*/Schema.encodeSync(this.fromMsgPack);
+  /**
+   * @since 1.0.0
+   */
+  get entryIdString() {
+    return Uuid.stringify(this.entryId);
+  }
+}
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export class Storage extends /*#__PURE__*/Context.Tag("@effect/experimental/EventLogServer/Storage")() {}
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export const makeStorageMemory = /*#__PURE__*/Effect.gen(function* () {
+  const knownIds = new Map();
+  const journals = new Map();
+  const remoteId = makeRemoteId();
+  const ensureJournal = publicKey => {
+    let journal = journals.get(publicKey);
+    if (journal) return journal;
+    journal = [];
+    journals.set(publicKey, journal);
+    return journal;
+  };
+  const pubsubs = yield* RcMap.make({
+    lookup: _publicKey => Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown),
+    idleTimeToLive: 60000
+  });
+  return Storage.of({
+    getId: Effect.succeed(remoteId),
+    write: (publicKey, entries) => Effect.gen(function* () {
+      const active = yield* RcMap.keys(pubsubs);
+      const pubsub = active.includes(publicKey) ? yield* RcMap.get(pubsubs, publicKey) : undefined;
+      const journal = ensureJournal(publicKey);
+      const encryptedEntries = [];
+      for (const entry of entries) {
+        const idString = entry.entryIdString;
+        if (knownIds.has(idString)) continue;
+        const encrypted = EncryptedRemoteEntry.make({
+          sequence: journal.length,
+          entryId: entry.entryId,
+          iv: entry.iv,
+          encryptedEntry: entry.encryptedEntry
+        });
+        encryptedEntries.push(encrypted);
+        knownIds.set(idString, encrypted.sequence);
+        journal.push(encrypted);
+        pubsub?.unsafeOffer(encrypted);
+      }
+      return encryptedEntries;
+    }).pipe(Effect.scoped),
+    entries: (publicKey, startSequence) => Effect.sync(() => ensureJournal(publicKey).slice(startSequence)),
+    changes: (publicKey, startSequence) => Effect.gen(function* () {
+      const mailbox = yield* Mailbox.make();
+      const pubsub = yield* RcMap.get(pubsubs, publicKey);
+      const queue = yield* pubsub.subscribe;
+      yield* mailbox.offerAll(ensureJournal(publicKey).slice(startSequence));
+      yield* queue.takeBetween(1, Number.MAX_SAFE_INTEGER).pipe(Effect.tap(chunk => mailbox.offerAll(chunk)), Effect.forever, Effect.forkScoped, Effect.interruptible);
+      return mailbox;
+    })
+  });
+});
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export const layerStorageMemory = /*#__PURE__*/Layer.scoped(Storage, makeStorageMemory);
+//# sourceMappingURL=EventLogServer.js.map
\ No newline at end of file
diff --git a/dist/esm/EventLogServer.js.map b/dist/esm/EventLogServer.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..514df91d5104632847c19bb3e328894f5ebdca0a
--- /dev/null
+++ b/dist/esm/EventLogServer.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"EventLogServer.js","names":["HttpServerRequest","HttpServerResponse","MsgPack","Chunk","Context","Effect","FiberMap","Layer","Mailbox","PubSub","RcMap","Schema","Uuid","EntryId","makeRemoteId","EncryptedRemoteEntry","Ack","Changes","ChunkedMessage","decodeRequest","encodeResponse","Hello","Pong","constChunkSize","makeHandler","gen","storage","Storage","remoteId","getId","chunkId","handler","socket","subscriptions","make","writeRaw","writer","chunks","Map","latestSequence","writeGen","response","data","_tag","byteLength","id","part","split","write","fork","handleRequest","request","encryptedEntries","length","sequenceNumbers","entries","map","encryptedEntry","entryId","PersistedEntry","iv","encrypted","publicKey","sequence","e","changes","startSequence","takeAll","pipe","flatMap","latestEntries","entry","push","void","toReadonlyArray","forever","scoped","run","remove","join","catchAllCause","logDebug","annotateLogs","module","makeHandlerHttp","upgrade","empty","Class","Uint8ArrayFromSelf","fromMsgPack","schema","encode","encodeSync","entryIdString","stringify","Tag","makeStorageMemory","knownIds","journals","ensureJournal","journal","get","set","pubsubs","lookup","_publicKey","acquireRelease","unbounded","shutdown","idleTimeToLive","of","succeed","active","keys","pubsub","includes","undefined","idString","has","unsafeOffer","sync","slice","mailbox","queue","subscribe","offerAll","takeBetween","Number","MAX_SAFE_INTEGER","tap","chunk","forkScoped","interruptible","layerStorageMemory"],"sources":["../../src/EventLogServer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Machine/Procedure.js.map b/dist/esm/Machine/Procedure.js.map
index 1a2bfb23b79e5baa27089aca3c10e02eb0da1907..c1fbacd7514748f0bdb4abcd714f1aa2bd46265f 100644
--- a/dist/esm/Machine/Procedure.js.map
+++ b/dist/esm/Machine/Procedure.js.map
@@ -1 +1 @@
-{"version":3,"file":"Procedure.js","names":["pipeArguments","Predicate","TypeId","Symbol","for","SerializableTypeId","isSerializable","u","hasProperty","NoReply","make","tag","handler","pipe","arguments","makeSerializable","schema","_tag"],"sources":["../../../src/Machine/Procedure.ts"],"sourcesContent":[null],"mappings":"AAOA,SAAwBA,aAAa,QAAQ,iBAAiB;AAC9D,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAG7C;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,wCAAwC,CAAC;AAwCzF;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAAkBF,MAAM,CAACC,GAAG,CAAC,oDAAoD,CAAC;AAQjH;;;;AAIA,OAAO,MAAME,cAAc,GAAIC,CAAU,IACvCN,SAAS,CAACO,WAAW,CAACD,CAAC,EAAEF,kBAAkB,CAAC;AAa9C;;;;AAIA,OAAO,MAAMI,OAAO,gBAAGN,MAAM,CAACC,GAAG,CAAC,gDAAgD,CAAC;AA0HnF;;;;AAIA,OAAO,MAAMM,IAAI,GAAGA,CAAA,KACpB,MACA,CACEC,GAAgB,EAChBC,OAAyC,MACX;EAC9B,CAACV,MAAM,GAAGA,MAAM;EAChBU,OAAO;EACPD,GAAG;EACHE,IAAIA,CAAA;IACF,OAAOb,aAAa,CAAC,IAAI,EAAEc,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAIA,OAAO,MAAMC,gBAAgB,GAAGA,CAAA,KAIhC,CAMEC,MAAmE,EACnEJ,OAAyC,MACoD;EAC7F,CAACV,MAAM,GAAGA,MAAM;EAChB,CAACG,kBAAkB,GAAGA,kBAAkB;EACxCW,MAAM,EAAEA,MAAa;EACrBJ,OAAO;EACPD,GAAG,EAAEK,MAAM,CAACC,IAAI;EAChBJ,IAAIA,CAAA;IACF,OAAOb,aAAa,CAAC,IAAI,EAAEc,SAAS,CAAC;EACvC;CACD,CAAC","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Procedure.js","names":["pipeArguments","Predicate","TypeId","Symbol","for","SerializableTypeId","isSerializable","u","hasProperty","NoReply","make","tag","handler","pipe","arguments","makeSerializable","schema","_tag"],"sources":["../../../src/Machine/Procedure.ts"],"sourcesContent":[null],"mappings":"AAKA,SAAwBA,aAAa,QAAQ,iBAAiB;AAC9D,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAI7C;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,wCAAwC,CAAC;AAwCzF;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAAkBF,MAAM,CAACC,GAAG,CAAC,oDAAoD,CAAC;AAQjH;;;;AAIA,OAAO,MAAME,cAAc,GAAIC,CAAU,IACvCN,SAAS,CAACO,WAAW,CAACD,CAAC,EAAEF,kBAAkB,CAAC;AAa9C;;;;AAIA,OAAO,MAAMI,OAAO,gBAAGN,MAAM,CAACC,GAAG,CAAC,gDAAgD,CAAC;AA0HnF;;;;AAIA,OAAO,MAAMM,IAAI,GAAGA,CAAA,KACpB,MACA,CACEC,GAAgB,EAChBC,OAAyC,MACX;EAC9B,CAACV,MAAM,GAAGA,MAAM;EAChBU,OAAO;EACPD,GAAG;EACHE,IAAIA,CAAA;IACF,OAAOb,aAAa,CAAC,IAAI,EAAEc,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAIA,OAAO,MAAMC,gBAAgB,GAAGA,CAAA,KAIhC,CAMEC,MAAmE,EACnEJ,OAAyC,MAC8C;EACvF,CAACV,MAAM,GAAGA,MAAM;EAChB,CAACG,kBAAkB,GAAGA,kBAAkB;EACxCW,MAAM,EAAEA,MAAa;EACrBJ,OAAO;EACPD,GAAG,EAAEK,MAAM,CAACC,IAAI;EAChBJ,IAAIA,CAAA;IACF,OAAOb,aAAa,CAAC,IAAI,EAAEc,SAAS,CAAC;EACvC;CACD,CAAC","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Machine/ProcedureList.js.map b/dist/esm/Machine/ProcedureList.js.map
index a4e104bd35439e901c6bbf69a3178890839105d0..5a5ea82539fd99be93f6187ce4392ab26c60f207 100644
--- a/dist/esm/Machine/ProcedureList.js.map
+++ b/dist/esm/Machine/ProcedureList.js.map
@@ -1 +1 @@
-{"version":3,"file":"ProcedureList.js","names":["Effect","Effectable","dual","Procedure","TypeId","Symbol","for","Proto","CommitPrototype","commit","succeed","makeProto","options","Object","assign","create","make","initialState","public","private","identifier","addProcedure","self","procedure","addProcedurePrivate","add","tag","handler","addPrivate","withInitialState"],"sources":["../../../src/Machine/ProcedureList.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,UAAU,MAAM,mBAAmB;AAC/C,SAASC,IAAI,QAAQ,iBAAiB;AAEtC,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAE3C;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,4CAA4C,CAAC;AAyB7F,MAAMC,KAAK,GAAG;EACZ,GAAGN,UAAU,CAACO,eAAe;EAC7B,CAACJ,MAAM,GAAGA,MAAM;EAChBK,MAAMA,CAAA;IACJ,OAAOT,MAAM,CAACU,OAAO,CAAC,IAAI,CAAC;EAC7B;CACD;AAED,MAAMC,SAAS,GACbC,OAKC,IAC4CC,MAAM,CAACC,MAAM,CAACD,MAAM,CAACE,MAAM,CAACR,KAAK,CAAC,EAAEK,OAAO,CAAC;AAE3F;;;;AAIA,OAAO,MAAMI,IAAI,GAAGA,CAAQC,YAAmB,EAAEL,OAEhD,KACCD,SAAS,CAAC;EACRM,YAAY;EACZC,MAAM,EAAE,EAAE;EACVC,OAAO,EAAE,EAAE;EACXC,UAAU,EAAER,OAAO,EAAEQ,UAAU,IAAI;CACpC,CAAC;AAEJ;;;;AAIA,OAAO,MAAMC,YAAY,gBAyBrBnB,IAAI,CACN,CAAC,EACD,CAQEoB,IAA8C,EAC9CC,SAA8C,KAE9CZ,SAAS,CAAC;EACR,GAAGW,IAAI;EACPJ,MAAM,EAAE,CAAC,GAAGI,IAAI,CAACJ,MAAM,EAAEK,SAAS;CACnC,CAAC,CACL;AAED;;;;AAIA,OAAO,MAAMC,mBAAmB,gBAyB5BtB,IAAI,CACN,CAAC,EACD,CAQEoB,IAA8C,EAC9CC,SAA8C,KAE9CZ,SAAS,CAAC;EACR,GAAGW,IAAI;EACPH,OAAO,EAAE,CAAC,GAAGG,IAAI,CAACH,OAAO,EAAEI,SAAS;CACrC,CAAC,CACL;AAED;;;;AAIA,OAAO,MAAME,GAAG,GAAGA,CAAA,KAwBjBvB,IAAI,CACF,CAAC,EACD,CAOEoB,IAA8C,EAC9CI,GAAgB,EAChBC,OAAyG,KAEzGN,YAAY,CAACC,IAAI,EAAEnB,SAAS,CAACa,IAAI,EAAY,EAAO,CAACU,GAAG,EAAEC,OAAO,CAAC,CAAC,CACtE;AAEH;;;;AAIA,OAAO,MAAMC,UAAU,GAAGA,CAAA,KAwBxB1B,IAAI,CACF,CAAC,EACD,CAOEoB,IAA8C,EAC9CI,GAAgB,EAChBC,OAAyG,KAEzGH,mBAAmB,CAACF,IAAI,EAAEnB,SAAS,CAACa,IAAI,EAAY,EAAO,CAACU,GAAG,EAAEC,OAAO,CAAC,CAAC,CAC7E;AAEH;;;;AAIA,OAAO,MAAME,gBAAgB,gBAUzB3B,IAAI,CAAC,CAAC,EAAE,CACVoB,IAA8C,EAC9CL,YAAkC,KACWN,SAAS,CAAC;EAAE,GAAGW,IAAI;EAAEL;AAAY,CAAE,CAAC,CAAC","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"ProcedureList.js","names":["Effect","Effectable","dual","Procedure","TypeId","Symbol","for","Proto","CommitPrototype","commit","succeed","makeProto","options","Object","assign","create","make","initialState","public","private","identifier","addProcedure","self","procedure","addProcedurePrivate","add","tag","handler","addPrivate","withInitialState"],"sources":["../../../src/Machine/ProcedureList.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,UAAU,MAAM,mBAAmB;AAC/C,SAASC,IAAI,QAAQ,iBAAiB;AAEtC,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAE3C;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,4CAA4C,CAAC;AAyB7F,MAAMC,KAAK,GAAG;EACZ,GAAGN,UAAU,CAACO,eAAe;EAC7B,CAACJ,MAAM,GAAGA,MAAM;EAChBK,MAAMA,CAAA;IACJ,OAAOT,MAAM,CAACU,OAAO,CAAC,IAAI,CAAC;EAC7B;CACD;AAED,MAAMC,SAAS,GACbC,OAKC,IAC4CC,MAAM,CAACC,MAAM,CAACD,MAAM,CAACE,MAAM,CAACR,KAAK,CAAC,EAAEK,OAAO,CAAC;AAE3F;;;;AAIA,OAAO,MAAMI,IAAI,GAAGA,CAAQC,YAAmB,EAAEL,OAEhD,KACCD,SAAS,CAAC;EACRM,YAAY;EACZC,MAAM,EAAE,EAAE;EACVC,OAAO,EAAE,EAAE;EACXC,UAAU,EAAER,OAAO,EAAEQ,UAAU,IAAI;CACpC,CAAC;AAEJ;;;;AAIA,OAAO,MAAMC,YAAY,gBA+BrBnB,IAAI,CACN,CAAC,EACD,CAQEoB,IAA8C,EAC9CC,SAA8C,KAE9CZ,SAAS,CAAC;EACR,GAAGW,IAAI;EACPJ,MAAM,EAAE,CAAC,GAAGI,IAAI,CAACJ,MAAM,EAAEK,SAAS;CACnC,CAAC,CACL;AAED;;;;AAIA,OAAO,MAAMC,mBAAmB,gBA+B5BtB,IAAI,CACN,CAAC,EACD,CAQEoB,IAA8C,EAC9CC,SAA8C,KAE9CZ,SAAS,CAAC;EACR,GAAGW,IAAI;EACPH,OAAO,EAAE,CAAC,GAAGG,IAAI,CAACH,OAAO,EAAEI,SAAS;CACrC,CAAC,CACL;AAED;;;;AAIA,OAAO,MAAME,GAAG,GAAGA,CAAA,KAwBjBvB,IAAI,CACF,CAAC,EACD,CAOEoB,IAA8C,EAC9CI,GAAgB,EAChBC,OAAyG,KAEzGN,YAAY,CAACC,IAAI,EAAEnB,SAAS,CAACa,IAAI,EAAY,EAAO,CAACU,GAAG,EAAEC,OAAO,CAAC,CAAC,CACtE;AAEH;;;;AAIA,OAAO,MAAMC,UAAU,GAAGA,CAAA,KAwBxB1B,IAAI,CACF,CAAC,EACD,CAOEoB,IAA8C,EAC9CI,GAAgB,EAChBC,OAAyG,KAEzGH,mBAAmB,CAACF,IAAI,EAAEnB,SAAS,CAACa,IAAI,EAAY,EAAO,CAACU,GAAG,EAAEC,OAAO,CAAC,CAAC,CAC7E;AAEH;;;;AAIA,OAAO,MAAME,gBAAgB,gBAkBzB3B,IAAI,CAAC,CAAC,EAAE,CACVoB,IAA8C,EAC9CL,YAAkC,KACWN,SAAS,CAAC;EAAE,GAAGW,IAAI;EAAEL;AAAY,CAAE,CAAC,CAAC","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Machine/SerializableProcedureList.js.map b/dist/esm/Machine/SerializableProcedureList.js.map
index 824553afa292329352dbbf6d6461d267b8ccd812..ce9639e9b4dc4acc1c35a9f33f91d665a543ed0b 100644
--- a/dist/esm/Machine/SerializableProcedureList.js.map
+++ b/dist/esm/Machine/SerializableProcedureList.js.map
@@ -1 +1 @@
-{"version":3,"file":"SerializableProcedureList.js","names":["dual","Procedure","ProcedureList","make","add","self","schema","handler","addProcedure","makeSerializable","addPrivate","addProcedurePrivate","withInitialState"],"sources":["../../../src/Machine/SerializableProcedureList.ts"],"sourcesContent":[null],"mappings":"AAMA,SAASA,IAAI,QAAQ,iBAAiB;AAEtC,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAC3C,OAAO,KAAKC,aAAa,MAAM,oBAAoB;AAmBnD;;;;AAIA,OAAO,MAAMC,IAAI,GAK4CD,aAAa,CAACC,IAAW;AAEtF;;;;AAIA,OAAO,MAAMC,GAAG,gBAkCZJ,IAAI,CACN,CAAC,EACD,CAUEK,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAMtGL,aAAa,CAACM,YAAY,CAACH,IAAI,EAAEJ,SAAS,CAACQ,gBAAgB,EAAY,CAACH,MAAM,EAAEC,OAAO,CAAC,CAAQ,CACtG;AAED;;;;AAIA,OAAO,MAAMG,UAAU,gBAkCnBV,IAAI,CACN,CAAC,EACD,CAUEK,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAMtGL,aAAa,CAACS,mBAAmB,CAACN,IAAI,EAAEJ,SAAS,CAACQ,gBAAgB,EAAY,CAACH,MAAM,EAAEC,OAAO,CAAC,CAAQ,CAC7G;AAED;;;;AAIA,OAAO,MAAMK,gBAAgB,GAUzBV,aAAa,CAACU,gBAAuB","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"SerializableProcedureList.js","names":["dual","Procedure","ProcedureList","make","add","self","schema","handler","addProcedure","makeSerializable","addPrivate","addProcedurePrivate","withInitialState"],"sources":["../../../src/Machine/SerializableProcedureList.ts"],"sourcesContent":[null],"mappings":"AAIA,SAASA,IAAI,QAAQ,iBAAiB;AAGtC,OAAO,KAAKC,SAAS,MAAM,gBAAgB;AAC3C,OAAO,KAAKC,aAAa,MAAM,oBAAoB;AAmBnD;;;;AAIA,OAAO,MAAMC,IAAI,GAK4CD,aAAa,CAACC,IAAW;AAEtF;;;;AAIA,OAAO,MAAMC,GAAG,gBA0CZJ,IAAI,CACN,CAAC,EACD,CAUEK,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAOzGL,aAAa,CAACM,YAAY,CACxBH,IAAI,EACJJ,SAAS,CAACQ,gBAAgB,EAUvB,CAACH,MAAM,EAAEC,OAAO,CAAC,CACd,CACX;AAED;;;;AAIA,OAAO,MAAMG,UAAU,gBA0CnBV,IAAI,CACN,CAAC,EACD,CAUEK,IAA0D,EAC1DC,MAAoE,EACpEC,OAAyG,KAOzGL,aAAa,CAACS,mBAAmB,CAC/BN,IAAI,EACJJ,SAAS,CAACQ,gBAAgB,EAUvB,CAACH,MAAM,EAAEC,OAAO,CAAC,CACd,CACX;AAED;;;;AAIA,OAAO,MAAMK,gBAAgB,GAkBzBV,aAAa,CAACU,gBAAuB","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Machine.js b/dist/esm/Machine.js
index 9410dda4add9fa873b5fc78336bf5855ef70be77..cf8f3f7c3ce70e2a558993604c873efdfad5b56e 100644
--- a/dist/esm/Machine.js
+++ b/dist/esm/Machine.js
@@ -1,5 +1,6 @@
-import * as Schema from "@effect/schema/Schema";
-import * as Serializable from "@effect/schema/Serializable";
+/**
+ * @since 1.0.0
+ */
 import * as Arr from "effect/Array";
 import * as Cause from "effect/Cause";
 import * as Context from "effect/Context";
@@ -17,6 +18,7 @@ import { pipeArguments } from "effect/Pipeable";
 import * as PubSub from "effect/PubSub";
 import * as Queue from "effect/Queue";
 import * as Readable from "effect/Readable";
+import * as Schema from "effect/Schema";
 import * as Stream from "effect/Stream";
 import * as Subscribable from "effect/Subscribable";
 import * as Tracer from "effect/Tracer";
@@ -136,11 +138,11 @@ export const withTracingEnabled = /*#__PURE__*/dual(2, (self, enabled) => Effect
  * @since 1.0.0
  * @category runtime
  */
-export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
-  const context = yield* _(Effect.context());
-  const requests = yield* _(Queue.unbounded());
-  const pubsub = yield* _(Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown));
-  const latch = yield* _(Deferred.make());
+export const boot = (self, ...[input, options]) => Effect.gen(function* () {
+  const context = yield* Effect.context();
+  const requests = yield* Queue.unbounded();
+  const pubsub = yield* Effect.acquireRelease(PubSub.unbounded(), PubSub.shutdown);
+  const latch = yield* Deferred.make();
   let currentState = undefined;
   let runState = {
     identifier: "Unknown",
@@ -187,7 +189,7 @@ export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
     }, span => Queue.offer(requests, [request, deferred, span, true]));
   });
   const sendExternal = request => Effect.suspend(() => runState.publicTags.has(request._tag) ? send(request) : Effect.die(`Request ${request._tag} marked as internal`));
-  const sendUnknown = u => Effect.suspend(() => runState.decodeRequest(u).pipe(Effect.flatMap(req => Effect.flatMap(Effect.exit(send(req)), exit => Serializable.serializeExit(req, exit))), Effect.provide(context)));
+  const sendUnknown = u => Effect.suspend(() => runState.decodeRequest(u).pipe(Effect.flatMap(req => Effect.flatMap(Effect.exit(send(req)), exit => Schema.serializeExit(req, exit))), Effect.provide(context)));
   const publishState = newState => {
     if (currentState !== newState) {
       currentState = newState;
@@ -195,9 +197,9 @@ export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
     }
     return Effect.void;
   };
-  const run = Effect.gen(function* (_) {
-    const fiberSet = yield* _(FiberSet.make());
-    const fiberMap = yield* _(FiberMap.make());
+  const run = Effect.gen(function* () {
+    const fiberSet = yield* FiberSet.make();
+    const fiberMap = yield* FiberMap.make();
     const fork = effect => Effect.asVoid(FiberSet.run(fiberSet, MachineDefect.wrap(effect)));
     const forkWith = dual(2, (effect, state) => Effect.map(fork(effect), _ => [_, state]));
     const forkReplace = dual(2, (effect, id) => Effect.asVoid(FiberMap.run(fiberMap, id, MachineDefect.wrap(effect))));
@@ -218,15 +220,15 @@ export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       forkReplace,
       forkReplaceWith
     };
-    const procedures = yield* _(self.initialize(input, currentState ?? options?.previousState), Effect.provideService(MachineContext, contextProto));
+    const procedures = yield* pipe(self.initialize(input, currentState ?? options?.previousState), Effect.provideService(MachineContext, contextProto));
     const procedureMap = Object.fromEntries(procedures.private.map(p => [p.tag, p]).concat(procedures.public.map(p => [p.tag, p])));
     runState = {
       identifier: procedures.identifier,
       publicTags: new Set(procedures.public.map(p => p.tag)),
       decodeRequest: Schema.decodeUnknown(Schema.Union(...Arr.filter(procedures.public, Procedure.isSerializable).map(p => p.schema)))
     };
-    yield* _(publishState(procedures.initialState));
-    yield* _(Deferred.succeed(latch, void 0));
+    yield* publishState(procedures.initialState);
+    yield* Deferred.succeed(latch, void 0);
     const process = pipe(Queue.take(requests), Effect.flatMap(([request, deferred, span, addSpan]) => Effect.flatMap(Deferred.isDone(deferred), done => {
       if (done) {
         return Effect.void;
@@ -268,7 +270,7 @@ export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       }
       return handler;
     })), Effect.forever, Effect.provideService(MachineContext, contextProto));
-    yield* _(Effect.all([process, FiberSet.join(fiberSet), FiberMap.join(fiberMap)], {
+    yield* pipe(Effect.all([process, FiberSet.join(fiberSet), FiberMap.join(fiberMap)], {
       concurrency: "unbounded",
       discard: true
     }), Effect.onExit(exit => {
@@ -281,8 +283,8 @@ export const boot = (self, ...[input, options]) => Effect.gen(function* (_) {
       cause
     }))));
   }).pipe(Effect.scoped);
-  const fiber = yield* _(run, self.retryPolicy ? Effect.retry(self.retryPolicy) : identity, Effect.forkScoped, Effect.interruptible);
-  yield* _(Deferred.await(latch));
+  const fiber = yield* pipe(run, self.retryPolicy ? Effect.retry(self.retryPolicy) : identity, Effect.forkScoped, Effect.interruptible);
+  yield* Deferred.await(latch);
   return identity(Object.assign(Object.create(ActorProto), {
     machine: self,
     input: input,
diff --git a/dist/esm/Machine.js.map b/dist/esm/Machine.js.map
index bf21721f512604f4c1b7aef2baeae711fabaf8b3..2b2cba313ba60c4423bd049d649980b01961c07c 100644
--- a/dist/esm/Machine.js.map
+++ b/dist/esm/Machine.js.map
@@ -1 +1 @@
-{"version":3,"file":"Machine.js","names":["Schema","Serializable","Arr","Cause","Context","Deferred","Effect","Fiber","FiberMap","FiberRef","FiberRefs","FiberSet","dual","identity","pipe","globalValue","Option","pipeArguments","PubSub","Queue","Readable","Stream","Subscribable","Tracer","Procedure","procedures","serializable","NoReply","TypeId","Symbol","for","SerializableTypeId","ActorTypeId","MachineDefect","TaggedError","cause","Defect","wrap","effect","catchAllCause","orDie","fail","squash","MachineContext","Tag","ActorProto","arguments","make","initialize","isEffect","retryPolicy","undefined","makeWith","makeSerializable","options","identifier","schemaInput","input","schemaState","state","retry","self","currentTracingEnabled","unsafeMake","withTracingEnabled","enabled","locally","boot","gen","_","context","requests","unbounded","pubsub","acquireRelease","shutdown","latch","currentState","runState","publicTags","Set","decodeRequest","requestContext","request","sync","fiber","getOrThrow","getCurrentFiber","fiberRefs","getFiberRefs","getOrDefault","currentContext","deferred","id","span","unsafeMap","get","ParentSpan","key","addSpans","send","flatMap","item","offer","zipRight","await","onInterrupt","interrupt","useSpan","_tag","parent","attributes","kind","captureStackTrace","sendIgnore","sendExternal","suspend","has","die","sendUnknown","u","req","exit","serializeExit","provide","publishState","newState","publish","void","run","fiberSet","fiberMap","fork","asVoid","forkWith","map","forkReplace","forkReplaceWith","forkOne","onlyIfMissing","forkOneWith","contextProto","sendAwait","unsafeSend","unsafeSendAwait","previousState","provideService","procedureMap","Object","fromEntries","private","p","tag","concat","public","decodeUnknown","Union","filter","isSerializable","schema","initialState","succeed","process","take","addSpan","isDone","done","procedure","create","handler","matchCauseEffect","onFailure","e","isFailure","failCause","onSuccess","response","withSpan","forever","all","join","concurrency","discard","onExit","takeAll","forEach","tapErrorCause","getWith","unhandledErrorLogLevel","match","onNone","onSome","level","log","currentLogLevel","catchAllDefect","scoped","forkScoped","interruptible","assign","machine","changes","fromPubSub","snapshot","zip","encode","restore","Tuple"],"sources":["../../src/Machine.ts"],"sourcesContent":[null],"mappings":"AAIA,OAAO,KAAKA,MAAM,MAAM,uBAAuB;AAC/C,OAAO,KAAKC,YAAY,MAAM,6BAA6B;AAC3D,OAAO,KAAKC,GAAG,MAAM,cAAc;AACnC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAC7C,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,SAASC,IAAI,EAAEC,QAAQ,EAAEC,IAAI,QAAQ,iBAAiB;AACtD,SAASC,WAAW,QAAQ,oBAAoB;AAChD,OAAO,KAAKC,MAAM,MAAM,eAAe;AAEvC,SAASC,aAAa,QAAQ,iBAAiB;AAC/C,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAI3C,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,YAAY,MAAM,qBAAqB;AACnD,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,SAAS,MAAM,wBAAwB;AAInD;;;;AAIA,OAAO,KAAKC,UAAU,MAAM,4BAA4B;AAExD;;;;AAIA,OAAO,KAAKC,YAAY,MAAM,wCAAwC;AAEtE;AACE;;;;AAIAC,OAAO,QACF,wBAAwB;AAE/B;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,8BAA8B,CAAC;AAyB/E;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAAkBF,MAAM,CAACC,GAAG,CAAC,2CAA2C,CAAC;AAmCxG;;;;AAIA,OAAO,MAAME,WAAW,gBAAkBH,MAAM,CAACC,GAAG,CAAC,oCAAoC,CAAC;AAQ1F;;;;AAIA,OAAM,MAAOG,aAAc,sBAAQjC,MAAM,CAACkC,WAAW,EAAiB,CAAC,eAAe,EAAE;EACtFC,KAAK,EAAEnC,MAAM,CAACoC;CACf,CAAC;EACA;;;EAGA,OAAOC,IAAIA,CAAUC,MAA8B;IACjD,OAAOhC,MAAM,CAACiC,aAAa,CACzBjC,MAAM,CAACkC,KAAK,CAACF,MAAM,CAAC,EACnBH,KAAK,IAAK7B,MAAM,CAACmC,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE,KAAK,EAAEhC,KAAK,CAACuC,MAAM,CAACP,KAAK;IAAC,CAAE,CAAC,CAAC,CAC1E;EACH;;AAGF;;;;AAIA,OAAM,MAAOQ,cAAe,sBAAQvC,OAAO,CAACwC,GAAG,CAAC,sCAAsC,CAAC,EAGpF;AAwIH,MAAMC,UAAU,GAAG;EACjB,CAACb,WAAW,GAAGA,WAAW;EAC1B,CAACZ,QAAQ,CAACQ,MAAM,GAAGR,QAAQ,CAACQ,MAAM;EAClC,CAACN,YAAY,CAACM,MAAM,GAAGN,YAAY,CAACM,MAAM;EAC1Cd,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE6B,SAAS,CAAC;EACvC;CACD;AAaD;;;;AAIA,OAAO,MAAMC,IAAI,GAQfC,UAEuE,KACwB;EAC/F,CAACpB,MAAM,GAAGA,MAAM;EAChBoB,UAAU,EAAE1C,MAAM,CAAC2C,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFE,WAAW,EAAEC,SAAS;EACtBrC,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE6B,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAIA,OAAO,MAAMM,QAAQ,GAAGA,CAAA,KAOnBL,IAAI;AAET;;;;AAIA,OAAO,MAAMM,gBAAgB,GAoCzBA,CAYFC,OAGC,EACDN,UAEmF,MAElF;EACC,CAACpB,MAAM,GAAGA,MAAM;EAChB,CAACG,kBAAkB,GAAGA,kBAAkB;EACxCiB,UAAU,EAAE1C,MAAM,CAAC2C,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFO,UAAU,EAAE,qBAAqB;EACjCL,WAAW,EAAEC,SAAS;EACtBK,WAAW,EAAEF,OAAO,CAACG,KAAY;EACjCC,WAAW,EAAEJ,OAAO,CAACK,KAAY;EACjC7C,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE6B,SAAS,CAAC;EACvC;CACD,CAAQ;AAEX;;;;AAIA,OAAO,MAAMc,KAAK,gBAQdhD,IAAI,CAAC,CAAC,EAAE,CACViD,IAAO,EACPX,WAA0C,MAEzC;EACC,GAAGW,IAAI;EACPX;CACD,CAAQ,CAAC;AAEZ;;;;AAIA,OAAO,MAAMY,qBAAqB,gBAA+B/C,WAAW,CAC1E,oDAAoD,EACpD,MAAMN,QAAQ,CAACsD,UAAU,CAAC,IAAI,CAAC,CAChC;AAED;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAG3BpD,IAAI,CACN,CAAC,EACD,CAAUiD,IAA4B,EAAEI,OAAgB,KAAK3D,MAAM,CAAC4D,OAAO,CAACL,IAAI,EAAEC,qBAAqB,EAAEG,OAAO,CAAC,CAClH;AAED;;;;AAIA,OAAO,MAAME,IAAI,GAAGA,CAGlBN,IAAO,EACP,GAAG,CAACJ,KAAK,EAAEH,OAAO,CAOf,KAMHhD,MAAM,CAAC8D,GAAG,CAAC,WAAUC,CAAC;EACpB,MAAMC,OAAO,GAAG,OAAOD,CAAC,CAAC/D,MAAM,CAACgE,OAAO,EAAsB,CAAC;EAC9D,MAAMC,QAAQ,GAAG,OAAOF,CAAC,CAAClD,KAAK,CAACqD,SAAS,EAOtC,CAAC;EACJ,MAAMC,MAAM,GAAG,OAAOJ,CAAC,CAAC/D,MAAM,CAACoE,cAAc,CAC3CxD,MAAM,CAACsD,SAAS,EAAoB,EACpCtD,MAAM,CAACyD,QAAQ,CAChB,CAAC;EACF,MAAMC,KAAK,GAAG,OAAOP,CAAC,CAAChE,QAAQ,CAAC0C,IAAI,EAAQ,CAAC;EAE7C,IAAI8B,YAAY,GAAqB1B,SAAgB;EACrD,IAAI2B,QAAQ,GAIR;IACFvB,UAAU,EAAE,SAAS;IACrBwB,UAAU,EAAE,IAAIC,GAAG,EAAU;IAC7BC,aAAa,EAAE9B;GAChB;EAED,MAAM+B,cAAc,GAAiCC,OAAU,IAC7D7E,MAAM,CAAC8E,IAAI,CAAC,MAAK;IACf,MAAMC,KAAK,GAAGrE,MAAM,CAACsE,UAAU,CAAC/E,KAAK,CAACgF,eAAe,EAAE,CAAC;IACxD,MAAMC,SAAS,GAAGH,KAAK,CAACI,YAAY,EAAE;IACtC,MAAMnB,OAAO,GAAG5D,SAAS,CAACgF,YAAY,CAACF,SAAS,EAAE/E,QAAQ,CAACkF,cAAc,CAAC;IAE1E,MAAMC,QAAQ,GAAGvF,QAAQ,CAAC0D,UAAU,CAAuCsB,KAAK,CAACQ,EAAE,EAAE,CAAC;IACtF,MAAMC,IAAI,GAA+BxB,OAAO,CAACyB,SAAS,CAACC,GAAG,CAACzE,MAAM,CAAC0E,UAAU,CAACC,GAAG,CAAC;IACrF,MAAMC,QAAQ,GAAGzF,SAAS,CAACgF,YAAY,CAACF,SAAS,EAAE1B,qBAAqB,CAAC;IAEzE,OAAO,CAACqB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEK,QAAQ,CAAU;EACrD,CAAC,CAAC;EAEJ,MAAMC,IAAI,GAAiCjB,OAAU,IACnD7E,MAAM,CAAC+F,OAAO,CACZnB,cAAc,CAACC,OAAO,CAAC,EACtBmB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAOnF,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE+B,IAAI,CAAC,CAACxF,IAAI,CACrCR,MAAM,CAACkG,QAAQ,CAACnG,QAAQ,CAACoG,KAAK,CAACH,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EACxChG,MAAM,CAACoG,WAAW,CAAC,MAAMrG,QAAQ,CAACsG,SAAS,CAACL,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACtD;IACH;IACA,MAAM,GAAGV,QAAQ,EAAEE,IAAI,CAAC,GAAGQ,IAAI;IAC/B,OAAOhG,MAAM,CAACsG,OAAO,CAAC,gBAAgBzB,OAAO,CAAC0B,IAAI,EAAE,EAAE;MACpDC,MAAM,EAAEhB,IAAI;MACZiB,UAAU,EAAE;QACV,gBAAgB,EAAEjC,QAAQ,CAACvB,UAAU;QACrC,GAAG4B;OACJ;MACD6B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGnB,IAAI,IACN3E,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAChF,IAAI,CACzDR,MAAM,CAACkG,QAAQ,CAACnG,QAAQ,CAACoG,KAAK,CAACb,QAAQ,CAAC,CAAC,EACzCtF,MAAM,CAACoG,WAAW,CAAC,MAAMrG,QAAQ,CAACsG,SAAS,CAACf,QAAQ,CAAC,CAAC,CACvD,CAAC;EACN,CAAC,CACF;EAEH,MAAMsB,UAAU,GAAiC/B,OAAU,IACzD7E,MAAM,CAAC+F,OAAO,CACZnB,cAAc,CAACC,OAAO,CAAC,EACtBmB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAOnF,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE+B,IAAI,CAAC;IACpC;IACA,MAAM,GAAGV,QAAQ,EAAEE,IAAI,CAAC,GAAGQ,IAAI;IAC/B,OAAOhG,MAAM,CAACsG,OAAO,CAAC,sBAAsBzB,OAAO,CAAC0B,IAAI,EAAE,EAAE;MAC1DC,MAAM,EAAEhB,IAAI;MACZiB,UAAU,EAAE;QACV,gBAAgB,EAAEjC,QAAQ,CAACvB,UAAU;QACrC,GAAG4B;OACJ;MACD6B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGnB,IAAI,IAAK3E,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;EACtE,CAAC,CACF;EAEH,MAAMqB,YAAY,GAAiChC,OAAU,IAC3D7E,MAAM,CAAC8G,OAAO,CAAC,MACbtC,QAAQ,CAACC,UAAU,CAACsC,GAAG,CAAClC,OAAO,CAAC0B,IAAI,CAAC,GACjCT,IAAI,CAACjB,OAAO,CAAC,GACb7E,MAAM,CAACgH,GAAG,CAAC,WAAWnC,OAAO,CAAC0B,IAAI,qBAAqB,CAAC,CAC7D;EAEH,MAAMU,WAAW,GAAIC,CAAU,IAC7BlH,MAAM,CAAC8G,OAAO,CAAC,MACbtC,QAAQ,CAACG,aAAa,CAACuC,CAAC,CAAC,CAAC1G,IAAI,CAC5BR,MAAM,CAAC+F,OAAO,CAAEoB,GAAG,IACjBnH,MAAM,CAAC+F,OAAO,CACZ/F,MAAM,CAACoH,IAAI,CAACtB,IAAI,CAACqB,GAAG,CAAC,CAAC,EACrBC,IAAI,IAAKzH,YAAY,CAAC0H,aAAa,CAACF,GAAG,EAAEC,IAAI,CAAC,CAChD,CACF,EACDpH,MAAM,CAACsH,OAAO,CAACtD,OAAO,CAAC,CACxB,CACsF;EAE3F,MAAMuD,YAAY,GAAIC,QAA0B,IAAI;IAClD,IAAIjD,YAAY,KAAKiD,QAAQ,EAAE;MAC7BjD,YAAY,GAAGiD,QAAQ;MACvB,OAAO5G,MAAM,CAAC6G,OAAO,CAACtD,MAAM,EAAEqD,QAAQ,CAAC;IACzC;IACA,OAAOxH,MAAM,CAAC0H,IAAI;EACpB,CAAC;EAED,MAAMC,GAAG,GAAG3H,MAAM,CAAC8D,GAAG,CAAC,WAAUC,CAAC;IAChC,MAAM6D,QAAQ,GAAG,OAAO7D,CAAC,CAAC1D,QAAQ,CAACoC,IAAI,EAAsB,CAAC;IAC9D,MAAMoF,QAAQ,GAAG,OAAO9D,CAAC,CAAC7D,QAAQ,CAACuC,IAAI,EAA8B,CAAC;IAEtE,MAAMqF,IAAI,GAAa9F,MAA8B,IACnDhC,MAAM,CAAC+H,MAAM,CAAC1H,QAAQ,CAACsH,GAAG,CAACC,QAAQ,EAAEjG,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;IACnE,MAAMgG,QAAQ,GAQV1H,IAAI,CAAC,CAAC,EAAE,CACV0B,MAA8B,EAC9BqB,KAAuB,KAEvBrD,MAAM,CAACiI,GAAG,CAACH,IAAI,CAAC9F,MAAM,CAAC,EAAG+B,CAAC,IAAK,CAACA,CAAC,EAAEV,KAAK,CAAU,CAAC,CAAC;IAEvD,MAAM6E,WAAW,GAGb5H,IAAI,CAAC,CAAC,EAAE,CAAU0B,MAA8B,EAAEuD,EAAU,KAC9DvF,MAAM,CAAC+H,MAAM,CACX7H,QAAQ,CAACyH,GAAG,CAACE,QAAQ,EAAEtC,EAAE,EAAE5D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CACvD,CAAC;IACJ,MAAMmG,eAAe,GAUjB7H,IAAI,CAAC,CAAC,EAAE,CACV0B,MAA8B,EAC9BuD,EAAU,EACVlC,KAAuB,KAEvBrD,MAAM,CAACiI,GAAG,CAACC,WAAW,CAAClG,MAAM,EAAEuD,EAAE,CAAC,EAAGxB,CAAC,IAAK,CAACA,CAAC,EAAEV,KAAK,CAAU,CAAC,CAAC;IAElE,MAAM+E,OAAO,GAGT9H,IAAI,CAAC,CAAC,EAAE,CAAU0B,MAA8B,EAAEuD,EAAU,KAC9DvF,MAAM,CAAC+H,MAAM,CAAC7H,QAAQ,CAACyH,GAAG,CAACE,QAAQ,EAAEtC,EAAE,EAAE5D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,EAAE;MAAEqG,aAAa,EAAE;IAAI,CAAE,CAAC,CAAC,CAAC;IAEjG,MAAMC,WAAW,GAUbhI,IAAI,CAAC,CAAC,EAAE,CACV0B,MAA8B,EAC9BuD,EAAU,EACVlC,KAAuB,KAEvBrD,MAAM,CAACiI,GAAG,CACRG,OAAO,CAACpG,MAAM,EAAEuD,EAAE,CAAC,EAClBxB,CAAC,IACA,CAACA,CAAC,EAAEV,KAAK,CAAU,CACtB,CAAC;IAEJ,MAAMkF,YAAY,GAA0E;MAC1FC,SAAS,EAAE1C,IAAI;MACfA,IAAI,EAAEc,UAAU;MAChB6B,UAAU,EAAE7B,UAAiB;MAC7B8B,eAAe,EAAE5C,IAAW;MAC5BgC,IAAI;MACJE,QAAQ;MACRI,OAAO;MACPE,WAAW;MACXJ,WAAW;MACXC;KACD;IAED,MAAMhH,UAAU,GAAG,OAAO4C,CAAC,CACzBR,IAAI,CAACb,UAAU,CAACS,KAAK,EAAEoB,YAAY,IAAIvB,OAAO,EAAE2F,aAAa,CAG5D,EACD3I,MAAM,CAAC4I,cAAc,CAACvG,cAAc,EAAEkG,YAAY,CAAC,CACpD;IACD,MAAMM,YAAY,GAGdC,MAAM,CAACC,WAAW,CACpB5H,UAAU,CAAC6H,OAAO,CAACf,GAAG,CAAEgB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CAACE,MAAM,CAC9ChI,UAAU,CAACiI,MAAM,CAACnB,GAAG,CAAEgB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CACzC,CACF;IAEDzE,QAAQ,GAAG;MACTvB,UAAU,EAAE9B,UAAU,CAAC8B,UAAU;MACjCwB,UAAU,EAAE,IAAIC,GAAG,CAACvD,UAAU,CAACiI,MAAM,CAACnB,GAAG,CAAEgB,CAAC,IAC1CA,CAAC,CAACC,GAAG,CACN,CAAC;MACFvE,aAAa,EAAEjF,MAAM,CAAC2J,aAAa,CACjC3J,MAAM,CAAC4J,KAAK,CACV,GAAG1J,GAAG,CAAC2J,MAAM,CACXpI,UAAU,CAACiI,MAAM,EACjBlI,SAAS,CAACsI,cAAc,CACzB,CAACvB,GAAG,CAAEgB,CAAC,IAAKA,CAAC,CAACQ,MAAM,CAAC,CACvB;KAEJ;IACD,OAAO1F,CAAC,CAACwD,YAAY,CAACpG,UAAU,CAACuI,YAAY,CAAC,CAAC;IAC/C,OAAO3F,CAAC,CAAChE,QAAQ,CAAC4J,OAAO,CAACrF,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;IAEzC,MAAMsF,OAAO,GAAGpJ,IAAI,CAClBK,KAAK,CAACgJ,IAAI,CAAC5F,QAAQ,CAAC,EACpBjE,MAAM,CAAC+F,OAAO,CAAC,CAAC,CAAClB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEsE,OAAO,CAAC,KAChD9J,MAAM,CAAC+F,OAAO,CAAChG,QAAQ,CAACgK,MAAM,CAACzE,QAAQ,CAAC,EAAG0E,IAAI,IAAI;MACjD,IAAIA,IAAI,EAAE;QACR,OAAOhK,MAAM,CAAC0H,IAAI;MACpB;MAEA,MAAMuC,SAAS,GAAGpB,YAAY,CAAChE,OAAO,CAAC0B,IAAI,CAAC;MAC5C,IAAI0D,SAAS,KAAKpH,SAAS,EAAE;QAC3B,OAAO9C,QAAQ,CAACiH,GAAG,CAAC1B,QAAQ,EAAE,mBAAmBT,OAAO,CAAC0B,IAAI,EAAE,CAAC;MAClE;MACA,MAAMvC,OAAO,GAAG8E,MAAM,CAACoB,MAAM,CAAC3B,YAAY,CAAC;MAC3CvE,OAAO,CAACX,KAAK,GAAGkB,YAAY;MAC5BP,OAAO,CAACa,OAAO,GAAGA,OAAO;MACzBb,OAAO,CAACsB,QAAQ,GAAGA,QAAQ;MAE3B,IAAI6E,OAAO,GAAGnK,MAAM,CAACoK,gBAAgB,CACnCH,SAAS,CAACE,OAAO,CAACnG,OAAO,CAAC,EAC1B;QACEqG,SAAS,EAAGC,CAAC,IAAI;UACf,IAAIzK,KAAK,CAAC0K,SAAS,CAACD,CAAC,CAAC,EAAE;YACtB,OAAOvK,QAAQ,CAACyK,SAAS,CAAClF,QAAQ,EAAEgF,CAAC,CAAC;UACxC;UACA;UACA,OAAOtK,MAAM,CAACkG,QAAQ,CACpBnG,QAAQ,CAACyK,SAAS,CAAClF,QAAQ,EAAEgF,CAAC,CAAC,EAC/BtK,MAAM,CAACwK,SAAS,CAACF,CAAC,CAAC,CACpB;QACH,CAAC;QACDG,SAAS,EAAEA,CAAC,CAACC,QAAQ,EAAElD,QAAQ,CAAC,KAAI;UAClC,IAAIkD,QAAQ,KAAKxJ,SAAS,CAACG,OAAO,EAAE;YAClC,OAAOkG,YAAY,CAACC,QAAQ,CAAC;UAC/B;UACA,OAAOxH,MAAM,CAACkG,QAAQ,CACpBqB,YAAY,CAACC,QAAQ,CAAC,EACtBzH,QAAQ,CAAC4J,OAAO,CAACrE,QAAQ,EAAEoF,QAAQ,CAAC,CACrC;QACH;OACD,CACF;MACD,IAAIZ,OAAO,EAAE;QACXK,OAAO,GAAGnK,MAAM,CAAC2K,QAAQ,CAACR,OAAO,EAAE,mBAAmBtF,OAAO,CAAC0B,IAAI,EAAE,EAAE;UACpEG,IAAI,EAAE,QAAQ;UACdF,MAAM,EAAEhB,IAAI;UACZiB,UAAU,EAAE;YACV,gBAAgB,EAAEjC,QAAQ,CAACvB;WAC5B;UACD0D,iBAAiB,EAAE;SACpB,CAAC;MACJ,CAAC,MAAM,IAAInB,IAAI,KAAK3C,SAAS,EAAE;QAC7BsH,OAAO,GAAGnK,MAAM,CAAC4I,cAAc,CAACuB,OAAO,EAAElJ,MAAM,CAAC0E,UAAU,EAAEH,IAAI,CAAC;MACnE;MAEA,OAAO2E,OAAO;IAChB,CAAC,CAAC,CACH,EACDnK,MAAM,CAAC4K,OAAO,EACd5K,MAAM,CAAC4I,cAAc,CAACvG,cAAc,EAAEkG,YAAY,CAAC,CACpD;IAED,OAAOxE,CAAC,CACN/D,MAAM,CAAC6K,GAAG,CAAC,CACTjB,OAAO,EACPvJ,QAAQ,CAACyK,IAAI,CAAClD,QAAQ,CAAC,EACvB1H,QAAQ,CAAC4K,IAAI,CAACjD,QAAQ,CAAC,CACxB,EAAE;MAAEkD,WAAW,EAAE,WAAW;MAAEC,OAAO,EAAE;IAAI,CAAE,CAAC,EAC/ChL,MAAM,CAACiL,MAAM,CAAE7D,IAAI,IAAI;MACrB,IAAIA,IAAI,CAACb,IAAI,KAAK,SAAS,EAAE,OAAOvG,MAAM,CAACgH,GAAG,CAAC,QAAQ,CAAC;MACxD,OAAOhH,MAAM,CAAC+F,OAAO,CACnBlF,KAAK,CAACqK,OAAO,CAACjH,QAAQ,CAAC,EACvBjE,MAAM,CAACmL,OAAO,CAAC,CAAC,GAAG7F,QAAQ,CAAC,KAAKvF,QAAQ,CAACyK,SAAS,CAAClF,QAAQ,EAAE8B,IAAI,CAACvF,KAAK,CAAC,CAAC,CAC3E;IACH,CAAC,CAAC,EACF7B,MAAM,CAACoL,aAAa,CAAEvJ,KAAK,IACzB1B,QAAQ,CAACkL,OAAO,CACdlL,QAAQ,CAACmL,sBAAsB,EAC/B5K,MAAM,CAAC6K,KAAK,CAAC;MACXC,MAAM,EAAEA,CAAA,KAAMxL,MAAM,CAAC0H,IAAI;MACzB+D,MAAM,EAAGC,KAAK,IACZ1L,MAAM,CAAC2L,GAAG,CAAC,sBAAsBnH,QAAQ,CAACvB,UAAU,WAAW,EAAEpB,KAAK,CAAC,CAACrB,IAAI,CAC1ER,MAAM,CAAC4D,OAAO,CAACzD,QAAQ,CAACyL,eAAe,EAAEF,KAAK,CAAC;KAEpD,CAAC,CACH,CACF,EACD1L,MAAM,CAAC6L,cAAc,CAAEhK,KAAK,IAAK7B,MAAM,CAACmC,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE;IAAK,CAAE,CAAC,CAAC,CAAC,CAC5E;EACH,CAAC,CAAC,CAACrB,IAAI,CAACR,MAAM,CAAC8L,MAAM,CAGpB;EAED,MAAM/G,KAAK,GAAG,OAAOhB,CAAC,CACpB4D,GAAG,EACHpE,IAAI,CAACX,WAAW,GACd5C,MAAM,CAACsD,KAAK,CAACC,IAAI,CAACX,WAAW,CAAC,GAC9BrC,QAAQ,EACVP,MAAM,CAAC+L,UAAU,EACjB/L,MAAM,CAACgM,aAAa,CACrB;EAED,OAAOjI,CAAC,CAAChE,QAAQ,CAACoG,KAAK,CAAC7B,KAAK,CAAC,CAAC;EAE/B,OAAO/D,QAAQ,CAAuBuI,MAAM,CAACmD,MAAM,CAACnD,MAAM,CAACoB,MAAM,CAAC3H,UAAU,CAAC,EAAE;IAC7E2J,OAAO,EAAE3I,IAAI;IACbJ,KAAK,EAAEA,KAAM;IACbuC,GAAG,EAAE1F,MAAM,CAAC8E,IAAI,CAAC,MAAMP,YAAY,CAAC;IACpC4H,OAAO,EAAEpL,MAAM,CAACoI,MAAM,CACpBpI,MAAM,CAAC+D,IAAI,CAAC,MAAMP,YAAY,CAAC,EAC/BxD,MAAM,CAACqL,UAAU,CAACjI,MAAM,CAAC,CAC1B;IACD2B,IAAI,EAAEe,YAAY;IAClBI,WAAW;IACX6D,IAAI,EAAE7K,KAAK,CAAC6K,IAAI,CAAC/F,KAAK;GACvB,CAAC,CAAQ;AACZ,CAAC,CAAC;AAEJ;;;;AAIA,OAAO,MAAMsH,QAAQ,GASnB9I,IAUC,IAEDvD,MAAM,CAACsM,GAAG,CACR5M,MAAM,CAAC6M,MAAM,CAAChJ,IAAI,CAAC2I,OAAO,CAAChJ,WAAW,CAAC,CAACK,IAAI,CAACJ,KAAK,CAAC,EACnDnD,MAAM,CAAC+F,OAAO,CAACxC,IAAI,CAACmC,GAAG,EAAEhG,MAAM,CAAC6M,MAAM,CAAChJ,IAAI,CAAC2I,OAAO,CAAC9I,WAAW,CAAC,CAAC,CAClE;AAEH;;;;AAIA,OAAO,MAAMoJ,OAAO,GAAGA,CASrBjJ,IAQC,EACD8I,QAAmD,KAgBnDrM,MAAM,CAAC+F,OAAO,CACZrG,MAAM,CAAC2J,aAAa,CAAC3J,MAAM,CAAC+M,KAAK,CAAClJ,IAAI,CAACL,WAAW,EAAEK,IAAI,CAACH,WAAW,CAAC,CAAC,CAACiJ,QAAQ,CAAC,EAChF,CAAC,CAAClJ,KAAK,EAAEwF,aAAa,CAAC,KAAM9E,IAAY,CAACN,IAAI,EAAEJ,KAAK,EAAE;EAAEwF;AAAa,CAAE,CAAC,CAC1E","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Machine.js","names":["Arr","Cause","Context","Deferred","Effect","Fiber","FiberMap","FiberRef","FiberRefs","FiberSet","dual","identity","pipe","globalValue","Option","pipeArguments","PubSub","Queue","Readable","Schema","Stream","Subscribable","Tracer","Procedure","procedures","serializable","NoReply","TypeId","Symbol","for","SerializableTypeId","ActorTypeId","MachineDefect","TaggedError","cause","Defect","wrap","effect","catchAllCause","orDie","fail","squash","MachineContext","Tag","ActorProto","arguments","make","initialize","isEffect","retryPolicy","undefined","makeWith","makeSerializable","options","identifier","schemaInput","input","schemaState","state","retry","self","currentTracingEnabled","unsafeMake","withTracingEnabled","enabled","locally","boot","gen","context","requests","unbounded","pubsub","acquireRelease","shutdown","latch","currentState","runState","publicTags","Set","decodeRequest","requestContext","request","sync","fiber","getOrThrow","getCurrentFiber","fiberRefs","getFiberRefs","getOrDefault","currentContext","deferred","id","span","unsafeMap","get","ParentSpan","key","addSpans","send","flatMap","item","offer","zipRight","await","onInterrupt","interrupt","useSpan","_tag","parent","attributes","kind","captureStackTrace","sendIgnore","sendExternal","suspend","has","die","sendUnknown","u","req","exit","serializeExit","provide","publishState","newState","publish","void","run","fiberSet","fiberMap","fork","asVoid","forkWith","map","_","forkReplace","forkReplaceWith","forkOne","onlyIfMissing","forkOneWith","contextProto","sendAwait","unsafeSend","unsafeSendAwait","previousState","provideService","procedureMap","Object","fromEntries","private","p","tag","concat","public","decodeUnknown","Union","filter","isSerializable","schema","initialState","succeed","process","take","addSpan","isDone","done","procedure","create","handler","matchCauseEffect","onFailure","e","isFailure","failCause","onSuccess","response","withSpan","forever","all","join","concurrency","discard","onExit","takeAll","forEach","tapErrorCause","getWith","unhandledErrorLogLevel","match","onNone","onSome","level","log","currentLogLevel","catchAllDefect","scoped","forkScoped","interruptible","assign","machine","changes","fromPubSub","snapshot","zip","encode","restore","Tuple"],"sources":["../../src/Machine.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,GAAG,MAAM,cAAc;AACnC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,OAAO,MAAM,gBAAgB;AACzC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,OAAO,KAAKC,SAAS,MAAM,kBAAkB;AAC7C,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAC3C,SAASC,IAAI,EAAEC,QAAQ,EAAEC,IAAI,QAAQ,iBAAiB;AACtD,SAASC,WAAW,QAAQ,oBAAoB;AAChD,OAAO,KAAKC,MAAM,MAAM,eAAe;AAGvC,SAASC,aAAa,QAAQ,iBAAiB;AAC/C,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,KAAK,MAAM,cAAc;AACrC,OAAO,KAAKC,QAAQ,MAAM,iBAAiB;AAG3C,OAAO,KAAKC,MAAM,MAAM,eAAe;AAEvC,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,YAAY,MAAM,qBAAqB;AACnD,OAAO,KAAKC,MAAM,MAAM,eAAe;AACvC,OAAO,KAAKC,SAAS,MAAM,wBAAwB;AAInD;;;;AAIA,OAAO,KAAKC,UAAU,MAAM,4BAA4B;AAExD;;;;AAIA,OAAO,KAAKC,YAAY,MAAM,wCAAwC;AAEtE;AACE;;;;AAIAC,OAAO,QACF,wBAAwB;AAE/B;;;;AAIA,OAAO,MAAMC,MAAM,gBAAkBC,MAAM,CAACC,GAAG,CAAC,8BAA8B,CAAC;AAyB/E;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAAkBF,MAAM,CAACC,GAAG,CAAC,2CAA2C,CAAC;AAmCxG;;;;AAIA,OAAO,MAAME,WAAW,gBAAkBH,MAAM,CAACC,GAAG,CAAC,oCAAoC,CAAC;AAQ1F;;;;AAIA,OAAM,MAAOG,aAAc,sBAAQb,MAAM,CAACc,WAAW,EAAiB,CAAC,eAAe,EAAE;EACtFC,KAAK,EAAEf,MAAM,CAACgB;CACf,CAAC;EACA;;;EAGA,OAAOC,IAAIA,CAAUC,MAA8B;IACjD,OAAOjC,MAAM,CAACkC,aAAa,CACzBlC,MAAM,CAACmC,KAAK,CAACF,MAAM,CAAC,EACnBH,KAAK,IAAK9B,MAAM,CAACoC,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE,KAAK,EAAEjC,KAAK,CAACwC,MAAM,CAACP,KAAK;IAAC,CAAE,CAAC,CAAC,CAC1E;EACH;;AAGF;;;;AAIA,OAAM,MAAOQ,cAAe,sBAAQxC,OAAO,CAACyC,GAAG,CAAC,sCAAsC,CAAC,EAGpF;AAwIH,MAAMC,UAAU,GAAG;EACjB,CAACb,WAAW,GAAGA,WAAW;EAC1B,CAACb,QAAQ,CAACS,MAAM,GAAGT,QAAQ,CAACS,MAAM;EAClC,CAACN,YAAY,CAACM,MAAM,GAAGN,YAAY,CAACM,MAAM;EAC1Cf,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE8B,SAAS,CAAC;EACvC;CACD;AAaD;;;;AAIA,OAAO,MAAMC,IAAI,GAgBfC,UAEuE,KACwB;EAC/F,CAACpB,MAAM,GAAGA,MAAM;EAChBoB,UAAU,EAAE3C,MAAM,CAAC4C,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFE,WAAW,EAAEC,SAAS;EACtBtC,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE8B,SAAS,CAAC;EACvC;CACD,CAAC;AAEF;;;;AAIA,OAAO,MAAMM,QAAQ,GAAGA,CAAA,KAOnBL,IAAI;AAET;;;;AAIA,OAAO,MAAMM,gBAAgB,GA4CzBA,CAYFC,OAGC,EACDN,UAEmF,MACkC;EACrH,CAACpB,MAAM,GAAGA,MAAM;EAChB,CAACG,kBAAkB,GAAGA,kBAAkB;EACxCiB,UAAU,EAAE3C,MAAM,CAAC4C,QAAQ,CAACD,UAAU,CAAC,GAAI,MAAMA,UAAU,GAAIA,UAAiB;EAChFO,UAAU,EAAE,qBAAqB;EACjCL,WAAW,EAAEC,SAAS;EACtBK,WAAW,EAAEF,OAAO,CAACG,KAAY;EACjCC,WAAW,EAAEJ,OAAO,CAACK,KAAY;EAEjC9C,IAAIA,CAAA;IACF,OAAOG,aAAa,CAAC,IAAI,EAAE8B,SAAS,CAAC;EACvC;CACD,CAAS;AAEV;;;;AAIA,OAAO,MAAMc,KAAK,gBAgBdjD,IAAI,CAAC,CAAC,EAAE,CACVkD,IAAO,EACPX,WAA0C,MACX;EAC/B,GAAGW,IAAI;EACPX;CACD,CAAS,CAAC;AAEX;;;;AAIA,OAAO,MAAMY,qBAAqB,gBAA+BhD,WAAW,CAC1E,oDAAoD,EACpD,MAAMN,QAAQ,CAACuD,UAAU,CAAC,IAAI,CAAC,CAChC;AAED;;;;AAIA,OAAO,MAAMC,kBAAkB,gBAW3BrD,IAAI,CACN,CAAC,EACD,CAAUkD,IAA4B,EAAEI,OAAgB,KAAK5D,MAAM,CAAC6D,OAAO,CAACL,IAAI,EAAEC,qBAAqB,EAAEG,OAAO,CAAC,CAClH;AAED;;;;AAIA,OAAO,MAAME,IAAI,GAAGA,CAGlBN,IAAO,EACP,GAAG,CAACJ,KAAK,EAAEH,OAAO,CAOf,KAMHjD,MAAM,CAAC+D,GAAG,CAAC,aAAS;EAClB,MAAMC,OAAO,GAAG,OAAOhE,MAAM,CAACgE,OAAO,EAAsB;EAC3D,MAAMC,QAAQ,GAAG,OAAOpD,KAAK,CAACqD,SAAS,EAOpC;EACH,MAAMC,MAAM,GAAG,OAAOnE,MAAM,CAACoE,cAAc,CACzCxD,MAAM,CAACsD,SAAS,EAAoB,EACpCtD,MAAM,CAACyD,QAAQ,CAChB;EACD,MAAMC,KAAK,GAAG,OAAOvE,QAAQ,CAAC2C,IAAI,EAAQ;EAE1C,IAAI6B,YAAY,GAAqBzB,SAAgB;EACrD,IAAI0B,QAAQ,GAIR;IACFtB,UAAU,EAAE,SAAS;IACrBuB,UAAU,EAAE,IAAIC,GAAG,EAAU;IAC7BC,aAAa,EAAE7B;GAChB;EAED,MAAM8B,cAAc,GAAiCC,OAAU,IAC7D7E,MAAM,CAAC8E,IAAI,CAAC,MAAK;IACf,MAAMC,KAAK,GAAGrE,MAAM,CAACsE,UAAU,CAAC/E,KAAK,CAACgF,eAAe,EAAE,CAAC;IACxD,MAAMC,SAAS,GAAGH,KAAK,CAACI,YAAY,EAAE;IACtC,MAAMnB,OAAO,GAAG5D,SAAS,CAACgF,YAAY,CAACF,SAAS,EAAE/E,QAAQ,CAACkF,cAAc,CAAC;IAE1E,MAAMC,QAAQ,GAAGvF,QAAQ,CAAC2D,UAAU,CAAuCqB,KAAK,CAACQ,EAAE,EAAE,CAAC;IACtF,MAAMC,IAAI,GAA+BxB,OAAO,CAACyB,SAAS,CAACC,GAAG,CAACxE,MAAM,CAACyE,UAAU,CAACC,GAAG,CAAC;IACrF,MAAMC,QAAQ,GAAGzF,SAAS,CAACgF,YAAY,CAACF,SAAS,EAAEzB,qBAAqB,CAAC;IAEzE,OAAO,CAACoB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEK,QAAQ,CAAU;EACrD,CAAC,CAAC;EAEJ,MAAMC,IAAI,GAAiCjB,OAAU,IACnD7E,MAAM,CAAC+F,OAAO,CACZnB,cAAc,CAACC,OAAO,CAAC,EACtBmB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAOnF,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE+B,IAAI,CAAC,CAACxF,IAAI,CACrCR,MAAM,CAACkG,QAAQ,CAACnG,QAAQ,CAACoG,KAAK,CAACH,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EACxChG,MAAM,CAACoG,WAAW,CAAC,MAAMrG,QAAQ,CAACsG,SAAS,CAACL,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CACtD;IACH;IACA,MAAM,GAAGV,QAAQ,EAAEE,IAAI,CAAC,GAAGQ,IAAI;IAC/B,OAAOhG,MAAM,CAACsG,OAAO,CAAC,gBAAgBzB,OAAO,CAAC0B,IAAI,EAAE,EAAE;MACpDC,MAAM,EAAEhB,IAAI;MACZiB,UAAU,EAAE;QACV,gBAAgB,EAAEjC,QAAQ,CAACtB,UAAU;QACrC,GAAG2B;OACJ;MACD6B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGnB,IAAI,IACN3E,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAChF,IAAI,CACzDR,MAAM,CAACkG,QAAQ,CAACnG,QAAQ,CAACoG,KAAK,CAACb,QAAQ,CAAC,CAAC,EACzCtF,MAAM,CAACoG,WAAW,CAAC,MAAMrG,QAAQ,CAACsG,SAAS,CAACf,QAAQ,CAAC,CAAC,CACvD,CAAC;EACN,CAAC,CACF;EAEH,MAAMsB,UAAU,GAAiC/B,OAAU,IACzD7E,MAAM,CAAC+F,OAAO,CACZnB,cAAc,CAACC,OAAO,CAAC,EACtBmB,IAAI,IAAI;IACP,IAAI,CAACA,IAAI,CAAC,CAAC,CAAC,EAAE;MACZ,OAAOnF,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE+B,IAAI,CAAC;IACpC;IACA,MAAM,GAAGV,QAAQ,EAAEE,IAAI,CAAC,GAAGQ,IAAI;IAC/B,OAAOhG,MAAM,CAACsG,OAAO,CAAC,sBAAsBzB,OAAO,CAAC0B,IAAI,EAAE,EAAE;MAC1DC,MAAM,EAAEhB,IAAI;MACZiB,UAAU,EAAE;QACV,gBAAgB,EAAEjC,QAAQ,CAACtB,UAAU;QACrC,GAAG2B;OACJ;MACD6B,IAAI,EAAE,QAAQ;MACdC,iBAAiB,EAAE;KACpB,EAAGnB,IAAI,IAAK3E,KAAK,CAACoF,KAAK,CAAChC,QAAQ,EAAE,CAACY,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;EACtE,CAAC,CACF;EAEH,MAAMqB,YAAY,GAAiChC,OAAU,IAC3D7E,MAAM,CAAC8G,OAAO,CAAC,MACbtC,QAAQ,CAACC,UAAU,CAACsC,GAAG,CAAClC,OAAO,CAAC0B,IAAI,CAAC,GACjCT,IAAI,CAACjB,OAAO,CAAC,GACb7E,MAAM,CAACgH,GAAG,CAAC,WAAWnC,OAAO,CAAC0B,IAAI,qBAAqB,CAAC,CAC7D;EAEH,MAAMU,WAAW,GAAIC,CAAU,IAC7BlH,MAAM,CAAC8G,OAAO,CAAC,MACbtC,QAAQ,CAACG,aAAa,CAACuC,CAAC,CAAC,CAAC1G,IAAI,CAC5BR,MAAM,CAAC+F,OAAO,CAAEoB,GAAG,IACjBnH,MAAM,CAAC+F,OAAO,CACZ/F,MAAM,CAACoH,IAAI,CAACtB,IAAI,CAACqB,GAAG,CAAC,CAAC,EACrBC,IAAI,IAAKrG,MAAM,CAACsG,aAAa,CAACF,GAAG,EAAEC,IAAI,CAAC,CAC1C,CACF,EACDpH,MAAM,CAACsH,OAAO,CAACtD,OAAO,CAAC,CACxB,CACsF;EAE3F,MAAMuD,YAAY,GAAIC,QAA0B,IAAI;IAClD,IAAIjD,YAAY,KAAKiD,QAAQ,EAAE;MAC7BjD,YAAY,GAAGiD,QAAQ;MACvB,OAAO5G,MAAM,CAAC6G,OAAO,CAACtD,MAAM,EAAEqD,QAAQ,CAAC;IACzC;IACA,OAAOxH,MAAM,CAAC0H,IAAI;EACpB,CAAC;EAED,MAAMC,GAAG,GAAG3H,MAAM,CAAC+D,GAAG,CAAC,aAAS;IAC9B,MAAM6D,QAAQ,GAAG,OAAOvH,QAAQ,CAACqC,IAAI,EAAsB;IAC3D,MAAMmF,QAAQ,GAAG,OAAO3H,QAAQ,CAACwC,IAAI,EAA8B;IAEnE,MAAMoF,IAAI,GAAa7F,MAA8B,IACnDjC,MAAM,CAAC+H,MAAM,CAAC1H,QAAQ,CAACsH,GAAG,CAACC,QAAQ,EAAEhG,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC;IACnE,MAAM+F,QAAQ,GAQV1H,IAAI,CAAC,CAAC,EAAE,CACV2B,MAA8B,EAC9BqB,KAAuB,KAEvBtD,MAAM,CAACiI,GAAG,CAACH,IAAI,CAAC7F,MAAM,CAAC,EAAGiG,CAAC,IAAK,CAACA,CAAC,EAAE5E,KAAK,CAAU,CAAC,CAAC;IAEvD,MAAM6E,WAAW,GAGb7H,IAAI,CAAC,CAAC,EAAE,CAAU2B,MAA8B,EAAEsD,EAAU,KAC9DvF,MAAM,CAAC+H,MAAM,CACX7H,QAAQ,CAACyH,GAAG,CAACE,QAAQ,EAAEtC,EAAE,EAAE3D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,CAAC,CACvD,CAAC;IACJ,MAAMmG,eAAe,GAUjB9H,IAAI,CAAC,CAAC,EAAE,CACV2B,MAA8B,EAC9BsD,EAAU,EACVjC,KAAuB,KAEvBtD,MAAM,CAACiI,GAAG,CAACE,WAAW,CAAClG,MAAM,EAAEsD,EAAE,CAAC,EAAG2C,CAAC,IAAK,CAACA,CAAC,EAAE5E,KAAK,CAAU,CAAC,CAAC;IAElE,MAAM+E,OAAO,GAGT/H,IAAI,CAAC,CAAC,EAAE,CAAU2B,MAA8B,EAAEsD,EAAU,KAC9DvF,MAAM,CAAC+H,MAAM,CAAC7H,QAAQ,CAACyH,GAAG,CAACE,QAAQ,EAAEtC,EAAE,EAAE3D,aAAa,CAACI,IAAI,CAACC,MAAM,CAAC,EAAE;MAAEqG,aAAa,EAAE;IAAI,CAAE,CAAC,CAAC,CAAC;IAEjG,MAAMC,WAAW,GAUbjI,IAAI,CAAC,CAAC,EAAE,CACV2B,MAA8B,EAC9BsD,EAAU,EACVjC,KAAuB,KAEvBtD,MAAM,CAACiI,GAAG,CACRI,OAAO,CAACpG,MAAM,EAAEsD,EAAE,CAAC,EAClB2C,CAAC,IACA,CAACA,CAAC,EAAE5E,KAAK,CAAU,CACtB,CAAC;IAEJ,MAAMkF,YAAY,GAA0E;MAC1FC,SAAS,EAAE3C,IAAI;MACfA,IAAI,EAAEc,UAAU;MAChB8B,UAAU,EAAE9B,UAAiB;MAC7B+B,eAAe,EAAE7C,IAAW;MAC5BgC,IAAI;MACJE,QAAQ;MACRK,OAAO;MACPE,WAAW;MACXJ,WAAW;MACXC;KACD;IAED,MAAMhH,UAAU,GAAG,OAAOZ,IAAI,CAC5BgD,IAAI,CAACb,UAAU,CAACS,KAAK,EAAEmB,YAAY,IAAItB,OAAO,EAAE2F,aAAa,CAG5D,EACD5I,MAAM,CAAC6I,cAAc,CAACvG,cAAc,EAAEkG,YAAY,CAAC,CACpD;IACD,MAAMM,YAAY,GAGdC,MAAM,CAACC,WAAW,CACpB5H,UAAU,CAAC6H,OAAO,CAAChB,GAAG,CAAEiB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CAACE,MAAM,CAC9ChI,UAAU,CAACiI,MAAM,CAACpB,GAAG,CAAEiB,CAAC,IAAK,CAACA,CAAC,CAACC,GAAG,EAAED,CAAC,CAAC,CAAC,CACzC,CACF;IAED1E,QAAQ,GAAG;MACTtB,UAAU,EAAE9B,UAAU,CAAC8B,UAAU;MACjCuB,UAAU,EAAE,IAAIC,GAAG,CAACtD,UAAU,CAACiI,MAAM,CAACpB,GAAG,CAAEiB,CAAC,IAC1CA,CAAC,CAACC,GAAG,CACN,CAAC;MACFxE,aAAa,EAAE5D,MAAM,CAACuI,aAAa,CACjCvI,MAAM,CAACwI,KAAK,CACV,GAAG3J,GAAG,CAAC4J,MAAM,CACXpI,UAAU,CAACiI,MAAM,EACjBlI,SAAS,CAACsI,cAAc,CACzB,CAACxB,GAAG,CAAEiB,CAAC,IAAKA,CAAC,CAACQ,MAAM,CAAC,CACvB;KAEJ;IACD,OAAOnC,YAAY,CAACnG,UAAU,CAACuI,YAAY,CAAC;IAC5C,OAAO5J,QAAQ,CAAC6J,OAAO,CAACtF,KAAK,EAAE,KAAK,CAAC,CAAC;IAEtC,MAAMuF,OAAO,GAAGrJ,IAAI,CAClBK,KAAK,CAACiJ,IAAI,CAAC7F,QAAQ,CAAC,EACpBjE,MAAM,CAAC+F,OAAO,CAAC,CAAC,CAAClB,OAAO,EAAES,QAAQ,EAAEE,IAAI,EAAEuE,OAAO,CAAC,KAChD/J,MAAM,CAAC+F,OAAO,CAAChG,QAAQ,CAACiK,MAAM,CAAC1E,QAAQ,CAAC,EAAG2E,IAAI,IAAI;MACjD,IAAIA,IAAI,EAAE;QACR,OAAOjK,MAAM,CAAC0H,IAAI;MACpB;MAEA,MAAMwC,SAAS,GAAGpB,YAAY,CAACjE,OAAO,CAAC0B,IAAI,CAAC;MAC5C,IAAI2D,SAAS,KAAKpH,SAAS,EAAE;QAC3B,OAAO/C,QAAQ,CAACiH,GAAG,CAAC1B,QAAQ,EAAE,mBAAmBT,OAAO,CAAC0B,IAAI,EAAE,CAAC;MAClE;MACA,MAAMvC,OAAO,GAAG+E,MAAM,CAACoB,MAAM,CAAC3B,YAAY,CAAC;MAC3CxE,OAAO,CAACV,KAAK,GAAGiB,YAAY;MAC5BP,OAAO,CAACa,OAAO,GAAGA,OAAO;MACzBb,OAAO,CAACsB,QAAQ,GAAGA,QAAQ;MAE3B,IAAI8E,OAAO,GAAGpK,MAAM,CAACqK,gBAAgB,CACnCH,SAAS,CAACE,OAAO,CAACpG,OAAO,CAAC,EAC1B;QACEsG,SAAS,EAAGC,CAAC,IAAI;UACf,IAAI1K,KAAK,CAAC2K,SAAS,CAACD,CAAC,CAAC,EAAE;YACtB,OAAOxK,QAAQ,CAAC0K,SAAS,CAACnF,QAAQ,EAAEiF,CAAC,CAAC;UACxC;UACA;UACA,OAAOvK,MAAM,CAACkG,QAAQ,CACpBnG,QAAQ,CAAC0K,SAAS,CAACnF,QAAQ,EAAEiF,CAAC,CAAC,EAC/BvK,MAAM,CAACyK,SAAS,CAACF,CAAC,CAAC,CACpB;QACH,CAAC;QACDG,SAAS,EAAEA,CAAC,CAACC,QAAQ,EAAEnD,QAAQ,CAAC,KAAI;UAClC,IAAImD,QAAQ,KAAKxJ,SAAS,CAACG,OAAO,EAAE;YAClC,OAAOiG,YAAY,CAACC,QAAQ,CAAC;UAC/B;UACA,OAAOxH,MAAM,CAACkG,QAAQ,CACpBqB,YAAY,CAACC,QAAQ,CAAC,EACtBzH,QAAQ,CAAC6J,OAAO,CAACtE,QAAQ,EAAEqF,QAAQ,CAAC,CACrC;QACH;OACD,CACF;MACD,IAAIZ,OAAO,EAAE;QACXK,OAAO,GAAGpK,MAAM,CAAC4K,QAAQ,CAACR,OAAO,EAAE,mBAAmBvF,OAAO,CAAC0B,IAAI,EAAE,EAAE;UACpEG,IAAI,EAAE,QAAQ;UACdF,MAAM,EAAEhB,IAAI;UACZiB,UAAU,EAAE;YACV,gBAAgB,EAAEjC,QAAQ,CAACtB;WAC5B;UACDyD,iBAAiB,EAAE;SACpB,CAAC;MACJ,CAAC,MAAM,IAAInB,IAAI,KAAK1C,SAAS,EAAE;QAC7BsH,OAAO,GAAGpK,MAAM,CAAC6I,cAAc,CAACuB,OAAO,EAAElJ,MAAM,CAACyE,UAAU,EAAEH,IAAI,CAAC;MACnE;MAEA,OAAO4E,OAAO;IAChB,CAAC,CAAC,CACH,EACDpK,MAAM,CAAC6K,OAAO,EACd7K,MAAM,CAAC6I,cAAc,CAACvG,cAAc,EAAEkG,YAAY,CAAC,CACpD;IAED,OAAOhI,IAAI,CACTR,MAAM,CAAC8K,GAAG,CAAC,CACTjB,OAAO,EACPxJ,QAAQ,CAAC0K,IAAI,CAACnD,QAAQ,CAAC,EACvB1H,QAAQ,CAAC6K,IAAI,CAAClD,QAAQ,CAAC,CACxB,EAAE;MAAEmD,WAAW,EAAE,WAAW;MAAEC,OAAO,EAAE;IAAI,CAAE,CAAC,EAC/CjL,MAAM,CAACkL,MAAM,CAAE9D,IAAI,IAAI;MACrB,IAAIA,IAAI,CAACb,IAAI,KAAK,SAAS,EAAE,OAAOvG,MAAM,CAACgH,GAAG,CAAC,QAAQ,CAAC;MACxD,OAAOhH,MAAM,CAAC+F,OAAO,CACnBlF,KAAK,CAACsK,OAAO,CAAClH,QAAQ,CAAC,EACvBjE,MAAM,CAACoL,OAAO,CAAC,CAAC,GAAG9F,QAAQ,CAAC,KAAKvF,QAAQ,CAAC0K,SAAS,CAACnF,QAAQ,EAAE8B,IAAI,CAACtF,KAAK,CAAC,CAAC,CAC3E;IACH,CAAC,CAAC,EACF9B,MAAM,CAACqL,aAAa,CAAEvJ,KAAK,IACzB3B,QAAQ,CAACmL,OAAO,CACdnL,QAAQ,CAACoL,sBAAsB,EAC/B7K,MAAM,CAAC8K,KAAK,CAAC;MACXC,MAAM,EAAEA,CAAA,KAAMzL,MAAM,CAAC0H,IAAI;MACzBgE,MAAM,EAAGC,KAAK,IACZ3L,MAAM,CAAC4L,GAAG,CAAC,sBAAsBpH,QAAQ,CAACtB,UAAU,WAAW,EAAEpB,KAAK,CAAC,CAACtB,IAAI,CAC1ER,MAAM,CAAC6D,OAAO,CAAC1D,QAAQ,CAAC0L,eAAe,EAAEF,KAAK,CAAC;KAEpD,CAAC,CACH,CACF,EACD3L,MAAM,CAAC8L,cAAc,CAAEhK,KAAK,IAAK9B,MAAM,CAACoC,IAAI,CAAC,IAAIR,aAAa,CAAC;MAAEE;IAAK,CAAE,CAAC,CAAC,CAAC,CAC5E;EACH,CAAC,CAAC,CAACtB,IAAI,CAACR,MAAM,CAAC+L,MAAM,CAGpB;EAED,MAAMhH,KAAK,GAAG,OAAOvE,IAAI,CACvBmH,GAAG,EACHnE,IAAI,CAACX,WAAW,GACd7C,MAAM,CAACuD,KAAK,CAACC,IAAI,CAACX,WAAW,CAAC,GAC9BtC,QAAQ,EACVP,MAAM,CAACgM,UAAU,EACjBhM,MAAM,CAACiM,aAAa,CACrB;EAED,OAAOlM,QAAQ,CAACoG,KAAK,CAAC7B,KAAK,CAAC;EAE5B,OAAO/D,QAAQ,CAAuBwI,MAAM,CAACmD,MAAM,CAACnD,MAAM,CAACoB,MAAM,CAAC3H,UAAU,CAAC,EAAE;IAC7E2J,OAAO,EAAE3I,IAAI;IACbJ,KAAK,EAAEA,KAAM;IACbsC,GAAG,EAAE1F,MAAM,CAAC8E,IAAI,CAAC,MAAMP,YAAY,CAAC;IACpC6H,OAAO,EAAEpL,MAAM,CAACoI,MAAM,CACpBpI,MAAM,CAAC8D,IAAI,CAAC,MAAMP,YAAY,CAAC,EAC/BvD,MAAM,CAACqL,UAAU,CAAClI,MAAM,CAAC,CAC1B;IACD2B,IAAI,EAAEe,YAAY;IAClBI,WAAW;IACX8D,IAAI,EAAE9K,KAAK,CAAC8K,IAAI,CAAChG,KAAK;GACvB,CAAC,CAAQ;AACZ,CAAC,CAAC;AAEJ;;;;AAIA,OAAO,MAAMuH,QAAQ,GASnB9I,IAUC,IAEDxD,MAAM,CAACuM,GAAG,CACRxL,MAAM,CAACyL,MAAM,CAAChJ,IAAI,CAAC2I,OAAO,CAAChJ,WAAW,CAAC,CAACK,IAAI,CAACJ,KAAK,CAAC,EACnDpD,MAAM,CAAC+F,OAAO,CAACvC,IAAI,CAACkC,GAAG,EAAE3E,MAAM,CAACyL,MAAM,CAAChJ,IAAI,CAAC2I,OAAO,CAAC9I,WAAW,CAAC,CAAC,CAClE;AAEH;;;;AAIA,OAAO,MAAMoJ,OAAO,GAAGA,CASrBjJ,IAQC,EACD8I,QAAmD,KAgBnDtM,MAAM,CAAC+F,OAAO,CACZhF,MAAM,CAACuI,aAAa,CAACvI,MAAM,CAAC2L,KAAK,CAAClJ,IAAI,CAACL,WAAW,EAAEK,IAAI,CAACH,WAAW,CAAC,CAAC,CAACiJ,QAAQ,CAAC,EAChF,CAAC,CAAClJ,KAAK,EAAEwF,aAAa,CAAC,KAAM9E,IAAY,CAACN,IAAI,EAAEJ,KAAK,EAAE;EAAEwF;AAAa,CAAE,CAAC,CAC1E","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/PersistedCache.js b/dist/esm/PersistedCache.js
index b07fb568893feaf442fa82f40836350ff3b32748..9119c279dd5a022bfc98a16c94d01314a9dba8e4 100644
--- a/dist/esm/PersistedCache.js
+++ b/dist/esm/PersistedCache.js
@@ -1,3 +1,6 @@
+/**
+ * @since 1.0.0
+ */
 import * as Cache from "effect/Cache";
 import * as Data from "effect/Data";
 import * as Effect from "effect/Effect";
diff --git a/dist/esm/PersistedCache.js.map b/dist/esm/PersistedCache.js.map
index 52cdbde46d9ec711acf13936814e931732d0c88b..4ddc9382d0b3671530ce79c337a5c5f18b40be97 100644
--- a/dist/esm/PersistedCache.js.map
+++ b/dist/esm/PersistedCache.js.map
@@ -1 +1 @@
-{"version":3,"file":"PersistedCache.js","names":["Cache","Data","Effect","Equal","identity","pipe","Hash","Option","Tracer","Persistence","CacheRequest","Class","symbol","that","equals","key","hash","make","options","ResultPersistence","flatMap","_","storeId","timeToLive","bindTo","bind","store","lookup","request","effect","get","match","onNone","exit","tap","set","flatten","onSome","span","_tag","withParentSpan","value","capacity","inMemoryCapacity","inMemoryTTL","map","inMemoryCache","serviceOption","ParentSpan","invalidate","remove","zipRight","none"],"sources":["../../src/PersistedCache.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"PersistedCache.js","names":["Cache","Data","Effect","Equal","identity","pipe","Hash","Option","Tracer","Persistence","CacheRequest","Class","symbol","that","equals","key","hash","make","options","ResultPersistence","flatMap","_","storeId","timeToLive","bindTo","bind","store","lookup","request","effect","get","match","onNone","exit","tap","set","flatten","onSome","span","_tag","withParentSpan","value","capacity","inMemoryCapacity","inMemoryTTL","map","inMemoryCache","serviceOption","ParentSpan","invalidate","remove","zipRight","none"],"sources":["../../src/PersistedCache.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Persistence/Lmdb.js b/dist/esm/Persistence/Lmdb.js
index 4af78b915c575711f70b66c970e53e180b337d6d..2dd9d7ff493730b32f0d79f8d189caf4159928c8 100644
--- a/dist/esm/Persistence/Lmdb.js
+++ b/dist/esm/Persistence/Lmdb.js
@@ -12,15 +12,15 @@ import * as Persistence from "../Persistence.js";
  * @since 1.0.0
  * @category constructors
  */
-export const make = options => Effect.gen(function* (_) {
-  const lmdb = yield* _(Effect.acquireRelease(Effect.sync(() => Lmdb.open(options)), lmdb => Effect.promise(() => lmdb.close())));
+export const make = options => Effect.gen(function* () {
+  const lmdb = yield* Effect.acquireRelease(Effect.sync(() => Lmdb.open(options)), lmdb => Effect.promise(() => lmdb.close()));
   return Persistence.BackingPersistence.of({
     [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
-    make: storeId => Effect.gen(function* (_) {
-      const clock = yield* _(Effect.clock);
-      const store = yield* _(Effect.acquireRelease(Effect.sync(() => lmdb.openDB({
+    make: storeId => Effect.gen(function* () {
+      const clock = yield* Effect.clock;
+      const store = yield* Effect.acquireRelease(Effect.sync(() => lmdb.openDB({
         name: storeId
-      })), store => Effect.promise(() => store.close())));
+      })), store => Effect.promise(() => store.close()));
       const valueToOption = (key, _) => {
         if (!Arr.isArray(_)) return Option.none();
         const [value, expires] = _;
diff --git a/dist/esm/Persistence/Lmdb.js.map b/dist/esm/Persistence/Lmdb.js.map
index fe2f615e04d55703f242194d9b5f7ae0f0f28eac..cbd704bfcfe076a79ba71444e68449b7a7ab0242 100644
--- a/dist/esm/Persistence/Lmdb.js.map
+++ b/dist/esm/Persistence/Lmdb.js.map
@@ -1 +1 @@
-{"version":3,"file":"Lmdb.js","names":["Arr","Effect","identity","Layer","Option","Lmdb","Persistence","make","options","gen","_","lmdb","acquireRelease","sync","open","promise","close","BackingPersistence","of","BackingPersistenceTypeId","storeId","clock","store","openDB","name","valueToOption","key","isArray","none","value","expires","unsafeCurrentTimeMillis","remove","some","get","try","catch","error","PersistenceBackingError","getMany","keys","map","tryPromise","i","set","ttl","put","unsafeTtlToExpires","clear","clearAsync","layer","scoped","layerResult","pipe","provide"],"sources":["../../../src/Persistence/Lmdb.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Lmdb.js","names":["Arr","Effect","identity","Layer","Option","Lmdb","Persistence","make","options","gen","lmdb","acquireRelease","sync","open","promise","close","BackingPersistence","of","BackingPersistenceTypeId","storeId","clock","store","openDB","name","valueToOption","key","_","isArray","none","value","expires","unsafeCurrentTimeMillis","remove","some","get","try","catch","error","PersistenceBackingError","getMany","keys","map","tryPromise","i","set","ttl","put","unsafeTtlToExpires","clear","clearAsync","layer","scoped","layerResult","pipe","provide"],"sources":["../../../src/Persistence/Lmdb.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Persistence/Redis.js b/dist/esm/Persistence/Redis.js
index a834991b773ca19c2c367961ef93c38a5457f462..00cca07a3cee5fb9fa71b81f5e77337a5c84aa66 100644
--- a/dist/esm/Persistence/Redis.js
+++ b/dist/esm/Persistence/Redis.js
@@ -13,8 +13,8 @@ import * as Persistence from "../Persistence.js";
  * @since 1.0.0
  * @category constructors
  */
-export const make = options => Effect.gen(function* (_) {
-  const redis = yield* _(Effect.acquireRelease(Effect.sync(() => new Redis(options)), redis => Effect.promise(() => redis.quit())));
+export const make = options => Effect.gen(function* () {
+  const redis = yield* Effect.acquireRelease(Effect.sync(() => new Redis(options)), redis => Effect.promise(() => redis.quit()));
   return Persistence.BackingPersistence.of({
     [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
     make: prefix => Effect.sync(() => {
diff --git a/dist/esm/Persistence/Redis.js.map b/dist/esm/Persistence/Redis.js.map
index 809381d9a5d5c513747b0af1b00434619aa2b251..4f5ac126c7b4eb042aacd4d1b05fcffb0b543560 100644
--- a/dist/esm/Persistence/Redis.js.map
+++ b/dist/esm/Persistence/Redis.js.map
@@ -1 +1 @@
-{"version":3,"file":"Redis.js","names":["Config","Duration","Effect","identity","Layer","Option","Redis","Persistence","make","options","gen","_","redis","acquireRelease","sync","promise","quit","BackingPersistence","of","BackingPersistenceTypeId","prefix","prefixed","key","parse","method","str","succeedNone","try","some","JSON","catch","error","PersistenceBackingError","get","flatMap","tryPromise","getMany","keys","mget","map","forEach","set","value","ttl","tryMapPromise","stringify","_tag","toMillis","remove","del","clear","then","layer","scoped","layerConfig","unwrap","layerResult","pipe","provide","layerResultConfig"],"sources":["../../../src/Persistence/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Redis.js","names":["Config","Duration","Effect","identity","Layer","Option","Redis","Persistence","make","options","gen","redis","acquireRelease","sync","promise","quit","BackingPersistence","of","BackingPersistenceTypeId","prefix","prefixed","key","parse","method","str","succeedNone","try","some","JSON","catch","error","PersistenceBackingError","get","flatMap","tryPromise","getMany","keys","mget","map","forEach","set","value","ttl","tryMapPromise","stringify","_tag","toMillis","remove","del","clear","then","layer","scoped","layerConfig","unwrap","layerResult","pipe","provide","layerResultConfig"],"sources":["../../../src/Persistence/Redis.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Persistence.js b/dist/esm/Persistence.js
index 00c6b2bddacfb2ec0aafcf05037a8de7b82961f4..9a05bd6b0b544cc4665a11cf1056507f5caff56a 100644
--- a/dist/esm/Persistence.js
+++ b/dist/esm/Persistence.js
@@ -3,15 +3,15 @@
  */
 import { TypeIdError } from "@effect/platform/Error";
 import * as KeyValueStore from "@effect/platform/KeyValueStore";
-import * as Serializable from "@effect/schema/Serializable";
-import * as TreeFormatter from "@effect/schema/TreeFormatter";
 import * as Context from "effect/Context";
 import * as Duration from "effect/Duration";
 import * as Effect from "effect/Effect";
 import { identity } from "effect/Function";
 import * as Layer from "effect/Layer";
 import * as Option from "effect/Option";
+import * as ParseResult from "effect/ParseResult";
 import * as PrimaryKey from "effect/PrimaryKey";
+import * as Schema from "effect/Schema";
 /**
  * @since 1.0.0
  * @category type ids
@@ -33,7 +33,7 @@ export class PersistenceParseError extends /*#__PURE__*/TypeIdError(ErrorTypeId,
     });
   }
   get message() {
-    return TreeFormatter.formatIssueSync(this.error);
+    return ParseResult.TreeFormatter.formatIssueSync(this.error);
   }
 }
 /**
@@ -79,15 +79,15 @@ export const ResultPersistence = /*#__PURE__*/Context.GenericTag("@effect/experi
  * @since 1.0.0
  * @category layers
  */
-export const layerResult = /*#__PURE__*/Layer.effect(ResultPersistence, /*#__PURE__*/Effect.gen(function* (_) {
-  const backing = yield* _(BackingPersistence);
+export const layerResult = /*#__PURE__*/Layer.effect(ResultPersistence, /*#__PURE__*/Effect.gen(function* () {
+  const backing = yield* BackingPersistence;
   return ResultPersistence.of({
     [ResultPersistenceTypeId]: ResultPersistenceTypeId,
     make: options => Effect.gen(function* () {
       const storage = yield* backing.make(options.storeId);
       const timeToLive = options.timeToLive ?? (() => Duration.infinity);
-      const parse = (method, key, value) => Effect.mapError(Serializable.deserializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
-      const encode = (method, key, value) => Effect.mapError(Serializable.serializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
+      const parse = (method, key, value) => Effect.mapError(Schema.deserializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
+      const encode = (method, key, value) => Effect.mapError(Schema.serializeExit(key, value), _ => PersistenceParseError.make(method, _.issue));
       const makeKey = key => key[PrimaryKey.symbol]();
       return identity({
         get: key => Effect.flatMap(storage.get(makeKey(key)), Option.match({
@@ -156,8 +156,8 @@ export const layerMemory = /*#__PURE__*/Layer.sync(BackingPersistence, () => {
  * @since 1.0.0
  * @category layers
  */
-export const layerKeyValueStore = /*#__PURE__*/Layer.effect(BackingPersistence, /*#__PURE__*/Effect.gen(function* (_) {
-  const backing = yield* _(KeyValueStore.KeyValueStore);
+export const layerKeyValueStore = /*#__PURE__*/Layer.effect(BackingPersistence, /*#__PURE__*/Effect.gen(function* () {
+  const backing = yield* KeyValueStore.KeyValueStore;
   return BackingPersistence.of({
     [BackingPersistenceTypeId]: BackingPersistenceTypeId,
     make: storeId => Effect.map(Effect.clock, clock => {
diff --git a/dist/esm/Persistence.js.map b/dist/esm/Persistence.js.map
index 3a95c72be218759c8f15860909065610e3fb7a24..451e77c234998d685d691b6b0ea454f7bda56b7f 100644
--- a/dist/esm/Persistence.js.map
+++ b/dist/esm/Persistence.js.map
@@ -1 +1 @@
-{"version":3,"file":"Persistence.js","names":["TypeIdError","KeyValueStore","Serializable","TreeFormatter","Context","Duration","Effect","identity","Layer","Option","PrimaryKey","ErrorTypeId","Symbol","for","PersistenceParseError","make","method","error","reason","message","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","_","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","issue","encode","serializeExit","makeKey","symbol","get","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","i","pipe","tapError","remove","option","set","ttl","decode","isZero","void","encoded","isFinite","some","none","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","stringify","u","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"Persistence.js","names":["TypeIdError","KeyValueStore","Context","Duration","Effect","identity","Layer","Option","ParseResult","PrimaryKey","Schema","ErrorTypeId","Symbol","for","PersistenceParseError","make","method","error","reason","message","TreeFormatter","formatIssueSync","PersistenceBackingError","cause","BackingPersistenceTypeId","BackingPersistence","GenericTag","ResultPersistenceTypeId","ResultPersistence","layerResult","effect","gen","backing","of","options","storage","storeId","timeToLive","infinity","parse","key","value","mapError","deserializeExit","_","issue","encode","serializeExit","makeKey","symbol","get","flatMap","match","onNone","succeedNone","onSome","asSome","getMany","keys","map","forEach","result","i","pipe","tapError","remove","option","set","ttl","decode","isZero","void","encoded","isFinite","some","none","clear","layerMemory","sync","stores","Map","getStore","store","undefined","clock","unsafeGet","unsafeCurrentTimeMillis","delete","unsafeTtlToExpires","layerKeyValueStore","prefix","s","try","JSON","catch","Array","isArray","expires","as","ignore","succeed","stringify","u","layerResultMemory","provide","layerResultKeyValueStore","_tag","toMillis"],"sources":["../../src/Persistence.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Reactivity.js b/dist/esm/Reactivity.js
new file mode 100644
index 0000000000000000000000000000000000000000..c76b9b5ec9facba59c39641b84bb84342dc0f9e5
--- /dev/null
+++ b/dist/esm/Reactivity.js
@@ -0,0 +1,131 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context";
+import * as Effect from "effect/Effect";
+import * as Exit from "effect/Exit";
+import * as FiberHandle from "effect/FiberHandle";
+import * as Hash from "effect/Hash";
+import * as Layer from "effect/Layer";
+import * as Mailbox from "effect/Mailbox";
+import * as Scope from "effect/Scope";
+import * as Stream from "effect/Stream";
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class Reactivity extends /*#__PURE__*/Context.Tag("@effect/experimental/Reactivity")() {}
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const make = /*#__PURE__*/Effect.sync(() => {
+  const handlers = new Map();
+  const unsafeInvalidate = keys => {
+    if (Array.isArray(keys)) {
+      for (let i = 0; i < keys.length; i++) {
+        const set = handlers.get(stringOrHash(keys[i]));
+        if (set === undefined) continue;
+        for (const run of set) run();
+      }
+    } else {
+      const record = keys;
+      for (const key in record) {
+        const hashes = idHashes(key, record[key]);
+        for (let i = 0; i < hashes.length; i++) {
+          const set = handlers.get(hashes[i]);
+          if (set === undefined) continue;
+          for (const run of set) run();
+        }
+        const set = handlers.get(key);
+        if (set !== undefined) {
+          for (const run of set) run();
+        }
+      }
+    }
+  };
+  const invalidate = keys => Effect.sync(() => unsafeInvalidate(keys));
+  const mutation = (keys, effect) => Effect.ensuring(effect, invalidate(keys));
+  const query = (keys, effect) => Effect.gen(function* () {
+    const resolvedKeys = Array.isArray(keys) ? keys.map(stringOrHash) : recordHashes(keys);
+    const scope = yield* Effect.scope;
+    const results = yield* Mailbox.make();
+    const runFork = yield* FiberHandle.makeRuntime();
+    let running = false;
+    let pending = false;
+    const handleExit = exit => {
+      if (exit._tag === "Failure") {
+        results.unsafeDone(Exit.failCause(exit.cause));
+      } else {
+        results.unsafeOffer(exit.value);
+      }
+      if (pending) {
+        pending = false;
+        runFork(effect).addObserver(handleExit);
+      } else {
+        running = false;
+      }
+    };
+    function run() {
+      if (running) {
+        pending = true;
+        return;
+      }
+      running = true;
+      runFork(effect).addObserver(handleExit);
+    }
+    yield* Scope.addFinalizer(scope, Effect.sync(() => {
+      for (let i = 0; i < resolvedKeys.length; i++) {
+        const set = handlers.get(resolvedKeys[i]);
+        set.delete(run);
+        if (set.size === 0) {
+          handlers.delete(resolvedKeys[i]);
+        }
+      }
+    }));
+    for (let i = 0; i < resolvedKeys.length; i++) {
+      let set = handlers.get(resolvedKeys[i]);
+      if (set === undefined) {
+        set = new Set();
+        handlers.set(resolvedKeys[i], set);
+      }
+      set.add(run);
+    }
+    run();
+    return results;
+  });
+  const stream = (tables, effect) => query(tables, effect).pipe(Effect.map(Mailbox.toStream), Stream.unwrapScoped);
+  return Reactivity.of({
+    mutation,
+    query,
+    stream,
+    unsafeInvalidate,
+    invalidate
+  });
+});
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layer = /*#__PURE__*/Layer.scoped(Reactivity, make);
+function stringOrHash(u) {
+  return typeof u === "string" ? u : Hash.hash(u);
+}
+const idHashes = (keyHash, ids) => {
+  const hashes = new Array(ids.length);
+  for (let i = 0; i < ids.length; i++) {
+    hashes[i] = `${keyHash}:${stringOrHash(ids[i])}`;
+  }
+  return hashes;
+};
+const recordHashes = record => {
+  const hashes = [];
+  for (const key in record) {
+    hashes.push(key);
+    for (const idHash of idHashes(key, record[key])) {
+      hashes.push(idHash);
+    }
+  }
+  return hashes;
+};
+//# sourceMappingURL=Reactivity.js.map
\ No newline at end of file
diff --git a/dist/esm/Reactivity.js.map b/dist/esm/Reactivity.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..f10bded6f8ebbc272f6301a42e611188ff907751
--- /dev/null
+++ b/dist/esm/Reactivity.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Reactivity.js","names":["Context","Effect","Exit","FiberHandle","Hash","Layer","Mailbox","Scope","Stream","Reactivity","Tag","make","sync","handlers","Map","unsafeInvalidate","keys","Array","isArray","i","length","set","get","stringOrHash","undefined","run","record","key","hashes","idHashes","invalidate","mutation","effect","ensuring","query","gen","resolvedKeys","map","recordHashes","scope","results","runFork","makeRuntime","running","pending","handleExit","exit","_tag","unsafeDone","failCause","cause","unsafeOffer","value","addObserver","addFinalizer","delete","size","Set","add","stream","tables","pipe","toStream","unwrapScoped","of","layer","scoped","u","hash","keyHash","ids","push","idHash"],"sources":["../../src/Reactivity.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/RequestResolver.js b/dist/esm/RequestResolver.js
index ca52ebc8be96659b9a604e22a0f6804bcb2c5134..1d4cc7b24663747cb1ac486fbf5b3d6655cb3290 100644
--- a/dist/esm/RequestResolver.js
+++ b/dist/esm/RequestResolver.js
@@ -1,3 +1,6 @@
+/**
+ * @since 1.0.0
+ */
 import * as Arr from "effect/Array";
 import * as Deferred from "effect/Deferred";
 import * as Effect from "effect/Effect";
@@ -12,7 +15,7 @@ import * as Persistence from "./Persistence.js";
  * @since 1.0.0
  * @category combinators
  */
-export const dataLoader = /*#__PURE__*/dual(2, (self, options) => Effect.gen(function* (_) {
+export const dataLoader = /*#__PURE__*/dual(2, (self, options) => Effect.gen(function* () {
   const scope = yield* Effect.scope;
   const handle = yield* FiberHandle.make();
   const maxSize = options.maxBatchSize ?? Infinity;
@@ -63,7 +66,7 @@ export const dataLoader = /*#__PURE__*/dual(2, (self, options) => Effect.gen(fun
  * @since 1.0.0
  * @category combinators
  */
-export const persisted = /*#__PURE__*/dual(2, (self, options) => Effect.gen(function* (_) {
+export const persisted = /*#__PURE__*/dual(2, (self, options) => Effect.gen(function* () {
   const storage = yield* (yield* Persistence.ResultPersistence).make({
     storeId: options.storeId,
     timeToLive: options.timeToLive
diff --git a/dist/esm/RequestResolver.js.map b/dist/esm/RequestResolver.js.map
index 1a27c768415ebf13e8b98b26b058a3e80e86be86..aa611d37ebb943a32f9f36121ba5d901140a6df2 100644
--- a/dist/esm/RequestResolver.js.map
+++ b/dist/esm/RequestResolver.js.map
@@ -1 +1 @@
-{"version":3,"file":"RequestResolver.js","names":["Arr","Deferred","Effect","Either","FiberHandle","dual","pipe","Option","Request","RequestResolver","Persistence","dataLoader","self","options","gen","_","scope","handle","make","maxSize","maxBatchSize","Infinity","batch","empty","process","items","forEach","deferred","request","withRequestCaching","exit","flatMap","done","batching","discard","loop","suspend","length","void","sleep","window","forkIn","zipRight","interruptible","runLoop","run","onlyIfMissing","runLoopReset","splice","uninterruptible","fromEffect","item","push","await","onInterrupt","sync","index","indexOf","persisted","storage","ResultPersistence","storeId","timeToLive","partition","requests","getMany","map","partitionMap","i","match","onNone","left","onSome","right","orElseSucceed","set","result","ignoreLogged","makeBatched","remaining","results","completeCached","complete","completeUncached"],"sources":["../../src/RequestResolver.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"RequestResolver.js","names":["Arr","Deferred","Effect","Either","FiberHandle","dual","pipe","Option","Request","RequestResolver","Persistence","dataLoader","self","options","gen","scope","handle","make","maxSize","maxBatchSize","Infinity","batch","empty","process","items","forEach","deferred","request","withRequestCaching","exit","flatMap","done","batching","discard","loop","suspend","length","void","sleep","window","forkIn","zipRight","interruptible","runLoop","run","onlyIfMissing","runLoopReset","splice","uninterruptible","fromEffect","item","push","await","onInterrupt","sync","index","indexOf","persisted","storage","ResultPersistence","storeId","timeToLive","partition","requests","getMany","map","partitionMap","_","i","match","onNone","left","onSome","right","orElseSucceed","set","result","ignoreLogged","makeBatched","remaining","results","completeCached","complete","completeUncached"],"sources":["../../src/RequestResolver.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/Sse.js b/dist/esm/Sse.js
new file mode 100644
index 0000000000000000000000000000000000000000..c9c1369330b87505bf6350ae9ab6866b4e752822
--- /dev/null
+++ b/dist/esm/Sse.js
@@ -0,0 +1,215 @@
+/**
+ * @since 1.0.0
+ */
+import * as Channel from "effect/Channel";
+import * as Chunk from "effect/Chunk";
+import * as Data from "effect/Data";
+import * as Duration from "effect/Duration";
+import * as Effect from "effect/Effect";
+import * as Mailbox from "effect/Mailbox";
+import { hasProperty } from "effect/Predicate";
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const makeChannel = options => {
+  const events = Mailbox.make(options?.bufferSize ?? 16).pipe(Effect.map(mailbox => {
+    let events = [];
+    let retry;
+    const parser = makeParser(event => {
+      switch (event._tag) {
+        case "Retry":
+          return retry = event;
+        case "Event":
+          return events.push(event);
+      }
+    });
+    const input = {
+      awaitRead() {
+        return Effect.void;
+      },
+      emit(chunks) {
+        Chunk.forEach(chunks, parser.feed);
+        const toEmit = events;
+        events = [];
+        return retry ? Effect.zipRight(mailbox.offerAll(toEmit), mailbox.fail(retry)) : mailbox.offerAll(toEmit);
+      },
+      error(cause) {
+        return mailbox.failCause(cause);
+      },
+      done(_) {
+        return mailbox.end;
+      }
+    };
+    return Channel.embedInput(Mailbox.toChannel(mailbox), input);
+  }), Channel.unwrap);
+  const withRetry = Channel.catchAll(events, error => Retry.is(error) ? Effect.sleep(error.duration).pipe(Effect.as(withRetry), Channel.unwrap) : Channel.fail(error));
+  return withRetry;
+};
+/**
+ * Create a SSE parser.
+ *
+ * Adapted from https://github.com/rexxars/eventsource-parser under MIT license.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export function makeParser(onParse) {
+  // Processing state
+  let isFirstChunk;
+  let buffer;
+  let startingPosition;
+  let startingFieldLength;
+  // Event state
+  let eventId;
+  let lastEventId;
+  let eventName;
+  let data;
+  reset();
+  return {
+    feed,
+    reset
+  };
+  function reset() {
+    isFirstChunk = true;
+    buffer = "";
+    startingPosition = 0;
+    startingFieldLength = -1;
+    eventId = undefined;
+    eventName = undefined;
+    data = "";
+  }
+  function feed(chunk) {
+    buffer = buffer ? buffer + chunk : chunk;
+    // Strip any UTF8 byte order mark (BOM) at the start of the stream.
+    // Note that we do not strip any non - UTF8 BOM, as eventsource streams are
+    // always decoded as UTF8 as per the specification.
+    if (isFirstChunk && hasBom(buffer)) {
+      buffer = buffer.slice(BOM.length);
+    }
+    isFirstChunk = false;
+    // Set up chunk-specific processing state
+    const length = buffer.length;
+    let position = 0;
+    let discardTrailingNewline = false;
+    // Read the current buffer byte by byte
+    while (position < length) {
+      // EventSource allows for carriage return + line feed, which means we
+      // need to ignore a linefeed character if the previous character was a
+      // carriage return
+      // @todo refactor to reduce nesting, consider checking previous byte?
+      // @todo but consider multiple chunks etc
+      if (discardTrailingNewline) {
+        if (buffer[position] === "\n") {
+          ;
+          ++position;
+        }
+        discardTrailingNewline = false;
+      }
+      let lineLength = -1;
+      let fieldLength = startingFieldLength;
+      let character;
+      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {
+        character = buffer[index];
+        if (character === ":" && fieldLength < 0) {
+          fieldLength = index - position;
+        } else if (character === "\r") {
+          discardTrailingNewline = true;
+          lineLength = index - position;
+        } else if (character === "\n") {
+          lineLength = index - position;
+        }
+      }
+      if (lineLength < 0) {
+        startingPosition = length - position;
+        startingFieldLength = fieldLength;
+        break;
+      } else {
+        startingPosition = 0;
+        startingFieldLength = -1;
+      }
+      parseEventStreamLine(buffer, position, fieldLength, lineLength);
+      position += lineLength + 1;
+    }
+    if (position === length) {
+      // If we consumed the entire buffer to read the event, reset the buffer
+      buffer = "";
+    } else if (position > 0) {
+      // If there are bytes left to process, set the buffer to the unprocessed
+      // portion of the buffer only
+      buffer = buffer.slice(position);
+    }
+  }
+  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {
+    if (lineLength === 0) {
+      // We reached the last line of this event
+      if (data.length > 0) {
+        onParse({
+          _tag: "Event",
+          id: eventId,
+          event: eventName ?? "message",
+          data: data.slice(0, -1) // remove trailing newline
+        });
+        data = "";
+        eventId = undefined;
+      }
+      eventName = undefined;
+      return;
+    }
+    const noValue = fieldLength < 0;
+    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));
+    let step = 0;
+    if (noValue) {
+      step = lineLength;
+    } else if (lineBuffer[index + fieldLength + 1] === " ") {
+      step = fieldLength + 2;
+    } else {
+      step = fieldLength + 1;
+    }
+    const position = index + step;
+    const valueLength = lineLength - step;
+    const value = lineBuffer.slice(position, position + valueLength).toString();
+    if (field === "data") {
+      data += value ? `${value}\n` : "\n";
+    } else if (field === "event") {
+      eventName = value;
+    } else if (field === "id" && !value.includes("\u0000")) {
+      eventId = value;
+      lastEventId = value;
+    } else if (field === "retry") {
+      const retry = parseInt(value, 10);
+      if (!Number.isNaN(retry)) {
+        onParse(new Retry({
+          duration: Duration.millis(retry),
+          lastEventId
+        }));
+      }
+    }
+  }
+}
+const BOM = [239, 187, 191];
+function hasBom(buffer) {
+  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);
+}
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const RetryTypeId = /*#__PURE__*/Symbol.for("@effect/experimental/Sse/Retry");
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export class Retry extends /*#__PURE__*/Data.TaggedClass("Retry") {
+  /**
+   * @since 1.0.0
+   */
+  [RetryTypeId] = RetryTypeId;
+  /**
+   * @since 1.0.0
+   */
+  static is(u) {
+    return hasProperty(u, RetryTypeId);
+  }
+}
+//# sourceMappingURL=Sse.js.map
\ No newline at end of file
diff --git a/dist/esm/Sse.js.map b/dist/esm/Sse.js.map
new file mode 100644
index 0000000000000000000000000000000000000000..d8b39b421474280d5ee9ba3618463c4b680af375
--- /dev/null
+++ b/dist/esm/Sse.js.map
@@ -0,0 +1 @@
+{"version":3,"file":"Sse.js","names":["Channel","Chunk","Data","Duration","Effect","Mailbox","hasProperty","makeChannel","options","events","make","bufferSize","pipe","map","mailbox","retry","parser","makeParser","event","_tag","push","input","awaitRead","void","emit","chunks","forEach","feed","toEmit","zipRight","offerAll","fail","error","cause","failCause","done","_","end","embedInput","toChannel","unwrap","withRetry","catchAll","Retry","is","sleep","duration","as","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","lastEventId","eventName","data","reset","undefined","chunk","hasBom","slice","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","id","noValue","field","step","valueLength","value","toString","includes","parseInt","Number","isNaN","millis","every","charCode","charCodeAt","RetryTypeId","Symbol","for","TaggedClass","u"],"sources":["../../src/Sse.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/VariantSchema.js b/dist/esm/VariantSchema.js
index bde58792fb5881a801e42564d80f48152206f8eb..0af6db385c55c6943cee50764642c7641d9527bf 100644
--- a/dist/esm/VariantSchema.js
+++ b/dist/esm/VariantSchema.js
@@ -1,9 +1,9 @@
-import * as ParseResult from "@effect/schema/ParseResult";
-import * as Schema from "@effect/schema/Schema";
 import { constUndefined, dual } from "effect/Function";
 import * as Option from "effect/Option";
+import * as ParseResult from "effect/ParseResult";
 import { pipeArguments } from "effect/Pipeable";
 import * as Predicate from "effect/Predicate";
+import * as Schema from "effect/Schema";
 import * as Struct_ from "effect/Struct";
 /**
  * @since 1.0.0
@@ -72,7 +72,10 @@ export const make = options => {
       }
       for (const variant of options.variants) {
         Object.defineProperty(Base, variant, {
-          value: extract(variantStruct, variant)
+          value: extract(variantStruct, variant).annotations({
+            identifier: `${identifier}.${variant}`,
+            title: `${identifier}.${variant}`
+          })
         });
       }
       return Base;
@@ -142,10 +145,10 @@ export const Override = value => value;
  * @since 1.0.0
  * @category overrideable
  */
-export const Overrideable = (from, to, options) => Schema.transformOrFail(from, Schema.Union(Schema.Undefined, to.pipe(Schema.brand("Override"))), {
-  decode: _ => ParseResult.succeed(undefined),
+export const Overrideable = (from, to, options) => Schema.transformOrFail(from, Schema.Union(Schema.Undefined, to), {
+  decode: _ => options.decode ? ParseResult.decode(options.decode)(_) : ParseResult.succeed(undefined),
   encode: dt => options.generate(dt === undefined ? Option.none() : Option.some(dt))
-}).pipe(Schema.propertySignature, Schema.withConstructorDefault(constUndefined));
+}).pipe(Schema.propertySignature, Schema.withConstructorDefault(options.constructorDefault ?? constUndefined));
 const StructProto = {
   pipe() {
     return pipeArguments(this, arguments);
diff --git a/dist/esm/VariantSchema.js.map b/dist/esm/VariantSchema.js.map
index 3f2a301bc9c31b6b6422fc1ac3d3beb268261dfa..d80ff3bbee5378108a7dcc16cc7d16067923d789 100644
--- a/dist/esm/VariantSchema.js.map
+++ b/dist/esm/VariantSchema.js.map
@@ -1 +1 @@
-{"version":3,"file":"VariantSchema.js","names":["ParseResult","Schema","constUndefined","dual","Option","pipeArguments","Predicate","Struct_","TypeId","Symbol","for","cacheSymbol","isStruct","u","hasProperty","FieldTypeId","isField","extract","args","self","variant","options","cache","cacheKey","isDefault","undefined","fields","key","Object","keys","value","isSchema","schemas","Struct","make","Class","identifier","annotations","variantStruct","schema","defaultVariant","Base","variants","defineProperty","FieldOnly","obj","Field","FieldExcept","includes","UnionVariants","members","Union","fieldEvolve","f","field","fromEntries","map","evolve","fieldFromKey","mapping","entries","renameFieldValue","extractVariants","Override","Overrideable","from","to","transformOrFail","Undefined","pipe","brand","decode","_","succeed","encode","dt","generate","none","some","propertySignature","withConstructorDefault","StructProto","arguments","create","FieldProto","VariantUnion","filter","member","isPropertySignature","fromKey"],"sources":["../../src/VariantSchema.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"VariantSchema.js","names":["constUndefined","dual","Option","ParseResult","pipeArguments","Predicate","Schema","Struct_","TypeId","Symbol","for","cacheSymbol","isStruct","u","hasProperty","FieldTypeId","isField","extract","args","self","variant","options","cache","cacheKey","isDefault","undefined","fields","key","Object","keys","value","isSchema","schemas","Struct","make","Class","identifier","annotations","variantStruct","schema","defaultVariant","Base","variants","defineProperty","title","FieldOnly","obj","Field","FieldExcept","includes","UnionVariants","members","Union","fieldEvolve","f","field","fromEntries","map","evolve","fieldFromKey","mapping","entries","renameFieldValue","extractVariants","Override","Overrideable","from","to","transformOrFail","Undefined","decode","_","succeed","encode","dt","generate","none","some","pipe","propertySignature","withConstructorDefault","constructorDefault","StructProto","arguments","create","FieldProto","VariantUnion","filter","member","isPropertySignature","fromKey"],"sources":["../../src/VariantSchema.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/index.js b/dist/esm/index.js
index 11bb5bfdcca32e83182f61585ef257af1e39ac9c..fa209dcc202a084cb45ddfe72105e0e0465b4da7 100644
--- a/dist/esm/index.js
+++ b/dist/esm/index.js
@@ -1,23 +1,39 @@
 /**
  * @since 1.0.0
  */
-export * as ChannelSchema from "./ChannelSchema.js";
+export * as DevTools from "./DevTools.js";
 /**
  * @since 1.0.0
  */
-export * as DevTools from "./DevTools.js";
+export * as Event from "./Event.js";
 /**
  * @since 1.0.0
  */
-export * as Machine from "./Machine.js";
+export * as EventGroup from "./EventGroup.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventJournal from "./EventJournal.js";
 /**
  * @since 1.0.0
  */
-export * as MsgPack from "./MsgPack.js";
+export * as EventLog from "./EventLog.js";
 /**
  * @since 1.0.0
  */
-export * as Ndjson from "./Ndjson.js";
+export * as EventLogEncryption from "./EventLogEncryption.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventLogRemote from "./EventLogRemote.js";
+/**
+ * @since 1.0.0
+ */
+export * as EventLogServer from "./EventLogServer.js";
+/**
+ * @since 1.0.0
+ */
+export * as Machine from "./Machine.js";
 /**
  * @since 1.0.0
  */
@@ -26,6 +42,10 @@ export * as PersistedCache from "./PersistedCache.js";
  * @since 1.0.0
  */
 export * as Persistence from "./Persistence.js";
+/**
+ * @since 1.0.0
+ */
+export * as Reactivity from "./Reactivity.js";
 /**
  * @since 1.0.0
  */
@@ -33,7 +53,7 @@ export * as RequestResolver from "./RequestResolver.js";
 /**
  * @since 1.0.0
  */
-export * as SocketServer from "./SocketServer.js";
+export * as Sse from "./Sse.js";
 /**
  * @since 1.0.0
  */
diff --git a/dist/esm/index.js.map b/dist/esm/index.js.map
index 65de973ef39619f9f03bc5623e6498f9dd68747d..6af6e34c94a0f7eabf748621b0d772af66654b67 100644
--- a/dist/esm/index.js.map
+++ b/dist/esm/index.js.map
@@ -1 +1 @@
-{"version":3,"file":"index.js","names":["ChannelSchema","DevTools","Machine","MsgPack","Ndjson","PersistedCache","Persistence","RequestResolver","SocketServer","VariantSchema"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,aAAa,MAAM,oBAAoB;AAEnD;;;AAGA,OAAO,KAAKC,QAAQ,MAAM,eAAe;AAEzC;;;AAGA,OAAO,KAAKC,OAAO,MAAM,cAAc;AAEvC;;;AAGA,OAAO,KAAKC,OAAO,MAAM,cAAc;AAEvC;;;AAGA,OAAO,KAAKC,MAAM,MAAM,aAAa;AAErC;;;AAGA,OAAO,KAAKC,cAAc,MAAM,qBAAqB;AAErD;;;AAGA,OAAO,KAAKC,WAAW,MAAM,kBAAkB;AAE/C;;;AAGA,OAAO,KAAKC,eAAe,MAAM,sBAAsB;AAEvD;;;AAGA,OAAO,KAAKC,YAAY,MAAM,mBAAmB;AAEjD;;;AAGA,OAAO,KAAKC,aAAa,MAAM,oBAAoB","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"index.js","names":["DevTools","Event","EventGroup","EventJournal","EventLog","EventLogEncryption","EventLogRemote","EventLogServer","Machine","PersistedCache","Persistence","Reactivity","RequestResolver","Sse","VariantSchema"],"sources":["../../src/index.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAGA,OAAO,KAAKA,QAAQ,MAAM,eAAe;AAEzC;;;AAGA,OAAO,KAAKC,KAAK,MAAM,YAAY;AAEnC;;;AAGA,OAAO,KAAKC,UAAU,MAAM,iBAAiB;AAE7C;;;AAGA,OAAO,KAAKC,YAAY,MAAM,mBAAmB;AAEjD;;;AAGA,OAAO,KAAKC,QAAQ,MAAM,eAAe;AAEzC;;;AAGA,OAAO,KAAKC,kBAAkB,MAAM,yBAAyB;AAE7D;;;AAGA,OAAO,KAAKC,cAAc,MAAM,qBAAqB;AAErD;;;AAGA,OAAO,KAAKC,cAAc,MAAM,qBAAqB;AAErD;;;AAGA,OAAO,KAAKC,OAAO,MAAM,cAAc;AAEvC;;;AAGA,OAAO,KAAKC,cAAc,MAAM,qBAAqB;AAErD;;;AAGA,OAAO,KAAKC,WAAW,MAAM,kBAAkB;AAE/C;;;AAGA,OAAO,KAAKC,UAAU,MAAM,iBAAiB;AAE7C;;;AAGA,OAAO,KAAKC,eAAe,MAAM,sBAAsB;AAEvD;;;AAGA,OAAO,KAAKC,GAAG,MAAM,UAAU;AAE/B;;;AAGA,OAAO,KAAKC,aAAa,MAAM,oBAAoB","ignoreList":[]}
\ No newline at end of file
diff --git a/package.json b/package.json
index 7f0da5eaddc91089ed832bbe56b9f3520fe3c3c1..033309a0cb15fff7899e34b894f7fe84e4b79538 100644
--- a/package.json
+++ b/package.json
@@ -10,16 +10,14 @@
   },
   "sideEffects": [],
   "dependencies": {
-    "msgpackr": "^1.10.2"
+    "uuid": "^11.0.3"
   },
   "peerDependencies": {
-    "ioredis": "^5",
-    "lmdb": "^3",
-    "ws": "^8",
     "@effect/platform": "^0.66.2",
     "@effect/platform-node": "^0.61.3",
-    "@effect/schema": "^0.74.1",
-    "effect": "^3.8.4"
+    "effect": "^3.8.4",
+    "ioredis": "^5",
+    "lmdb": "^3"
   },
   "peerDependenciesMeta": {
     "@effect/platform-node": {
@@ -30,9 +28,6 @@
     },
     "lmdb": {
       "optional": true
-    },
-    "ws": {
-      "optional": true
     }
   },
   "publishConfig": {
@@ -48,11 +43,6 @@
       "import": "./dist/esm/index.js",
       "default": "./dist/cjs/index.js"
     },
-    "./ChannelSchema": {
-      "types": "./dist/dts/ChannelSchema.d.ts",
-      "import": "./dist/esm/ChannelSchema.js",
-      "default": "./dist/cjs/ChannelSchema.js"
-    },
     "./DevTools": {
       "types": "./dist/dts/DevTools.d.ts",
       "import": "./dist/esm/DevTools.js",
@@ -73,6 +63,51 @@
       "import": "./dist/esm/DevTools/Server.js",
       "default": "./dist/cjs/DevTools/Server.js"
     },
+    "./Event": {
+      "types": "./dist/dts/Event.d.ts",
+      "import": "./dist/esm/Event.js",
+      "default": "./dist/cjs/Event.js"
+    },
+    "./EventGroup": {
+      "types": "./dist/dts/EventGroup.d.ts",
+      "import": "./dist/esm/EventGroup.js",
+      "default": "./dist/cjs/EventGroup.js"
+    },
+    "./EventJournal": {
+      "types": "./dist/dts/EventJournal.d.ts",
+      "import": "./dist/esm/EventJournal.js",
+      "default": "./dist/cjs/EventJournal.js"
+    },
+    "./EventLog": {
+      "types": "./dist/dts/EventLog.d.ts",
+      "import": "./dist/esm/EventLog.js",
+      "default": "./dist/cjs/EventLog.js"
+    },
+    "./EventLogEncryption": {
+      "types": "./dist/dts/EventLogEncryption.d.ts",
+      "import": "./dist/esm/EventLogEncryption.js",
+      "default": "./dist/cjs/EventLogEncryption.js"
+    },
+    "./EventLogRemote": {
+      "types": "./dist/dts/EventLogRemote.d.ts",
+      "import": "./dist/esm/EventLogRemote.js",
+      "default": "./dist/cjs/EventLogRemote.js"
+    },
+    "./EventLogRemote/Node": {
+      "types": "./dist/dts/EventLogRemote/Node.d.ts",
+      "import": "./dist/esm/EventLogRemote/Node.js",
+      "default": "./dist/cjs/EventLogRemote/Node.js"
+    },
+    "./EventLogServer": {
+      "types": "./dist/dts/EventLogServer.d.ts",
+      "import": "./dist/esm/EventLogServer.js",
+      "default": "./dist/cjs/EventLogServer.js"
+    },
+    "./EventLogServer/Cloudflare": {
+      "types": "./dist/dts/EventLogServer/Cloudflare.d.ts",
+      "import": "./dist/esm/EventLogServer/Cloudflare.js",
+      "default": "./dist/cjs/EventLogServer/Cloudflare.js"
+    },
     "./Machine": {
       "types": "./dist/dts/Machine.d.ts",
       "import": "./dist/esm/Machine.js",
@@ -93,16 +128,6 @@
       "import": "./dist/esm/Machine/SerializableProcedureList.js",
       "default": "./dist/cjs/Machine/SerializableProcedureList.js"
     },
-    "./MsgPack": {
-      "types": "./dist/dts/MsgPack.d.ts",
-      "import": "./dist/esm/MsgPack.js",
-      "default": "./dist/cjs/MsgPack.js"
-    },
-    "./Ndjson": {
-      "types": "./dist/dts/Ndjson.d.ts",
-      "import": "./dist/esm/Ndjson.js",
-      "default": "./dist/cjs/Ndjson.js"
-    },
     "./PersistedCache": {
       "types": "./dist/dts/PersistedCache.d.ts",
       "import": "./dist/esm/PersistedCache.js",
@@ -123,20 +148,20 @@
       "import": "./dist/esm/Persistence/Redis.js",
       "default": "./dist/cjs/Persistence/Redis.js"
     },
+    "./Reactivity": {
+      "types": "./dist/dts/Reactivity.d.ts",
+      "import": "./dist/esm/Reactivity.js",
+      "default": "./dist/cjs/Reactivity.js"
+    },
     "./RequestResolver": {
       "types": "./dist/dts/RequestResolver.d.ts",
       "import": "./dist/esm/RequestResolver.js",
       "default": "./dist/cjs/RequestResolver.js"
     },
-    "./SocketServer": {
-      "types": "./dist/dts/SocketServer.d.ts",
-      "import": "./dist/esm/SocketServer.js",
-      "default": "./dist/cjs/SocketServer.js"
-    },
-    "./SocketServer/Node": {
-      "types": "./dist/dts/SocketServer/Node.d.ts",
-      "import": "./dist/esm/SocketServer/Node.js",
-      "default": "./dist/cjs/SocketServer/Node.js"
+    "./Sse": {
+      "types": "./dist/dts/Sse.d.ts",
+      "import": "./dist/esm/Sse.js",
+      "default": "./dist/cjs/Sse.js"
     },
     "./VariantSchema": {
       "types": "./dist/dts/VariantSchema.d.ts",
@@ -146,9 +171,6 @@
   },
   "typesVersions": {
     "*": {
-      "ChannelSchema": [
-        "./dist/dts/ChannelSchema.d.ts"
-      ],
       "DevTools": [
         "./dist/dts/DevTools.d.ts"
       ],
@@ -161,6 +183,33 @@
       "DevTools/Server": [
         "./dist/dts/DevTools/Server.d.ts"
       ],
+      "Event": [
+        "./dist/dts/Event.d.ts"
+      ],
+      "EventGroup": [
+        "./dist/dts/EventGroup.d.ts"
+      ],
+      "EventJournal": [
+        "./dist/dts/EventJournal.d.ts"
+      ],
+      "EventLog": [
+        "./dist/dts/EventLog.d.ts"
+      ],
+      "EventLogEncryption": [
+        "./dist/dts/EventLogEncryption.d.ts"
+      ],
+      "EventLogRemote": [
+        "./dist/dts/EventLogRemote.d.ts"
+      ],
+      "EventLogRemote/Node": [
+        "./dist/dts/EventLogRemote/Node.d.ts"
+      ],
+      "EventLogServer": [
+        "./dist/dts/EventLogServer.d.ts"
+      ],
+      "EventLogServer/Cloudflare": [
+        "./dist/dts/EventLogServer/Cloudflare.d.ts"
+      ],
       "Machine": [
         "./dist/dts/Machine.d.ts"
       ],
@@ -173,12 +222,6 @@
       "Machine/SerializableProcedureList": [
         "./dist/dts/Machine/SerializableProcedureList.d.ts"
       ],
-      "MsgPack": [
-        "./dist/dts/MsgPack.d.ts"
-      ],
-      "Ndjson": [
-        "./dist/dts/Ndjson.d.ts"
-      ],
       "PersistedCache": [
         "./dist/dts/PersistedCache.d.ts"
       ],
@@ -191,14 +234,14 @@
       "Persistence/Redis": [
         "./dist/dts/Persistence/Redis.d.ts"
       ],
+      "Reactivity": [
+        "./dist/dts/Reactivity.d.ts"
+      ],
       "RequestResolver": [
         "./dist/dts/RequestResolver.d.ts"
       ],
-      "SocketServer": [
-        "./dist/dts/SocketServer.d.ts"
-      ],
-      "SocketServer/Node": [
-        "./dist/dts/SocketServer/Node.d.ts"
+      "Sse": [
+        "./dist/dts/Sse.d.ts"
       ],
       "VariantSchema": [
         "./dist/dts/VariantSchema.d.ts"
diff --git a/src/DevTools/Client.ts b/src/DevTools/Client.ts
index 3cf9877b8a4578922439bee688fcf0eebf3dc32a..1405b8048c3093e0a4448fabfe8646daea15a1d8 100644
--- a/src/DevTools/Client.ts
+++ b/src/DevTools/Client.ts
@@ -1,10 +1,13 @@
 /**
  * @since 1.0.0
  */
+import * as Ndjson from "@effect/platform/Ndjson"
 import * as Socket from "@effect/platform/Socket"
 import * as Cause from "effect/Cause"
 import * as Context from "effect/Context"
+import * as Deferred from "effect/Deferred"
 import * as Effect from "effect/Effect"
+import * as Exit from "effect/Exit"
 import { pipe } from "effect/Function"
 import * as Layer from "effect/Layer"
 import * as Mailbox from "effect/Mailbox"
@@ -14,7 +17,6 @@ import * as Schedule from "effect/Schedule"
 import type * as Scope from "effect/Scope"
 import * as Stream from "effect/Stream"
 import * as Tracer from "effect/Tracer"
-import * as Ndjson from "../Ndjson.js"
 import * as Domain from "./Domain.js"
 
 /**
@@ -104,6 +106,8 @@ export const make: Effect.Effect<ClientImpl, never, Scope.Scope | Socket.Socket>
     }
   }
 
+  const connected = yield* Deferred.make<void>()
+
   yield* Mailbox.toStream(requests).pipe(
     Stream.pipeThroughChannel(
       Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
@@ -112,6 +116,7 @@ export const make: Effect.Effect<ClientImpl, never, Scope.Scope | Socket.Socket>
       })
     ),
     Stream.runForEach((req) => {
+      Deferred.unsafeDone(connected, Exit.void)
       switch (req._tag) {
         case "MetricsRequest": {
           return requests.offer(metricsSnapshot())
@@ -121,8 +126,8 @@ export const make: Effect.Effect<ClientImpl, never, Scope.Scope | Socket.Socket>
         }
       }
     }),
+    Effect.tapErrorCause(Effect.logDebug),
     Effect.retry(Schedule.spaced("1 seconds")),
-    Effect.catchAllCause(Effect.logDebug),
     Effect.forkScoped,
     Effect.uninterruptible
   )
@@ -139,6 +144,10 @@ export const make: Effect.Effect<ClientImpl, never, Scope.Scope | Socket.Socket>
     Effect.interruptible
   )
 
+  yield* Deferred.await(connected).pipe(
+    Effect.timeoutOption("1 second")
+  )
+
   return Client.of({
     unsafeAddSpan: (request) => requests.unsafeOffer(request)
   })
@@ -160,9 +169,9 @@ export const layer: Layer.Layer<Client, never, Socket.Socket> = Layer.scoped(Cli
  * @since 1.0.0
  * @category constructors
  */
-export const makeTracer: Effect.Effect<Tracer.Tracer, never, Client> = Effect.gen(function*(_) {
-  const client = yield* _(Client)
-  const currentTracer = yield* _(Effect.tracer)
+export const makeTracer: Effect.Effect<Tracer.Tracer, never, Client> = Effect.gen(function*() {
+  const client = yield* Client
+  const currentTracer = yield* Effect.tracer
 
   return Tracer.make({
     span(name, parent, context, links, startTime, kind) {
diff --git a/src/DevTools/Domain.ts b/src/DevTools/Domain.ts
index 0771bac1f93b9f8b3c17c6b3b645f0a27e625fca..a9cdfad7b23f6133c3aa9f720623a94984b6d119 100644
--- a/src/DevTools/Domain.ts
+++ b/src/DevTools/Domain.ts
@@ -1,8 +1,8 @@
 /**
  * @since 1.0.0
  */
-import * as Schema from "@effect/schema/Schema"
 import type { Option } from "effect/Option"
+import * as Schema from "effect/Schema"
 
 /**
  * @since 1.0.0
@@ -64,7 +64,11 @@ export const Span: Schema.Schema<Span, SpanFrom> = Schema.Struct({
   sampled: Schema.Boolean,
   attributes: Schema.ReadonlyMap({ key: Schema.String, value: Schema.Unknown }),
   status: SpanStatus,
-  parent: Schema.Option(Schema.suspend(() => ParentSpan))
+  parent: Schema.Option(
+    Schema.suspend(() => ParentSpan)
+      // add a title annotation to avoid "Cannot access 'ParentSpan' before initialization" error during module initialization
+      .annotations({ title: "ParentSpan" })
+  )
 })
 
 /**
diff --git a/src/DevTools/Server.ts b/src/DevTools/Server.ts
index 9fc80ccaa72b070c106f8f88c3a509db7a60d5bc..92ef64beddfff5a0b661e37731b7fcce03e2e1ec 100644
--- a/src/DevTools/Server.ts
+++ b/src/DevTools/Server.ts
@@ -1,89 +1,56 @@
 /**
  * @since 1.0.0
  */
+import * as Ndjson from "@effect/platform/Ndjson"
 import * as Socket from "@effect/platform/Socket"
-import * as Context from "effect/Context"
+import * as SocketServer from "@effect/platform/SocketServer"
 import * as Effect from "effect/Effect"
-import * as Queue from "effect/Queue"
+import * as Mailbox from "effect/Mailbox"
 import * as Stream from "effect/Stream"
-import * as Ndjson from "../Ndjson.js"
-import * as SocketServer from "../SocketServer/Node.js"
 import * as Domain from "./Domain.js"
 
-/**
- * @since 1.0.0
- * @category models
- */
-export interface ServerImpl {
-  readonly run: <R, E, _>(
-    handle: (client: Client) => Effect.Effect<_, E, R>
-  ) => Effect.Effect<never, SocketServer.SocketServerError | E, R>
-}
-
 /**
  * @since 1.0.0
  * @category models
  */
 export interface Client {
-  readonly queue: Queue.Dequeue<Domain.Request.WithoutPing>
+  readonly queue: Mailbox.ReadonlyMailbox<Domain.Request.WithoutPing>
   readonly request: (_: Domain.Response.WithoutPong) => Effect.Effect<void>
 }
 
-/**
- * @since 1.0.0
- * @category tags
- */
-export interface Server {
-  readonly _: unique symbol
-}
-
-/**
- * @since 1.0.0
- * @category tags
- */
-export const Server = Context.GenericTag<Server, ServerImpl>("@effect/experimental/DevTools/Server")
-
 /**
  * @since 1.0.0
  * @category constructors
  */
-export const make = Effect.gen(function*(_) {
-  const server = yield* _(SocketServer.SocketServer)
-
-  const run = <R, E, _>(handle: (client: Client) => Effect.Effect<_, E, R>) =>
-    server.run((socket) =>
-      Effect.gen(function*(_) {
-        const responses = yield* _(Queue.unbounded<Domain.Response>())
-        const requests = yield* _(Queue.unbounded<Domain.Request.WithoutPing>())
-
-        const client: Client = {
-          queue: requests,
-          request: (res) => responses.offer(res)
-        }
-
-        yield* _(
-          Stream.fromQueue(responses),
-          Stream.pipeThroughChannel(
-            Ndjson.duplexSchema(Socket.toChannel(socket), {
-              inputSchema: Domain.Response,
-              outputSchema: Domain.Request
-            })
-          ),
-          Stream.runForEach((req) =>
-            req._tag === "Ping"
-              ? responses.offer({ _tag: "Pong" })
-              : requests.offer(req)
-          ),
-          Effect.ensuring(Effect.all([
-            requests.shutdown,
-            responses.shutdown
-          ])),
-          Effect.fork
-        )
-
-        return yield* _(handle(client))
-      })
-    )
-
-  return Server.of({ run })
+export const run = Effect.fnUntraced(function*<R, E, _>(handle: (client: Client) => Effect.Effect<_, E, R>) {
+  const server = yield* SocketServer.SocketServer
+  return yield* server.run((socket) =>
+    Effect.gen(function*() {
+      const responses = yield* Mailbox.make<Domain.Response>()
+      const requests = yield* Mailbox.make<Domain.Request.WithoutPing>()
+
+      const client: Client = {
+        queue: requests,
+        request: (res) => responses.offer(res)
+      }
+
+      yield* Mailbox.toStream(responses).pipe(
+        Stream.pipeThroughChannel(
+          Ndjson.duplexSchemaString(Socket.toChannelString(socket), {
+            inputSchema: Domain.Response,
+            outputSchema: Domain.Request
+          })
+        ),
+        Stream.runForEach((req) =>
+          req._tag === "Ping"
+            ? responses.offer({ _tag: "Pong" })
+            : requests.offer(req)
+        ),
+        Effect.ensuring(Effect.zipRight(responses.shutdown, requests.shutdown)),
+        Effect.fork
+      )
+
+      yield* handle(client)
+    })
+  )
 })
diff --git a/src/Event.ts b/src/Event.ts
new file mode 100644
index 0000000000000000000000000000000000000000..4e325b56032d1e57225455634d8d7210ca95007e
--- /dev/null
+++ b/src/Event.ts
@@ -0,0 +1,261 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack"
+import { pipeArguments } from "effect/Pipeable"
+import * as Predicate from "effect/Predicate"
+import * as Schema from "effect/Schema"
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const TypeId: unique symbol = Symbol.for("@effect/experimental/Event")
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type TypeId = typeof TypeId
+
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export const isEvent = (u: unknown): u is Event<any, any, any, any> => Predicate.hasProperty(u, TypeId)
+
+/**
+ * Represents an event in an EventLog.
+ *
+ * @since 1.0.0
+ * @category models
+ */
+export interface Event<
+  out Tag extends string,
+  in out Payload extends Schema.Schema.Any = typeof Schema.Void,
+  in out Success extends Schema.Schema.Any = typeof Schema.Void,
+  in out Error extends Schema.Schema.All = typeof Schema.Never
+> {
+  readonly [TypeId]: TypeId
+  readonly tag: Tag
+  readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string
+  readonly payload: Payload
+  readonly payloadMsgPack: MsgPack.schema<Payload>
+  readonly success: Success
+  readonly error: Error
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventHandler<in out Tag extends string> {
+  readonly _: unique symbol
+  readonly tag: Tag
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare namespace Event {
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export interface Any {
+    readonly [TypeId]: TypeId
+    readonly tag: string
+  }
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export interface AnyWithProps extends Event<string, Schema.Schema.Any, Schema.Schema.Any, Schema.Schema.Any> {}
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ToService<A> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? EventHandler<_Tag> :
+    never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Tag<A> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? _Tag :
+    never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ErrorSchema<A extends Any> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? _Error
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Error<A extends Any> = Schema.Schema.Type<ErrorSchema<A>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type AddError<A extends Any, Error extends Schema.Schema.Any> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? Event<_Tag, _Payload, _Success, _Error | Error>
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type PayloadSchema<A extends Any> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? _Payload
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Payload<A extends Any> = Schema.Schema.Type<PayloadSchema<A>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type TaggedPayload<A extends Any> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? {
+      readonly _tag: _Tag
+      readonly payload: Schema.Schema.Type<_Payload>
+    }
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type SuccessSchema<A extends Any> = A extends Event<
+    infer _Tag,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? _Success
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Success<A extends Any> = Schema.Schema.Type<SuccessSchema<A>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Context<A> = A extends Event<
+    infer _Name,
+    infer _Payload,
+    infer _Success,
+    infer _Error
+  > ? Schema.Schema.Context<_Payload> | Schema.Schema.Context<_Success> | Schema.Schema.Context<_Error>
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type WithTag<Events extends Any, Tag extends string> = Extract<Events, { readonly tag: Tag }>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ExcludeTag<Events extends Any, Tag extends string> = Exclude<Events, { readonly tag: Tag }>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type PayloadWithTag<Events extends Any, Tag extends string> = Payload<WithTag<Events, Tag>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type SuccessWithTag<Events extends Any, Tag extends string> = Success<WithTag<Events, Tag>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ErrorWithTag<Events extends Any, Tag extends string> = Error<WithTag<Events, Tag>>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ContextWithTag<Events extends Any, Tag extends string> = Context<WithTag<Events, Tag>>
+}
+
+const Proto = {
+  [TypeId]: TypeId,
+  pipe() {
+    return pipeArguments(this, arguments)
+  }
+}
+
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const make = <
+  Tag extends string,
+  Payload extends Schema.Schema.Any = typeof Schema.Void,
+  Success extends Schema.Schema.Any = typeof Schema.Void,
+  Error extends Schema.Schema.All = typeof Schema.Never
+>(options: {
+  readonly tag: Tag
+  readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string
+  readonly payload?: Payload
+  readonly success?: Success
+  readonly error?: Error
+}): Event<Tag, Payload, Success, Error> =>
+  Object.assign(Object.create(Proto), {
+    tag: options.tag,
+    primaryKey: options.primaryKey,
+    payload: options.payload ?? Schema.Void,
+    payloadMsgPack: MsgPack.schema(options.payload ?? Schema.Void),
+    success: options.success ?? Schema.Void,
+    error: options.error ?? Schema.Never
+  })
diff --git a/src/EventGroup.ts b/src/EventGroup.ts
new file mode 100644
index 0000000000000000000000000000000000000000..74d7195f1851941a83fad16644366c7df4e8b422
--- /dev/null
+++ b/src/EventGroup.ts
@@ -0,0 +1,158 @@
+/**
+ * @since 1.0.0
+ */
+import * as HttpApiSchema from "@effect/platform/HttpApiSchema"
+import { type Pipeable, pipeArguments } from "effect/Pipeable"
+import * as Predicate from "effect/Predicate"
+import * as Record from "effect/Record"
+import type * as Schema from "effect/Schema"
+import type { Event } from "./Event.js"
+import * as EventApi from "./Event.js"
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const TypeId: unique symbol = Symbol.for("@effect/experimental/EventGroup")
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type TypeId = typeof TypeId
+
+/**
+ * @since 1.0.0
+ * @category guards
+ */
+export const isEventGroup = (u: unknown): u is EventGroup.Any => Predicate.hasProperty(u, TypeId)
+
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLogBuilder.group` api.
+ *
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventGroup<
+  out Events extends Event.Any = never
+> extends Pipeable {
+  new(_: never): {}
+
+  readonly [TypeId]: TypeId
+  readonly events: Record.ReadonlyRecord<string, Events>
+
+  /**
+   * Add an `Event` to the `EventGroup`.
+   */
+  add<
+    Tag extends string,
+    Payload extends Schema.Schema.Any = typeof Schema.Void,
+    Success extends Schema.Schema.Any = typeof Schema.Void,
+    Error extends Schema.Schema.All = typeof Schema.Never
+  >(options: {
+    readonly tag: Tag
+    readonly primaryKey: (payload: Schema.Schema.Type<Payload>) => string
+    readonly payload?: Payload
+    readonly success?: Success
+    readonly error?: Error
+  }): EventGroup<Events | Event<Tag, Payload, Success, Error>>
+
+  /**
+   * Add an error schema to all the events in the `EventGroup`.
+   */
+  addError<Error extends Schema.Schema.Any>(error: Error): EventGroup<Event.AddError<Events, Error>>
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export declare namespace EventGroup {
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export interface Any {
+    readonly [TypeId]: TypeId
+  }
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type AnyWithProps = EventGroup<Event.AnyWithProps>
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type ToService<A> = A extends EventGroup<infer _Events> ? Event.ToService<_Events>
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Events<Group> = Group extends EventGroup<infer _Events> ? _Events
+    : never
+
+  /**
+   * @since 1.0.0
+   * @category models
+   */
+  export type Context<Group> = Event.Context<Events<Group>>
+}
+
+const Proto = {
+  [TypeId]: TypeId,
+  add(this: EventGroup.AnyWithProps, options: {
+    readonly tag: string
+    readonly primaryKey: (payload: Schema.Schema.Any) => string
+    readonly payload?: Schema.Schema.Any
+    readonly success?: Schema.Schema.Any
+    readonly error?: Schema.Schema.All
+  }) {
+    return makeProto({
+      events: {
+        ...this.events,
+        [options.tag]: EventApi.make(options)
+      }
+    })
+  },
+  addError(this: EventGroup.AnyWithProps, error: Schema.Schema.Any) {
+    return makeProto({
+      events: Record.map(this.events, (event) =>
+        EventApi.make({
+          ...event,
+          error: HttpApiSchema.UnionUnify(event.error, error)
+        }))
+    })
+  },
+  pipe() {
+    return pipeArguments(this, arguments)
+  }
+}
+
+const makeProto = <
+  Events extends Event.Any
+>(options: {
+  readonly events: Record.ReadonlyRecord<string, Events>
+}): EventGroup<Events> => {
+  function EventGroup() {}
+  Object.setPrototypeOf(EventGroup, Proto)
+  return Object.assign(EventGroup, options) as any
+}
+
+/**
+ * An `EventGroup` is a collection of `Event`s. You can use an `EventGroup` to
+ * represent a portion of your domain.
+ *
+ * The events can be implemented later using the `EventLog.group` api.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export const empty: EventGroup<never> = makeProto({ events: Record.empty() })
diff --git a/src/EventJournal.ts b/src/EventJournal.ts
new file mode 100644
index 0000000000000000000000000000000000000000..4126ff20e4993db8ae6444aba73b0f982545ac92
--- /dev/null
+++ b/src/EventJournal.ts
@@ -0,0 +1,606 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack"
+import * as Context from "effect/Context"
+import * as DateTime from "effect/DateTime"
+import * as Effect from "effect/Effect"
+import * as Layer from "effect/Layer"
+import * as PubSub from "effect/PubSub"
+import type * as Queue from "effect/Queue"
+import * as Schema from "effect/Schema"
+import type { Scope } from "effect/Scope"
+import * as Uuid from "uuid"
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class EventJournal extends Context.Tag("@effect/experimental/EventJournal")<
+  EventJournal,
+  {
+    /**
+     * Read all the entries in the journal.
+     */
+    readonly entries: Effect.Effect<ReadonlyArray<Entry>, EventJournalError>
+
+    /**
+     * Write an event to the journal, performing an effect before committing the
+     * event.
+     */
+    readonly write: <A, E, R>(options: {
+      readonly event: string
+      readonly primaryKey: string
+      readonly payload: Uint8Array
+      readonly effect: (entry: Entry) => Effect.Effect<A, E, R>
+    }) => Effect.Effect<A, EventJournalError | E, R>
+
+    /**
+     * Write events from a remote source to the journal.
+     */
+    readonly writeFromRemote: (
+      options: {
+        readonly remoteId: RemoteId
+        readonly entries: ReadonlyArray<RemoteEntry>
+        readonly compact?:
+          | ((uncommitted: ReadonlyArray<RemoteEntry>) => Effect.Effect<
+            ReadonlyArray<[compacted: ReadonlyArray<Entry>, remoteEntries: ReadonlyArray<RemoteEntry>]>,
+            EventJournalError
+          >)
+          | undefined
+        readonly effect: (options: {
+          readonly entry: Entry
+          readonly conflicts: ReadonlyArray<Entry>
+        }) => Effect.Effect<void, EventJournalError>
+      }
+    ) => Effect.Effect<void, EventJournalError>
+
+    /**
+     * Return the uncommitted entries for a remote source.
+     */
+    readonly withRemoteUncommited: <A, E, R>(
+      remoteId: RemoteId,
+      f: (entries: ReadonlyArray<Entry>) => Effect.Effect<A, E, R>
+    ) => Effect.Effect<A, EventJournalError | E, R>
+
+    /**
+     * Retrieve the last known sequence number for a remote source.
+     */
+    readonly nextRemoteSequence: (remoteId: RemoteId) => Effect.Effect<number, EventJournalError>
+
+    /**
+     * The entries added to the local journal.
+     */
+    readonly changes: Effect.Effect<Queue.Dequeue<Entry>, never, Scope>
+
+    /**
+     * Remove all data
+     */
+    readonly destroy: Effect.Effect<void, EventJournalError>
+  }
+>() {}
+
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export const ErrorTypeId: unique symbol = Symbol.for("@effect/experimental/EventJournal/ErrorId")
+
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export type ErrorTypeId = typeof ErrorTypeId
+
+/**
+ * @since 1.0.0
+ * @category errors
+ */
+export class EventJournalError
+  extends Schema.TaggedClass<EventJournalError>("@effect/experimental/EventJournal/Error")("EventJournalError", {
+    method: Schema.String,
+    cause: Schema.Defect
+  })
+{
+  /**
+   * @since 1.0.0
+   */
+  readonly [ErrorTypeId]: ErrorTypeId = ErrorTypeId
+}
+
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const RemoteIdTypeId: unique symbol = Symbol.for("@effect/experimental/EventJournal/RemoteId")
+
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const RemoteId = Schema.Uint8ArrayFromSelf.pipe(Schema.brand(RemoteIdTypeId))
+
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export type RemoteId = typeof RemoteId.Type
+
+/**
+ * @since 1.0.0
+ * @category remote
+ */
+export const makeRemoteId = (): RemoteId => Uuid.v4({}, new Uint8Array(16)) as RemoteId
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const EntryIdTypeId: unique symbol = Symbol.for("@effect/experimental/EventJournal/EntryId")
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const EntryId = Schema.Uint8ArrayFromSelf.pipe(Schema.brand(EntryIdTypeId))
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export type EntryId = typeof EntryId.Type
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const makeEntryId = (options: { msecs?: number } = {}): EntryId => {
+  return Uuid.v7(options, new Uint8Array(16)) as EntryId
+}
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export const entryIdMillis = (entryId: EntryId): number => {
+  const bytes = new Uint8Array(8)
+  bytes.set(entryId.subarray(0, 6), 2)
+  return Number(new DataView(bytes.buffer).getBigUint64(0))
+}
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export class Entry extends Schema.Class<Entry>("@effect/experimental/EventJournal/Entry")({
+  id: EntryId,
+  event: Schema.String,
+  primaryKey: Schema.String,
+  payload: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static arrayMsgPack = Schema.Array(MsgPack.schema(Entry))
+
+  /**
+   * @since 1.0.0
+   */
+  static encodeArray = Schema.encode(Entry.arrayMsgPack)
+
+  /**
+   * @since 1.0.0
+   */
+  static decodeArray = Schema.decode(Entry.arrayMsgPack)
+
+  /**
+   * @since 1.0.0
+   */
+  get idString(): string {
+    return Uuid.stringify(this.id)
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  get createdAtMillis(): number {
+    return entryIdMillis(this.id)
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  get createdAt(): DateTime.Utc {
+    return DateTime.unsafeMake(this.createdAtMillis)
+  }
+}
+
+/**
+ * @since 1.0.0
+ * @category entry
+ */
+export class RemoteEntry extends Schema.Class<RemoteEntry>("@effect/experimental/EventJournal/RemoteEntry")({
+  remoteSequence: Schema.Number,
+  entry: Entry
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export const makeMemory: Effect.Effect<typeof EventJournal.Service> = Effect.gen(function*() {
+  const journal: Array<Entry> = []
+  const byId = new Map<string, Entry>()
+  const remotes = new Map<string, { sequence: number; missing: Array<Entry> }>()
+  const pubsub = yield* PubSub.unbounded<Entry>()
+
+  const ensureRemote = (remoteId: RemoteId) => {
+    const remoteIdString = Uuid.stringify(remoteId)
+    let remote = remotes.get(remoteIdString)
+    if (remote) return remote
+    remote = { sequence: 0, missing: journal.slice() }
+    remotes.set(remoteIdString, remote)
+    return remote
+  }
+
+  return EventJournal.of({
+    entries: Effect.sync(() => journal.slice()),
+    write({ effect, event, payload, primaryKey }) {
+      return Effect.acquireUseRelease(
+        Effect.sync(() =>
+          new Entry({
+            id: makeEntryId(),
+            event,
+            primaryKey,
+            payload
+          }, { disableValidation: true })
+        ),
+        effect,
+        (entry, exit) =>
+          Effect.suspend(() => {
+            if (exit._tag === "Failure" || byId.has(entry.idString)) return Effect.void
+            journal.push(entry)
+            byId.set(entry.idString, entry)
+            remotes.forEach((remote) => {
+              remote.missing.push(entry)
+            })
+            return pubsub.publish(entry)
+          })
+      )
+    },
+    writeFromRemote: (options) =>
+      Effect.gen(function*() {
+        const remote = ensureRemote(options.remoteId)
+        const uncommittedRemotes: Array<RemoteEntry> = []
+        const uncommitted: Array<Entry> = []
+        for (const remoteEntry of options.entries) {
+          if (byId.has(remoteEntry.entry.idString)) {
+            if (remoteEntry.remoteSequence > remote.sequence) {
+              remote.sequence = remoteEntry.remoteSequence
+            }
+            continue
+          }
+          uncommittedRemotes.push(remoteEntry)
+          uncommitted.push(remoteEntry.entry)
+        }
+
+        const brackets = options.compact
+          ? yield* options.compact(uncommittedRemotes)
+          : [[uncommitted, uncommittedRemotes]] as const
+
+        for (const [compacted, remoteEntries] of brackets) {
+          for (const originEntry of compacted) {
+            const entryMillis = entryIdMillis(originEntry.id)
+            const conflicts: Array<Entry> = []
+            for (let i = journal.length - 1; i >= -1; i--) {
+              const entry = journal[i]
+              if (entry !== undefined && entry.createdAtMillis > entryMillis) {
+                continue
+              }
+              for (let j = i + 2; j < journal.length; j++) {
+                const entry = journal[j]!
+                if (entry.event === originEntry.event && entry.primaryKey === originEntry.primaryKey) {
+                  conflicts.push(entry)
+                }
+              }
+              yield* options.effect({ entry: originEntry, conflicts })
+              break
+            }
+          }
+          for (let j = 0; j < remoteEntries.length; j++) {
+            const remoteEntry = remoteEntries[j]
+            journal.push(remoteEntry.entry)
+            if (remoteEntry.remoteSequence > remote.sequence) {
+              remote.sequence = remoteEntry.remoteSequence
+            }
+          }
+          journal.sort((a, b) => a.createdAtMillis - b.createdAtMillis)
+        }
+      }),
+    withRemoteUncommited: (remoteId, f) =>
+      Effect.acquireUseRelease(
+        Effect.sync(() => ensureRemote(remoteId).missing.slice()),
+        f,
+        (entries, exit) =>
+          Effect.sync(() => {
+            if (exit._tag === "Failure") return
+            const last = entries[entries.length - 1]
+            if (!last) return
+            const remote = ensureRemote(remoteId)
+            for (let i = remote.missing.length - 1; i >= 0; i--) {
+              if (remote.missing[i].id === last.id) {
+                remote.missing = remote.missing.slice(i + 1)
+                break
+              }
+            }
+          })
+      ),
+    nextRemoteSequence: (remoteId) => Effect.sync(() => ensureRemote(remoteId).sequence),
+    changes: PubSub.subscribe(pubsub),
+    destroy: Effect.sync(() => {
+      journal.length = 0
+      byId.clear()
+      remotes.clear()
+    })
+  })
+})
+
+/**
+ * @since 1.0.0
+ * @category memory
+ */
+export const layerMemory: Layer.Layer<EventJournal> = Layer.effect(EventJournal, makeMemory)
+
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export const makeIndexedDb = (options?: {
+  readonly database?: string
+}): Effect.Effect<typeof EventJournal.Service, EventJournalError, Scope> =>
+  Effect.gen(function*() {
+    const database = options?.database ?? "effect_event_journal"
+    const openRequest = indexedDB.open(database, 1)
+    openRequest.onupgradeneeded = () => {
+      const db = openRequest.result
+
+      const entries = db.createObjectStore("entries", { keyPath: "id" })
+      entries.createIndex("id", "id", { unique: true })
+      entries.createIndex("event", "event")
+
+      const remotes = db.createObjectStore("remotes", { keyPath: ["remoteId", "entryId"] })
+      remotes.createIndex("id", ["remoteId", "entryId"], { unique: true })
+      remotes.createIndex("sequence", ["remoteId", "sequence"], { unique: true })
+
+      const remoteEntryId = db.createObjectStore("remoteEntryId", { keyPath: ["remoteId"] })
+      remoteEntryId.createIndex("id", "remoteId", { unique: true })
+    }
+    const db = yield* Effect.acquireRelease(
+      idbReq("open", () => openRequest),
+      (db) => Effect.sync(() => db.close())
+    )
+
+    const pubsub = yield* PubSub.unbounded<Entry>()
+
+    return EventJournal.of({
+      entries: idbReq(
+        "entries",
+        () =>
+          db.transaction("entries", "readonly")
+            .objectStore("entries")
+            .index("id")
+            .getAll()
+      ).pipe(
+        Effect.flatMap((_) =>
+          decodeEntryIdbArray(_).pipe(
+            Effect.mapError((cause) => new EventJournalError({ method: "entries", cause }))
+          )
+        )
+      ),
+      write: ({ effect, event, payload, primaryKey }) =>
+        Effect.uninterruptibleMask((restore) => {
+          const entry = new Entry({
+            id: makeEntryId(),
+            event,
+            primaryKey,
+            payload
+          }, { disableValidation: true })
+          return restore(effect(entry)).pipe(
+            Effect.zipLeft(idbReq(
+              "write",
+              () =>
+                db
+                  .transaction("entries", "readwrite")
+                  .objectStore("entries")
+                  .put(encodeEntryIdb(entry))
+            )),
+            Effect.zipLeft(pubsub.publish(entry))
+          )
+        }),
+      writeFromRemote: (options) =>
+        Effect.gen(function*() {
+          const uncommitted: Array<Entry> = []
+          const uncommittedRemotes: Array<RemoteEntry> = []
+
+          yield* Effect.async<void, EventJournalError>((resume) => {
+            const tx = db.transaction(["entries", "remotes"], "readwrite")
+            const entries = tx.objectStore("entries")
+            const remotes = tx.objectStore("remotes")
+            const iterator = options.entries[Symbol.iterator]()
+            const handleNext = (state: IteratorResult<RemoteEntry, void>) => {
+              if (state.done) return
+              const remoteEntry = state.value
+              const entry = remoteEntry.entry
+              entries.get(entry.id).onsuccess = (event) => {
+                if ((event.target as any).result) {
+                  remotes.put({
+                    remoteId: options.remoteId,
+                    entryId: remoteEntry.entry.id,
+                    sequence: remoteEntry.remoteSequence
+                  })
+                  handleNext(iterator.next())
+                  return
+                }
+                uncommitted.push(entry)
+                uncommittedRemotes.push(remoteEntry)
+                handleNext(iterator.next())
+              }
+            }
+            handleNext(iterator.next())
+            tx.oncomplete = () => resume(Effect.void)
+            tx.onerror = () =>
+              resume(Effect.fail(new EventJournalError({ method: "writeFromRemote", cause: tx.error })))
+            return Effect.sync(() => tx.abort())
+          })
+
+          const brackets = options.compact
+            ? yield* options.compact(uncommittedRemotes)
+            : [[uncommitted, uncommittedRemotes]] as const
+
+          for (const [compacted, remoteEntries] of brackets) {
+            for (const originEntry of compacted) {
+              const conflicts: Array<Entry> = []
+              yield* Effect.async<void, EventJournalError>((resume) => {
+                const tx = db.transaction("entries", "readonly")
+                const entries = tx.objectStore("entries")
+                const cursorRequest = entries.index("id").openCursor(
+                  IDBKeyRange.lowerBound(originEntry.id, true),
+                  "next"
+                )
+                cursorRequest.onsuccess = () => {
+                  const cursor = cursorRequest.result!
+                  if (!cursor) return
+                  const decodedEntry = decodeEntryIdb(cursor.value)
+                  if (
+                    decodedEntry.event === originEntry.event &&
+                    decodedEntry.primaryKey === originEntry.primaryKey
+                  ) {
+                    conflicts.push(decodedEntry)
+                  }
+                  cursor.continue()
+                }
+                tx.oncomplete = () => resume(Effect.void)
+                tx.onerror = () =>
+                  resume(Effect.fail(new EventJournalError({ method: "writeFromRemote", cause: tx.error })))
+                return Effect.sync(() => tx.abort())
+              })
+
+              yield* options.effect({ entry: originEntry, conflicts })
+            }
+
+            yield* Effect.async<void, EventJournalError>((resume) => {
+              const tx = db.transaction(["entries", "remotes"], "readwrite")
+              const entries = tx.objectStore("entries")
+              const remotes = tx.objectStore("remotes")
+              for (const remoteEntry of remoteEntries) {
+                entries.add(encodeEntryIdb(remoteEntry.entry))
+                remotes.put({
+                  remoteId: options.remoteId,
+                  entryId: remoteEntry.entry.id,
+                  sequence: remoteEntry.remoteSequence
+                })
+              }
+              tx.oncomplete = () => resume(Effect.void)
+              tx.onerror = () =>
+                resume(Effect.fail(new EventJournalError({ method: "writeFromRemote", cause: tx.error })))
+              return Effect.sync(() => tx.abort())
+            })
+          }
+        }),
+      withRemoteUncommited: (remoteId, f) =>
+        Effect.async<Array<Entry>, EventJournalError>((resume) => {
+          const entries: Array<Entry> = []
+          const tx = db.transaction(["entries", "remotes", "remoteEntryId"], "readwrite")
+
+          const entriesStore = tx.objectStore("entries")
+          const remotesStore = tx.objectStore("remotes")
+          const remoteEntryIdStore = tx.objectStore("remoteEntryId")
+
+          remoteEntryIdStore.get(remoteId).onsuccess = (event) => {
+            const startEntryId = (event.target as any).result?.entryId
+            const entryCursor = entriesStore.index("id").openCursor(
+              startEntryId ? IDBKeyRange.lowerBound(startEntryId, true) : null,
+              "next"
+            )
+            entryCursor.onsuccess = () => {
+              const cursor = entryCursor.result
+              if (!cursor) return
+              const entry = decodeEntryIdb(cursor.value)
+              remotesStore.get([remoteId, entry.id]).onsuccess = (event) => {
+                if (!(event.target as any).result) entries.push(entry)
+                cursor.continue()
+              }
+            }
+          }
+
+          tx.oncomplete = () => resume(Effect.succeed(entries))
+          tx.onerror = () =>
+            resume(Effect.fail(new EventJournalError({ method: "withRemoteUncommited", cause: tx.error })))
+          return Effect.sync(() => tx.abort())
+        }).pipe(
+          Effect.flatMap((entries) => {
+            if (entries.length === 0) return f(entries)
+            const entryId = entries[entries.length - 1].id
+            return Effect.uninterruptibleMask((restore) =>
+              restore(f(entries)).pipe(
+                Effect.zipLeft(idbReq("withRemoteUncommited", () =>
+                  db.transaction("remoteEntryId", "readwrite").objectStore("remoteEntryId").put({
+                    remoteId,
+                    entryId
+                  })))
+              )
+            )
+          })
+        ),
+      nextRemoteSequence: (remoteId) =>
+        Effect.async<number, EventJournalError>((resume) => {
+          const tx = db.transaction("remotes", "readonly")
+          let sequence = 0
+          const cursorRequest = tx.objectStore("remotes").index("sequence").openCursor(
+            IDBKeyRange.bound([remoteId, 0], [remoteId, Infinity]),
+            "prev"
+          )
+          cursorRequest.onsuccess = () => {
+            const cursor = cursorRequest.result
+            if (!cursor) return
+            sequence = cursor.value.sequence + 1
+          }
+          tx.oncomplete = () => resume(Effect.succeed(sequence))
+          tx.onerror = () =>
+            resume(Effect.fail(new EventJournalError({ method: "nextRemoteSequence", cause: tx.error })))
+          return Effect.sync(() => tx.abort())
+        }),
+      changes: PubSub.subscribe(pubsub),
+      destroy: Effect.sync(() => {
+        indexedDB.deleteDatabase(database)
+      })
+    })
+  })
+
+const decodeEntryIdb = Schema.decodeSync(Entry)
+const encodeEntryIdb = Schema.encodeSync(Entry)
+const EntryIdbArray = Schema.Array(Entry)
+const decodeEntryIdbArray = Schema.decodeUnknown(EntryIdbArray)
+
+/**
+ * @since 1.0.0
+ * @category indexed db
+ */
+export const layerIndexedDb = (options?: {
+  readonly database?: string
+}): Layer.Layer<EventJournal, EventJournalError> =>
+  Layer.scoped(
+    EventJournal,
+    makeIndexedDb(options)
+  )
+
+const idbReq = <T>(method: string, evaluate: () => IDBRequest<T>) =>
+  Effect.async<T, EventJournalError>((resume) => {
+    const request = evaluate()
+    if (request.readyState === "done") {
+      resume(Effect.succeed(request.result))
+      return
+    }
+    request.onsuccess = () => resume(Effect.succeed(request.result))
+    request.onerror = () => resume(Effect.fail(new EventJournalError({ method, cause: request.error })))
+  })
diff --git a/src/EventLog.ts b/src/EventLog.ts
new file mode 100644
index 0000000000000000000000000000000000000000..276eff55727b78c7995fa13f55f46907d2fc3253
--- /dev/null
+++ b/src/EventLog.ts
@@ -0,0 +1,696 @@
+/**
+ * @since 1.0.0
+ */
+import * as Chunk from "effect/Chunk"
+import * as Context from "effect/Context"
+import * as Effect from "effect/Effect"
+import * as FiberMap from "effect/FiberMap"
+import * as FiberRef from "effect/FiberRef"
+import { identity } from "effect/Function"
+import * as Layer from "effect/Layer"
+import { type Pipeable, pipeArguments } from "effect/Pipeable"
+import * as Predicate from "effect/Predicate"
+import * as Queue from "effect/Queue"
+import type * as Record from "effect/Record"
+import type * as Redacted from "effect/Redacted"
+import * as Schema from "effect/Schema"
+import type { Scope } from "effect/Scope"
+import type { Covariant } from "effect/Types"
+import type { Event } from "./Event.js"
+import type { EventGroup } from "./EventGroup.js"
+import type { EventJournalError, RemoteEntry, RemoteId } from "./EventJournal.js"
+import { Entry, EventJournal, makeEntryId } from "./EventJournal.js"
+import { type EventLogRemote } from "./EventLogRemote.js"
+import * as Reactivity from "./Reactivity.js"
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const SchemaTypeId: unique symbol = Symbol.for("@effect/experimental/EventLog/EventLogSchema")
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export type SchemaTypeId = typeof SchemaTypeId
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const isEventLogSchema = (u: unknown): u is EventLogSchema<any> => Predicate.hasProperty(u, SchemaTypeId)
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export interface EventLogSchema<Groups extends EventGroup.Any> {
+  new(_: never): {}
+  readonly [SchemaTypeId]: SchemaTypeId
+  readonly groups: ReadonlyArray<Groups>
+}
+
+/**
+ * @since 1.0.0
+ * @category schema
+ */
+export const schema = <Groups extends ReadonlyArray<EventGroup.Any>>(
+  ...groups: Groups
+): EventLogSchema<Groups[number]> => {
+  function EventLog() {}
+  EventLog[SchemaTypeId] = SchemaTypeId
+  EventLog.groups = groups
+  return EventLog as any
+}
+
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export const HandlersTypeId: unique symbol = Symbol.for("@effect/experimental/EventLog/Handlers")
+
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export type HandlersTypeId = typeof HandlersTypeId
+
+/**
+ * Represents a handled `EventGroup`.
+ *
+ * @since 1.0.0
+ * @category handlers
+ */
+export interface Handlers<
+  R,
+  Events extends Event.Any = never
+> extends Pipeable {
+  readonly [HandlersTypeId]: {
+    _Endpoints: Covariant<Events>
+  }
+  readonly group: EventGroup.AnyWithProps
+  readonly handlers: Record.ReadonlyRecord<string, Handlers.Item<R>>
+  readonly context: Context.Context<any>
+
+  /**
+   * Add the implementation for an `Event` to a `Handlers` group.
+   */
+  handle<Tag extends Events["tag"], R1>(
+    name: Tag,
+    handler: (
+      options: {
+        readonly payload: Event.PayloadWithTag<Events, Tag>
+        readonly entry: Entry
+        readonly conflicts: Array<{
+          readonly entry: Entry
+          readonly payload: Event.PayloadWithTag<Events, Tag>
+        }>
+      }
+    ) => Effect.Effect<Event.SuccessWithTag<Events, Tag>, Event.ErrorWithTag<Events, Tag>, R1>
+  ): Handlers<
+    R | R1,
+    Event.ExcludeTag<Events, Tag>
+  >
+}
+
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export declare namespace Handlers {
+  /**
+   * @since 1.0.0
+   * @category handlers
+   */
+  export interface Any {
+    readonly [HandlersTypeId]: any
+  }
+
+  /**
+   * @since 1.0.0
+   * @category handlers
+   */
+  export type Item<R> = {
+    readonly event: Event.AnyWithProps
+    readonly context: Context.Context<any>
+    readonly handler: (options: {
+      readonly payload: any
+      readonly entry: Entry
+      readonly conflicts: Array<{
+        readonly entry: Entry
+        readonly payload: any
+      }>
+    }) => Effect.Effect<any, R>
+  }
+
+  /**
+   * @since 1.0.0
+   * @category handlers
+   */
+  export type ValidateReturn<A> = A extends (
+    | Handlers<
+      infer _R,
+      infer _Events
+    >
+    | Effect.Effect<
+      Handlers<
+        infer _R,
+        infer _Events
+      >,
+      infer _EX,
+      infer _RX
+    >
+  ) ? [_Events] extends [never] ? A
+    : `Event not handled: ${Event.Tag<_Events>}` :
+    `Must return the implemented handlers`
+
+  /**
+   * @since 1.0.0
+   * @category handlers
+   */
+  export type Error<A> = A extends Effect.Effect<
+    Handlers<
+      infer _R,
+      infer _Events
+    >,
+    infer _EX,
+    infer _RX
+  > ? _EX :
+    never
+
+  /**
+   * @since 1.0.0
+   * @category handlers
+   */
+  export type Context<A> = A extends Handlers<
+    infer _R,
+    infer _Events
+  > ? _R | Event.Context<_Events> :
+    A extends Effect.Effect<
+      Handlers<
+        infer _R,
+        infer _Events
+      >,
+      infer _EX,
+      infer _RX
+    > ? _R | _RX | Event.Context<_Events> :
+    never
+}
+
+const handlersProto = {
+  [HandlersTypeId]: {
+    _Endpoints: identity
+  },
+  handle<Tag extends string, R1>(
+    this: Handlers<any, any>,
+    tag: Tag,
+    handler: (payload: any) => Effect.Effect<any, R1>
+  ): Handlers<any, any> {
+    return makeHandlers({
+      group: this.group,
+      context: this.context,
+      handlers: {
+        ...this.handlers,
+        [tag]: {
+          event: this.group.events[tag],
+          context: this.context,
+          handler
+        }
+      }
+    })
+  },
+  pipe() {
+    return pipeArguments(this, arguments)
+  }
+}
+
+const makeHandlers = <Events extends Event.Any>(options: {
+  readonly group: EventGroup.AnyWithProps
+  readonly handlers: Record.ReadonlyRecord<string, Handlers.Item<any>>
+  readonly context: Context.Context<any>
+}): Handlers<never, Events> => Object.assign(Object.create(handlersProto), options)
+
+/**
+ * @since 1.0.0
+ * @category handlers
+ */
+export const group = <Events extends Event.Any, Return>(
+  group: EventGroup<Events>,
+  f: (handlers: Handlers<never, Events>) => Handlers.ValidateReturn<Return>
+): Layer.Layer<Event.ToService<Events>, Handlers.Error<Return>, Exclude<Handlers.Context<Return>, Scope>> =>
+  Effect.gen(function*() {
+    const context = yield* Effect.context<Handlers.Context<Return>>()
+    const result = f(makeHandlers({
+      group: group as any,
+      handlers: {},
+      context
+    }))
+    const handlers = Effect.isEffect(result) ? yield* (result as any as Effect.Effect<any>) : result
+    const registry = yield* Registry
+    yield* registry.add(handlers)
+  }).pipe(
+    Layer.scopedDiscard,
+    Layer.provide(Registry.layer)
+  ) as any
+
+/**
+ * @since 1.0.0
+ * @category compaction
+ */
+export const groupCompaction = <Events extends Event.Any, R>(
+  group: EventGroup<Events>,
+  effect: (options: {
+    readonly primaryKey: string
+    readonly entries: Array<Entry>
+    readonly events: Array<Event.TaggedPayload<Events>>
+    readonly write: <Tag extends Event.Tag<Events>>(
+      tag: Tag,
+      payload: Event.PayloadWithTag<Events, Tag>
+    ) => Effect.Effect<void>
+  }) => Effect.Effect<void, never, R>
+): Layer.Layer<never, never, EventLog | R | Event.Context<Events>> =>
+  Effect.gen(function*() {
+    const log = yield* EventLog
+    const context = yield* Effect.context<R | Event.Context<Events>>()
+
+    yield* log.registerCompaction({
+      events: Object.keys(group.events),
+      effect: Effect.fnUntraced(function*({ entries, write }) {
+        const writePayload = (timestamp: number, tag: string, payload: any) =>
+          Effect.gen(function*() {
+            const event = group.events[tag] as any as Event.AnyWithProps
+            const entry = new Entry({
+              id: makeEntryId({ msecs: timestamp }),
+              event: tag,
+              payload: yield* (Schema.encode(event.payloadMsgPack)(payload).pipe(
+                Effect.locally(FiberRef.currentContext, context),
+                Effect.orDie
+              ) as Effect.Effect<Uint8Array>),
+              primaryKey: event.primaryKey(payload)
+            }, { disableValidation: true })
+            yield* write(entry)
+          })
+
+        const byPrimaryKey = new Map<
+          string,
+          {
+            readonly entries: Array<Entry>
+            readonly taggedPayloads: Array<{
+              readonly _tag: string
+              readonly payload: any
+            }>
+          }
+        >()
+        for (const entry of entries) {
+          const payload =
+            yield* (Schema.decodeUnknown((group.events[entry.event] as any).payloadMsgPack)(entry.payload).pipe(
+              Effect.locally(FiberRef.currentContext, context)
+            ) as Effect.Effect<any>)
+
+          if (byPrimaryKey.has(entry.primaryKey)) {
+            const record = byPrimaryKey.get(entry.primaryKey)!
+            record.entries.push(entry)
+            record.taggedPayloads.push({
+              _tag: entry.event,
+              payload
+            })
+          } else {
+            byPrimaryKey.set(entry.primaryKey, {
+              entries: [entry],
+              taggedPayloads: [{ _tag: entry.event, payload }]
+            })
+          }
+        }
+
+        for (const [primaryKey, { entries, taggedPayloads }] of byPrimaryKey) {
+          yield* (effect({
+            primaryKey,
+            entries,
+            events: taggedPayloads as any,
+            write(tag, payload) {
+              return writePayload(entries[0].createdAtMillis, tag, payload)
+            }
+          }).pipe(
+            Effect.locally(FiberRef.currentContext, context)
+          ) as Effect.Effect<void>)
+        }
+      })
+    })
+  }).pipe(Layer.scopedDiscard)
+
+/**
+ * @since 1.0.0
+ * @category reactivity
+ */
+export const groupReactivity = <Events extends Event.Any>(
+  group: EventGroup<Events>,
+  keys:
+    | { readonly [Tag in Event.Tag<Events>]?: ReadonlyArray<string> }
+    | ReadonlyArray<string>
+): Layer.Layer<never, never, EventLog> =>
+  Effect.gen(function*() {
+    const log = yield* EventLog
+    if (!Array.isArray(keys)) {
+      yield* log.registerReactivity(keys as any)
+      return
+    }
+    const obj: Record<string, ReadonlyArray<string>> = {}
+    for (const tag in group.events) {
+      obj[tag] = keys
+    }
+    yield* log.registerReactivity(obj)
+  }).pipe(Layer.scopedDiscard)
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export class Registry extends Context.Tag("@effect/experimental/EventLog/Registry")<
+  Registry,
+  {
+    readonly add: (handlers: Handlers.Any) => Effect.Effect<void>
+    readonly handlers: Effect.Effect<Record.ReadonlyRecord<string, Handlers.Item<any>>>
+  }
+>() {
+  /**
+   * @since 1.0.0
+   */
+  static layer = Layer.sync(Registry, () => {
+    const items: Record<string, Handlers.Item<any>> = {}
+
+    return {
+      add: (handlers: Handlers<any, never>) =>
+        Effect.sync(() => {
+          for (const tag in handlers.handlers) {
+            items[tag] = handlers.handlers[tag]
+          }
+        }),
+      handlers: Effect.sync(() => items)
+    } as any
+  })
+}
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class Identity extends Context.Tag("@effect/experimental/EventLog/Identity")<Identity, {
+  readonly publicKey: string
+  readonly privateKey: Redacted.Redacted<Uint8Array>
+}>() {}
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class EventLog extends Context.Tag("@effect/experimental/EventLog/EventLog")<EventLog, {
+  readonly write: <Groups extends EventGroup.Any, Tag extends Event.Tag<EventGroup.Events<Groups>>>(options: {
+    readonly schema: EventLogSchema<Groups>
+    readonly event: Tag
+    readonly payload: Event.PayloadWithTag<EventGroup.Events<Groups>, Tag>
+  }) => Effect.Effect<
+    Event.SuccessWithTag<EventGroup.Events<Groups>, Tag>,
+    Event.ErrorWithTag<EventGroup.Events<Groups>, Tag> | EventJournalError
+  >
+  readonly registerRemote: (remote: EventLogRemote) => Effect.Effect<void, never, Scope>
+  readonly registerCompaction: (options: {
+    readonly events: ReadonlyArray<string>
+    readonly effect: (options: {
+      readonly entries: ReadonlyArray<Entry>
+      readonly write: (entry: Entry) => Effect.Effect<void>
+    }) => Effect.Effect<void>
+  }) => Effect.Effect<void, never, Scope>
+  readonly registerReactivity: (keys: Record<string, ReadonlyArray<string>>) => Effect.Effect<void, never, Scope>
+  readonly entries: Effect.Effect<ReadonlyArray<Entry>, EventJournalError>
+  readonly destroy: Effect.Effect<void, EventJournalError>
+}>() {}
+
+const make = Effect.gen(function*() {
+  const identity = yield* Identity
+  const registry = yield* Registry
+  const journal = yield* EventJournal
+  const handlers = yield* registry.handlers
+  const remotes = yield* FiberMap.make<RemoteId>()
+  const compactors = new Map<string, {
+    readonly events: ReadonlySet<string>
+    readonly effect: (options: {
+      readonly entries: ReadonlyArray<Entry>
+      readonly write: (entry: Entry) => Effect.Effect<void>
+    }) => Effect.Effect<void>
+  }>()
+  const journalSemaphore = yield* Effect.makeSemaphore(1)
+
+  const reactivity = yield* Reactivity.Reactivity
+  const reactivityKeys: Record<string, ReadonlyArray<string>> = {}
+
+  const runRemote = (remote: EventLogRemote) =>
+    Effect.gen(function*() {
+      const startSequence = yield* journal.nextRemoteSequence(remote.id)
+      const changes = yield* remote.changes(identity, startSequence)
+
+      yield* changes.takeAll.pipe(
+        Effect.flatMap(([entries]) =>
+          journal.writeFromRemote({
+            remoteId: remote.id,
+            entries: Chunk.toReadonlyArray(entries),
+            compact: compactors.size > 0 ?
+              (remoteEntries) =>
+                Effect.gen(function*() {
+                  let unprocessed = remoteEntries as Array<RemoteEntry>
+                  const brackets: Array<[Array<Entry>, Array<RemoteEntry>]> = []
+                  let uncompacted: Array<Entry> = []
+                  let uncompactedRemote: Array<RemoteEntry> = []
+                  while (true) {
+                    let i = 0
+                    for (; i < unprocessed.length; i++) {
+                      const remoteEntry = unprocessed[i]
+                      if (!compactors.has(remoteEntry.entry.event)) {
+                        uncompacted.push(remoteEntry.entry)
+                        uncompactedRemote.push(remoteEntry)
+                        continue
+                      }
+                      if (uncompacted.length > 0) {
+                        brackets.push([uncompacted, uncompactedRemote])
+                        uncompacted = []
+                        uncompactedRemote = []
+                      }
+                      const compactor = compactors.get(remoteEntry.entry.event)!
+                      const entry = remoteEntry.entry
+                      const entries = [entry]
+                      const remoteEntries = [remoteEntry]
+                      const compacted: Array<Entry> = []
+                      const currentEntries = unprocessed
+                      unprocessed = []
+                      for (let j = i + 1; j < currentEntries.length; j++) {
+                        const nextRemoteEntry = currentEntries[j]
+                        if (!compactor.events.has(nextRemoteEntry.entry.event)) {
+                          unprocessed.push(nextRemoteEntry)
+                          continue
+                        }
+                        entries.push(nextRemoteEntry.entry)
+                        remoteEntries.push(nextRemoteEntry)
+                      }
+                      yield* compactor.effect({
+                        entries,
+                        write(entry) {
+                          return Effect.sync(() => {
+                            compacted.push(entry)
+                          })
+                        }
+                      })
+                      brackets.push([compacted, remoteEntries])
+                      break
+                    }
+                    if (i === unprocessed.length) {
+                      brackets.push([unprocessed.map((_) => _.entry), unprocessed])
+                      break
+                    }
+                  }
+                  return brackets
+                }) :
+              undefined,
+            effect: ({ conflicts, entry }) => {
+              const handler = handlers[entry.event]
+              if (!handler) return Effect.logDebug(`Event handler not found for: "${entry.event}"`)
+              const decodePayload = Schema.decode(
+                handlers[entry.event].event.payloadMsgPack as unknown as Schema.Schema<any>
+              )
+              return Effect.gen(function*() {
+                const decodedConflicts: Array<{ entry: Entry; payload: any }> = new Array(conflicts.length)
+                for (let i = 0; i < conflicts.length; i++) {
+                  decodedConflicts[i] = {
+                    entry: conflicts[i],
+                    payload: yield* decodePayload(conflicts[i].payload)
+                  }
+                }
+                yield* handler.handler({
+                  payload: yield* decodePayload(entry.payload),
+                  entry,
+                  conflicts: decodedConflicts
+                })
+                if (reactivityKeys[entry.event]) {
+                  for (const key of reactivityKeys[entry.event]) {
+                    reactivity.unsafeInvalidate({
+                      [key]: [entry.primaryKey]
+                    })
+                  }
+                }
+              }).pipe(
+                Effect.catchAllCause(Effect.log),
+                Effect.annotateLogs({
+                  service: "EventLog",
+                  effect: "writeFromRemote",
+                  entryId: entry.idString
+                })
+              )
+            }
+          }).pipe(journalSemaphore.withPermits(1))
+        ),
+        Effect.catchAllCause(Effect.log),
+        Effect.forever,
+        Effect.annotateLogs({
+          service: "EventLog",
+          effect: "runRemote consume"
+        }),
+        Effect.fork
+      )
+
+      const write = journal.withRemoteUncommited(remote.id, (entries) => remote.write(identity, entries))
+      yield* Effect.addFinalizer(() => Effect.ignore(write))
+      yield* write
+      yield* Queue.takeBetween(yield* journal.changes, 1, Number.MAX_SAFE_INTEGER).pipe(
+        Effect.zipRight(Effect.sleep(500)),
+        Effect.zipRight(write),
+        Effect.catchAllCause(Effect.log),
+        Effect.forever
+      )
+    }).pipe(
+      Effect.scoped,
+      Effect.provideService(Identity, identity),
+      Effect.interruptible
+    )
+
+  return EventLog.of({
+    write: (options: {
+      readonly schema: EventLogSchema<any>
+      readonly event: string
+      readonly payload: any
+    }) => {
+      const handler = handlers[options.event]
+      if (handler === undefined) {
+        return Effect.die(`Event handler not found for: "${options.event}"`)
+      }
+      return Effect.gen(function*() {
+        const payload = yield* Effect.orDie(
+          Schema.encode(handlers[options.event].event.payloadMsgPack as unknown as Schema.Schema<Uint8Array>)(
+            options.payload
+          )
+        )
+        return yield* journalSemaphore.withPermits(1)(journal.write({
+          event: options.event,
+          primaryKey: handler.event.primaryKey(options.payload),
+          payload,
+          effect: (entry) =>
+            Effect.tap(
+              handler.handler({
+                payload: options.payload,
+                entry,
+                conflicts: []
+              }),
+              () => {
+                if (reactivityKeys[entry.event]) {
+                  for (const key of reactivityKeys[entry.event]) {
+                    reactivity.unsafeInvalidate({
+                      [key]: [entry.primaryKey]
+                    })
+                  }
+                }
+              }
+            )
+        }))
+      }).pipe(
+        Effect.mapInputContext((context) => Context.merge(handler.context, context))
+      )
+    },
+    entries: journal.entries,
+    registerRemote: (remote) =>
+      Effect.gen(function*() {
+        yield* Effect.acquireRelease(
+          FiberMap.run(remotes, remote.id, runRemote(remote)),
+          () => FiberMap.remove(remotes, remote.id)
+        )
+      }),
+    registerCompaction: (options) =>
+      Effect.acquireRelease(
+        Effect.sync(() => {
+          const events = new Set(options.events)
+          const compactor = {
+            events,
+            effect: options.effect
+          }
+          for (const event of options.events) {
+            compactors.set(event, compactor)
+          }
+        }),
+        () =>
+          Effect.sync(() => {
+            for (const event of options.events) {
+              compactors.delete(event)
+            }
+          })
+      ),
+    registerReactivity: (keys) =>
+      Effect.sync(() => {
+        Object.assign(reactivityKeys, keys)
+      }),
+    destroy: journal.destroy
+  })
+})
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerEventLog: Layer.Layer<EventLog, never, EventJournal | Identity> = Layer.scoped(EventLog, make).pipe(
+  Layer.provide([Registry.layer, Reactivity.layer])
+)
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layer = <Groups extends EventGroup.Any>(_schema: EventLogSchema<Groups>): Layer.Layer<
+  EventLog,
+  never,
+  EventGroup.ToService<Groups> | EventJournal | Identity
+> => layerEventLog as any
+
+/**
+ * @since 1.0.0
+ * @category client
+ */
+export const makeClient = <Groups extends EventGroup.Any>(
+  schema: EventLogSchema<Groups>
+): Effect.Effect<
+  (<Tag extends Event.Tag<EventGroup.Events<Groups>>>(
+    event: Tag,
+    payload: Event.PayloadWithTag<EventGroup.Events<Groups>, Tag>
+  ) => Effect.Effect<
+    Event.SuccessWithTag<EventGroup.Events<Groups>, Tag>,
+    Event.ErrorWithTag<EventGroup.Events<Groups>, Tag> | EventJournalError
+  >),
+  never,
+  EventLog
+> =>
+  Effect.gen(function*() {
+    const log = yield* EventLog
+
+    return <Tag extends Event.Tag<EventGroup.Events<Groups>>>(
+      event: Tag,
+      payload: Event.PayloadWithTag<EventGroup.Events<Groups>, Tag>
+    ): Effect.Effect<
+      Event.SuccessWithTag<EventGroup.Events<Groups>, Tag>,
+      Event.ErrorWithTag<EventGroup.Events<Groups>, Tag> | EventJournalError
+    > => log.write({ schema, event, payload })
+  })
diff --git a/src/EventLogEncryption.ts b/src/EventLogEncryption.ts
new file mode 100644
index 0000000000000000000000000000000000000000..d098c228eaf4ef02f1161d43294a13c322de2765
--- /dev/null
+++ b/src/EventLogEncryption.ts
@@ -0,0 +1,143 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context"
+import * as Effect from "effect/Effect"
+import * as Layer from "effect/Layer"
+import * as Redacted from "effect/Redacted"
+import * as Schema from "effect/Schema"
+import { Entry, EntryId, RemoteEntry } from "./EventJournal.js"
+import type { Identity } from "./EventLog.js"
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export const EncryptedEntry = Schema.Struct({
+  entryId: EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+})
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EncryptedRemoteEntry extends Schema.Schema.Type<typeof EncryptedRemoteEntry> {}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export const EncryptedRemoteEntry = Schema.Struct({
+  sequence: Schema.Number,
+  iv: Schema.Uint8ArrayFromSelf,
+  entryId: EntryId,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+})
+
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export class EventLogEncryption extends Context.Tag("@effect/experimental/EventLogEncryption")<
+  EventLogEncryption,
+  {
+    readonly encrypt: (
+      identity: typeof Identity.Service,
+      entries: ReadonlyArray<Entry>
+    ) => Effect.Effect<{
+      readonly iv: Uint8Array
+      readonly encryptedEntries: ReadonlyArray<Uint8Array>
+    }>
+    readonly decrypt: (
+      identity: typeof Identity.Service,
+      entries: ReadonlyArray<EncryptedRemoteEntry>
+    ) => Effect.Effect<Array<RemoteEntry>>
+    readonly sha256String: (data: Uint8Array) => Effect.Effect<string>
+    readonly sha256: (data: Uint8Array) => Effect.Effect<Uint8Array>
+  }
+>() {}
+
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export const makeEncryptionSubtle = (crypto: Crypto): Effect.Effect<typeof EventLogEncryption.Service> =>
+  Effect.sync(() => {
+    const keyCache = new WeakMap<typeof Identity.Service, CryptoKey>()
+    const getKey = (identity: typeof Identity.Service) =>
+      Effect.suspend(() => {
+        if (keyCache.has(identity)) {
+          return Effect.succeed(keyCache.get(identity)!)
+        }
+        return Effect.promise(() =>
+          crypto.subtle.importKey(
+            "raw",
+            Redacted.value(identity.privateKey),
+            "AES-GCM",
+            true,
+            ["encrypt", "decrypt"]
+          )
+        ).pipe(
+          Effect.tap((key) => {
+            keyCache.set(identity, key)
+          })
+        )
+      })
+
+    return EventLogEncryption.of({
+      encrypt: (identity, entries) =>
+        Effect.gen(function*() {
+          const data = yield* Effect.orDie(Entry.encodeArray(entries))
+          const key = yield* getKey(identity)
+          const iv = crypto.getRandomValues(new Uint8Array(12))
+          const encryptedEntries = yield* Effect.promise(() =>
+            Promise.all(
+              data.map((entry) => crypto.subtle.encrypt({ name: "AES-GCM", iv, tagLength: 128 }, key, entry))
+            )
+          )
+          return {
+            iv,
+            encryptedEntries: encryptedEntries.map((entry) => new Uint8Array(entry))
+          }
+        }),
+      decrypt: (identity, entries) =>
+        Effect.gen(function*() {
+          const key = yield* getKey(identity)
+          const decryptedData = (yield* Effect.promise(() =>
+            Promise.all(entries.map((data) =>
+              crypto.subtle.decrypt(
+                { name: "AES-GCM", iv: data.iv, tagLength: 128 },
+                key,
+                data.encryptedEntry
+              )
+            ))
+          )).map((buffer) => new Uint8Array(buffer))
+          const decoded = yield* Effect.orDie(Entry.decodeArray(decryptedData))
+          return decoded.map((entry, i) => new RemoteEntry({ remoteSequence: entries[i].sequence, entry }))
+        }),
+      sha256: (data) =>
+        Effect.promise(() => crypto.subtle.digest("SHA-256", data)).pipe(
+          Effect.map((hash) => new Uint8Array(hash))
+        ),
+      sha256String: (data) =>
+        Effect.map(
+          Effect.promise(() => crypto.subtle.digest("SHA-256", data)),
+          (hash) => {
+            const hashArray = Array.from(new Uint8Array(hash))
+            const hashHex = hashArray
+              .map((bytes) => bytes.toString(16).padStart(2, "0"))
+              .join("")
+            return hashHex
+          }
+        )
+    })
+  })
+
+/**
+ * @since 1.0.0
+ * @category encrytion
+ */
+export const layerSubtle: Layer.Layer<EventLogEncryption> = Layer.suspend(() =>
+  Layer.effect(EventLogEncryption, makeEncryptionSubtle(globalThis.crypto))
+)
diff --git a/src/EventLogRemote/Node.ts b/src/EventLogRemote/Node.ts
new file mode 100644
index 0000000000000000000000000000000000000000..a99b906b40931da0fb79eee174c95ad33eeb11e4
--- /dev/null
+++ b/src/EventLogRemote/Node.ts
@@ -0,0 +1,19 @@
+/**
+ * @since 1.0.0
+ */
+import * as NodeSocket from "@effect/platform-node/NodeSocket"
+import * as Layer from "effect/Layer"
+import type { EventLog } from "../EventLog.js"
+import * as EventLogEncryption from "../EventLogEncryption.js"
+import * as EventLogRemote from "../EventLogRemote.js"
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocket = (
+  url: string
+): Layer.Layer<never, never, EventLog> =>
+  EventLogRemote.layerWebSocket(url).pipe(
+    Layer.provide([EventLogEncryption.layerSubtle, NodeSocket.layerWebSocketConstructor])
+  )
diff --git a/src/EventLogRemote.ts b/src/EventLogRemote.ts
new file mode 100644
index 0000000000000000000000000000000000000000..1522c79b4d67004cbe0fe75bcfb01b84352d2739
--- /dev/null
+++ b/src/EventLogRemote.ts
@@ -0,0 +1,470 @@
+/**
+ * @since 1.0.0
+ */
+import * as MsgPack from "@effect/platform/MsgPack"
+import * as Socket from "@effect/platform/Socket"
+import * as Deferred from "effect/Deferred"
+import * as Effect from "effect/Effect"
+import * as Exit from "effect/Exit"
+import * as Layer from "effect/Layer"
+import * as Mailbox from "effect/Mailbox"
+import * as RcMap from "effect/RcMap"
+import * as Schedule from "effect/Schedule"
+import * as Schema from "effect/Schema"
+import * as Scope from "effect/Scope"
+import type { Entry } from "./EventJournal.js"
+import { RemoteEntry, RemoteId } from "./EventJournal.js"
+import type { Identity } from "./EventLog.js"
+import { EventLog } from "./EventLog.js"
+import { EncryptedEntry, EncryptedRemoteEntry, EventLogEncryption, layerSubtle } from "./EventLogEncryption.js"
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface EventLogRemote {
+  readonly id: RemoteId
+  readonly changes: (
+    identity: typeof Identity.Service,
+    startSequence: number
+  ) => Effect.Effect<Mailbox.ReadonlyMailbox<RemoteEntry>, never, Scope.Scope>
+  readonly write: (identity: typeof Identity.Service, entries: ReadonlyArray<Entry>) => Effect.Effect<void>
+}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Hello extends Schema.TaggedClass<Hello>("@effect/experimental/EventLogRemote/Hello")("Hello", {
+  remoteId: RemoteId
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class ChunkedMessage
+  extends Schema.TaggedClass<ChunkedMessage>("@effect/experimental/EventLogRemote/ChunkedMessage")("ChunkedMessage", {
+    id: Schema.Number,
+    part: Schema.Tuple(Schema.Number, Schema.Number),
+    data: Schema.Uint8ArrayFromSelf
+  })
+{
+  /**
+   * @since 1.0.0
+   */
+  static split(id: number, data: Uint8Array): ReadonlyArray<ChunkedMessage> {
+    const parts = Math.ceil(data.byteLength / constChunkSize)
+    const result: Array<ChunkedMessage> = new Array(parts)
+    for (let i = 0; i < parts; i++) {
+      const start = i * constChunkSize
+      const end = Math.min((i + 1) * constChunkSize, data.byteLength)
+      result[i] = new ChunkedMessage({ id, part: [i, parts], data: data.subarray(start, end) })
+    }
+    return result
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  static join(
+    map: Map<number, {
+      readonly parts: Array<Uint8Array>
+      count: number
+      bytes: number
+    }>,
+    part: ChunkedMessage
+  ): Uint8Array | undefined {
+    const [index, total] = part.part
+    let entry = map.get(part.id)
+    if (!entry) {
+      entry = {
+        parts: new Array(total),
+        count: 0,
+        bytes: 0
+      }
+      map.set(part.id, entry)
+    }
+    entry.parts[index] = part.data
+    entry.count++
+    entry.bytes += part.data.byteLength
+    if (entry.count !== total) {
+      return
+    }
+    const data = new Uint8Array(entry.bytes)
+    let offset = 0
+    for (const part of entry.parts) {
+      data.set(part, offset)
+      offset += part.byteLength
+    }
+    map.delete(part.id)
+    return data
+  }
+}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class WriteEntries
+  extends Schema.TaggedClass<WriteEntries>("@effect/experimental/EventLogRemote/WriteEntries")("WriteEntries", {
+    publicKey: Schema.String,
+    id: Schema.Number,
+    iv: Schema.Uint8ArrayFromSelf,
+    encryptedEntries: Schema.Array(EncryptedEntry)
+  })
+{}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Ack extends Schema.TaggedClass<Ack>("@effect/experimental/EventLogRemote/Ack")("Ack", {
+  id: Schema.Number,
+  sequenceNumbers: Schema.Array(Schema.Number)
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class RequestChanges
+  extends Schema.TaggedClass<RequestChanges>("@effect/experimental/EventLogRemote/RequestChanges")("RequestChanges", {
+    publicKey: Schema.String,
+    startSequence: Schema.Number
+  })
+{}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Changes extends Schema.TaggedClass<Changes>("@effect/experimental/EventLogRemote/Changes")("Changes", {
+  publicKey: Schema.String,
+  entries: Schema.Array(EncryptedRemoteEntry)
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class StopChanges
+  extends Schema.TaggedClass<StopChanges>("@effect/experimental/EventLogRemote/StopChanges")("StopChanges", {
+    publicKey: Schema.String
+  })
+{}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Ping extends Schema.TaggedClass<Ping>("@effect/experimental/EventLogRemote/Ping")("Ping", {
+  id: Schema.Number
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export class Pong extends Schema.TaggedClass<Pong>("@effect/experimental/EventLogRemote/Pong")("Pong", {
+  id: Schema.Number
+}) {}
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolRequest = Schema.Union(
+  WriteEntries,
+  RequestChanges,
+  StopChanges,
+  ChunkedMessage,
+  Ping
+)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolRequestMsgPack = MsgPack.schema(ProtocolRequest)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const decodeRequest = Schema.decodeSync(ProtocolRequestMsgPack)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const encodeRequest = Schema.encodeSync(ProtocolRequestMsgPack)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolResponse = Schema.Union(
+  Hello,
+  Ack,
+  Changes,
+  ChunkedMessage,
+  Pong
+)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const ProtocolResponseMsgPack = MsgPack.schema(ProtocolResponse)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const decodeResponse = Schema.decodeSync(ProtocolResponseMsgPack)
+
+/**
+ * @since 1.0.0
+ * @category protocol
+ */
+export const encodeResponse = Schema.encodeSync(ProtocolResponseMsgPack)
+
+/**
+ * @since 1.0.0
+ * @category change
+ */
+export class RemoteAdditions
+  extends Schema.TaggedClass<RemoteAdditions>("@effect/experimental/EventLogRemote/RemoveAdditions")(
+    "RemoveAdditions",
+    { entries: Schema.Array(RemoteEntry) }
+  )
+{}
+
+const constChunkSize = 512_000
+
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export const fromSocket = (options?: {
+  readonly disablePing?: boolean
+}): Effect.Effect<
+  void,
+  never,
+  Scope.Scope | EventLog | EventLogEncryption | Socket.Socket
+> =>
+  Effect.gen(function*() {
+    const log = yield* EventLog
+    const socket = yield* Socket.Socket
+    const encryption = yield* EventLogEncryption
+    const scope = yield* Effect.scope
+    const writeRaw = yield* socket.writer
+
+    function* writeGen(request: typeof ProtocolRequest.Type) {
+      const data = encodeRequest(request)
+      if (request._tag !== "WriteEntries" || data.byteLength <= constChunkSize) {
+        return yield* writeRaw(data)
+      }
+      const id = request.id
+      for (const part of ChunkedMessage.split(id, data)) {
+        yield* writeRaw(encodeRequest(part))
+      }
+    }
+
+    const write = (request: typeof ProtocolRequest.Type) => Effect.gen(() => writeGen(request))
+
+    yield* Effect.gen(function*() {
+      let pendingCounter = 0
+      const pending = new Map<number, {
+        readonly entries: ReadonlyArray<Entry>
+        readonly deferred: Deferred.Deferred<void>
+        readonly publicKey: string
+      }>()
+      const chunks = new Map<number, {
+        readonly parts: Array<Uint8Array>
+        count: number
+        bytes: number
+      }>()
+
+      const subscriptions = yield* RcMap.make({
+        lookup: (publicKey: string) =>
+          Effect.acquireRelease(
+            Mailbox.make<RemoteEntry>(),
+            (mailbox) =>
+              Effect.zipRight(
+                mailbox.shutdown,
+                Effect.ignoreLogged(write(new StopChanges({ publicKey })))
+              )
+          )
+      })
+      const identities = new WeakMap<any, typeof Identity.Service>()
+      const badPing = yield* Deferred.make<never, Error>()
+
+      let latestPing = 0
+      let latestPong = 0
+
+      if (options?.disablePing !== true) {
+        yield* Effect.suspend(() => {
+          if (latestPing !== latestPong) {
+            return Deferred.fail(badPing, new Error("Ping timeout"))
+          }
+          return write(new Ping({ id: ++latestPing }))
+        }).pipe(
+          Effect.delay(10000),
+          Effect.forever,
+          Effect.fork,
+          Effect.interruptible
+        )
+      }
+
+      function handleMessage(res: typeof ProtocolResponse.Type) {
+        switch (res._tag) {
+          case "Hello": {
+            return log.registerRemote({
+              id: res.remoteId,
+              write: (identity, entries) =>
+                Effect.gen(function*() {
+                  const encrypted = yield* encryption.encrypt(identity, entries)
+                  const deferred = yield* Deferred.make<void>()
+                  const id = pendingCounter++
+                  pending.set(id, {
+                    entries,
+                    deferred,
+                    publicKey: identity.publicKey
+                  })
+                  yield* Effect.orDie(write(
+                    new WriteEntries({
+                      publicKey: identity.publicKey,
+                      id,
+                      iv: encrypted.iv,
+                      encryptedEntries: encrypted.encryptedEntries.map((encryptedEntry, i) => ({
+                        entryId: entries[i].id,
+                        encryptedEntry
+                      }))
+                    })
+                  ))
+                  yield* Deferred.await(deferred)
+                }),
+              changes: (identity, startSequence) =>
+                Effect.gen(function*() {
+                  const mailbox = yield* RcMap.get(subscriptions, identity.publicKey)
+                  identities.set(mailbox, identity)
+                  yield* Effect.orDie(write(
+                    new RequestChanges({
+                      publicKey: identity.publicKey,
+                      startSequence
+                    })
+                  ))
+                  return mailbox
+                })
+            }).pipe(Scope.extend(scope))
+          }
+          case "Ack": {
+            return Effect.gen(function*() {
+              const entry = pending.get(res.id)
+              if (!entry) return
+              pending.delete(res.id)
+              const { deferred, entries, publicKey } = entry
+              const remoteEntries = res.sequenceNumbers.map((sequenceNumber, i) => {
+                const entry = entries[i]
+                return new RemoteEntry({
+                  remoteSequence: sequenceNumber,
+                  entry
+                })
+              })
+              const mailbox = yield* RcMap.get(subscriptions, publicKey)
+              yield* mailbox.offerAll(remoteEntries)
+              yield* Deferred.done(deferred, Exit.void)
+            })
+          }
+          case "Pong": {
+            latestPong = res.id
+            if (res.id === latestPing) {
+              return
+            }
+            return Effect.fail(new Error("Pong id mismatch"))
+          }
+          case "Changes": {
+            return Effect.gen(function*() {
+              const mailbox = yield* RcMap.get(subscriptions, res.publicKey)
+              const identity = identities.get(mailbox)!
+              const entries = yield* encryption.decrypt(identity, res.entries)
+              yield* mailbox.offerAll(entries)
+            }).pipe(Effect.scoped)
+          }
+          case "ChunkedMessage": {
+            const data = ChunkedMessage.join(chunks, res)
+            if (!data) return
+            return handleMessage(decodeResponse(data))
+          }
+        }
+      }
+
+      return yield* socket.run((data) => handleMessage(decodeResponse(data))).pipe(
+        Effect.raceFirst(Deferred.await(badPing))
+      )
+    }).pipe(
+      Effect.scoped,
+      Effect.tapErrorCause(Effect.logDebug),
+      Effect.retry({
+        schedule: Schedule.exponential(100).pipe(
+          Schedule.union(Schedule.spaced(5000))
+        )
+      }),
+      Effect.annotateLogs({
+        service: "EventLogRemote",
+        method: "fromSocket"
+      }),
+      Effect.forkScoped,
+      Effect.interruptible
+    )
+  })
+
+/**
+ * @since 1.0.0
+ * @category construtors
+ */
+export const fromWebSocket = (
+  url: string,
+  options?: {
+    readonly disablePing?: boolean
+  }
+): Effect.Effect<void, never, Scope.Scope | EventLogEncryption | EventLog | Socket.WebSocketConstructor> =>
+  Effect.gen(function*() {
+    const socket = yield* Socket.makeWebSocket(url)
+    return yield* fromSocket(options).pipe(
+      Effect.provideService(Socket.Socket, socket)
+    )
+  })
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocket = (
+  url: string,
+  options?: {
+    readonly disablePing?: boolean
+  }
+): Layer.Layer<
+  never,
+  never,
+  | Socket.WebSocketConstructor
+  | EventLog
+  | EventLogEncryption
+> => Layer.scopedDiscard(fromWebSocket(url, options))
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layerWebSocketBrowser = (
+  url: string,
+  options?: {
+    readonly disablePing?: boolean
+  }
+): Layer.Layer<never, never, EventLog> =>
+  layerWebSocket(url, options).pipe(
+    Layer.provide([layerSubtle, Socket.layerWebSocketConstructorGlobal])
+  )
diff --git a/src/EventLogServer/Cloudflare.ts b/src/EventLogServer/Cloudflare.ts
new file mode 100644
index 0000000000000000000000000000000000000000..e105e26b168f6973ecbd7da9059c39deeab81612
--- /dev/null
+++ b/src/EventLogServer/Cloudflare.ts
@@ -0,0 +1,188 @@
+/**
+ * @since 1.0.0
+ */
+/// <reference types="@cloudflare/workers-types" />
+import { DurableObject } from "cloudflare:workers"
+import * as Cause from "effect/Cause"
+import * as Effect from "effect/Effect"
+import type * as Layer from "effect/Layer"
+import * as ManagedRuntime from "effect/ManagedRuntime"
+import { RemoteId } from "../EventJournal.js"
+import type { EncryptedRemoteEntry } from "../EventLogEncryption.js"
+import * as EventLogRemote from "../EventLogRemote.js"
+import * as EventLogServer from "../EventLogServer.js"
+
+/**
+ * @since 1.0.0
+ * @category DurableObject
+ */
+export abstract class EventLogDurableObject extends DurableObject {
+  /**
+   * @since 1.0.0
+   */
+  readonly runtime: ManagedRuntime.ManagedRuntime<EventLogServer.Storage, never>
+
+  constructor(options: {
+    readonly ctx: DurableObjectState
+    readonly env: unknown
+    readonly storageLayer: Layer.Layer<EventLogServer.Storage>
+  }) {
+    super(options.ctx, options.env)
+    this.ctx.setHibernatableWebSocketEventTimeout(5000)
+    this.runtime = ManagedRuntime.make(options.storageLayer)
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  webSocketMessage(ws: WebSocket, message: string | ArrayBuffer) {
+    return this.handleRequest(
+      ws,
+      EventLogRemote.decodeRequest(
+        message instanceof ArrayBuffer
+          ? new Uint8Array(message)
+          : new TextEncoder().encode(message)
+      )
+    )
+  }
+
+  private chunks = new Map<
+    number,
+    {
+      readonly parts: Array<Uint8Array>
+      count: number
+      bytes: number
+    }
+  >()
+  /**
+   * @since 1.0.0
+   */
+  private async handleRequest(
+    ws: WebSocket,
+    request: typeof EventLogRemote.ProtocolRequest.Type
+  ): Promise<void> {
+    switch (request._tag) {
+      case "WriteEntries": {
+        return Effect.gen(this, function*() {
+          const storage = yield* EventLogServer.Storage
+          const entries = request.encryptedEntries.map(
+            ({ encryptedEntry, entryId }) =>
+              new EventLogServer.PersistedEntry({
+                entryId,
+                iv: request.iv,
+                encryptedEntry
+              })
+          )
+          const encryptedEntries = yield* storage.write(
+            request.publicKey,
+            entries
+          )
+          ws.send(
+            EventLogRemote.encodeResponse(
+              new EventLogRemote.Ack({
+                id: request.id,
+                sequenceNumbers: encryptedEntries.map((_) => _.sequence)
+              })
+            )
+          )
+          const changes = this.encodeChanges(
+            request.publicKey,
+            encryptedEntries
+          )
+          for (const peer of this.ctx.getWebSockets()) {
+            if (peer === ws) continue
+            for (const change of changes) {
+              peer.send(change)
+            }
+          }
+        }).pipe(this.runtime.runPromise)
+      }
+      case "ChunkedMessage": {
+        const data = EventLogRemote.ChunkedMessage.join(this.chunks, request)
+        if (!data) return
+        return this.handleRequest(ws, EventLogRemote.decodeRequest(data))
+      }
+      case "RequestChanges": {
+        return Effect.gen(this, function*() {
+          const storage = yield* EventLogServer.Storage
+          const entries = yield* storage.entries(
+            request.publicKey,
+            request.startSequence
+          )
+          if (entries.length === 0) return
+          const changes = this.encodeChanges(request.publicKey, entries)
+          for (const change of changes) {
+            ws.send(change)
+          }
+        }).pipe(this.runtime.runPromise)
+      }
+    }
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  private encodeChanges(
+    publicKey: string,
+    entries: ReadonlyArray<EncryptedRemoteEntry>
+  ): ReadonlyArray<Uint8Array> {
+    let changes = [
+      EventLogRemote.encodeResponse(
+        new EventLogRemote.Changes({
+          publicKey,
+          entries
+        })
+      )
+    ]
+    if (changes[0].byteLength > 512_000) {
+      changes = EventLogRemote.ChunkedMessage.split(
+        Math.floor(Math.random() * 1_000_000_000),
+        changes[0]
+      ).map((_) => EventLogRemote.encodeResponse(_))
+    }
+    return changes
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  webSocketError(_ws: WebSocket, error: Error): void {
+    this.runtime.runFork(Effect.logWarning(Cause.fail(error)))
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  webSocketClose(_ws: WebSocket, code: number, reason: string): void {
+    this.runtime.runFork(Effect.logWarning("WebSocket closed", { code, reason }))
+  }
+
+  /**
+   * @since 1.0.0
+   */
+  async fetch(): Promise<Response> {
+    const webSocketPair = new WebSocketPair()
+    const [client, server] = Object.values(webSocketPair)
+
+    this.ctx.acceptWebSocket(server)
+
+    EventLogServer.Storage.pipe(
+      Effect.flatMap((_) => _.getId),
+      Effect.tap((remoteId) => {
+        server.send(
+          EventLogRemote.encodeResponse(
+            new EventLogRemote.Hello({
+              remoteId: RemoteId.make(remoteId)
+            })
+          )
+        )
+      }),
+      this.runtime.runFork
+    )
+
+    return new Response(null, {
+      status: 101,
+      webSocket: client
+    })
+  }
+}
diff --git a/src/EventLogServer.ts b/src/EventLogServer.ts
new file mode 100644
index 0000000000000000000000000000000000000000..042cd51e627944174821cc4153098ed546de1104
--- /dev/null
+++ b/src/EventLogServer.ts
@@ -0,0 +1,288 @@
+/**
+ * @since 1.0.0
+ */
+import type * as HttpServerError from "@effect/platform/HttpServerError"
+import * as HttpServerRequest from "@effect/platform/HttpServerRequest"
+import * as HttpServerResponse from "@effect/platform/HttpServerResponse"
+import * as MsgPack from "@effect/platform/MsgPack"
+import type * as Socket from "@effect/platform/Socket"
+import * as Chunk from "effect/Chunk"
+import * as Context from "effect/Context"
+import * as Effect from "effect/Effect"
+import * as FiberMap from "effect/FiberMap"
+import * as Layer from "effect/Layer"
+import * as Mailbox from "effect/Mailbox"
+import * as PubSub from "effect/PubSub"
+import * as RcMap from "effect/RcMap"
+import * as Schema from "effect/Schema"
+import type * as Scope from "effect/Scope"
+import * as Uuid from "uuid"
+import type { RemoteId } from "./EventJournal.js"
+import { EntryId, makeRemoteId } from "./EventJournal.js"
+import { EncryptedRemoteEntry } from "./EventLogEncryption.js"
+import type { ProtocolRequest, ProtocolResponse } from "./EventLogRemote.js"
+import { Ack, Changes, ChunkedMessage, decodeRequest, encodeResponse, Hello, Pong } from "./EventLogRemote.js"
+
+const constChunkSize = 512_000
+
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const makeHandler: Effect.Effect<
+  (socket: Socket.Socket) => Effect.Effect<void, Socket.SocketError, Scope.Scope>,
+  never,
+  Storage
+> = Effect.gen(function*() {
+  const storage = yield* Storage
+  const remoteId = yield* storage.getId
+  let chunkId = 0
+
+  function* handler(socket: Socket.Socket) {
+    const subscriptions = yield* FiberMap.make<string>()
+    const writeRaw = yield* socket.writer
+    const chunks = new Map<number, {
+      readonly parts: Array<Uint8Array>
+      count: number
+      bytes: number
+    }>()
+    let latestSequence = -1
+
+    function* writeGen(response: typeof ProtocolResponse.Type) {
+      const data = encodeResponse(response)
+      if (response._tag !== "Changes" || data.byteLength <= constChunkSize) {
+        return yield* writeRaw(data)
+      }
+      const id = chunkId++
+      for (const part of ChunkedMessage.split(id, data)) {
+        yield* writeRaw(encodeResponse(part))
+      }
+    }
+    const write = (response: typeof ProtocolResponse.Type) => Effect.gen(() => writeGen(response))
+
+    yield* Effect.fork(write(new Hello({ remoteId })))
+
+    function handleRequest(request: typeof ProtocolRequest.Type) {
+      switch (request._tag) {
+        case "Ping": {
+          return write(new Pong({ id: request.id }))
+        }
+        case "WriteEntries": {
+          if (request.encryptedEntries.length === 0) {
+            return write(
+              new Ack({
+                id: request.id,
+                sequenceNumbers: []
+              })
+            )
+          }
+          return Effect.gen(function*() {
+            const entries = request.encryptedEntries.map(({ encryptedEntry, entryId }) =>
+              new PersistedEntry({
+                entryId,
+                iv: request.iv,
+                encryptedEntry
+              })
+            )
+            const encrypted = yield* storage.write(request.publicKey, entries)
+            latestSequence = encrypted[encrypted.length - 1].sequence
+            return yield* write(
+              new Ack({
+                id: request.id,
+                sequenceNumbers: encrypted.map((e) => e.sequence)
+              })
+            )
+          })
+        }
+        case "RequestChanges": {
+          return Effect.gen(function*() {
+            const changes = yield* storage.changes(request.publicKey, request.startSequence)
+            yield* changes.takeAll.pipe(
+              Effect.flatMap(function([entries]) {
+                const latestEntries: Array<EncryptedRemoteEntry> = []
+                for (const entry of entries) {
+                  if (entry.sequence <= latestSequence) continue
+                  latestEntries.push(entry)
+                  latestSequence = entry.sequence
+                }
+                if (latestEntries.length === 0) return Effect.void
+                return write(
+                  new Changes({
+                    publicKey: request.publicKey,
+                    entries: Chunk.toReadonlyArray(entries)
+                  })
+                )
+              }),
+              Effect.forever
+            )
+          }).pipe(
+            Effect.scoped,
+            FiberMap.run(subscriptions, request.publicKey)
+          )
+        }
+        case "StopChanges": {
+          return FiberMap.remove(subscriptions, request.publicKey)
+        }
+        case "ChunkedMessage": {
+          const data = ChunkedMessage.join(chunks, request)
+          if (!data) return
+          return handleRequest(decodeRequest(data))
+        }
+      }
+    }
+
+    yield* socket.run((data) => handleRequest(decodeRequest(data))).pipe(Effect.catchAllCause(Effect.logDebug))
+  }
+
+  return (socket) =>
+    Effect.gen(() => handler(socket)).pipe(Effect.annotateLogs({
+      module: "EventLogServer"
+    }))
+})
+
+/**
+ * @since 1.0.0
+ * @category websockets
+ */
+export const makeHandlerHttp: Effect.Effect<
+  Effect.Effect<
+    HttpServerResponse.HttpServerResponse,
+    HttpServerError.RequestError | Socket.SocketError,
+    HttpServerRequest.HttpServerRequest | Scope.Scope
+  >,
+  never,
+  Storage
+> = Effect.gen(function*() {
+  const handler = yield* makeHandler
+
+  return Effect.gen(function*() {
+    const request = yield* HttpServerRequest.HttpServerRequest
+    const socket = yield* request.upgrade
+    yield* handler(socket)
+    return HttpServerResponse.empty()
+  }).pipe(Effect.annotateLogs({
+    module: "EventLogServer"
+  }))
+})
+
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export class PersistedEntry extends Schema.Class<PersistedEntry>("@effect/experimental/EventLogServer/PersistedEntry")({
+  entryId: EntryId,
+  iv: Schema.Uint8ArrayFromSelf,
+  encryptedEntry: Schema.Uint8ArrayFromSelf
+}) {
+  /**
+   * @since 1.0.0
+   */
+  static fromMsgPack = MsgPack.schema(PersistedEntry)
+
+  /**
+   * @since 1.0.0
+   */
+  static encode = Schema.encodeSync(this.fromMsgPack)
+
+  /**
+   * @since 1.0.0
+   */
+  get entryIdString(): string {
+    return Uuid.stringify(this.entryId)
+  }
+}
+
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export class Storage extends Context.Tag("@effect/experimental/EventLogServer/Storage")<
+  Storage,
+  {
+    readonly getId: Effect.Effect<RemoteId>
+    readonly write: (
+      publicKey: string,
+      entries: ReadonlyArray<PersistedEntry>
+    ) => Effect.Effect<ReadonlyArray<EncryptedRemoteEntry>>
+    readonly entries: (
+      publicKey: string,
+      startSequence: number
+    ) => Effect.Effect<ReadonlyArray<EncryptedRemoteEntry>>
+    readonly changes: (
+      publicKey: string,
+      startSequence: number
+    ) => Effect.Effect<Mailbox.ReadonlyMailbox<EncryptedRemoteEntry>, never, Scope.Scope>
+  }
+>() {}
+
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export const makeStorageMemory: Effect.Effect<typeof Storage.Service, never, Scope.Scope> = Effect.gen(function*() {
+  const knownIds = new Map<string, number>()
+  const journals = new Map<string, Array<EncryptedRemoteEntry>>()
+  const remoteId = makeRemoteId()
+  const ensureJournal = (publicKey: string) => {
+    let journal = journals.get(publicKey)
+    if (journal) return journal
+    journal = []
+    journals.set(publicKey, journal)
+    return journal
+  }
+  const pubsubs = yield* RcMap.make({
+    lookup: (_publicKey: string) =>
+      Effect.acquireRelease(
+        PubSub.unbounded<EncryptedRemoteEntry>(),
+        PubSub.shutdown
+      ),
+    idleTimeToLive: 60000
+  })
+
+  return Storage.of({
+    getId: Effect.succeed(remoteId),
+    write: (publicKey, entries) =>
+      Effect.gen(function*() {
+        const active = yield* RcMap.keys(pubsubs)
+        const pubsub = active.includes(publicKey) ? yield* RcMap.get(pubsubs, publicKey) : undefined
+        const journal = ensureJournal(publicKey)
+        const encryptedEntries: Array<EncryptedRemoteEntry> = []
+        for (const entry of entries) {
+          const idString = entry.entryIdString
+          if (knownIds.has(idString)) continue
+          const encrypted = EncryptedRemoteEntry.make({
+            sequence: journal.length,
+            entryId: entry.entryId,
+            iv: entry.iv,
+            encryptedEntry: entry.encryptedEntry
+          })
+          encryptedEntries.push(encrypted)
+          knownIds.set(idString, encrypted.sequence)
+          journal.push(encrypted)
+          pubsub?.unsafeOffer(encrypted)
+        }
+        return encryptedEntries
+      }).pipe(Effect.scoped),
+    entries: (publicKey, startSequence) => Effect.sync(() => ensureJournal(publicKey).slice(startSequence)),
+    changes: (publicKey, startSequence) =>
+      Effect.gen(function*() {
+        const mailbox = yield* Mailbox.make<EncryptedRemoteEntry>()
+        const pubsub = yield* RcMap.get(pubsubs, publicKey)
+        const queue = yield* pubsub.subscribe
+        yield* mailbox.offerAll(ensureJournal(publicKey).slice(startSequence))
+        yield* queue.takeBetween(1, Number.MAX_SAFE_INTEGER).pipe(
+          Effect.tap((chunk) => mailbox.offerAll(chunk)),
+          Effect.forever,
+          Effect.forkScoped,
+          Effect.interruptible
+        )
+        return mailbox
+      })
+  })
+})
+
+/**
+ * @since 1.0.0
+ * @category storage
+ */
+export const layerStorageMemory: Layer.Layer<Storage> = Layer.scoped(Storage, makeStorageMemory)
diff --git a/src/Machine/Procedure.ts b/src/Machine/Procedure.ts
index b85a1daebb3a55748e89cfc30151df1402603dd5..3dec66d6b5e19175fd2f329d9a7ae9e654221041 100644
--- a/src/Machine/Procedure.ts
+++ b/src/Machine/Procedure.ts
@@ -1,13 +1,12 @@
 /**
  * @since 1.0.0
  */
-import type * as Schema from "@effect/schema/Schema"
-import type * as Serializable from "@effect/schema/Serializable"
 import type * as Deferred from "effect/Deferred"
 import type * as Effect from "effect/Effect"
 import { type Pipeable, pipeArguments } from "effect/Pipeable"
 import * as Predicate from "effect/Predicate"
 import type { Request } from "effect/Request"
+import type * as Schema from "effect/Schema"
 
 /**
  * @since 1.0.0
@@ -243,7 +242,7 @@ export const makeSerializable = <
 >(
   schema: Schema.Schema<Req, IS, RS> & { readonly _tag: Req["_tag"] },
   handler: Handler<Req, State, Requests, R>
-): SerializableProcedure<Req, State, R | Serializable.SerializableWithResult.Context<Req>> => ({
+): SerializableProcedure<Req, State, R | Schema.SerializableWithResult.Context<Req>> => ({
   [TypeId]: TypeId,
   [SerializableTypeId]: SerializableTypeId,
   schema: schema as any,
diff --git a/src/Machine/ProcedureList.ts b/src/Machine/ProcedureList.ts
index 0194a06ed732ea64d9514951dd22202cedf69281..724c1b16d85c2169e8fc6cd1c0a351de565e8411 100644
--- a/src/Machine/ProcedureList.ts
+++ b/src/Machine/ProcedureList.ts
@@ -72,19 +72,25 @@ export const make = <State>(initialState: State, options?: {
  * @category combinators
  */
 export const addProcedure: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     Req extends Procedure.TaggedRequest.Any,
     State,
     R2
-  >(
-    procedure: Procedure.Procedure<Req, State, R2>
-  ): <
+  >(procedure: Procedure.Procedure<Req, State, R2>): <
     Public extends Procedure.TaggedRequest.Any,
     Private extends Procedure.TaggedRequest.Any,
     R
   >(
     self: ProcedureList<State, Public, Private, R>
   ) => ProcedureList<State, Req | Public, Private, R | R2>
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     State,
     Public extends Procedure.TaggedRequest.Any,
@@ -120,19 +126,25 @@ export const addProcedure: {
  * @category combinators
  */
 export const addProcedurePrivate: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     Req extends Procedure.TaggedRequest.Any,
     State,
     R2
-  >(
-    procedure: Procedure.Procedure<Req, State, R2>
-  ): <
+  >(procedure: Procedure.Procedure<Req, State, R2>): <
     Public extends Procedure.TaggedRequest.Any,
     Private extends Procedure.TaggedRequest.Any,
     R
   >(
     self: ProcedureList<State, Public, Private, R>
   ) => ProcedureList<State, Public, Private | Req, R | R2>
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     State,
     Public extends Procedure.TaggedRequest.Any,
@@ -256,11 +268,19 @@ export const addPrivate = <Req extends Procedure.TaggedRequest.Any>(): {
  * @category combinators
  */
 export const withInitialState: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <State>(
     initialState: Types.NoInfer<State>
   ): <Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(
     self: ProcedureList<State, Public, Private, R>
   ) => ProcedureList<State, Public, Private, R>
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, R>(
     self: ProcedureList<State, Public, Private, R>,
     initialState: Types.NoInfer<State>
diff --git a/src/Machine/SerializableProcedureList.ts b/src/Machine/SerializableProcedureList.ts
index 99ba09b2fd990a4eb1784ede4dab4acf03a2da7d..1683214cefd6d58320b58f5ede042a4c5d2bcaec 100644
--- a/src/Machine/SerializableProcedureList.ts
+++ b/src/Machine/SerializableProcedureList.ts
@@ -1,10 +1,9 @@
 /**
  * @since 1.0.0
  */
-import type * as Schema from "@effect/schema/Schema"
-import type * as Serializable from "@effect/schema/Serializable"
 import type * as Effect from "effect/Effect"
 import { dual } from "effect/Function"
+import type * as Schema from "effect/Schema"
 import type * as Types from "effect/Types"
 import * as Procedure from "./Procedure.js"
 import * as ProcedureList from "./ProcedureList.js"
@@ -42,6 +41,10 @@ export const make: <State>(
  * @category combinators
  */
 export const add: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     Req extends Schema.TaggedRequest.All,
     I,
@@ -59,8 +62,12 @@ export const add: {
     State,
     Req | Public,
     Private,
-    R | R2 | Serializable.SerializableWithResult.Context<Req>
+    R | R2 | Schema.SerializableWithResult.Context<Req>
   >
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     State,
     Public extends Schema.TaggedRequest.All,
@@ -74,7 +81,7 @@ export const add: {
     self: SerializableProcedureList<State, Public, Private, R>,
     schema: Schema.Schema<Req, I, ReqR> & { readonly _tag: Req["_tag"] },
     handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>
-  ): SerializableProcedureList<State, Req | Public, Private, R | R2 | Serializable.SerializableWithResult.Context<Req>>
+  ): SerializableProcedureList<State, Req | Public, Private, R | R2 | Schema.SerializableWithResult.Context<Req>>
 } = dual(
   3,
   <
@@ -94,8 +101,22 @@ export const add: {
     State,
     Req | Public,
     Private,
-    R | R2 | Serializable.SerializableWithResult.Context<Req>
-  > => ProcedureList.addProcedure(self, Procedure.makeSerializable<any, any>()(schema, handler)) as any
+    R | R2 | Schema.SerializableWithResult.Context<Req>
+  > =>
+    ProcedureList.addProcedure(
+      self,
+      Procedure.makeSerializable<
+        /**
+         * @since 1.0.0
+         * @category combinators
+         */
+        any, /**
+         * @since 1.0.0
+         * @category combinators
+         */
+        any
+      >()(schema, handler)
+    ) as any
 )
 
 /**
@@ -103,6 +124,10 @@ export const add: {
  * @category combinators
  */
 export const addPrivate: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     Req extends Schema.TaggedRequest.All,
     I,
@@ -120,8 +145,12 @@ export const addPrivate: {
     State,
     Public,
     Private | Req,
-    R | R2 | Serializable.SerializableWithResult.Context<Req>
+    R | R2 | Schema.SerializableWithResult.Context<Req>
   >
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <
     State,
     Public extends Schema.TaggedRequest.All,
@@ -135,7 +164,7 @@ export const addPrivate: {
     self: SerializableProcedureList<State, Public, Private, R>,
     schema: Schema.Schema<Req, I, ReqR> & { readonly _tag: Req["_tag"] },
     handler: Procedure.Handler<Req, Types.NoInfer<State>, Types.NoInfer<Public> | Types.NoInfer<Private>, R2>
-  ): SerializableProcedureList<State, Public, Private | Req, R | R2 | Serializable.SerializableWithResult.Context<Req>>
+  ): SerializableProcedureList<State, Public, Private | Req, R | R2 | Schema.SerializableWithResult.Context<Req>>
 } = dual(
   3,
   <
@@ -155,8 +184,22 @@ export const addPrivate: {
     State,
     Public,
     Private | Req,
-    R | R2 | Serializable.SerializableWithResult.Context<Req>
-  > => ProcedureList.addProcedurePrivate(self, Procedure.makeSerializable<any, any>()(schema, handler)) as any
+    R | R2 | Schema.SerializableWithResult.Context<Req>
+  > =>
+    ProcedureList.addProcedurePrivate(
+      self,
+      Procedure.makeSerializable<
+        /**
+         * @since 1.0.0
+         * @category combinators
+         */
+        any, /**
+         * @since 1.0.0
+         * @category combinators
+         */
+        any
+      >()(schema, handler)
+    ) as any
 )
 
 /**
@@ -164,11 +207,19 @@ export const addPrivate: {
  * @category combinators
  */
 export const withInitialState: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <State>(
     initialState: Types.NoInfer<State>
   ): <Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R>(
     self: SerializableProcedureList<State, Public, Private, R>
   ) => SerializableProcedureList<State, Public, Private, R>
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <State, Public extends Schema.TaggedRequest.All, Private extends Schema.TaggedRequest.All, R>(
     self: SerializableProcedureList<State, Public, Private, R>,
     initialState: Types.NoInfer<State>
diff --git a/src/Machine.ts b/src/Machine.ts
index b61dabd741b8befa870d24cfadcaeebff339ac5f..821c3d498ee5533de984beee9a94bd5e9e5c50c4 100644
--- a/src/Machine.ts
+++ b/src/Machine.ts
@@ -1,9 +1,6 @@
 /**
  * @since 1.0.0
  */
-import type * as ParseResult from "@effect/schema/ParseResult"
-import * as Schema from "@effect/schema/Schema"
-import * as Serializable from "@effect/schema/Serializable"
 import * as Arr from "effect/Array"
 import * as Cause from "effect/Cause"
 import * as Context from "effect/Context"
@@ -17,6 +14,7 @@ import * as FiberSet from "effect/FiberSet"
 import { dual, identity, pipe } from "effect/Function"
 import { globalValue } from "effect/GlobalValue"
 import * as Option from "effect/Option"
+import type * as ParseResult from "effect/ParseResult"
 import type { Pipeable } from "effect/Pipeable"
 import { pipeArguments } from "effect/Pipeable"
 import * as PubSub from "effect/PubSub"
@@ -24,6 +22,7 @@ import * as Queue from "effect/Queue"
 import * as Readable from "effect/Readable"
 import type { Request } from "effect/Request"
 import type * as Schedule from "effect/Schedule"
+import * as Schema from "effect/Schema"
 import type * as Scope from "effect/Scope"
 import * as Stream from "effect/Stream"
 import * as Subscribable from "effect/Subscribable"
@@ -318,9 +317,17 @@ export interface SerializableActor<M extends Machine.Any> extends Actor<M> {
  * @category constructors
  */
 export const make: {
+  /**
+   * @since 1.0.0
+   * @category constructors
+   */
   <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, InitErr, R>(
     initialize: Effect.Effect<ProcedureList<State, Public, Private, R>, InitErr, R>
   ): Machine<State, Public, Private, void, InitErr, Exclude<R, Scope.Scope | MachineContext>>
+  /**
+   * @since 1.0.0
+   * @category constructors
+   */
   <State, Public extends Procedure.TaggedRequest.Any, Private extends Procedure.TaggedRequest.Any, Input, InitErr, R>(
     initialize: Machine.Initialize<Input, State, Public, Private, R, InitErr, R>
   ): Machine<State, Public, Private, Input, InitErr, Exclude<R, Scope.Scope | MachineContext>>
@@ -355,6 +362,10 @@ export const makeWith = <State, Input = void>(): {
  * @category constructors
  */
 export const makeSerializable: {
+  /**
+   * @since 1.0.0
+   * @category constructors
+   */
   <
     State,
     IS,
@@ -372,6 +383,10 @@ export const makeSerializable: {
       | Effect.Effect<SerializableProcedureList<State, Public, Private, R>, InitErr, R>
       | Machine.InitializeSerializable<void, State, Public, Private, R, InitErr, R>
   ): SerializableMachine<State, Public, Private, void, InitErr, Exclude<R, Scope.Scope | MachineContext>, RS>
+  /**
+   * @since 1.0.0
+   * @category constructors
+   */
   <
     State,
     IS,
@@ -409,28 +424,36 @@ export const makeSerializable: {
   initialize:
     | Machine.InitializeSerializable<Input, State, Public, Private, R, InitErr, R>
     | Effect.Effect<SerializableProcedureList<State, Public, Private, R>, InitErr, R>
-): SerializableMachine<State, Public, Private, Input, InitErr, Exclude<R, Scope.Scope | MachineContext>, RS | RI> =>
-  ({
-    [TypeId]: TypeId,
-    [SerializableTypeId]: SerializableTypeId,
-    initialize: Effect.isEffect(initialize) ? (() => initialize) : initialize as any,
-    identifier: "SerializableMachine",
-    retryPolicy: undefined,
-    schemaInput: options.input as any,
-    schemaState: options.state as any,
-    pipe() {
-      return pipeArguments(this, arguments)
-    }
-  }) as any
+): SerializableMachine<State, Public, Private, Input, InitErr, Exclude<R, Scope.Scope | MachineContext>, RS | RI> => (({
+  [TypeId]: TypeId,
+  [SerializableTypeId]: SerializableTypeId,
+  initialize: Effect.isEffect(initialize) ? (() => initialize) : initialize as any,
+  identifier: "SerializableMachine",
+  retryPolicy: undefined,
+  schemaInput: options.input as any,
+  schemaState: options.state as any,
+
+  pipe() {
+    return pipeArguments(this, arguments)
+  }
+}) as any)
 
 /**
  * @since 1.0.0
  * @category combinators
  */
 export const retry: {
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <M extends Machine.Any, Out, In extends Machine.InitError<M> | MachineDefect, R>(
     policy: Schedule.Schedule<Out, In, R>
   ): (self: M) => Machine.AddContext<M, R>
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <M extends Machine.Any, Out, In extends Machine.InitError<M> | MachineDefect, R>(
     self: M,
     policy: Schedule.Schedule<Out, In, R>
@@ -438,11 +461,10 @@ export const retry: {
 } = dual(2, <M extends Machine.Any, Out, In extends Machine.InitError<M> | MachineDefect, R>(
   self: M,
   retryPolicy: Schedule.Schedule<Out, In, R>
-): Machine.AddContext<M, R> =>
-  ({
-    ...self,
-    retryPolicy
-  }) as any)
+): Machine.AddContext<M, R> => (({
+  ...self,
+  retryPolicy
+}) as any))
 
 /**
  * @since 1.0.0
@@ -458,7 +480,15 @@ export const currentTracingEnabled: FiberRef.FiberRef<boolean> = globalValue(
  * @category tracing
  */
 export const withTracingEnabled: {
+  /**
+   * @since 1.0.0
+   * @category tracing
+   */
   (enabled: boolean): <A, E, R>(effect: Effect.Effect<A, E, R>) => Effect.Effect<A, E, R>
+  /**
+   * @since 1.0.0
+   * @category tracing
+   */
   <A, E, R>(effect: Effect.Effect<A, E, R>, enabled: boolean): Effect.Effect<A, E, R>
 } = dual(
   2,
@@ -486,21 +516,21 @@ export const boot = <
   never,
   Machine.Context<M> | Scope.Scope
 > =>
-  Effect.gen(function*(_) {
-    const context = yield* _(Effect.context<Machine.Context<M>>())
-    const requests = yield* _(Queue.unbounded<
+  Effect.gen(function*() {
+    const context = yield* Effect.context<Machine.Context<M>>()
+    const requests = yield* Queue.unbounded<
       readonly [
         Procedure.TaggedRequest.Any,
         Deferred.Deferred<any, any>,
         Tracer.AnySpan | undefined,
         addSpans: boolean
       ]
-    >())
-    const pubsub = yield* _(Effect.acquireRelease(
+    >()
+    const pubsub = yield* Effect.acquireRelease(
       PubSub.unbounded<Machine.State<M>>(),
       PubSub.shutdown
-    ))
-    const latch = yield* _(Deferred.make<void>())
+    )
+    const latch = yield* Deferred.make<void>()
 
     let currentState: Machine.State<M> = undefined as any
     let runState: {
@@ -586,7 +616,7 @@ export const boot = <
           Effect.flatMap((req) =>
             Effect.flatMap(
               Effect.exit(send(req)),
-              (exit) => Serializable.serializeExit(req, exit)
+              (exit) => Schema.serializeExit(req, exit)
             )
           ),
           Effect.provide(context)
@@ -601,9 +631,9 @@ export const boot = <
       return Effect.void
     }
 
-    const run = Effect.gen(function*(_) {
-      const fiberSet = yield* _(FiberSet.make<any, MachineDefect>())
-      const fiberMap = yield* _(FiberMap.make<string, any, MachineDefect>())
+    const run = Effect.gen(function*() {
+      const fiberSet = yield* FiberSet.make<any, MachineDefect>()
+      const fiberMap = yield* FiberMap.make<string, any, MachineDefect>()
 
       const fork = <A, E, R>(effect: Effect.Effect<A, E, R>) =>
         Effect.asVoid(FiberSet.run(fiberSet, MachineDefect.wrap(effect)))
@@ -685,7 +715,7 @@ export const boot = <
         forkReplaceWith
       }
 
-      const procedures = yield* _(
+      const procedures = yield* pipe(
         self.initialize(input, currentState ?? options?.previousState) as Effect.Effect<
           SerializableProcedureList<Machine.State<M>, Machine.Public<M>, Machine.Private<M>, never>,
           Machine.InitError<M>
@@ -715,8 +745,8 @@ export const boot = <
           )
         )
       }
-      yield* _(publishState(procedures.initialState))
-      yield* _(Deferred.succeed(latch, void 0))
+      yield* publishState(procedures.initialState)
+      yield* Deferred.succeed(latch, void 0)
 
       const process = pipe(
         Queue.take(requests),
@@ -779,7 +809,7 @@ export const boot = <
         Effect.provideService(MachineContext, contextProto)
       )
 
-      yield* _(
+      yield* pipe(
         Effect.all([
           process,
           FiberSet.join(fiberSet),
@@ -811,7 +841,7 @@ export const boot = <
       MachineDefect | Machine.InitError<M>
     >
 
-    const fiber = yield* _(
+    const fiber = yield* pipe(
       run,
       self.retryPolicy ?
         Effect.retry(self.retryPolicy) :
@@ -820,7 +850,7 @@ export const boot = <
       Effect.interruptible
     )
 
-    yield* _(Deferred.await(latch))
+    yield* Deferred.await(latch)
 
     return identity<SerializableActor<M>>(Object.assign(Object.create(ActorProto), {
       machine: self,
diff --git a/src/PersistedCache.ts b/src/PersistedCache.ts
index 63a7a16c6fd0df4bae53f48ea00b8181a93bc6a2..e4fe7777d033644e6b85a3a1614bf5b7da3fab66 100644
--- a/src/PersistedCache.ts
+++ b/src/PersistedCache.ts
@@ -1,7 +1,6 @@
 /**
  * @since 1.0.0
  */
-import type * as Serializable from "@effect/schema/Serializable"
 import * as Cache from "effect/Cache"
 import * as Data from "effect/Data"
 import type * as Duration from "effect/Duration"
@@ -10,6 +9,7 @@ import * as Equal from "effect/Equal"
 import { identity, pipe } from "effect/Function"
 import * as Hash from "effect/Hash"
 import * as Option from "effect/Option"
+import type * as Schema from "effect/Schema"
 import type * as Scope from "effect/Scope"
 import * as Tracer from "effect/Tracer"
 import * as Persistence from "./Persistence.js"
@@ -34,8 +34,8 @@ export interface PersistedCache<K extends Persistence.ResultPersistence.KeyAny>
   readonly get: (
     key: K
   ) => Effect.Effect<
-    Serializable.WithResult.Success<K>,
-    Serializable.WithResult.Failure<K> | Persistence.PersistenceError
+    Schema.WithResult.Success<K>,
+    Schema.WithResult.Failure<K> | Persistence.PersistenceError
   >
   readonly invalidate: (key: K) => Effect.Effect<void, Persistence.PersistenceError>
 }
@@ -46,14 +46,14 @@ export interface PersistedCache<K extends Persistence.ResultPersistence.KeyAny>
  */
 export const make = <K extends Persistence.ResultPersistence.KeyAny, R>(options: {
   readonly storeId: string
-  readonly lookup: (key: K) => Effect.Effect<Serializable.WithResult.Success<K>, Serializable.WithResult.Failure<K>, R>
+  readonly lookup: (key: K) => Effect.Effect<Schema.WithResult.Success<K>, Schema.WithResult.Failure<K>, R>
   readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<K>) => Duration.DurationInput
   readonly inMemoryCapacity?: number | undefined
   readonly inMemoryTTL?: Duration.DurationInput | undefined
 }): Effect.Effect<
   PersistedCache<K>,
   never,
-  Serializable.SerializableWithResult.Context<K> | R | Persistence.ResultPersistence | Scope.Scope
+  Schema.SerializableWithResult.Context<K> | R | Persistence.ResultPersistence | Scope.Scope
 > =>
   Persistence.ResultPersistence.pipe(
     Effect.flatMap((_) =>
@@ -67,9 +67,9 @@ export const make = <K extends Persistence.ResultPersistence.KeyAny, R>(options:
       Cache.make({
         lookup: (request: CacheRequest<K>) => {
           const effect: Effect.Effect<
-            Serializable.WithResult.Success<K>,
-            Serializable.WithResult.Failure<K> | Persistence.PersistenceError,
-            Serializable.SerializableWithResult.Context<K> | R
+            Schema.WithResult.Success<K>,
+            Schema.WithResult.Failure<K> | Persistence.PersistenceError,
+            Schema.SerializableWithResult.Context<K> | R
           > = pipe(
             store.get(request.key as any),
             Effect.flatMap(Option.match({
diff --git a/src/Persistence/Lmdb.ts b/src/Persistence/Lmdb.ts
index 2925f3ca4fb31af599f0edba3bcbdd6d0414d856..691668c23278d113bd49b8bf1f6ede20f6f024af 100644
--- a/src/Persistence/Lmdb.ts
+++ b/src/Persistence/Lmdb.ts
@@ -14,21 +14,21 @@ import * as Persistence from "../Persistence.js"
  * @category constructors
  */
 export const make = (options: Lmdb.RootDatabaseOptionsWithPath) =>
-  Effect.gen(function*(_) {
-    const lmdb = yield* _(Effect.acquireRelease(
+  Effect.gen(function*() {
+    const lmdb = yield* Effect.acquireRelease(
       Effect.sync(() => Lmdb.open(options)),
       (lmdb) => Effect.promise(() => lmdb.close())
-    ))
+    )
 
     return Persistence.BackingPersistence.of({
       [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
       make: (storeId) =>
-        Effect.gen(function*(_) {
-          const clock = yield* _(Effect.clock)
-          const store = yield* _(Effect.acquireRelease(
+        Effect.gen(function*() {
+          const clock = yield* Effect.clock
+          const store = yield* Effect.acquireRelease(
             Effect.sync(() => lmdb.openDB({ name: storeId })),
             (store) => Effect.promise(() => store.close())
-          ))
+          )
           const valueToOption = (key: string, _: any) => {
             if (!Arr.isArray(_)) return Option.none()
             const [value, expires] = _ as [unknown, number | null]
diff --git a/src/Persistence/Redis.ts b/src/Persistence/Redis.ts
index da2f88d32ff0e221f03fa400805a576d32982222..bfee3c3a29f107745b48fbbf94d8d698f453afb7 100644
--- a/src/Persistence/Redis.ts
+++ b/src/Persistence/Redis.ts
@@ -17,11 +17,11 @@ import * as Persistence from "../Persistence.js"
  * @category constructors
  */
 export const make = (options: RedisOptions) =>
-  Effect.gen(function*(_) {
-    const redis = yield* _(Effect.acquireRelease(
+  Effect.gen(function*() {
+    const redis = yield* Effect.acquireRelease(
       Effect.sync(() => new Redis(options)),
       (redis) => Effect.promise(() => redis.quit())
-    ))
+    )
     return Persistence.BackingPersistence.of({
       [Persistence.BackingPersistenceTypeId]: Persistence.BackingPersistenceTypeId,
       make: (prefix) =>
diff --git a/src/Persistence.ts b/src/Persistence.ts
index 109bd073e8c247859007390c795f9bc167fd4a0c..1b971b9ca88a572e0c9d01d2afcb8d1d1b8557ce 100644
--- a/src/Persistence.ts
+++ b/src/Persistence.ts
@@ -3,9 +3,6 @@
  */
 import { TypeIdError } from "@effect/platform/Error"
 import * as KeyValueStore from "@effect/platform/KeyValueStore"
-import type * as ParseResult from "@effect/schema/ParseResult"
-import * as Serializable from "@effect/schema/Serializable"
-import * as TreeFormatter from "@effect/schema/TreeFormatter"
 import type * as Clock from "effect/Clock"
 import * as Context from "effect/Context"
 import * as Duration from "effect/Duration"
@@ -14,7 +11,9 @@ import type * as Exit from "effect/Exit"
 import { identity } from "effect/Function"
 import * as Layer from "effect/Layer"
 import * as Option from "effect/Option"
+import * as ParseResult from "effect/ParseResult"
 import * as PrimaryKey from "effect/PrimaryKey"
+import * as Schema from "effect/Schema"
 import type * as Scope from "effect/Scope"
 
 /**
@@ -52,7 +51,7 @@ export class PersistenceParseError extends TypeIdError(ErrorTypeId, "Persistence
   }
 
   get message() {
-    return TreeFormatter.formatIssueSync(this.error)
+    return ParseResult.TreeFormatter.formatIssueSync(this.error)
   }
 }
 
@@ -178,7 +177,7 @@ export declare namespace ResultPersistence {
    * @since 1.0.0
    * @category models
    */
-  export interface Key<R, IE, E, IA, A> extends Serializable.WithResult<A, IA, E, IE, R>, PrimaryKey.PrimaryKey {}
+  export interface Key<R, IE, E, IA, A> extends Schema.WithResult<A, IA, E, IE, R>, PrimaryKey.PrimaryKey {}
 
   /**
    * @since 1.0.0
@@ -212,8 +211,8 @@ export const ResultPersistence: Context.Tag<ResultPersistence, ResultPersistence
  */
 export const layerResult = Layer.effect(
   ResultPersistence,
-  Effect.gen(function*(_) {
-    const backing = yield* _(BackingPersistence)
+  Effect.gen(function*() {
+    const backing = yield* BackingPersistence
     return ResultPersistence.of({
       [ResultPersistenceTypeId]: ResultPersistenceTypeId,
       make: (options) =>
@@ -226,7 +225,7 @@ export const layerResult = Layer.effect(
             value: unknown
           ) =>
             Effect.mapError(
-              Serializable.deserializeExit(key, value),
+              Schema.deserializeExit(key, value),
               (_) => PersistenceParseError.make(method, _.issue)
             )
           const encode = <R, IE, E, IA, A>(
@@ -235,7 +234,7 @@ export const layerResult = Layer.effect(
             value: Exit.Exit<A, E>
           ) =>
             Effect.mapError(
-              Serializable.serializeExit(key, value),
+              Schema.serializeExit(key, value),
               (_) => PersistenceParseError.make(method, _.issue)
             )
           const makeKey = <R, IE, E, IA, A>(
@@ -334,8 +333,8 @@ export const layerMemory: Layer.Layer<BackingPersistence> = Layer.sync(
  */
 export const layerKeyValueStore: Layer.Layer<BackingPersistence, never, KeyValueStore.KeyValueStore> = Layer.effect(
   BackingPersistence,
-  Effect.gen(function*(_) {
-    const backing = yield* _(KeyValueStore.KeyValueStore)
+  Effect.gen(function*() {
+    const backing = yield* KeyValueStore.KeyValueStore
     return BackingPersistence.of({
       [BackingPersistenceTypeId]: BackingPersistenceTypeId,
       make: (storeId) =>
diff --git a/src/Reactivity.ts b/src/Reactivity.ts
new file mode 100644
index 0000000000000000000000000000000000000000..2aa3f253d5496edc21d9ef959def662e73b56a20
--- /dev/null
+++ b/src/Reactivity.ts
@@ -0,0 +1,194 @@
+/**
+ * @since 1.0.0
+ */
+import * as Context from "effect/Context"
+import * as Effect from "effect/Effect"
+import * as Exit from "effect/Exit"
+import * as FiberHandle from "effect/FiberHandle"
+import * as Hash from "effect/Hash"
+import * as Layer from "effect/Layer"
+import * as Mailbox from "effect/Mailbox"
+import type { ReadonlyRecord } from "effect/Record"
+import * as Scope from "effect/Scope"
+import * as Stream from "effect/Stream"
+
+/**
+ * @since 1.0.0
+ * @category tags
+ */
+export class Reactivity extends Context.Tag("@effect/experimental/Reactivity")<
+  Reactivity,
+  Reactivity.Service
+>() {}
+
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const make = Effect.sync(() => {
+  const handlers = new Map<number | string, Set<() => void>>()
+
+  const unsafeInvalidate = (keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>): void => {
+    if (Array.isArray(keys)) {
+      for (let i = 0; i < keys.length; i++) {
+        const set = handlers.get(stringOrHash(keys[i]))
+        if (set === undefined) continue
+        for (const run of set) run()
+      }
+    } else {
+      const record = keys as ReadonlyRecord<string, Array<unknown>>
+      for (const key in record) {
+        const hashes = idHashes(key, record[key])
+        for (let i = 0; i < hashes.length; i++) {
+          const set = handlers.get(hashes[i])
+          if (set === undefined) continue
+          for (const run of set) run()
+        }
+
+        const set = handlers.get(key)
+        if (set !== undefined) {
+          for (const run of set) run()
+        }
+      }
+    }
+  }
+
+  const invalidate = (
+    keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>
+  ): Effect.Effect<void> => Effect.sync(() => unsafeInvalidate(keys))
+
+  const mutation = <A, E, R>(
+    keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+    effect: Effect.Effect<A, E, R>
+  ): Effect.Effect<A, E, R> => Effect.ensuring(effect, invalidate(keys))
+
+  const query = <A, E, R>(
+    keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+    effect: Effect.Effect<A, E, R>
+  ): Effect.Effect<Mailbox.ReadonlyMailbox<A, E>, never, R | Scope.Scope> =>
+    Effect.gen(function*() {
+      const resolvedKeys = Array.isArray(keys) ? keys.map(stringOrHash) : recordHashes(keys as any)
+      const scope = yield* Effect.scope
+      const results = yield* Mailbox.make<A, E>()
+      const runFork = yield* FiberHandle.makeRuntime<R>()
+
+      let running = false
+      let pending = false
+      const handleExit = (exit: Exit.Exit<A, E>) => {
+        if (exit._tag === "Failure") {
+          results.unsafeDone(Exit.failCause(exit.cause))
+        } else {
+          results.unsafeOffer(exit.value)
+        }
+        if (pending) {
+          pending = false
+          runFork(effect).addObserver(handleExit)
+        } else {
+          running = false
+        }
+      }
+
+      function run() {
+        if (running) {
+          pending = true
+          return
+        }
+        running = true
+        runFork(effect).addObserver(handleExit)
+      }
+
+      yield* Scope.addFinalizer(
+        scope,
+        Effect.sync(() => {
+          for (let i = 0; i < resolvedKeys.length; i++) {
+            const set = handlers.get(resolvedKeys[i])!
+            set.delete(run)
+            if (set.size === 0) {
+              handlers.delete(resolvedKeys[i])
+            }
+          }
+        })
+      )
+      for (let i = 0; i < resolvedKeys.length; i++) {
+        let set = handlers.get(resolvedKeys[i])
+        if (set === undefined) {
+          set = new Set()
+          handlers.set(resolvedKeys[i], set)
+        }
+        set.add(run)
+      }
+
+      run()
+
+      return results as Mailbox.ReadonlyMailbox<A, E>
+    })
+
+  const stream = <A, E, R>(
+    tables: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+    effect: Effect.Effect<A, E, R>
+  ): Stream.Stream<A, E, Exclude<R, Scope.Scope>> =>
+    query(tables, effect).pipe(
+      Effect.map(Mailbox.toStream),
+      Stream.unwrapScoped
+    )
+
+  return Reactivity.of({ mutation, query, stream, unsafeInvalidate, invalidate })
+})
+
+/**
+ * @since 1.0.0
+ * @category layers
+ */
+export const layer: Layer.Layer<Reactivity> = Layer.scoped(Reactivity, make)
+
+/**
+ * @since 1.0.0
+ * @category model
+ */
+export declare namespace Reactivity {
+  /**
+   * @since 1.0.0
+   * @category model
+   */
+  export interface Service {
+    readonly unsafeInvalidate: (keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>) => void
+    readonly invalidate: (
+      keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>
+    ) => Effect.Effect<void>
+    readonly mutation: <A, E, R>(
+      keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+      effect: Effect.Effect<A, E, R>
+    ) => Effect.Effect<A, E, R>
+    readonly query: <A, E, R>(
+      keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+      effect: Effect.Effect<A, E, R>
+    ) => Effect.Effect<Mailbox.ReadonlyMailbox<A, E>, never, R | Scope.Scope>
+    readonly stream: <A, E, R>(
+      keys: ReadonlyArray<unknown> | ReadonlyRecord<string, ReadonlyArray<unknown>>,
+      effect: Effect.Effect<A, E, R>
+    ) => Stream.Stream<A, E, Exclude<R, Scope.Scope>>
+  }
+}
+
+function stringOrHash(u: unknown): string | number {
+  return typeof u === "string" ? u : Hash.hash(u)
+}
+
+const idHashes = (keyHash: number | string, ids: ReadonlyArray<unknown>): ReadonlyArray<string> => {
+  const hashes: Array<string> = new Array(ids.length)
+  for (let i = 0; i < ids.length; i++) {
+    hashes[i] = `${keyHash}:${stringOrHash(ids[i])}`
+  }
+  return hashes
+}
+
+const recordHashes = (record: ReadonlyRecord<string, ReadonlyArray<unknown>>): ReadonlyArray<string> => {
+  const hashes: Array<string> = []
+  for (const key in record) {
+    hashes.push(key)
+    for (const idHash of idHashes(key, record[key])) {
+      hashes.push(idHash)
+    }
+  }
+  return hashes
+}
diff --git a/src/RequestResolver.ts b/src/RequestResolver.ts
index 64bc85f9cd154c7711b2734cb0947e97ad401680..4ddfc63fc861bdefd2ee68be1b923f1b60f9f619 100644
--- a/src/RequestResolver.ts
+++ b/src/RequestResolver.ts
@@ -1,7 +1,6 @@
 /**
  * @since 1.0.0
  */
-import type * as Serializable from "@effect/schema/Serializable"
 import * as Arr from "effect/Array"
 import * as Deferred from "effect/Deferred"
 import type * as Duration from "effect/Duration"
@@ -12,6 +11,7 @@ import { dual, pipe } from "effect/Function"
 import * as Option from "effect/Option"
 import * as Request from "effect/Request"
 import * as RequestResolver from "effect/RequestResolver"
+import type * as Schema from "effect/Schema"
 import type * as Scope from "effect/Scope"
 import * as Persistence from "./Persistence.js"
 
@@ -28,12 +28,22 @@ interface DataLoaderItem<A extends Request.Request<any, any>> {
  * @category combinators
  */
 export const dataLoader = dual<
-  (options: {
-    readonly window: Duration.DurationInput
-    readonly maxBatchSize?: number
-  }) => <A extends Request.Request<any, any>>(
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
+  (
+    options: {
+      readonly window: Duration.DurationInput
+      readonly maxBatchSize?: number
+    }
+  ) => <A extends Request.Request<any, any>>(
     self: RequestResolver.RequestResolver<A, never>
   ) => Effect.Effect<RequestResolver.RequestResolver<A, never>, never, Scope.Scope>,
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <A extends Request.Request<any, any>>(
     self: RequestResolver.RequestResolver<A, never>,
     options: {
@@ -45,11 +55,27 @@ export const dataLoader = dual<
   readonly window: Duration.DurationInput
   readonly maxBatchSize?: number
 }) =>
-  Effect.gen(function*(_) {
+  Effect.gen(function*() {
     const scope = yield* Effect.scope
-    const handle = yield* FiberHandle.make<void, never>()
+    const handle = yield* FiberHandle.make<
+      /**
+       * @since 1.0.0
+       * @category combinators
+       */
+      void, /**
+       * @since 1.0.0
+       * @category combinators
+       */
+      never
+    >()
     const maxSize = options.maxBatchSize ?? Infinity
-    let batch = Arr.empty<DataLoaderItem<A>>()
+    let batch = Arr.empty<
+      /**
+       * @since 1.0.0
+       * @category combinators
+       */
+      DataLoaderItem<A>
+    >()
     const process = (items: ReadonlyArray<DataLoaderItem<A>>) =>
       Effect.forEach(
         items,
@@ -88,21 +114,34 @@ export const dataLoader = dual<
       return runLoop
     }).pipe(Effect.uninterruptible)
     return RequestResolver.fromEffect((request: A) =>
-      Effect.flatMap(Deferred.make<Request.Request.Success<A>, Request.Request.Error<A>>(), (deferred) => {
-        const item: DataLoaderItem<A> = { request, deferred }
-        batch.push(item)
-        return run.pipe(
-          Effect.zipRight(Deferred.await(deferred)),
-          Effect.onInterrupt(() =>
-            Effect.sync(() => {
-              const index = batch.indexOf(item)
-              if (index >= 0) {
-                batch.splice(index, 1)
-              }
-            })
+      Effect.flatMap(
+        Deferred.make<
+          /**
+           * @since 1.0.0
+           * @category combinators
+           */
+          Request.Request.Success<A>, /**
+           * @since 1.0.0
+           * @category combinators
+           */
+          Request.Request.Error<A>
+        >(),
+        (deferred) => {
+          const item: DataLoaderItem<A> = { request, deferred }
+          batch.push(item)
+          return run.pipe(
+            Effect.zipRight(Deferred.await(deferred)),
+            Effect.onInterrupt(() =>
+              Effect.sync(() => {
+                const index = batch.indexOf(item)
+                if (index >= 0) {
+                  batch.splice(index, 1)
+                }
+              })
+            )
           )
-        )
-      })
+        }
+      )
     )
   }))
 
@@ -110,9 +149,7 @@ export const dataLoader = dual<
  * @since 1.0.0
  * @category model
  */
-export interface PersistedRequest<R, IE, E, IA, A>
-  extends Request.Request<A, E>, Serializable.WithResult<A, IA, E, IE, R>
-{}
+export interface PersistedRequest<R, IE, E, IA, A> extends Request.Request<A, E>, Schema.WithResult<A, IA, E, IE, R> {}
 
 /**
  * @since 1.0.0
@@ -131,16 +168,26 @@ export declare namespace PersistedRequest {
  * @category combinators
  */
 export const persisted: {
-  <Req extends PersistedRequest.Any>(options: {
-    readonly storeId: string
-    readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput
-  }): (
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
+  <Req extends PersistedRequest.Any>(
+    options: {
+      readonly storeId: string
+      readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput
+    }
+  ): (
     self: RequestResolver.RequestResolver<Req, never>
   ) => Effect.Effect<
-    RequestResolver.RequestResolver<Req, Serializable.WithResult.Context<Req>>,
+    RequestResolver.RequestResolver<Req, Schema.WithResult.Context<Req>>,
     never,
     Persistence.ResultPersistence | Scope.Scope
   >
+  /**
+   * @since 1.0.0
+   * @category combinators
+   */
   <Req extends PersistedRequest.Any>(
     self: RequestResolver.RequestResolver<Req, never>,
     options: {
@@ -148,7 +195,7 @@ export const persisted: {
       readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput
     }
   ): Effect.Effect<
-    RequestResolver.RequestResolver<Req, Serializable.WithResult.Context<Req>>,
+    RequestResolver.RequestResolver<Req, Schema.WithResult.Context<Req>>,
     never,
     Persistence.ResultPersistence | Scope.Scope
   >
@@ -159,11 +206,11 @@ export const persisted: {
     readonly timeToLive: (...args: Persistence.ResultPersistence.TimeToLiveArgs<Req>) => Duration.DurationInput
   }
 ): Effect.Effect<
-  RequestResolver.RequestResolver<Req, Serializable.WithResult.Context<Req>>,
+  RequestResolver.RequestResolver<Req, Schema.WithResult.Context<Req>>,
   never,
   Persistence.ResultPersistence | Scope.Scope
 > =>
-  Effect.gen(function*(_) {
+  Effect.gen(function*() {
     const storage = yield* (yield* Persistence.ResultPersistence).make({
       storeId: options.storeId,
       timeToLive: options.timeToLive as any
diff --git a/src/Sse.ts b/src/Sse.ts
new file mode 100644
index 0000000000000000000000000000000000000000..6b829b707f39e65a5d0bdc086681bfbe26fdfee6
--- /dev/null
+++ b/src/Sse.ts
@@ -0,0 +1,307 @@
+/**
+ * @since 1.0.0
+ */
+import * as Channel from "effect/Channel"
+import * as Chunk from "effect/Chunk"
+import * as Data from "effect/Data"
+import * as Duration from "effect/Duration"
+import * as Effect from "effect/Effect"
+import * as Mailbox from "effect/Mailbox"
+import { hasProperty } from "effect/Predicate"
+import type * as AsyncInput from "effect/SingleProducerAsyncInput"
+
+/**
+ * @since 1.0.0
+ * @category constructors
+ */
+export const makeChannel = <IE, Done>(options?: {
+  readonly bufferSize?: number
+}): Channel.Channel<
+  Chunk.Chunk<Event>,
+  Chunk.Chunk<string>,
+  IE,
+  IE,
+  void,
+  Done
+> => {
+  const events = Mailbox.make<Event, IE | Retry>(options?.bufferSize ?? 16).pipe(
+    Effect.map((mailbox) => {
+      let events: Array<Event> = []
+      let retry: Retry | undefined
+      const parser = makeParser((event) => {
+        switch (event._tag) {
+          case "Retry":
+            return (retry = event)
+          case "Event":
+            return events.push(event)
+        }
+      })
+      const input: AsyncInput.AsyncInputProducer<
+        IE,
+        Chunk.Chunk<string>,
+        Done
+      > = {
+        awaitRead() {
+          return Effect.void
+        },
+        emit(chunks) {
+          Chunk.forEach(chunks, parser.feed)
+          const toEmit = events
+          events = []
+          return retry
+            ? Effect.zipRight(mailbox.offerAll(toEmit), mailbox.fail(retry))
+            : mailbox.offerAll(toEmit)
+        },
+        error(cause) {
+          return mailbox.failCause(cause)
+        },
+        done(_) {
+          return mailbox.end
+        }
+      }
+      return Channel.embedInput(Mailbox.toChannel(mailbox), input)
+    }),
+    Channel.unwrap
+  )
+
+  const withRetry: Channel.Channel<
+    Chunk.Chunk<Event>,
+    Chunk.Chunk<string>,
+    IE,
+    IE,
+    void,
+    Done
+  > = Channel.catchAll(events, (error) =>
+    Retry.is(error) ?
+      Effect.sleep(error.duration).pipe(
+        Effect.as(withRetry),
+        Channel.unwrap
+      ) :
+      Channel.fail(error))
+
+  return withRetry
+}
+
+/**
+ * Create a SSE parser.
+ *
+ * Adapted from https://github.com/rexxars/eventsource-parser under MIT license.
+ *
+ * @since 1.0.0
+ * @category constructors
+ */
+export function makeParser(onParse: (event: AnyEvent) => void): Parser {
+  // Processing state
+  let isFirstChunk: boolean
+  let buffer: string
+  let startingPosition: number
+  let startingFieldLength: number
+
+  // Event state
+  let eventId: string | undefined
+  let lastEventId: string | undefined
+  let eventName: string | undefined
+  let data: string
+
+  reset()
+  return { feed, reset }
+
+  function reset(): void {
+    isFirstChunk = true
+    buffer = ""
+    startingPosition = 0
+    startingFieldLength = -1
+
+    eventId = undefined
+    eventName = undefined
+    data = ""
+  }
+
+  function feed(chunk: string): void {
+    buffer = buffer ? buffer + chunk : chunk
+
+    // Strip any UTF8 byte order mark (BOM) at the start of the stream.
+    // Note that we do not strip any non - UTF8 BOM, as eventsource streams are
+    // always decoded as UTF8 as per the specification.
+    if (isFirstChunk && hasBom(buffer)) {
+      buffer = buffer.slice(BOM.length)
+    }
+
+    isFirstChunk = false
+
+    // Set up chunk-specific processing state
+    const length = buffer.length
+    let position = 0
+    let discardTrailingNewline = false
+
+    // Read the current buffer byte by byte
+    while (position < length) {
+      // EventSource allows for carriage return + line feed, which means we
+      // need to ignore a linefeed character if the previous character was a
+      // carriage return
+      // @todo refactor to reduce nesting, consider checking previous byte?
+      // @todo but consider multiple chunks etc
+      if (discardTrailingNewline) {
+        if (buffer[position] === "\n") {
+          ;++position
+        }
+        discardTrailingNewline = false
+      }
+
+      let lineLength = -1
+      let fieldLength = startingFieldLength
+      let character: string
+
+      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {
+        character = buffer[index]
+        if (character === ":" && fieldLength < 0) {
+          fieldLength = index - position
+        } else if (character === "\r") {
+          discardTrailingNewline = true
+          lineLength = index - position
+        } else if (character === "\n") {
+          lineLength = index - position
+        }
+      }
+
+      if (lineLength < 0) {
+        startingPosition = length - position
+        startingFieldLength = fieldLength
+        break
+      } else {
+        startingPosition = 0
+        startingFieldLength = -1
+      }
+
+      parseEventStreamLine(buffer, position, fieldLength, lineLength)
+
+      position += lineLength + 1
+    }
+
+    if (position === length) {
+      // If we consumed the entire buffer to read the event, reset the buffer
+      buffer = ""
+    } else if (position > 0) {
+      // If there are bytes left to process, set the buffer to the unprocessed
+      // portion of the buffer only
+      buffer = buffer.slice(position)
+    }
+  }
+
+  function parseEventStreamLine(
+    lineBuffer: string,
+    index: number,
+    fieldLength: number,
+    lineLength: number
+  ) {
+    if (lineLength === 0) {
+      // We reached the last line of this event
+      if (data.length > 0) {
+        onParse({
+          _tag: "Event",
+          id: eventId,
+          event: eventName ?? "message",
+          data: data.slice(0, -1) // remove trailing newline
+        })
+        data = ""
+        eventId = undefined
+      }
+      eventName = undefined
+      return
+    }
+
+    const noValue = fieldLength < 0
+    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength))
+    let step = 0
+
+    if (noValue) {
+      step = lineLength
+    } else if (lineBuffer[index + fieldLength + 1] === " ") {
+      step = fieldLength + 2
+    } else {
+      step = fieldLength + 1
+    }
+
+    const position = index + step
+    const valueLength = lineLength - step
+    const value = lineBuffer.slice(position, position + valueLength).toString()
+
+    if (field === "data") {
+      data += value ? `${value}\n` : "\n"
+    } else if (field === "event") {
+      eventName = value
+    } else if (field === "id" && !value.includes("\u0000")) {
+      eventId = value
+      lastEventId = value
+    } else if (field === "retry") {
+      const retry = parseInt(value, 10)
+      if (!Number.isNaN(retry)) {
+        onParse(new Retry({ duration: Duration.millis(retry), lastEventId }))
+      }
+    }
+  }
+}
+
+const BOM = [239, 187, 191]
+
+function hasBom(buffer: string) {
+  return BOM.every((charCode: number, index: number) => buffer.charCodeAt(index) === charCode)
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface Parser {
+  feed(chunk: string): void
+  reset(): void
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export interface Event {
+  readonly _tag: "Event"
+  readonly event: string
+  readonly id: string | undefined
+  readonly data: string
+}
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export const RetryTypeId: unique symbol = Symbol.for("@effect/experimental/Sse/Retry")
+
+/**
+ * @since 1.0.0
+ * @category type ids
+ */
+export type RetryTypeId = typeof RetryTypeId
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export class Retry extends Data.TaggedClass("Retry")<{
+  readonly duration: Duration.Duration
+  readonly lastEventId: string | undefined
+}> {
+  /**
+   * @since 1.0.0
+   */
+  readonly [RetryTypeId]: RetryTypeId = RetryTypeId
+  /**
+   * @since 1.0.0
+   */
+  static is(u: unknown): u is Retry {
+    return hasProperty(u, RetryTypeId)
+  }
+}
+
+/**
+ * @since 1.0.0
+ * @category models
+ */
+export type AnyEvent = Event | Retry
diff --git a/src/VariantSchema.ts b/src/VariantSchema.ts
index baa072dfae2f0bd361350efdaf0281f0cdb4ecb7..ea328de05aaec74b5b6c89ec842fa2c0a6f4c21a 100644
--- a/src/VariantSchema.ts
+++ b/src/VariantSchema.ts
@@ -1,15 +1,15 @@
 /**
  * @since 1.0.0
  */
-import type * as AST from "@effect/schema/AST"
-import * as ParseResult from "@effect/schema/ParseResult"
-import * as Schema from "@effect/schema/Schema"
 import type { Brand } from "effect/Brand"
 import type * as Effect from "effect/Effect"
 import { constUndefined, dual } from "effect/Function"
 import * as Option from "effect/Option"
+import * as ParseResult from "effect/ParseResult"
 import { type Pipeable, pipeArguments } from "effect/Pipeable"
 import * as Predicate from "effect/Predicate"
+import * as Schema from "effect/Schema"
+import type * as AST from "effect/SchemaAST"
 import * as Struct_ from "effect/Struct"
 
 /**
@@ -506,7 +506,10 @@ export const make = <
       }
       for (const variant of options.variants) {
         Object.defineProperty(Base, variant, {
-          value: extract(variantStruct, variant)
+          value: extract(variantStruct, variant).annotations({
+            identifier: `${identifier}.${variant}`,
+            title: `${identifier}.${variant}`
+          })
         })
       }
       return Base
@@ -614,12 +617,18 @@ export const Overrideable = <From, IFrom, RFrom, To, ITo, R>(
   to: Schema.Schema<To, ITo>,
   options: {
     readonly generate: (_: Option.Option<ITo>) => Effect.Effect<From, ParseResult.ParseIssue, R>
+    readonly decode?: Schema.Schema<ITo, From>
+    readonly constructorDefault?: () => To
   }
 ): Overrideable<To, IFrom, RFrom | R> =>
-  Schema.transformOrFail(from, Schema.Union(Schema.Undefined, to.pipe(Schema.brand("Override"))), {
-    decode: (_) => ParseResult.succeed(undefined),
-    encode: (dt) => options.generate(dt === undefined ? Option.none() : Option.some(dt))
-  }).pipe(Schema.propertySignature, Schema.withConstructorDefault(constUndefined))
+  Schema.transformOrFail(
+    from,
+    Schema.Union(Schema.Undefined, to as Schema.brand<Schema.Schema<To, ITo>, "Override">),
+    {
+      decode: (_) => options.decode ? ParseResult.decode(options.decode)(_) : ParseResult.succeed(undefined),
+      encode: (dt) => options.generate(dt === undefined ? Option.none() : Option.some(dt))
+    }
+  ).pipe(Schema.propertySignature, Schema.withConstructorDefault(options.constructorDefault ?? constUndefined as any))
 
 const StructProto = {
   pipe() {
diff --git a/src/index.ts b/src/index.ts
index 645dea8abe91ebab46f2641efe1e308bcb0f87b9..e28fb066a2d4c94c444aa7188a1a235c6d8c9eb3 100644
--- a/src/index.ts
+++ b/src/index.ts
@@ -1,27 +1,47 @@
 /**
  * @since 1.0.0
  */
-export * as ChannelSchema from "./ChannelSchema.js"
+export * as DevTools from "./DevTools.js"
 
 /**
  * @since 1.0.0
  */
-export * as DevTools from "./DevTools.js"
+export * as Event from "./Event.js"
 
 /**
  * @since 1.0.0
  */
-export * as Machine from "./Machine.js"
+export * as EventGroup from "./EventGroup.js"
+
+/**
+ * @since 1.0.0
+ */
+export * as EventJournal from "./EventJournal.js"
+
+/**
+ * @since 1.0.0
+ */
+export * as EventLog from "./EventLog.js"
+
+/**
+ * @since 1.0.0
+ */
+export * as EventLogEncryption from "./EventLogEncryption.js"
+
+/**
+ * @since 1.0.0
+ */
+export * as EventLogRemote from "./EventLogRemote.js"
 
 /**
  * @since 1.0.0
  */
-export * as MsgPack from "./MsgPack.js"
+export * as EventLogServer from "./EventLogServer.js"
 
 /**
  * @since 1.0.0
  */
-export * as Ndjson from "./Ndjson.js"
+export * as Machine from "./Machine.js"
 
 /**
  * @since 1.0.0
@@ -33,6 +53,11 @@ export * as PersistedCache from "./PersistedCache.js"
  */
 export * as Persistence from "./Persistence.js"
 
+/**
+ * @since 1.0.0
+ */
+export * as Reactivity from "./Reactivity.js"
+
 /**
  * @since 1.0.0
  */
@@ -41,7 +66,7 @@ export * as RequestResolver from "./RequestResolver.js"
 /**
  * @since 1.0.0
  */
-export * as SocketServer from "./SocketServer.js"
+export * as Sse from "./Sse.js"
 
 /**
  * @since 1.0.0
