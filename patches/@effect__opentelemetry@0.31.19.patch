diff --git a/dist/cjs/internal/metrics.js b/dist/cjs/internal/metrics.js
index 7640fec69a25914959dc6692e97cc723a19dce40..ba924614c72cf8ccf5cdef887d16f162bc43990a 100644
--- a/dist/cjs/internal/metrics.js
+++ b/dist/cjs/internal/metrics.js
@@ -46,10 +46,22 @@ class MetricProducerImpl {
   constructor(resource) {
     this.resource = resource;
   }
+  startTime = {};
   collect(_options) {
     const snapshot = Metric.unsafeSnapshot();
     const hrTimeNow = currentHrTime();
-    const metricData = [];
+    const metricData = {};
+    const updateOrAdd = data => {
+      const existing = metricData[data.descriptor.name];
+      if (existing) {
+        metricData[data.descriptor.name] = {
+          ...existing,
+          dataPoints: existing.dataPoints.concat(data.dataPoints)
+        };
+        return;
+      }
+      metricData[data.descriptor.name] = data;
+    };
     for (let i = 0, len = snapshot.length; i < len; i++) {
       const {
         metricKey,
@@ -60,26 +72,27 @@ class MetricProducerImpl {
         return acc;
       });
       const descriptor = descriptorFromKey(metricKey, attributes);
+      const startTime = this.startTime[descriptor.name] ||= hrTimeNow;
       if (MetricState.isCounterState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.SUM,
           descriptor,
           isMonotonic: descriptor.type === _sdkMetrics.InstrumentType.COUNTER,
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.count)
           }]
         });
       } else if (MetricState.isGaugeState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.GAUGE,
           descriptor,
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.value)
@@ -101,12 +114,12 @@ class MetricProducerImpl {
           prev = value;
           i++;
         }
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.HISTOGRAM,
           descriptor,
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: {
@@ -122,7 +135,7 @@ class MetricProducerImpl {
         const dataPoints = [];
         for (const [freqKey, value] of metricState.occurrences) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: {
               ...attributes,
@@ -131,7 +144,7 @@ class MetricProducerImpl {
             value
           });
         }
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes),
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
@@ -140,7 +153,7 @@ class MetricProducerImpl {
         });
       } else if (MetricState.isSummaryState(metricState)) {
         const dataPoints = [{
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: {
             ...attributes,
@@ -150,7 +163,7 @@ class MetricProducerImpl {
         }];
         for (const [quantile, value] of metricState.quantiles) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: {
               ...attributes,
@@ -160,7 +173,7 @@ class MetricProducerImpl {
           });
         }
         dataPoints.push({
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: {
             ...attributes,
@@ -168,14 +181,14 @@ class MetricProducerImpl {
           },
           value: metricState.max
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes, "quantiles"),
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           isMonotonic: false,
           dataPoints
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "count"),
@@ -186,13 +199,13 @@ class MetricProducerImpl {
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.count
           }]
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: _sdkMetrics.DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "sum"),
@@ -203,7 +216,7 @@ class MetricProducerImpl {
           aggregationTemporality: _sdkMetrics.AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.sum
@@ -218,7 +231,7 @@ class MetricProducerImpl {
           scope: {
             name: sdkName
           },
-          metrics: metricData
+          metrics: Object.values(metricData)
         }]
       },
       errors: []
diff --git a/dist/cjs/internal/metrics.js.map b/dist/cjs/internal/metrics.js.map
index f95252d4cea2060ec923791e0a746c56bad6526d..a12db5f157b621dd35ebe0d38bbca748e729956a 100644
--- a/dist/cjs/internal/metrics.js.map
+++ b/dist/cjs/internal/metrics.js.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.js","names":["_api","require","_sdkMetrics","Effect","_interopRequireWildcard","Layer","Metric","MetricKeyType","MetricState","Option","ReadonlyArray","Resource","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","sdkName","MetricProducerImpl","resource","constructor","collect","_options","snapshot","unsafeSnapshot","hrTimeNow","currentHrTime","metricData","len","length","metricKey","metricState","attributes","reduce","tags","acc","label","key","value","descriptor","descriptorFromKey","isCounterState","push","dataPointType","DataPointType","SUM","isMonotonic","type","InstrumentType","COUNTER","aggregationTemporality","AggregationTemporality","CUMULATIVE","dataPoints","startTime","endTime","Number","count","isGaugeState","GAUGE","isHistogramState","size","buckets","boundaries","Array","counts","prev","boundary","HISTOGRAM","min","max","sum","isFrequencyState","freqKey","occurrences","isSummaryState","quantile","quantiles","toString","_tag","descriptorMeta","unit","valueType","ValueType","INT","DOUBLE","Promise","resolve","resourceMetrics","scopeMetrics","scope","name","metrics","errors","exports","suffix","description","getOrElse","time_unit","instrumentTypeFromKey","keyType","bigint","isHistogramKey","isGaugeKey","OBSERVABLE_GAUGE","isFrequencyKey","isCounterKey","incremental","UP_DOWN_COUNTER","now","Date","Math","floor","makeProducer","map","registerProducer","self","metricReader","acquireRelease","sync","reader","setMetricProducer","ignoreLogged","promise","shutdown","layer","evaluate","scopedDiscard","flatMap","producer"],"sources":["../../../src/internal/metrics.ts"],"sourcesContent":[null],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"metrics.js","names":["_api","require","_sdkMetrics","Effect","_interopRequireWildcard","Layer","Metric","MetricKeyType","MetricState","Option","ReadonlyArray","Resource","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","sdkName","MetricProducerImpl","resource","constructor","startTime","collect","_options","snapshot","unsafeSnapshot","hrTimeNow","currentHrTime","metricData","updateOrAdd","data","existing","descriptor","name","dataPoints","concat","len","length","metricKey","metricState","attributes","reduce","tags","acc","label","key","value","descriptorFromKey","isCounterState","dataPointType","DataPointType","SUM","isMonotonic","type","InstrumentType","COUNTER","aggregationTemporality","AggregationTemporality","CUMULATIVE","endTime","Number","count","isGaugeState","GAUGE","isHistogramState","size","buckets","boundaries","Array","counts","prev","boundary","HISTOGRAM","min","max","sum","isFrequencyState","freqKey","occurrences","push","isSummaryState","quantile","quantiles","toString","_tag","descriptorMeta","unit","valueType","ValueType","INT","DOUBLE","Promise","resolve","resourceMetrics","scopeMetrics","scope","metrics","values","errors","exports","suffix","description","getOrElse","time_unit","instrumentTypeFromKey","keyType","bigint","isHistogramKey","isGaugeKey","OBSERVABLE_GAUGE","isFrequencyKey","isCounterKey","incremental","UP_DOWN_COUNTER","now","Date","Math","floor","makeProducer","map","registerProducer","self","metricReader","acquireRelease","sync","reader","setMetricProducer","ignoreLogged","promise","shutdown","layer","evaluate","scopedDiscard","flatMap","producer"],"sources":["../../../src/internal/metrics.ts"],"sourcesContent":[null],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/esm/internal/metrics.js b/dist/esm/internal/metrics.js
index 776ba1912a2a40e2f959623c90d9b08e81ef04fe..6ab34c7a6e1c142bfebde42fdb3eafd634d0be17 100644
--- a/dist/esm/internal/metrics.js
+++ b/dist/esm/internal/metrics.js
@@ -15,10 +15,22 @@ export class MetricProducerImpl {
   constructor(resource) {
     this.resource = resource;
   }
+  startTime = {};
   collect(_options) {
     const snapshot = Metric.unsafeSnapshot();
     const hrTimeNow = currentHrTime();
-    const metricData = [];
+    const metricData = {};
+    const updateOrAdd = data => {
+      const existing = metricData[data.descriptor.name];
+      if (existing) {
+        metricData[data.descriptor.name] = {
+          ...existing,
+          dataPoints: existing.dataPoints.concat(data.dataPoints)
+        };
+        return;
+      }
+      metricData[data.descriptor.name] = data;
+    };
     for (let i = 0, len = snapshot.length; i < len; i++) {
       const {
         metricKey,
@@ -29,26 +41,27 @@ export class MetricProducerImpl {
         return acc;
       });
       const descriptor = descriptorFromKey(metricKey, attributes);
+      const startTime = this.startTime[descriptor.name] ||= hrTimeNow;
       if (MetricState.isCounterState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor,
           isMonotonic: descriptor.type === InstrumentType.COUNTER,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.count)
           }]
         });
       } else if (MetricState.isGaugeState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.GAUGE,
           descriptor,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.value)
@@ -70,12 +83,12 @@ export class MetricProducerImpl {
           prev = value;
           i++;
         }
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.HISTOGRAM,
           descriptor,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: {
@@ -91,7 +104,7 @@ export class MetricProducerImpl {
         const dataPoints = [];
         for (const [freqKey, value] of metricState.occurrences) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: {
               ...attributes,
@@ -100,7 +113,7 @@ export class MetricProducerImpl {
             value
           });
         }
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes),
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
@@ -109,7 +122,7 @@ export class MetricProducerImpl {
         });
       } else if (MetricState.isSummaryState(metricState)) {
         const dataPoints = [{
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: {
             ...attributes,
@@ -119,7 +132,7 @@ export class MetricProducerImpl {
         }];
         for (const [quantile, value] of metricState.quantiles) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: {
               ...attributes,
@@ -129,7 +142,7 @@ export class MetricProducerImpl {
           });
         }
         dataPoints.push({
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: {
             ...attributes,
@@ -137,14 +150,14 @@ export class MetricProducerImpl {
           },
           value: metricState.max
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes, "quantiles"),
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: false,
           dataPoints
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "count"),
@@ -155,13 +168,13 @@ export class MetricProducerImpl {
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.count
           }]
         });
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "sum"),
@@ -172,7 +185,7 @@ export class MetricProducerImpl {
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.sum
@@ -187,7 +200,7 @@ export class MetricProducerImpl {
           scope: {
             name: sdkName
           },
-          metrics: metricData
+          metrics: Object.values(metricData)
         }]
       },
       errors: []
diff --git a/dist/esm/internal/metrics.js.map b/dist/esm/internal/metrics.js.map
index ba605f0a0c2a6bd1ac5abd205e0830d5c7e853f1..84802fbc7573b0ee048991adc2005837dd418c9a 100644
--- a/dist/esm/internal/metrics.js.map
+++ b/dist/esm/internal/metrics.js.map
@@ -1 +1 @@
-{"version":3,"file":"metrics.js","names":["ValueType","AggregationTemporality","DataPointType","InstrumentType","Effect","Layer","Metric","MetricKeyType","MetricState","Option","ReadonlyArray","Resource","sdkName","MetricProducerImpl","resource","constructor","collect","_options","snapshot","unsafeSnapshot","hrTimeNow","currentHrTime","metricData","i","len","length","metricKey","metricState","attributes","reduce","tags","acc","label","key","value","descriptor","descriptorFromKey","isCounterState","push","dataPointType","SUM","isMonotonic","type","COUNTER","aggregationTemporality","CUMULATIVE","dataPoints","startTime","endTime","Number","count","isGaugeState","GAUGE","isHistogramState","size","buckets","boundaries","Array","counts","prev","boundary","HISTOGRAM","min","max","sum","isFrequencyState","freqKey","occurrences","isSummaryState","quantile","quantiles","toString","_tag","descriptorMeta","unit","valueType","INT","DOUBLE","Promise","resolve","resourceMetrics","scopeMetrics","scope","name","metrics","errors","suffix","description","getOrElse","time_unit","instrumentTypeFromKey","keyType","bigint","isHistogramKey","isGaugeKey","OBSERVABLE_GAUGE","isFrequencyKey","isCounterKey","incremental","UP_DOWN_COUNTER","now","Date","Math","floor","makeProducer","map","registerProducer","self","metricReader","acquireRelease","sync","reader","setMetricProducer","ignoreLogged","promise","shutdown","layer","evaluate","scopedDiscard","flatMap","producer"],"sources":["../../../src/internal/metrics.ts"],"sourcesContent":[null],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"metrics.js","names":["ValueType","AggregationTemporality","DataPointType","InstrumentType","Effect","Layer","Metric","MetricKeyType","MetricState","Option","ReadonlyArray","Resource","sdkName","MetricProducerImpl","resource","constructor","startTime","collect","_options","snapshot","unsafeSnapshot","hrTimeNow","currentHrTime","metricData","updateOrAdd","data","existing","descriptor","name","dataPoints","concat","i","len","length","metricKey","metricState","attributes","reduce","tags","acc","label","key","value","descriptorFromKey","isCounterState","dataPointType","SUM","isMonotonic","type","COUNTER","aggregationTemporality","CUMULATIVE","endTime","Number","count","isGaugeState","GAUGE","isHistogramState","size","buckets","boundaries","Array","counts","prev","boundary","HISTOGRAM","min","max","sum","isFrequencyState","freqKey","occurrences","push","isSummaryState","quantile","quantiles","toString","_tag","descriptorMeta","unit","valueType","INT","DOUBLE","Promise","resolve","resourceMetrics","scopeMetrics","scope","metrics","Object","values","errors","suffix","description","getOrElse","time_unit","instrumentTypeFromKey","keyType","bigint","isHistogramKey","isGaugeKey","OBSERVABLE_GAUGE","isFrequencyKey","isCounterKey","incremental","UP_DOWN_COUNTER","now","Date","Math","floor","makeProducer","map","registerProducer","self","metricReader","acquireRelease","sync","reader","setMetricProducer","ignoreLogged","promise","shutdown","layer","evaluate","scopedDiscard","flatMap","producer"],"sources":["../../../src/internal/metrics.ts"],"sourcesContent":[null],"mappings":"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"}
\ No newline at end of file
diff --git a/src/internal/metrics.ts b/src/internal/metrics.ts
index 171ba8102aa613175d2f9c529cddbc886c1776d8..1b9963e6f6fd628670e009487997b76b3577df8a 100644
--- a/src/internal/metrics.ts
+++ b/src/internal/metrics.ts
@@ -28,11 +28,23 @@ const sdkName = "@effect/opentelemetry/Metrics"
 export class MetricProducerImpl implements MetricProducer {
   constructor(readonly resource: Resources.Resource) {
   }
+  readonly startTime: Record<string, HrTime> = {}
 
   collect(_options?: MetricCollectOptions): Promise<CollectionResult> {
     const snapshot = Metric.unsafeSnapshot()
     const hrTimeNow = currentHrTime()
-    const metricData: Array<MetricData> = []
+    const metricData: Record<string, MetricData> = {}
+    const updateOrAdd = (data: MetricData) => {
+      const existing = metricData[data.descriptor.name]
+      if (existing) {
+        metricData[data.descriptor.name] = {
+          ...existing,
+          dataPoints: existing.dataPoints.concat(data.dataPoints)
+        } as any
+        return
+      }
+      metricData[data.descriptor.name] = data
+    }
 
     for (let i = 0, len = snapshot.length; i < len; i++) {
       const { metricKey, metricState } = snapshot[i]
@@ -42,26 +54,28 @@ export class MetricProducerImpl implements MetricProducer {
       })
       const descriptor = descriptorFromKey(metricKey, attributes)
 
+      const startTime = this.startTime[descriptor.name] ||= hrTimeNow
+
       if (MetricState.isCounterState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor,
           isMonotonic: descriptor.type === InstrumentType.COUNTER,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.count)
           }]
         })
       } else if (MetricState.isGaugeState(metricState)) {
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.GAUGE,
           descriptor,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: Number(metricState.value)
@@ -84,12 +98,12 @@ export class MetricProducerImpl implements MetricProducer {
           i++
         }
 
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.HISTOGRAM,
           descriptor,
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: {
@@ -105,7 +119,7 @@ export class MetricProducerImpl implements MetricProducer {
         const dataPoints: Array<DataPoint<number>> = []
         for (const [freqKey, value] of metricState.occurrences) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: {
               ...attributes,
@@ -114,7 +128,7 @@ export class MetricProducerImpl implements MetricProducer {
             value
           })
         }
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes),
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
@@ -123,34 +137,34 @@ export class MetricProducerImpl implements MetricProducer {
         })
       } else if (MetricState.isSummaryState(metricState)) {
         const dataPoints: Array<DataPoint<number>> = [{
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: { ...attributes, quantile: "min" },
           value: metricState.min
         }]
         for (const [quantile, value] of metricState.quantiles) {
           dataPoints.push({
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes: { ...attributes, quantile: quantile.toString() },
             value: value._tag === "Some" ? value.value : 0
           })
         }
         dataPoints.push({
-          startTime: hrTimeNow,
+          startTime,
           endTime: hrTimeNow,
           attributes: { ...attributes, quantile: "max" },
           value: metricState.max
         })
 
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: descriptorFromKey(metricKey, attributes, "quantiles"),
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: false,
           dataPoints
         })
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "count"),
@@ -161,13 +175,13 @@ export class MetricProducerImpl implements MetricProducer {
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.count
           }]
         })
-        metricData.push({
+        updateOrAdd({
           dataPointType: DataPointType.SUM,
           descriptor: {
             ...descriptorMeta(metricKey, "sum"),
@@ -178,7 +192,7 @@ export class MetricProducerImpl implements MetricProducer {
           aggregationTemporality: AggregationTemporality.CUMULATIVE,
           isMonotonic: true,
           dataPoints: [{
-            startTime: hrTimeNow,
+            startTime,
             endTime: hrTimeNow,
             attributes,
             value: metricState.sum
@@ -192,7 +206,7 @@ export class MetricProducerImpl implements MetricProducer {
         resource: this.resource,
         scopeMetrics: [{
           scope: { name: sdkName },
-          metrics: metricData
+          metrics: Object.values(metricData)
         }]
       },
       errors: []
