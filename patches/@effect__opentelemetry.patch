diff --git a/dist/cjs/internal/tracer.js b/dist/cjs/internal/tracer.js
index fbeace9fc8e0df9fd50e02dc34130bb09d9b6f8c..6e94e142b17e42347038282fa51339da3846d315 100644
--- a/dist/cjs/internal/tracer.js
+++ b/dist/cjs/internal/tracer.js
@@ -25,16 +25,20 @@ const kindMap = {
   "producer": OtelApi.SpanKind.PRODUCER,
   "consumer": OtelApi.SpanKind.CONSUMER
 };
-const getOtelParent = (tracer, otelContext, context) => {
-  const active = tracer.getSpan(otelContext);
-  const otelParent = active ? active.spanContext() : undefined;
-  return otelParent ? Option.some(EffectTracer.externalSpan({
-    spanId: otelParent.spanId,
-    traceId: otelParent.traceId,
-    sampled: (otelParent.traceFlags & 1) === 1,
-    context
-  })) : Option.none();
-};
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 /** @internal */
 class OtelSpan {
   name;
@@ -50,14 +54,20 @@ class OtelSpan {
   sampled;
   parent;
   status;
-  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, options) {
+  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, _options) {
     this.name = name;
     this.context = context;
     this.links = links;
     this.kind = kind;
     this[OtelSpanTypeId] = OtelSpanTypeId;
     const active = contextApi.active();
-    this.parent = effectParent._tag === "Some" ? effectParent : options?.root !== true ? getOtelParent(traceApi, active, context) : Option.none();
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent;
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(name, {
       startTime: (0, _utils.nanosToHrTime)(startTime),
       links: links.length > 0 ? links.map(link => ({
diff --git a/dist/cjs/internal/tracer.js.map b/dist/cjs/internal/tracer.js.map
index 62dcb4fc911dfeaa1af9e86431130cc576bc4c10..67b17723e4d340b10f6aa122f24ab522fc1b1ba7 100644
--- a/dist/cjs/internal/tracer.js.map
+++ b/dist/cjs/internal/tracer.js.map
@@ -1 +1 @@
-{"version":3,"file":"tracer.js","names":["OtelApi","_interopRequireWildcard","require","OtelSemConv","Cause","Context","Effect","Exit","_Function","Layer","Option","EffectTracer","_Resource","_utils","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","getOtelParent","tracer","otelContext","context","active","getSpan","otelParent","spanContext","undefined","some","externalSpan","spanId","traceId","sampled","traceFlags","none","OtelSpan","name","links","kind","_tag","span","attributes","Map","parent","status","constructor","contextApi","traceApi","effectParent","startTime","options","root","startSpan","nanosToHrTime","length","map","link","makeSpanContext","recordToAttributes","populateContext","value","trace","deleteSpan","TraceFlags","SAMPLED","attribute","key","setAttribute","unknownToAttributeValue","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","exports","TracerProvider","GenericTag","Tracer","make","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","makeOtelSpan","clock","NONE","isRemote","void","self","setAttributes","entries","arguments","convertOtelTimeInput","addLink","die","updateName","time","isRecording","constTrue","exception","timeInput","fail","error","bigint1e6","BigInt","bigint1e9","input","unsafeCurrentTimeNanos","Math","round","Date","getTime","seconds","nanos","currentOtelSpan","clockWith","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","flatMap","zip","Resource","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","setSpan","setSpanContext","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","dual","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAF,uBAAA,CAAAC,OAAA;AACA,IAAAE,KAAA,GAAAH,uBAAA,CAAAC,OAAA;AAEA,IAAAG,OAAA,GAAAJ,uBAAA,CAAAC,OAAA;AACA,IAAAI,MAAA,GAAAL,uBAAA,CAAAC,OAAA;AACA,IAAAK,IAAA,GAAAN,uBAAA,CAAAC,OAAA;AACA,IAAAM,SAAA,GAAAN,OAAA;AACA,IAAAO,KAAA,GAAAR,uBAAA,CAAAC,OAAA;AACA,IAAAQ,MAAA,GAAAT,uBAAA,CAAAC,OAAA;AACA,IAAAS,YAAA,GAAAV,uBAAA,CAAAC,OAAA;AACA,IAAAU,SAAA,GAAAV,OAAA;AAEA,IAAAW,MAAA,GAAAX,OAAA;AAAuF,SAAAD,wBAAAa,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAf,uBAAA,YAAAA,CAAAa,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,gBAAAP,CAAA,IAAAD,CAAA,gBAAAC,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAC,CAAA,OAAAM,CAAA,IAAAD,CAAA,GAAAU,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAC,CAAA,OAAAM,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAP,CAAA,EAAAM,CAAA,IAAAC,CAAA,CAAAP,CAAA,IAAAD,CAAA,CAAAC,CAAA,WAAAO,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAEvF,MAAMkB,cAAc,gBAAGC,MAAM,CAACC,GAAG,CAAC,uCAAuC,CAAC;AAE1E,MAAMC,OAAO,GAAG;EACd,UAAU,EAAEpC,OAAO,CAACqC,QAAQ,CAACC,QAAQ;EACrC,QAAQ,EAAEtC,OAAO,CAACqC,QAAQ,CAACE,MAAM;EACjC,QAAQ,EAAEvC,OAAO,CAACqC,QAAQ,CAACG,MAAM;EACjC,UAAU,EAAExC,OAAO,CAACqC,QAAQ,CAACI,QAAQ;EACrC,UAAU,EAAEzC,OAAO,CAACqC,QAAQ,CAACK;CAC9B;AAED,MAAMC,aAAa,GAAGA,CAACC,MAAwB,EAAEC,WAA4B,EAAEC,OAA+B,KAAI;EAChH,MAAMC,MAAM,GAAGH,MAAM,CAACI,OAAO,CAACH,WAAW,CAAC;EAC1C,MAAMI,UAAU,GAAGF,MAAM,GAAGA,MAAM,CAACG,WAAW,EAAE,GAAGC,SAAS;EAC5D,OAAOF,UAAU,GACbvC,MAAM,CAAC0C,IAAI,CACXzC,YAAY,CAAC0C,YAAY,CAAC;IACxBC,MAAM,EAAEL,UAAU,CAACK,MAAM;IACzBC,OAAO,EAAEN,UAAU,CAACM,OAAO;IAC3BC,OAAO,EAAE,CAACP,UAAU,CAACQ,UAAU,GAAG,CAAC,MAAM,CAAC;IAC1CX;GACD,CAAC,CACH,GACCpC,MAAM,CAACgD,IAAI,EAAE;AACnB,CAAC;AAED;AACM,MAAOC,QAAQ;EAgBRC,IAAA;EAEAd,OAAA;EACAe,KAAA;EAEAC,IAAA;EApBF,CAAC7B,cAAc;EACf8B,IAAI,GAAG,MAAM;EAEbC,IAAI;EACJV,MAAM;EACNC,OAAO;EACPU,UAAU,gBAAG,IAAIC,GAAG,EAAmB;EACvCV,OAAO;EACPW,MAAM;EACfC,MAAM;EAENC,YACEC,UAA8B,EAC9BC,QAA0B,EAC1B3B,MAAsB,EACbgB,IAAY,EACrBY,YAAiD,EACxC1B,OAA+B,EAC/Be,KAAmC,EAC5CY,SAAiB,EACRX,IAA2B,EACpCY,OAAkC;IANzB,KAAAd,IAAI,GAAJA,IAAI;IAEJ,KAAAd,OAAO,GAAPA,OAAO;IACP,KAAAe,KAAK,GAALA,KAAK;IAEL,KAAAC,IAAI,GAAJA,IAAI;IAGb,IAAI,CAAC7B,cAAc,CAAC,GAAGA,cAAc;IACrC,MAAMc,MAAM,GAAGuB,UAAU,CAACvB,MAAM,EAAE;IAClC,IAAI,CAACoB,MAAM,GAAGK,YAAY,CAACT,IAAI,KAAK,MAAM,GACtCS,YAAY,GACXE,OAAO,EAAEC,IAAI,KAAK,IAAI,GACvBhC,aAAa,CAAC4B,QAAQ,EAAExB,MAAM,EAAED,OAAO,CAAC,GACxCpC,MAAM,CAACgD,IAAI,EAAE;IACjB,IAAI,CAACM,IAAI,GAAGpB,MAAM,CAACgC,SAAS,CAC1BhB,IAAI,EACJ;MACEa,SAAS,EAAE,IAAAI,oBAAa,EAACJ,SAAS,CAAC;MACnCZ,KAAK,EAAEA,KAAK,CAACiB,MAAM,GAAG,CAAC,GACnBjB,KAAK,CAACkB,GAAG,CAAEC,IAAI,KAAM;QACrBlC,OAAO,EAAEmC,eAAe,CAACD,IAAI,CAAChB,IAAI,CAAC;QACnCC,UAAU,EAAE,IAAAiB,yBAAkB,EAACF,IAAI,CAACf,UAAU;OAC/C,CAAC,CAAC,GACDd,SAAgB;MACpBW,IAAI,EAAE1B,OAAO,CAAC,IAAI,CAAC0B,IAAI;KACxB,EACD,IAAI,CAACK,MAAM,CAACJ,IAAI,KAAK,MAAM,GACvBoB,eAAe,CAACpC,MAAM,EAAE,IAAI,CAACoB,MAAM,CAACiB,KAAK,EAAEtC,OAAO,CAAC,GACnD9C,OAAO,CAACqF,KAAK,CAACC,UAAU,CAACvC,MAAM,CAAC,CACrC;IACD,MAAMG,WAAW,GAAG,IAAI,CAACc,IAAI,CAACd,WAAW,EAAE;IAC3C,IAAI,CAACI,MAAM,GAAGJ,WAAW,CAACI,MAAM;IAChC,IAAI,CAACC,OAAO,GAAGL,WAAW,CAACK,OAAO;IAClC,IAAI,CAACa,MAAM,GAAG;MACZL,IAAI,EAAE,SAAS;MACfU;KACD;IACD,IAAI,CAACjB,OAAO,GAAG,CAACN,WAAW,CAACO,UAAU,GAAGzD,OAAO,CAACuF,UAAU,CAACC,OAAO,MAAMxF,OAAO,CAACuF,UAAU,CAACC,OAAO;EACrG;EAEAC,SAASA,CAACC,GAAW,EAAEN,KAAc;IACnC,IAAI,CAACpB,IAAI,CAAC2B,YAAY,CAACD,GAAG,EAAE,IAAAE,8BAAuB,EAACR,KAAK,CAAC,CAAC;IAC3D,IAAI,CAACnB,UAAU,CAACtC,GAAG,CAAC+D,GAAG,EAAEN,KAAK,CAAC;EACjC;EAEAS,QAAQA,CAAChC,KAA2C;IAClD;IACA,IAAI,CAACA,KAAK,CAACiC,IAAI,CAAC,GAAGjC,KAAK,CAAC;IACzB,IAAI,CAACG,IAAI,CAAC6B,QAAQ,CAAChC,KAAK,CAACkB,GAAG,CAAEC,IAAI,KAAM;MACtClC,OAAO,EAAEmC,eAAe,CAACD,IAAI,CAAChB,IAAI,CAAC;MACnCC,UAAU,EAAE,IAAAiB,yBAAkB,EAACF,IAAI,CAACf,UAAU;KAC/C,CAAC,CAAC,CAAC;EACN;EAEA8B,GAAGA,CAACC,OAAe,EAAEC,IAAiC;IACpD,MAAMC,MAAM,GAAG,IAAArB,oBAAa,EAACmB,OAAO,CAAC;IACrC,IAAI,CAAC5B,MAAM,GAAG;MACZL,IAAI,EAAE,OAAO;MACbiC,OAAO;MACPC,IAAI;MACJxB,SAAS,EAAE,IAAI,CAACL,MAAM,CAACK;KACxB;IAED,IAAIwB,IAAI,CAAClC,IAAI,KAAK,SAAS,EAAE;MAC3B,IAAI,CAACC,IAAI,CAACmC,SAAS,CAAC;QAAEC,IAAI,EAAEpG,OAAO,CAACqG,cAAc,CAACC;MAAE,CAAE,CAAC;IAC1D,CAAC,MAAM;MACL,IAAIlG,KAAK,CAACmG,iBAAiB,CAACN,IAAI,CAACO,KAAK,CAAC,EAAE;QACvC,IAAI,CAACxC,IAAI,CAACmC,SAAS,CAAC;UAClBC,IAAI,EAAEpG,OAAO,CAACqG,cAAc,CAACC,EAAE;UAC/BG,OAAO,EAAErG,KAAK,CAACsG,MAAM,CAACT,IAAI,CAACO,KAAK;SACjC,CAAC;QACF,IAAI,CAACxC,IAAI,CAAC2B,YAAY,CAAC,YAAY,EAAE,gBAAgB,CAAC;QACtD,IAAI,CAAC3B,IAAI,CAAC2B,YAAY,CAAC,oBAAoB,EAAE,IAAI,CAAC;MACpD,CAAC,MAAM;QACL,MAAMgB,UAAU,GAAGvG,KAAK,CAACwG,YAAY,CAACX,IAAI,CAACO,KAAK,CAAC,CAAC,CAAC,CAAC;QACpD,IAAIG,UAAU,EAAE;UACdA,UAAU,CAACE,KAAK,GAAGzG,KAAK,CAACsG,MAAM,CAACT,IAAI,CAACO,KAAK,EAAE;YAAEM,gBAAgB,EAAE;UAAI,CAAE,CAAC;UACvE,IAAI,CAAC9C,IAAI,CAAC+C,eAAe,CAACJ,UAAU,EAAET,MAAM,CAAC;UAC7C,IAAI,CAAClC,IAAI,CAACmC,SAAS,CAAC;YAClBC,IAAI,EAAEpG,OAAO,CAACqG,cAAc,CAACW,KAAK;YAClCP,OAAO,EAAEE,UAAU,CAACF;WACrB,CAAC;QACJ,CAAC,MAAM;UACL;UACA,IAAI,CAACzC,IAAI,CAACmC,SAAS,CAAC;YAAEC,IAAI,EAAEpG,OAAO,CAACqG,cAAc,CAACC;UAAE,CAAE,CAAC;QAC1D;MACF;IACF;IACA,IAAI,CAACtC,IAAI,CAAC+B,GAAG,CAACG,MAAM,CAAC;EACvB;EAEAe,KAAKA,CAACrD,IAAY,EAAEa,SAAiB,EAAER,UAAoC;IACzE,IAAI,CAACD,IAAI,CAACkD,QAAQ,CAChBtD,IAAI,EACJK,UAAU,GAAG,IAAAiB,yBAAkB,EAACjB,UAAU,CAAC,GAAGd,SAAS,EACvD,IAAA0B,oBAAa,EAACJ,SAAS,CAAC,CACzB;EACH;;AAGF;AAAA0C,OAAA,CAAAxD,QAAA,GAAAA,QAAA;AACO,MAAMyD,cAAc,GAAAD,OAAA,CAAAC,cAAA,gBAAG/G,OAAO,CAACgH,UAAU,CAC9C,iDAAiD,CAClD;AAED;AACO,MAAMC,MAAM,GAAAH,OAAA,CAAAG,MAAA,gBAAGjH,OAAO,CAACgH,UAAU,CAA6B,yCAAyC,CAAC;AAE/G;AACO,MAAME,IAAI,GAAAJ,OAAA,CAAAI,IAAA,gBAAGjH,MAAM,CAACyE,GAAG,CAACuC,MAAM,EAAG1E,MAAM,IAC5CjC,YAAY,CAAC4G,IAAI,CAAC;EAChBvD,IAAIA,CAACJ,IAAI,EAAEO,MAAM,EAAErB,OAAO,EAAEe,KAAK,EAAEY,SAAS,EAAEX,IAAI,EAAEY,OAAO;IACzD,OAAO,IAAIf,QAAQ,CACjB3D,OAAO,CAAC8C,OAAO,EACf9C,OAAO,CAACqF,KAAK,EACbzC,MAAM,EACNgB,IAAI,EACJO,MAAM,EACNrB,OAAO,EACPe,KAAK,CAAC2D,KAAK,EAAE,EACb/C,SAAS,EACTX,IAAI,EACJY,OAAO,CACR;EACH,CAAC;EACD5B,OAAOA,CAAC2E,SAAS,EAAEC,KAAK;IACtB,MAAMC,WAAW,GAAGD,KAAK,CAACC,WAAW;IAErC,IAAIA,WAAW,KAAKxE,SAAS,EAAE;MAC7B,OAAOsE,SAAS,EAAE;IACpB;IAEA,OAAOzH,OAAO,CAAC8C,OAAO,CAAC8E,IAAI,CACzBzC,eAAe,CAACnF,OAAO,CAAC8C,OAAO,CAACC,MAAM,EAAE,EAAE4E,WAAW,CAAC,EACtDF,SAAS,CACV;EACH;CACD,CAAC,CAAC;AAEL;AACO,MAAMI,aAAa,GAAAV,OAAA,CAAAU,aAAA,gBAAGxH,OAAO,CAACgH,UAAU,CAC7C,6CAA6C,CAC9C;AAED;AACO,MAAMS,aAAa,GAAAX,OAAA,CAAAW,aAAA,gBAAGzH,OAAO,CAACgH,UAAU,CAC7C,6CAA6C,CAC9C;AAED;AACO,MAAMU,gBAAgB,GAAIrD,OAKhC,IAA+B;EAC9B,IAAI5B,OAAO,GAAGzC,OAAO,CAAC2H,KAAK,EAAE;EAE7B,IAAItD,OAAO,CAACjB,UAAU,KAAKN,SAAS,EAAE;IACpCL,OAAO,GAAGzC,OAAO,CAAC4H,GAAG,CAACnF,OAAO,EAAE+E,aAAa,EAAEnD,OAAO,CAACjB,UAAU,CAAC;EACnE;EAEA,IAAI,OAAOiB,OAAO,CAACwD,UAAU,KAAK,QAAQ,EAAE;IAC1CpF,OAAO,GAAGpC,MAAM,CAACyH,KAAK,CAACC,gBAAgB,CAAC1D,OAAO,CAACwD,UAAU,CAAC,EAAE;MAC3DG,MAAM,EAAEA,CAAA,KAAMvF,OAAO;MACrBwF,MAAM,EAAGJ,UAAU,IAAK7H,OAAO,CAAC4H,GAAG,CAACnF,OAAO,EAAEgF,aAAa,EAAEI,UAAU;KACvE,CAAC;EACJ,CAAC,MAAM,IAAIxD,OAAO,CAACwD,UAAU,EAAE;IAC7BpF,OAAO,GAAGzC,OAAO,CAAC4H,GAAG,CAACnF,OAAO,EAAEgF,aAAa,EAAEpD,OAAO,CAACwD,UAAU,CAAC;EACnE;EAEA,OAAO;IACLnE,IAAI,EAAE,cAAc;IACpBR,OAAO,EAAEmB,OAAO,CAACnB,OAAO;IACxBD,MAAM,EAAEoB,OAAO,CAACpB,MAAM;IACtBE,OAAO,EAAEkB,OAAO,CAACjB,UAAU,KAAKN,SAAS,GACrC,CAACuB,OAAO,CAACjB,UAAU,GAAGzD,OAAO,CAACuF,UAAU,CAACC,OAAO,MAAMxF,OAAO,CAACuF,UAAU,CAACC,OAAO,GAChF,IAAI;IACR1C;GACD;AACH,CAAC;AAAAqE,OAAA,CAAAY,gBAAA,GAAAA,gBAAA;AAED,MAAMQ,YAAY,GAAGA,CAACvE,IAAuB,EAAEwE,KAAkB,KAAkB;EACjF,MAAMtF,WAAW,GAAwB;IACvCK,OAAO,EAAES,IAAI,CAACT,OAAO;IACrBD,MAAM,EAAEU,IAAI,CAACV,MAAM;IACnBG,UAAU,EAAEO,IAAI,CAACR,OAAO,GAAGxD,OAAO,CAACuF,UAAU,CAACC,OAAO,GAAGxF,OAAO,CAACuF,UAAU,CAACkD,IAAI;IAC/EC,QAAQ,EAAE;GACX;EAED,IAAIzC,IAAI,GAAG1F,IAAI,CAACoI,IAAI;EAEpB,MAAMC,IAAI,GAAiB;IACzB1F,WAAW,EAAEA,CAAA,KAAMA,WAAW;IAC9ByC,YAAYA,CAACD,GAAG,EAAEN,KAAK;MACrBpB,IAAI,CAACyB,SAAS,CAACC,GAAG,EAAEN,KAAK,CAAC;MAC1B,OAAOwD,IAAI;IACb,CAAC;IACDC,aAAaA,CAAC5E,UAAU;MACtB,KAAK,MAAM,CAACyB,GAAG,EAAEN,KAAK,CAAC,IAAItD,MAAM,CAACgH,OAAO,CAAC7E,UAAU,CAAC,EAAE;QACrDD,IAAI,CAACyB,SAAS,CAACC,GAAG,EAAEN,KAAK,CAAC;MAC5B;MACA,OAAOwD,IAAI;IACb,CAAC;IACD1B,QAAQA,CAACtD,IAAI;MACX,IAAIK,UAAU,GAAmCd,SAAS;MAC1D,IAAIsB,SAAS,GAAkCtB,SAAS;MACxD,IAAI4F,SAAS,CAACjE,MAAM,KAAK,CAAC,EAAE;QAC1Bb,UAAU,GAAG8E,SAAS,CAAC,CAAC,CAAC;QACzBtE,SAAS,GAAGsE,SAAS,CAAC,CAAC,CAAC;MAC1B,CAAC,MAAM;QACLtE,SAAS,GAAGsE,SAAS,CAAC,CAAC,CAAC;MAC1B;MACA/E,IAAI,CAACiD,KAAK,CAACrD,IAAI,EAAEoF,oBAAoB,CAACvE,SAAS,EAAE+D,KAAK,CAAC,EAAEvE,UAAU,CAAC;MACpE,OAAO2E,IAAI;IACb,CAAC;IACDK,OAAOA,CAACjE,IAAI;MACVhB,IAAI,CAAC6B,QAAQ,CAAC,CAAC;QACb9B,IAAI,EAAE,UAAU;QAChBC,IAAI,EAAE+D,gBAAgB,CAAC/C,IAAI,CAAClC,OAAO,CAAC;QACpCmB,UAAU,EAAEe,IAAI,CAACf,UAAU,IAAI;OAChC,CAAC,CAAC;MACH,OAAO2E,IAAI;IACb,CAAC;IACD/C,QAAQA,CAAChC,KAAK;MACZG,IAAI,CAAC6B,QAAQ,CAAChC,KAAK,CAACkB,GAAG,CAAEC,IAAI,KAAM;QACjCjB,IAAI,EAAE,UAAU;QAChBC,IAAI,EAAE+D,gBAAgB,CAAC/C,IAAI,CAAClC,OAAO,CAAC;QACpCmB,UAAU,EAAEe,IAAI,CAACf,UAAU,IAAI;OAChC,CAAC,CAAC,CAAC;MACJ,OAAO2E,IAAI;IACb,CAAC;IACDzC,SAASA,CAAC/B,MAAM;MACd6B,IAAI,GAAGjG,OAAO,CAACqG,cAAc,CAACW,KAAK,GAC/BzG,IAAI,CAAC2I,GAAG,CAAC9E,MAAM,CAACqC,OAAO,IAAI,eAAe,CAAC,GAC3ClG,IAAI,CAACoI,IAAI;MACb,OAAOC,IAAI;IACb,CAAC;IACDO,UAAU,EAAEA,CAAA,KAAMP,IAAI;IACtB7C,GAAGA,CAACC,OAAO;MACT,MAAMoD,IAAI,GAAGJ,oBAAoB,CAAChD,OAAO,EAAEwC,KAAK,CAAC;MACjDxE,IAAI,CAAC+B,GAAG,CAACqD,IAAI,EAAEnD,IAAI,CAAC;MACpB,OAAO2C,IAAI;IACb,CAAC;IACDS,WAAW,EAAEC,mBAAS;IACtBvC,eAAeA,CAACwC,SAAS,EAAEC,SAAS;MAClC,MAAMJ,IAAI,GAAGJ,oBAAoB,CAACQ,SAAS,EAAEhB,KAAK,CAAC;MACnD,MAAMhC,KAAK,GAAGpG,KAAK,CAACqJ,IAAI,CAACF,SAAS,CAAC;MACnC,MAAMG,KAAK,GAAGtJ,KAAK,CAACwG,YAAY,CAACJ,KAAK,CAAC,CAAC,CAAC,CAAC;MAC1CxC,IAAI,CAACiD,KAAK,CAACyC,KAAK,CAACjD,OAAO,EAAE2C,IAAI,EAAE;QAC9B,gBAAgB,EAAEM,KAAK,CAAC9F,IAAI;QAC5B,mBAAmB,EAAE8F,KAAK,CAACjD,OAAO;QAClC,sBAAsB,EAAEiD,KAAK,CAAC7C,KAAK,IAAI;OACxC,CAAC;IACJ;GACD;EACD,OAAO+B,IAAI;AACb,CAAC;AAED,MAAMe,SAAS,gBAAGC,MAAM,CAAC,SAAS,CAAC;AACnC,MAAMC,SAAS,gBAAGD,MAAM,CAAC,aAAa,CAAC;AAEvC,MAAMZ,oBAAoB,GAAGA,CAACc,KAAoC,EAAEtB,KAAkB,KAAY;EAChG,IAAIsB,KAAK,KAAK3G,SAAS,EAAE;IACvB,OAAOqF,KAAK,CAACuB,sBAAsB,EAAE;EACvC,CAAC,MAAM,IAAI,OAAOD,KAAK,KAAK,QAAQ,EAAE;IACpC,OAAOF,MAAM,CAACI,IAAI,CAACC,KAAK,CAACH,KAAK,GAAG,SAAS,CAAC,CAAC;EAC9C,CAAC,MAAM,IAAIA,KAAK,YAAYI,IAAI,EAAE;IAChC,OAAON,MAAM,CAACE,KAAK,CAACK,OAAO,EAAE,CAAC,GAAGR,SAAS;EAC5C;EACA,MAAM,CAACS,OAAO,EAAEC,KAAK,CAAC,GAAGP,KAAK;EAC9B,OAAOF,MAAM,CAACQ,OAAO,CAAC,GAAGP,SAAS,GAAGD,MAAM,CAACS,KAAK,CAAC;AACpD,CAAC;AAED;AACO,MAAMC,eAAe,GAAAnD,OAAA,CAAAmD,eAAA,gBAA8DhK,MAAM,CAACiK,SAAS,CAAE/B,KAAK,IAC/GlI,MAAM,CAACyE,GAAG,CAACzE,MAAM,CAACqH,WAAW,EAAG3D,IAAI,IAAkB;EACpD,IAAI/B,cAAc,IAAI+B,IAAI,EAAE;IAC1B,OAAQA,IAAiB,CAACA,IAAI;EAChC;EACA,OAAOuE,YAAY,CAACvE,IAAI,EAAEwE,KAAK,CAAC;AAClC,CAAC,CAAC,CACH;AAED;AACO,MAAMgC,mBAAmB,GAAArD,OAAA,CAAAqD,mBAAA,gBAAG/J,KAAK,CAACgK,IAAI,CAC3CrD,cAAc,EACd,MAAMpH,OAAO,CAACqF,KAAK,CAACqF,iBAAiB,EAAE,CACxC;AAED;AACO,MAAMC,WAAW,GAAAxD,OAAA,CAAAwD,WAAA,gBAAGlK,KAAK,CAACmK,MAAM,CACrCtD,MAAM,eACNhH,MAAM,CAACuK,OAAO,cACZvK,MAAM,CAACwK,GAAG,CAACC,kBAAQ,EAAE3D,cAAc,CAAC,EACpC,CAAC,CAAC4D,QAAQ,EAAEC,QAAQ,CAAC,KACnB3K,MAAM,CAACmK,IAAI,CAAC,MACVQ,QAAQ,CAACC,SAAS,CAChBF,QAAQ,CAAC/G,UAAU,CAAC9D,WAAW,CAACgL,iBAAiB,CAAW,EAC5DH,QAAQ,CAAC/G,UAAU,CAAC9D,WAAW,CAACiL,oBAAoB,CAAW,CAChE,CACF,CACJ,CACF;AAED;AACO,MAAMC,iBAAiB,GAAAlE,OAAA,CAAAkE,iBAAA,gBAAGV,WAAW,CAACW,IAAI,cAC/C7K,KAAK,CAAC8K,OAAO,CAACf,mBAAmB,CAAC,CACnC;AAED;AACO,MAAMgB,WAAW,GAAArE,OAAA,CAAAqE,WAAA,gBAAG/K,KAAK,CAACgL,YAAY,CAACnL,MAAM,CAACyE,GAAG,CAACwC,IAAI,EAAE9G,KAAK,CAACiL,SAAS,CAAC,CAAC,CAACJ,IAAI,cACnF7K,KAAK,CAACkL,YAAY,CAACN,iBAAiB,CAAC,CACtC;AAED;AACO,MAAMO,sBAAsB,GAAAzE,OAAA,CAAAyE,sBAAA,gBAAGnL,KAAK,CAACgL,YAAY,cAACnL,MAAM,CAACyE,GAAG,CAACwC,IAAI,EAAE9G,KAAK,CAACiL,SAAS,CAAC,CAAC;AAE3F;AACO,MAAMG,KAAK,GAAA1E,OAAA,CAAA0E,KAAA,gBAAGD,sBAAsB,CAACN,IAAI,cAC9C7K,KAAK,CAACkL,YAAY,CAAChB,WAAW,CAAC,CAChC;AAED;AACA;AACA;AAEA,MAAMvC,gBAAgB,gBAAG1H,MAAM,CAACoL,aAAa,CAAC9L,OAAO,CAACoI,gBAAgB,CAAC;AAEvE,MAAMjD,eAAe,GAAGA,CACtBtC,WAA4B,EAC5BmB,IAA0B,EAC1BlB,OAAgC,KAEhCkB,IAAI,YAAYL,QAAQ,GACtB3D,OAAO,CAACqF,KAAK,CAAC0G,OAAO,CAAClJ,WAAW,EAAEmB,IAAI,CAACA,IAAI,CAAC,GAC7ChE,OAAO,CAACqF,KAAK,CAAC2G,cAAc,CAACnJ,WAAW,EAAEoC,eAAe,CAACjB,IAAI,EAAElB,OAAO,CAAC,CAAC;AAE7E,MAAMmC,eAAe,GAAGA,CAACjB,IAA0B,EAAElB,OAAgC,MAA2B;EAC9GQ,MAAM,EAAEU,IAAI,CAACV,MAAM;EACnBC,OAAO,EAAES,IAAI,CAACT,OAAO;EACrBmF,QAAQ,EAAE1E,IAAI,CAACD,IAAI,KAAK,cAAc;EACtCN,UAAU,EAAE/C,MAAM,CAACuL,SAAS,CAC1BnJ,OAAO,GACLoJ,eAAe,CAAClI,IAAI,EAAElB,OAAO,EAAE+E,aAAa,CAAC,GAC7CxH,OAAO,CAAC8L,SAAS,CAACnI,IAAI,CAAClB,OAAO,EAAE+E,aAAa,CAAC,EAChD,MAAM7H,OAAO,CAACuF,UAAU,CAACC,OAAO,CACjC;EACD0C,UAAU,EAAExH,MAAM,CAAC0L,cAAc,CAC/BtJ,OAAO,GACLoJ,eAAe,CAAClI,IAAI,EAAElB,OAAO,EAAEgF,aAAa,CAAC,GAC7CzH,OAAO,CAAC8L,SAAS,CAACnI,IAAI,CAAClB,OAAO,EAAEgF,aAAa,CAAC;CAEnD,CAAC;AAEF,MAAMoE,eAAe,GAAGA,CACtB/H,MAA4B,EAC5BrB,OAA+B,EAC/BuJ,GAAsB,KAEtB3L,MAAM,CAAC4L,MAAM,CACXjM,OAAO,CAAC8L,SAAS,CAACrJ,OAAO,EAAEuJ,GAAG,CAAC,EAC/B,MAAMhM,OAAO,CAAC8L,SAAS,CAAChI,MAAM,CAACrB,OAAO,EAAEuJ,GAAG,CAAC,CAC7C;AAEH;AACO,MAAME,eAAe,GAAApF,OAAA,CAAAoF,eAAA,gBAAG,IAAAC,cAAI,EAQjC,CAAC,EAAE,CACH5B,MAA8B,EAC9B1H,WAAgC,KAEhC5C,MAAM,CAACmM,cAAc,CAAC7B,MAAM,EAAE7C,gBAAgB,CAAC7E,WAAW,CAAC,CAAC,CAAC","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"tracer.js","names":["OtelApi","_interopRequireWildcard","require","OtelSemConv","Cause","Context","Effect","Exit","_Function","Layer","Option","EffectTracer","_Resource","_utils","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","OtelSpan","name","context","links","kind","_tag","span","spanId","traceId","attributes","Map","sampled","parent","status","constructor","contextApi","traceApi","tracer","effectParent","startTime","_options","active","startSpan","nanosToHrTime","length","map","link","makeSpanContext","recordToAttributes","undefined","populateContext","value","trace","deleteSpan","spanContext","traceFlags","TraceFlags","SAMPLED","attribute","key","setAttribute","unknownToAttributeValue","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","exports","TracerProvider","GenericTag","Tracer","make","options","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","makeOtelSpan","clock","NONE","isRemote","void","self","setAttributes","entries","arguments","convertOtelTimeInput","addLink","die","updateName","time","isRecording","constTrue","exception","timeInput","fail","error","bigint1e6","BigInt","bigint1e9","input","unsafeCurrentTimeNanos","Math","round","Date","getTime","seconds","nanos","currentOtelSpan","clockWith","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","flatMap","zip","Resource","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","otelContext","setSpan","setSpanContext","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","dual","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/internal/tracer.js b/dist/esm/internal/tracer.js
index 4434c16fe85569b20c92478fc072009aca1c8d67..43146d88df339f814dc38493670d67804905bd60 100644
--- a/dist/esm/internal/tracer.js
+++ b/dist/esm/internal/tracer.js
@@ -18,16 +18,20 @@ const kindMap = {
   "producer": OtelApi.SpanKind.PRODUCER,
   "consumer": OtelApi.SpanKind.CONSUMER
 };
-const getOtelParent = (tracer, otelContext, context) => {
-  const active = tracer.getSpan(otelContext);
-  const otelParent = active ? active.spanContext() : undefined;
-  return otelParent ? Option.some(EffectTracer.externalSpan({
-    spanId: otelParent.spanId,
-    traceId: otelParent.traceId,
-    sampled: (otelParent.traceFlags & 1) === 1,
-    context
-  })) : Option.none();
-};
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 /** @internal */
 export class OtelSpan {
   name;
@@ -43,14 +47,20 @@ export class OtelSpan {
   sampled;
   parent;
   status;
-  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, options) {
+  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, _options) {
     this.name = name;
     this.context = context;
     this.links = links;
     this.kind = kind;
     this[OtelSpanTypeId] = OtelSpanTypeId;
     const active = contextApi.active();
-    this.parent = effectParent._tag === "Some" ? effectParent : options?.root !== true ? getOtelParent(traceApi, active, context) : Option.none();
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent;
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(name, {
       startTime: nanosToHrTime(startTime),
       links: links.length > 0 ? links.map(link => ({
diff --git a/dist/esm/internal/tracer.js.map b/dist/esm/internal/tracer.js.map
index cae48736cc728ed88d706fbea6b98434bdac67c7..d4975b7e0f00fcfe5d161c2c1d60f930fbcb8ae8 100644
--- a/dist/esm/internal/tracer.js.map
+++ b/dist/esm/internal/tracer.js.map
@@ -1 +1 @@
-{"version":3,"file":"tracer.js","names":["OtelApi","OtelSemConv","Cause","Context","Effect","Exit","constTrue","dual","Layer","Option","EffectTracer","Resource","nanosToHrTime","recordToAttributes","unknownToAttributeValue","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","getOtelParent","tracer","otelContext","context","active","getSpan","otelParent","spanContext","undefined","some","externalSpan","spanId","traceId","sampled","traceFlags","none","OtelSpan","name","links","kind","_tag","span","attributes","Map","parent","status","constructor","contextApi","traceApi","effectParent","startTime","options","root","startSpan","length","map","link","makeSpanContext","populateContext","value","trace","deleteSpan","TraceFlags","SAMPLED","attribute","key","setAttribute","set","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","TracerProvider","GenericTag","Tracer","make","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","makeOtelSpan","clock","NONE","isRemote","void","self","setAttributes","Object","entries","arguments","convertOtelTimeInput","addLink","die","updateName","time","isRecording","exception","timeInput","fail","error","bigint1e6","BigInt","bigint1e9","input","unsafeCurrentTimeNanos","Math","round","Date","getTime","seconds","nanos","currentOtelSpan","clockWith","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","flatMap","zip","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","setSpan","setSpanContext","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"tracer.js","names":["OtelApi","OtelSemConv","Cause","Context","Effect","Exit","constTrue","dual","Layer","Option","EffectTracer","Resource","nanosToHrTime","recordToAttributes","unknownToAttributeValue","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","OtelSpan","name","context","links","kind","_tag","span","spanId","traceId","attributes","Map","sampled","parent","status","constructor","contextApi","traceApi","tracer","effectParent","startTime","_options","active","startSpan","length","map","link","makeSpanContext","undefined","populateContext","value","trace","deleteSpan","spanContext","traceFlags","TraceFlags","SAMPLED","attribute","key","setAttribute","set","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","TracerProvider","GenericTag","Tracer","make","options","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","makeOtelSpan","clock","NONE","isRemote","void","self","setAttributes","Object","entries","arguments","convertOtelTimeInput","addLink","die","updateName","time","isRecording","exception","timeInput","fail","error","bigint1e6","BigInt","bigint1e9","input","unsafeCurrentTimeNanos","Math","round","Date","getTime","seconds","nanos","currentOtelSpan","clockWith","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","flatMap","zip","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","otelContext","setSpan","setSpanContext","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/src/internal/tracer.ts b/src/internal/tracer.ts
index 8b857b8de36ecac04bfd14e42110be36a54d9cf3..02d9a611293318bb2409f3646cc52281e9da5797 100644
--- a/src/internal/tracer.ts
+++ b/src/internal/tracer.ts
@@ -23,20 +23,20 @@ const kindMap = {
   "consumer": OtelApi.SpanKind.CONSUMER
 }
 
-const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
-  const active = tracer.getSpan(otelContext)
-  const otelParent = active ? active.spanContext() : undefined
-  return otelParent
-    ? Option.some(
-      EffectTracer.externalSpan({
-        spanId: otelParent.spanId,
-        traceId: otelParent.traceId,
-        sampled: (otelParent.traceFlags & 1) === 1,
-        context
-      })
-    )
-    : Option.none()
-}
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 
 /** @internal */
 export class OtelSpan implements EffectTracer.Span {
@@ -61,15 +61,17 @@ export class OtelSpan implements EffectTracer.Span {
     readonly links: Array<EffectTracer.SpanLink>,
     startTime: bigint,
     readonly kind: EffectTracer.SpanKind,
-    options?: EffectTracer.SpanOptions
+    _options?: EffectTracer.SpanOptions
   ) {
     this[OtelSpanTypeId] = OtelSpanTypeId
     const active = contextApi.active()
-    this.parent = effectParent._tag === "Some"
-      ? effectParent
-      : (options?.root !== true)
-      ? getOtelParent(traceApi, active, context)
-      : Option.none()
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(
       name,
       {
