diff --git a/dist/cjs/internal/tracer.js b/dist/cjs/internal/tracer.js
index 544381cb3b45aebe0e9c080b70877d3db8f4f387..e36701d2ae5c5cb9fcf5794ffb999ff2fe2bf428 100644
--- a/dist/cjs/internal/tracer.js
+++ b/dist/cjs/internal/tracer.js
@@ -24,16 +24,20 @@ const kindMap = {
   "producer": OtelApi.SpanKind.PRODUCER,
   "consumer": OtelApi.SpanKind.CONSUMER
 };
-const getOtelParent = (tracer, otelContext, context) => {
-  const active = tracer.getSpan(otelContext);
-  const otelParent = active ? active.spanContext() : undefined;
-  return otelParent ? Option.some(EffectTracer.externalSpan({
-    spanId: otelParent.spanId,
-    traceId: otelParent.traceId,
-    sampled: (otelParent.traceFlags & 1) === 1,
-    context
-  })) : Option.none();
-};
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 /** @internal */
 class OtelSpan {
   name;
@@ -49,14 +53,20 @@ class OtelSpan {
   sampled;
   parent;
   status;
-  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, options) {
+  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, _options) {
     this.name = name;
     this.context = context;
     this.links = links;
     this.kind = kind;
     this[OtelSpanTypeId] = OtelSpanTypeId;
     const active = contextApi.active();
-    this.parent = effectParent._tag === "Some" ? effectParent : options?.root !== true ? getOtelParent(traceApi, active, context) : Option.none();
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent;
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(name, {
       startTime: (0, _utils.nanosToHrTime)(startTime),
       links: links.length > 0 ? links.map(link => ({
diff --git a/dist/cjs/internal/tracer.js.map b/dist/cjs/internal/tracer.js.map
index 239679c9af7366b1a5619b13f05367966cb26b3e..fbb57608929b1a96077878520a4f1a0a2c3740ae 100644
--- a/dist/cjs/internal/tracer.js.map
+++ b/dist/cjs/internal/tracer.js.map
@@ -1 +1 @@
-{"version":3,"file":"tracer.js","names":["OtelApi","_interopRequireWildcard","require","OtelSemConv","Cause","Context","Effect","_Function","Layer","Option","EffectTracer","_Resource","_utils","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","getOtelParent","tracer","otelContext","context","active","getSpan","otelParent","spanContext","undefined","some","externalSpan","spanId","traceId","sampled","traceFlags","none","OtelSpan","name","links","kind","_tag","span","attributes","Map","parent","status","constructor","contextApi","traceApi","effectParent","startTime","options","root","startSpan","nanosToHrTime","length","map","link","makeSpanContext","recordToAttributes","populateContext","value","trace","deleteSpan","TraceFlags","SAMPLED","attribute","key","setAttribute","unknownToAttributeValue","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","exports","TracerProvider","GenericTag","Tracer","make","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","currentOtelSpan","flatMap","succeed","fail","NoSuchElementException","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","zip","Resource","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","setSpan","setSpanContext","isRemote","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","dual","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"tracer.js","names":["OtelApi","_interopRequireWildcard","require","OtelSemConv","Cause","Context","Effect","_Function","Layer","Option","EffectTracer","_Resource","_utils","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","OtelSpan","name","context","links","kind","_tag","span","spanId","traceId","attributes","Map","sampled","parent","status","constructor","contextApi","traceApi","tracer","effectParent","startTime","_options","active","startSpan","nanosToHrTime","length","map","link","makeSpanContext","recordToAttributes","undefined","populateContext","value","trace","deleteSpan","spanContext","traceFlags","TraceFlags","SAMPLED","attribute","key","setAttribute","unknownToAttributeValue","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","exports","TracerProvider","GenericTag","Tracer","make","options","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","currentOtelSpan","flatMap","succeed","fail","NoSuchElementException","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","zip","Resource","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","otelContext","setSpan","setSpanContext","isRemote","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","dual","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/dist/esm/internal/tracer.js b/dist/esm/internal/tracer.js
index 9ff913e439b5ba4e7eec649347a6e0ed0d43d0d5..e67f197d60ca5fe244a00d2eb0d9569f9b8af7b9 100644
--- a/dist/esm/internal/tracer.js
+++ b/dist/esm/internal/tracer.js
@@ -17,16 +17,20 @@ const kindMap = {
   "producer": OtelApi.SpanKind.PRODUCER,
   "consumer": OtelApi.SpanKind.CONSUMER
 };
-const getOtelParent = (tracer, otelContext, context) => {
-  const active = tracer.getSpan(otelContext);
-  const otelParent = active ? active.spanContext() : undefined;
-  return otelParent ? Option.some(EffectTracer.externalSpan({
-    spanId: otelParent.spanId,
-    traceId: otelParent.traceId,
-    sampled: (otelParent.traceFlags & 1) === 1,
-    context
-  })) : Option.none();
-};
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 /** @internal */
 export class OtelSpan {
   name;
@@ -42,14 +46,20 @@ export class OtelSpan {
   sampled;
   parent;
   status;
-  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, options) {
+  constructor(contextApi, traceApi, tracer, name, effectParent, context, links, startTime, kind, _options) {
     this.name = name;
     this.context = context;
     this.links = links;
     this.kind = kind;
     this[OtelSpanTypeId] = OtelSpanTypeId;
     const active = contextApi.active();
-    this.parent = effectParent._tag === "Some" ? effectParent : options?.root !== true ? getOtelParent(traceApi, active, context) : Option.none();
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent;
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(name, {
       startTime: nanosToHrTime(startTime),
       links: links.length > 0 ? links.map(link => ({
diff --git a/dist/esm/internal/tracer.js.map b/dist/esm/internal/tracer.js.map
index 1bced742027106e3a5e85b107935f602e0810048..8112e64516e2e55388f2fba167b166888bbd9c1f 100644
--- a/dist/esm/internal/tracer.js.map
+++ b/dist/esm/internal/tracer.js.map
@@ -1 +1 @@
-{"version":3,"file":"tracer.js","names":["OtelApi","OtelSemConv","Cause","Context","Effect","dual","Layer","Option","EffectTracer","Resource","nanosToHrTime","recordToAttributes","unknownToAttributeValue","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","getOtelParent","tracer","otelContext","context","active","getSpan","otelParent","spanContext","undefined","some","externalSpan","spanId","traceId","sampled","traceFlags","none","OtelSpan","name","links","kind","_tag","span","attributes","Map","parent","status","constructor","contextApi","traceApi","effectParent","startTime","options","root","startSpan","length","map","link","makeSpanContext","populateContext","value","trace","deleteSpan","TraceFlags","SAMPLED","attribute","key","setAttribute","set","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","TracerProvider","GenericTag","Tracer","make","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","currentOtelSpan","flatMap","succeed","fail","NoSuchElementException","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","zip","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","setSpan","setSpanContext","isRemote","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
+{"version":3,"file":"tracer.js","names":["OtelApi","OtelSemConv","Cause","Context","Effect","dual","Layer","Option","EffectTracer","Resource","nanosToHrTime","recordToAttributes","unknownToAttributeValue","OtelSpanTypeId","Symbol","for","kindMap","SpanKind","INTERNAL","CLIENT","SERVER","PRODUCER","CONSUMER","OtelSpan","name","context","links","kind","_tag","span","spanId","traceId","attributes","Map","sampled","parent","status","constructor","contextApi","traceApi","tracer","effectParent","startTime","_options","active","startSpan","length","map","link","makeSpanContext","undefined","populateContext","value","trace","deleteSpan","spanContext","traceFlags","TraceFlags","SAMPLED","attribute","key","setAttribute","set","addLinks","push","end","endTime","exit","hrTime","setStatus","code","SpanStatusCode","OK","isInterruptedOnly","cause","message","pretty","firstError","prettyErrors","stack","renderErrorCause","recordException","ERROR","event","addEvent","TracerProvider","GenericTag","Tracer","make","options","slice","execution","fiber","currentSpan","with","traceFlagsTag","traceStateTag","makeExternalSpan","empty","add","traceState","match","createTraceState","onNone","onSome","currentOtelSpan","flatMap","succeed","fail","NoSuchElementException","layerGlobalProvider","sync","getTracerProvider","layerTracer","effect","zip","resource","provider","getTracer","ATTR_SERVICE_NAME","ATTR_SERVICE_VERSION","layerGlobalTracer","pipe","provide","layerGlobal","unwrapEffect","setTracer","provideMerge","layerWithoutOtelTracer","layer","liftThrowable","otelContext","setSpan","setSpanContext","isRemote","getOrElse","extractTraceTag","getOption","getOrUndefined","tag","orElse","withSpanContext","withParentSpan"],"sources":["../../../src/internal/tracer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}
\ No newline at end of file
diff --git a/package.json b/package.json
index 11c1431c3d4f1b3639afc72ad6e4b4ef95fcefdc..9ad12cf2a59204d8c8476fb579120179bd01611b 100644
--- a/package.json
+++ b/package.json
@@ -19,8 +19,8 @@
     "@opentelemetry/sdk-trace-web": "^2.0.0",
     "@opentelemetry/sdk-logs": "^0.203.0",
     "@opentelemetry/semantic-conventions": "^1.33.0",
-    "@effect/platform": "^0.93.0",
-    "effect": "^3.19.0"
+    "@effect/platform": "workspace:^",
+    "effect": "workspace:^"
   },
   "peerDependenciesMeta": {
     "@opentelemetry/api": {
diff --git a/src/internal/tracer.ts b/src/internal/tracer.ts
index b67ea0303eb640e762d16e3dbe9cfae027c54b18..297043d6a4bc887a867c76aa0a316fb76ca85875 100644
--- a/src/internal/tracer.ts
+++ b/src/internal/tracer.ts
@@ -22,20 +22,20 @@ const kindMap = {
   "consumer": OtelApi.SpanKind.CONSUMER
 }
 
-const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
-  const active = tracer.getSpan(otelContext)
-  const otelParent = active ? active.spanContext() : undefined
-  return otelParent
-    ? Option.some(
-      EffectTracer.externalSpan({
-        spanId: otelParent.spanId,
-        traceId: otelParent.traceId,
-        sampled: (otelParent.traceFlags & 1) === 1,
-        context
-      })
-    )
-    : Option.none()
-}
+// const getOtelParent = (tracer: OtelApi.TraceAPI, otelContext: OtelApi.Context, context: Context.Context<never>) => {
+//   const active = tracer.getSpan(otelContext)
+//   const otelParent = active ? active.spanContext() : undefined
+//   return otelParent
+//     ? Option.some(
+//       EffectTracer.externalSpan({
+//         spanId: otelParent.spanId,
+//         traceId: otelParent.traceId,
+//         sampled: (otelParent.traceFlags & 1) === 1,
+//         context
+//       })
+//     )
+//     : Option.none()
+// }
 
 /** @internal */
 export class OtelSpan implements EffectTracer.Span {
@@ -60,15 +60,17 @@ export class OtelSpan implements EffectTracer.Span {
     readonly links: Array<EffectTracer.SpanLink>,
     startTime: bigint,
     readonly kind: EffectTracer.SpanKind,
-    options?: EffectTracer.SpanOptions
+    _options?: EffectTracer.SpanOptions
   ) {
     this[OtelSpanTypeId] = OtelSpanTypeId
     const active = contextApi.active()
-    this.parent = effectParent._tag === "Some"
-      ? effectParent
-      : (options?.root !== true)
-      ? getOtelParent(traceApi, active, context)
-      : Option.none()
+    // PRO: disabled automatic parent extraction to resolve strange behaviour
+    this.parent = effectParent
+    // this.parent = effectParent._tag === "Some"
+    //   ? effectParent
+    //   : (options?.root !== true)
+    //   ? getOtelParent(traceApi, active, context)
+    //   : Option.none()
     this.span = tracer.startSpan(
       name,
       {
